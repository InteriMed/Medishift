{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null",
    "users": {
      "$userId": {
        ".read": "$userId === auth.uid || root.child('users').child(auth.uid).child('roles').hasChild('super_admin') || root.child('users').child(auth.uid).child('roles').hasChild('admin')",
        ".write": "$userId === auth.uid || root.child('users').child(auth.uid).child('roles').hasChild('super_admin') || root.child('users').child(auth.uid).child('roles').hasChild('admin')"
      }
    },
    "workers": {
      "$userId": {
        ".read": true,
        ".write": "$userId === auth.uid"
      }
    },
    "companies": {
      "$companyId": {
        ".read": true,
        ".write": "$companyId === auth.uid"
      }
    },
    "availability": {
      "$availabilityId": {
        ".read": true,
        ".write": "auth != null && (data.child('userId').val() === auth.uid || newData.child('userId').val() === auth.uid)"
      }
    },
    "contracts": {
      "$contractId": {
        ".read": "auth != null && (data.child('parties').child('professional').child('profileId').val() === auth.uid || data.child('parties').child('employer').child('profileId').val() === auth.uid || data.child('workerID').val() === auth.uid || data.child('companyID').val() === auth.uid)",
        ".write": "auth != null && (data.child('parties').child('professional').child('profileId').val() === auth.uid || data.child('parties').child('employer').child('profileId').val() === auth.uid || data.child('workerID').val() === auth.uid || data.child('companyID').val() === auth.uid)"
      }
    },
    "conversations": {
      "$conversationId": {
        ".read": "auth != null && (data.child('participantIds').hasChild(auth.uid) || data.child('participants').hasChild(auth.uid))",
        ".write": "auth != null && (data.child('participantIds').hasChild(auth.uid) || data.child('participants').hasChild(auth.uid))",
        "messages": {
          "$messageId": {
            ".read": "auth != null && (root.child('conversations').child($conversationId).child('participantIds').hasChild(auth.uid) || root.child('conversations').child($conversationId).child('participants').hasChild(auth.uid))",
            ".write": "auth != null && (root.child('conversations').child($conversationId).child('participantIds').hasChild(auth.uid) || root.child('conversations').child($conversationId).child('participants').hasChild(auth.uid)) && (data.child('senderId').val() === auth.uid || newData.child('senderId').val() === auth.uid)"
          }
        }
      }
    },
    "notifications": {
      "$notificationId": {
        ".read": "auth != null && data.child('userId').val() === auth.uid",
        ".write": "auth != null && data.child('userId').val() === auth.uid"
      }
    },
    "positions": {
      "$positionId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('postedByUserId').val() === auth.uid || newData.child('postedByUserId').val() === auth.uid)",
        "applications": {
          "$applicationId": {
            ".read": "auth != null",
            ".write": "auth != null && (data.child('userId').val() === auth.uid || newData.child('userId').val() === auth.uid)"
          }
        }
      }
    },
    "calendar_events": {
      "$eventId": {
        ".read": "auth != null && data.child('userId').val() === auth.uid",
        ".write": "auth != null && data.child('userId').val() === auth.uid"
      }
    },
    "professionalProfiles": {
      "$userId": {
        ".read": "$userId === auth.uid || root.child('users').child(auth.uid).child('roles').hasChild('super_admin') || root.child('users').child(auth.uid).child('roles').hasChild('admin')",
        ".write": "$userId === auth.uid || root.child('users').child(auth.uid).child('roles').hasChild('super_admin') || root.child('users').child(auth.uid).child('roles').hasChild('admin')"
      }
    },
    "facilityProfiles": {
      "$facilityId": {
        ".read": "$facilityId === auth.uid || root.child('users').child(auth.uid).child('roles').hasChild('super_admin') || root.child('users').child(auth.uid).child('roles').hasChild('admin')",
        ".write": "$facilityId === auth.uid || root.child('users').child(auth.uid).child('roles').hasChild('super_admin') || root.child('users').child(auth.uid).child('roles').hasChild('admin')"
      }
    },
    "organizations": {
      "$organizationId": {
        ".read": "auth != null && (data.child('admins').hasChild(auth.uid) || root.child('facilityProfiles').child(auth.uid).child('organizationId').val() === $organizationId)",
        ".write": "auth != null && data.child('admins').hasChild(auth.uid)"
      }
    },
    "shifts": {
      "$shiftId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('assignedUserId').val() === auth.uid || data.child('facilityId').val() === auth.uid || root.child('facilityProfiles').child(data.child('facilityId').val()).child('admins').hasChild(auth.uid))"
      }
    },
    "leaves": {
      "$leaveId": {
        ".read": "auth != null && (data.child('userId').val() === auth.uid || root.child('facilityProfiles').child(data.child('facilityId').val()).child('admins').hasChild(auth.uid))",
        ".write": "auth != null && (data.child('userId').val() === auth.uid || root.child('facilityProfiles').child(data.child('facilityId').val()).child('admins').hasChild(auth.uid))"
      }
    },
    "staffing_requirements": {
      "$requirementId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('facilityId').val() === auth.uid || root.child('facilityProfiles').child(data.child('facilityId').val()).child('admins').hasChild(auth.uid))"
      }
    },
    "payroll_requests": {
      "$requestId": {
        ".read": "auth != null && (data.child('pharmacyUid').val() === auth.uid || data.child('workerUid').val() === auth.uid)",
        ".write": "auth != null && data.child('pharmacyUid').val() === auth.uid"
      }
    },
    "tutorials": {
      "$document": {
        ".read": "auth != null",
        ".write": "auth != null"
      }
    },
    "userSettings": {
      "$userId": {
        ".read": "auth != null && $userId === auth.uid",
        ".write": "auth != null && $userId === auth.uid"
      }
    },
    "professionalAvailabilities": {
      "$availabilityId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('userId').val() === auth.uid || newData.child('userId').val() === auth.uid)"
      }
    },
    "cached_document_data": {
      "$userId": {
        ".read": "auth != null && $userId === auth.uid",
        ".write": "auth != null && $userId === auth.uid"
      }
    },
    "extractedDataCache": {
      "$userId": {
        ".read": "auth != null && $userId === auth.uid",
        ".write": "auth != null && $userId === auth.uid"
      }
    },
    "client_errors": {
      "$errorId": {
        ".read": false,
        ".write": "auth != null"
      }
    },
    "audit_logs": {
      "$logId": {
        ".read": "auth != null && data.child('userId').val() === auth.uid",
        ".write": false
      }
    },
    "cross_facility_reports": {
      "$reportId": {
        ".read": "auth != null && (data.child('requestingFacilityId').val() === auth.uid || data.child('providingFacilityId').val() === auth.uid)",
        ".write": false
      }
    }
  }
}

