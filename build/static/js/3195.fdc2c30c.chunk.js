"use strict";(self.webpackChunkmedishift_deployment_server=self.webpackChunkmedishift_deployment_server||[]).push([[3195],{3195(e,s,l){l.r(s),l.d(s,{default:()=>u});var t=l(2483),r=l(7958),a=l(7186),d=l(2206),i=l(2504),o=l(6935),n=l(2598),c=l(5892),m=l(6723);const x={pending:{color:"bg-transparent text-yellow-700 border-yellow-700",icon:n.Ohp,label:"Pending"},sent:{color:"bg-transparent text-blue-700 border-blue-700",icon:n.kGk,label:"Sent to PayrollPlus"},confirmed:{color:"bg-transparent text-green-700 border-green-700",icon:n.A3x,label:"Confirmed"},paid:{color:"bg-transparent text-emerald-700 border-emerald-700",icon:n.A3x,label:"Paid"},failed:{color:"bg-transparent text-red-700 border-red-700",icon:n.y3G,label:"Failed"}},u=()=>{const{t:e}=(0,r.Bd)(["payroll","common"]),{currentUser:s}=(0,i.A)(),{showNotification:l}=(0,o.h)(),[u,p]=(0,t.useState)([]),[h,f]=(0,t.useState)(!0),[b,j]=(0,t.useState)(null),[v,y]=(0,t.useState)("all"),[g,N]=(0,t.useState)({total:0,pending:0,sent:0,confirmed:0,totalAmount:0}),w=(0,t.useCallback)(async()=>{if(s){f(!0);try{const e=(0,a.Qg)(d.functions,"getPayrollRequests"),s=await e({status:"all"===v?null:v,limit:100});if(s.data.success){const e=s.data.requests||[];p(e);const l=e.reduce((e,s)=>{var l;return e.total++,e[s.status]=(e[s.status]||0)+1,e.totalAmount+=(null===(l=s.financials)||void 0===l?void 0:l.totalCost)||0,e},{total:0,pending:0,sent:0,confirmed:0,paid:0,totalAmount:0});N(l)}}catch(t){console.error("Error fetching payroll requests:",t),l(e("payroll:errors.fetchFailed","Failed to load payroll requests"),"error")}finally{f(!1)}}},[s,v,l,e]);(0,t.useEffect)(()=>{w()},[w]);const k=e=>new Intl.NumberFormat("de-CH",{style:"currency",currency:"CHF"}).format(e||0),P=e=>{if(!e)return"N/A";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("de-CH",{day:"2-digit",month:"2-digit",year:"numeric"})},C=s=>{let{status:l}=s;const t=x[l]||x.pending,r=t.icon;return(0,m.jsxs)("span",{className:(0,c.cn)("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border",t.color),children:[(0,m.jsx)(r,{className:"w-3.5 h-3.5"}),e("payroll:status.".concat(l),t.label)]})},D=e=>{let{icon:s,label:l,value:t,subValue:r,className:a}=e;return(0,m.jsx)("div",{className:(0,c.cn)("bg-card rounded-xl border border-border p-5 shadow-sm",a),children:(0,m.jsxs)("div",{className:"flex items-center gap-3",children:[(0,m.jsx)("div",{className:"p-2.5 rounded-lg bg-primary/10 text-primary",children:(0,m.jsx)(s,{className:"w-5 h-5"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm text-muted-foreground",children:l}),(0,m.jsx)("p",{className:"text-2xl font-bold text-foreground",children:t}),r&&(0,m.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:r})]})]})})},A=s=>{var l,t,r,a,d,i,o,n;let{request:c}=s;return(0,m.jsxs)("tr",{className:"border-b border-border hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>j(c),children:[(0,m.jsxs)("td",{className:"px-4 py-3",children:[(0,m.jsx)("div",{className:"font-medium text-foreground",children:(null===(l=c.workerProfile)||void 0===l?void 0:l.fullName)||e("payroll:placeholders.unknown")}),(0,m.jsx)("div",{className:"text-xs text-muted-foreground",children:(null===(t=c.shiftDetails)||void 0===t?void 0:t.role)||e("payroll:placeholders.pharmacist")})]}),(0,m.jsxs)("td",{className:"px-4 py-3",children:[(0,m.jsx)("div",{className:"text-sm",children:P(null===(r=c.shiftDetails)||void 0===r?void 0:r.date)}),(0,m.jsxs)("div",{className:"text-xs text-muted-foreground",children:[null===(a=c.shiftDetails)||void 0===a?void 0:a.startTime," - ",null===(d=c.shiftDetails)||void 0===d?void 0:d.endTime]})]}),(0,m.jsx)("td",{className:"px-4 py-3",children:(0,m.jsxs)("div",{className:"text-sm font-medium",children:[(null===(i=c.shiftDetails)||void 0===i?void 0:i.duration)||0,"h"]})}),(0,m.jsxs)("td",{className:"px-4 py-3",children:[(0,m.jsx)("div",{className:"text-sm font-medium text-foreground",children:k(null===(o=c.financials)||void 0===o?void 0:o.totalCost)}),(null===(n=c.financials)||void 0===n?void 0:n.isPilot)&&(0,m.jsx)("div",{className:"text-xs text-green-600",children:e("payroll:details.suffixes.pilotFee")})]}),(0,m.jsx)("td",{className:"px-4 py-3",children:(0,m.jsx)(C,{status:c.status})}),(0,m.jsx)("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:P(c.createdAt)})]})},S=s=>{var l,t,r,a,d,i,o,c,x,u,p,h,f,b,j,v,y;let{request:g,onClose:N}=s;return g?(0,m.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,m.jsxs)("div",{className:"bg-card rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[(0,m.jsxs)("div",{className:"p-6 border-b border-border",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("h3",{className:"text-xl font-semibold text-foreground",children:e("payroll:details.title","Payroll Request Details")}),(0,m.jsx)("button",{onClick:N,className:"p-2 hover:bg-muted rounded-lg transition-colors",children:"\u2715"})]}),(0,m.jsx)("div",{className:"mt-2",children:(0,m.jsx)(C,{status:g.status})})]}),(0,m.jsxs)("div",{className:"p-6 space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:e("payroll:details.worker","Worker")}),(0,m.jsxs)("div",{className:"bg-muted/30 rounded-lg p-4",children:[(0,m.jsx)("p",{className:"font-medium",children:null===(l=g.workerProfile)||void 0===l?void 0:l.fullName}),(0,m.jsx)("p",{className:"text-sm text-muted-foreground",children:null===(t=g.workerProfile)||void 0===t?void 0:t.email}),(null===(r=g.workerProfile)||void 0===r?void 0:r.glnNumber)&&(0,m.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["GLN: ",g.workerProfile.glnNumber]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:e("payroll:details.shift","Shift Details")}),(0,m.jsxs)("div",{className:"bg-muted/30 rounded-lg p-4 space-y-2",children:[(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.date"),":"]}),(0,m.jsx)("span",{children:P(null===(a=g.shiftDetails)||void 0===a?void 0:a.date)})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.time"),":"]}),(0,m.jsxs)("span",{children:[null===(d=g.shiftDetails)||void 0===d?void 0:d.startTime," - ",null===(i=g.shiftDetails)||void 0===i?void 0:i.endTime]})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.duration"),":"]}),(0,m.jsxs)("span",{children:[null===(o=g.shiftDetails)||void 0===o?void 0:o.duration," ",e("payroll:details.suffixes.hours")]})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.role"),":"]}),(0,m.jsx)("span",{children:null===(c=g.shiftDetails)||void 0===c?void 0:c.role})]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:e("payroll:details.financials","Financials")}),(0,m.jsxs)("div",{className:"bg-muted/30 rounded-lg p-4 space-y-2",children:[(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.hourlyRate"),":"]}),(0,m.jsxs)("span",{children:[k(null===(x=g.financials)||void 0===x?void 0:x.hourlyRate),e("payroll:details.suffixes.perHour")]})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.workerGrossPay"),":"]}),(0,m.jsx)("span",{children:k(null===(u=g.financials)||void 0===u?void 0:u.workerGrossPay)})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsxs)("span",{className:"text-muted-foreground",children:[e("payroll:details.labels.commission")," (",null===(p=g.financials)||void 0===p?void 0:p.markup,"%):"]}),(0,m.jsx)("span",{children:k(null===(h=g.financials)||void 0===h?void 0:h.commission)})]}),(0,m.jsxs)("div",{className:"flex justify-between pt-2 border-t border-border font-semibold",children:[(0,m.jsxs)("span",{children:[e("payroll:details.labels.totalCost"),":"]}),(0,m.jsx)("span",{className:"text-primary",children:k(null===(f=g.financials)||void 0===f?void 0:f.totalCost)})]}),(null===(b=g.financials)||void 0===b?void 0:b.isPilot)&&(0,m.jsxs)("div",{className:"text-center text-sm text-green-600 pt-2",children:["\u2728 ",null===(j=g.financials)||void 0===j?void 0:j.message]})]})]}),(null===(v=g.payrollData)||void 0===v?void 0:v.emailSentAt)&&(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:e("payroll:details.payrollplus","PayrollPlus Status")}),(0,m.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,m.jsxs)("p",{className:"text-sm text-green-800",children:[e("payroll:details.labels.emailSent")," ",P(g.payrollData.emailSentAt)]})})]}),(null===(y=g.payrollData)||void 0===y?void 0:y.error)&&(0,m.jsxs)("div",{className:"relative overflow-hidden p-5 bg-white border-2 border-[var(--red-2)] rounded-xl shadow-lg flex gap-4 text-[var(--red-4)] animate-in fade-in slide-in-from-bottom-2",style:{boxShadow:"var(--shadow-elevated)"},children:[(0,m.jsx)("div",{className:"flex-shrink-0",children:(0,m.jsx)("div",{className:"w-10 h-10 rounded-full bg-[var(--red-2)]/20 flex items-center justify-center border-2 border-[var(--red-2)]",children:(0,m.jsx)(n.y3G,{className:"w-5 h-5 text-[var(--red-4)]"})})}),(0,m.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,m.jsx)("h4",{className:"font-bold text-sm mb-1 text-[var(--red-4)]",children:e("payroll:details.labels.error")}),(0,m.jsx)("p",{className:"text-sm leading-relaxed text-[var(--red-4)]/90",children:g.payrollData.error})]})]})]}),(0,m.jsx)("div",{className:"p-6 border-t border-border",children:(0,m.jsx)("button",{onClick:N,className:"w-full py-2.5 px-4 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors",children:e("common:close","Close")})})]})}):null},q=()=>(0,m.jsxs)("div",{className:"text-center py-16",children:[(0,m.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:(0,m.jsx)(n.jH2,{className:"w-8 h-8 text-muted-foreground"})}),(0,m.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:e("payroll:empty.title","No payroll requests yet")}),(0,m.jsx)("p",{className:"text-muted-foreground max-w-sm mx-auto",children:e("payroll:empty.description","When you confirm shifts with workers, payroll requests will appear here.")})]});return(0,m.jsxs)("div",{className:"h-full flex flex-col overflow-hidden animate-in fade-in duration-500",children:[(0,m.jsx)("div",{className:"shrink-0 p-6 border-b border-border bg-card/50",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:e("payroll:title","Payroll Management")}),(0,m.jsx)("p",{className:"text-muted-foreground mt-1",children:e("payroll:subtitle","Track and manage staff payment requests")})]}),(0,m.jsxs)("button",{onClick:w,disabled:h,className:(0,c.cn)("flex items-center gap-2 px-4 py-2 rounded-lg border border-border","hover:bg-muted transition-colors",h&&"opacity-50 cursor-not-allowed"),children:[(0,m.jsx)(n.jTZ,{className:(0,c.cn)("w-4 h-4",h&&"animate-spin")}),e("common:refresh","Refresh")]})]})}),(0,m.jsx)("div",{className:"shrink-0 p-6",children:(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,m.jsx)(D,{icon:n.jH2,label:e("payroll:stats.total","Total Requests"),value:g.total}),(0,m.jsx)(D,{icon:n.Ohp,label:e("payroll:stats.pending","Pending"),value:g.pending||0}),(0,m.jsx)(D,{icon:n.kGk,label:e("payroll:stats.sent","Sent to PayrollPlus"),value:g.sent||0}),(0,m.jsx)(D,{icon:n.z8N,label:e("payroll:stats.totalAmount","Total Amount"),value:k(g.totalAmount),subValue:e("payroll:stats.allTime","All time")})]})}),(0,m.jsx)("div",{className:"shrink-0 px-6",children:(0,m.jsx)("div",{className:"flex gap-2 border-b border-border",children:["all","pending","sent","confirmed","paid"].map(s=>(0,m.jsxs)("button",{onClick:()=>y(s),className:(0,c.cn)("px-4 py-2 text-sm font-medium border-b-2 transition-colors",v===s?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"),children:[e("payroll:filter.".concat(s),s.charAt(0).toUpperCase()+s.slice(1)),"all"!==s&&g[s]>0&&(0,m.jsx)("span",{className:"ml-1.5 px-1.5 py-0.5 text-xs rounded-full bg-muted",children:g[s]})]},s))})}),(0,m.jsx)("div",{className:"flex-1 overflow-auto p-6",children:h?(0,m.jsx)("div",{className:"flex items-center justify-center py-16",children:(0,m.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}):0===u.length?(0,m.jsx)(q,{}):(0,m.jsx)("div",{className:"bg-card rounded-xl border border-border overflow-hidden",children:(0,m.jsxs)("table",{className:"w-full",children:[(0,m.jsx)("thead",{className:"bg-muted/30",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase",children:e("payroll:table.worker","Worker")}),(0,m.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase",children:e("payroll:table.shift","Shift")}),(0,m.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase",children:e("payroll:table.hours","Hours")}),(0,m.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase",children:e("payroll:table.amount","Amount")}),(0,m.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase",children:e("payroll:table.status","Status")}),(0,m.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase",children:e("payroll:table.created","Created")})]})}),(0,m.jsx)("tbody",{children:u.map(e=>(0,m.jsx)(A,{request:e},e.id))})]})})}),b&&(0,m.jsx)(S,{request:b,onClose:()=>j(null)}),(0,m.jsx)("div",{className:"shrink-0 px-6 pb-6",children:(0,m.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4",children:(0,m.jsxs)("div",{className:"flex items-center gap-3",children:[(0,m.jsx)("div",{className:"p-2 rounded-full bg-green-100",children:(0,m.jsx)("span",{className:"text-xl",children:"\ud83c\udf89"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h4",{className:"font-medium text-green-800",children:e("payroll:pilot.title","Pilot Program Active")}),(0,m.jsx)("p",{className:"text-sm text-green-700",children:e("payroll:pilot.description","You're currently enjoying 0% platform fees until February 28, 2025!")})]})]})})})]})}}}]);
//# sourceMappingURL=3195.fdc2c30c.chunk.js.map