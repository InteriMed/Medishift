"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[358],{3358:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var o=n(9379),r=n(5043),a=n(4117);const s=[{id:"blue",color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb",name:"Personal"},{id:"red",color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",name:"Missing employees"},{id:"purple",color:"#6c6ce7",color1:"#e6e6ff",color2:"#a08dfc",name:"Waiting for confirmation"},{id:"green",color:"#0da71c",color1:"#ccffce",color2:"#32cb65",name:"Approved employee"},{id:"grey",color:"#8c8c8c",color1:"#e6e6e6",color2:"#b3b3b3",name:"Unvalidated"}],i={MOVE:"move",RESIZE:"resize",PANEL:"panel"},l=e=>{const t=e.getDay();return 0===t?6:t-1},c=e=>{const t=new Date(e),n=l(t);t.setDate(t.getDate()-n);const o=[];for(let r=0;r<7;r++){const e=new Date(t);e.setDate(t.getDate()+r),o.push(e)}return o},d=e=>{const t=new Date(2e3,0,3);return Array.from({length:7},(n,o)=>{const r=new Date(t);r.setDate(t.getDate()+o);const a=r.toLocaleString(e,{weekday:"short"}).slice(0,3);return a.charAt(0).toUpperCase()+a.slice(1)})},u=(e,t)=>{if(!e||!t)return!1;const n=e instanceof Date?e:new Date(e),o=t instanceof Date?t:new Date(t);return n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()&&n.getDate()===o.getDate()},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;const o=[],r=new Date(e);r.setDate(r.getDate()-t);const a=t+1+n;for(let s=0;s<a;s++){const e=new Date(r);e.setDate(r.getDate()+s),o.push(e)}return o},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const o=[],r=new Date(e),a=l(r);r.setDate(r.getDate()-a);const s=new Date(r);s.setDate(s.getDate()-7*t);const i=t+1+n;for(let l=0;l<i;l++){const e=new Date(s);e.setDate(s.getDate()+7*l);const t=[];for(let n=0;n<7;n++){const o=new Date(e);o.setDate(e.getDate()+n),t.push(o)}o.push(t)}return o};var f=n(5200),h=n(4764),v=n(579);const p=e=>{let{currentDate:t,view:n,setView:o,navigateDate:s,setCurrentDate:i,categories:l,handleCategoryToggle:c,onResetCategories:d,isTopBarMode:u=!1,onShowFiltersOverlay:g,scrollContainerRef:m,isSidebarCollapsed:p,toggleSidebar:x}=e;const{t:b}=(0,a.Bd)(),[y,w]=(0,r.useState)(!1),D=(0,r.useRef)(null);(0,r.useEffect)(()=>{const e=e=>{D.current&&!D.current.contains(e.target)&&w(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const k=l.filter(e=>e.checked).length,j=k<l.length;return(0,v.jsxs)("div",{className:(0,h.cn)("flex flex-col md:flex-row items-center justify-between gap-4 w-full",u&&"h-full"),children:[(0,v.jsxs)("div",{className:"flex items-center gap-3",children:[(0,v.jsx)("button",{className:(0,h.cn)("flex items-center gap-2 px-3 h-9 text-sm font-medium rounded-lg transition-all border","bg-background border-border text-muted-foreground hover:text-foreground"),onClick:()=>{const e=new Date;i(e)},title:b("calendar:today"),children:b("calendar:today")}),(0,v.jsx)("div",{className:"h-6 w-px bg-border/50 hidden md:block"}),(0,v.jsxs)("div",{className:"flex items-center h-10 px-0.5 py-0.5 bg-muted/50 rounded-lg border border-border/50",children:[(0,v.jsx)("button",{className:(0,h.cn)("px-3 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0","day"===n?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),style:{height:"36px",maxHeight:"36px",minHeight:"36px"},onClick:()=>{o("day")},children:b("calendar:dayView")}),(0,v.jsx)("button",{className:(0,h.cn)("px-3 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0","week"===n?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),style:{height:"36px",maxHeight:"36px",minHeight:"36px"},onClick:()=>o("week"),children:b("calendar:weekView")})]})]}),(0,v.jsxs)("div",{className:"flex items-center gap-2",children:[(0,v.jsxs)("div",{className:"relative",ref:D,children:[(0,v.jsxs)("button",{className:(0,h.cn)("flex items-center gap-2 px-3 h-9 text-sm font-medium rounded-lg transition-all border",y?"bg-secondary border-border/60 text-foreground":"bg-background border-border text-muted-foreground hover:text-foreground"),onClick:()=>w(!y),title:b("calendar:filterCategories"),children:[(0,v.jsx)(f.K7R,{className:"w-3.5 h-3.5"}),j&&(0,v.jsx)("span",{className:"flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[10px] text-primary-foreground font-bold",children:k})]}),y&&(0,v.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-64 bg-card rounded-lg shadow-xl border border-border p-2 z-30 animate-in fade-in zoom-in-95 duration-200",children:[(0,v.jsxs)("div",{className:"px-3 py-2 border-b border-border/50 mb-2 flex justify-between items-center",children:[(0,v.jsx)("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:b("calendar:categories")}),j&&(0,v.jsx)("button",{onClick:d,className:"text-[10px] text-primary hover:underline",children:b("calendar:reset")})]}),(0,v.jsx)("div",{className:"space-y-1 max-h-[300px] overflow-y-auto",children:l.map((e,t)=>(0,v.jsxs)("label",{className:"flex items-center gap-3 px-3 py-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors group",children:[(0,v.jsxs)("div",{className:"relative flex items-center",children:[(0,v.jsx)("input",{type:"checkbox",checked:e.checked,onChange:()=>c(t),className:"peer h-4 w-4 rounded border text-primary focus:ring-1 focus:ring-primary/20 cursor-pointer transition-all appearance-none bg-background",style:{backgroundColor:e.checked?e.color:"transparent",borderColor:e.color,borderWidth:"1px"}}),(0,v.jsx)("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]}),(0,v.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,v.jsx)("span",{className:"text-xs font-medium text-foreground",children:e.name})})]},t))})]})]}),(0,v.jsx)("button",{onClick:d,className:(0,h.cn)("h-9 w-9 flex items-center justify-center rounded-lg border border-border hover:bg-muted text-muted-foreground transition-all",!j&&"opacity-50 cursor-not-allowed hover:bg-transparent"),disabled:!j,title:b("calendar:resetAll"),children:(0,v.jsx)(f.yGN,{className:"w-3.5 h-3.5"})})]})]})},x=e=>{let{currentDate:t,onDateClick:n,events:o=[],view:s="week",visibleWeekStart:i,visibleWeekEnd:l}=e;const{t:g,i18n:m}=(0,a.Bd)(),[p,x]=(0,r.useState)(new Date(t)),[b,y]=(0,r.useState)([]),[w,D]=(0,r.useState)(!1),[k,j]=(0,r.useState)(!1),N=(0,r.useRef)(null),C=(0,r.useRef)(null),E=d(m.language);(0,r.useEffect)(()=>{const e=document.createElement("style");return e.textContent="\n      .minicalendar-selected-day:hover {\n        background-color: var(--color-logo-2) !important;\n        color: white !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,r.useEffect)(()=>{const e=new Date(t);x(t=>{const n=t.getMonth(),o=t.getFullYear(),r=e.getMonth(),a=e.getFullYear();return n!==r||o!==a?e:t})},[t]),(0,r.useEffect)(()=>{const e=p.getFullYear(),t=p.getMonth(),n=new Date(e,t,1),o=0===n.getDay()?6:n.getDay()-1,r=new Date(e,t+1,0).getDate(),a=[];if(o>0){const n=new Date(e,t,0).getDate();for(let r=n-o+1;r<=n;r++)a.push({date:new Date(e,t-1,r),isCurrentMonth:!1})}const s=[];for(let c=1;c<=r;c++)s.push({date:new Date(e,t,c),isCurrentMonth:!0});const i=[],l=42-(a.length+s.length);for(let c=1;c<=l;c++)i.push({date:new Date(e,t+1,c),isCurrentMonth:!1});y([...a,...s,...i])},[p]),(0,r.useEffect)(()=>{const e=e=>{N.current&&!N.current.contains(e.target)&&D(!1),C.current&&!C.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const S=e=>{const t=new Date(p);t.setMonth(t.getMonth()+e),x(t)},A=Array.from({length:12},(e,t)=>({value:t,label:new Date(2024,t,1).toLocaleString(m.language,{month:"long"})})),T=(new Date).getFullYear(),R=Array.from({length:21},(e,t)=>{const n=T-10+t;return{value:n,label:n.toString()}});return(0,v.jsxs)("div",{className:"w-full bg-card rounded-xl border border-border/60 p-4 select-none",children:[(0,v.jsxs)("div",{className:"flex items-center justify-between mb-0 px-1",children:[(0,v.jsxs)("div",{className:"flex items-center gap-1.5 text-sm font-semibold text-foreground",children:[(0,v.jsxs)("div",{className:"relative group cursor-pointer hover:bg-muted/50 px-2.5 py-1.5 rounded-lg transition-colors",onClick:()=>{D(!w),j(!1)},ref:N,children:[(0,v.jsx)("span",{className:"capitalize",children:p.toLocaleString(m.language,{month:"long"})}),w&&(0,v.jsx)("div",{className:"absolute top-full left-0 mt-1 w-36 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto z-30 py-1",children:A.map(e=>(0,v.jsxs)("div",{className:(0,h.cn)("px-3 py-2 hover:bg-muted text-sm cursor-pointer flex justify-between items-center",p.getMonth()===e.value&&"bg-primary/10 text-primary font-medium"),onClick:t=>{t.stopPropagation(),(e=>{const t=new Date(p);t.setMonth(e),x(t),D(!1)})(e.value)},children:[e.label,p.getMonth()===e.value&&(0,v.jsx)(f.YrT,{size:14})]},e.value))})]}),(0,v.jsxs)("div",{className:"relative group cursor-pointer hover:bg-muted/50 px-2.5 py-1.5 rounded-lg transition-colors",onClick:()=>{j(!k),D(!1)},ref:C,children:[(0,v.jsx)("span",{children:p.getFullYear().toString()}),k&&(0,v.jsx)("div",{className:"absolute top-full left-0 mt-1 w-24 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto z-30 py-1",children:R.map(e=>(0,v.jsxs)("div",{className:(0,h.cn)("px-3 py-2 hover:bg-muted text-sm cursor-pointer flex justify-between items-center",p.getFullYear()===e.value&&"bg-primary/10 text-primary font-medium"),onClick:t=>{t.stopPropagation(),(e=>{const t=new Date(p);t.setFullYear(e),x(t),j(!1)})(e.value)},children:[e.label,p.getFullYear()===e.value&&(0,v.jsx)(f.YrT,{size:14})]},e.value))})]})]}),(0,v.jsxs)("div",{className:"flex items-center gap-1",children:[(0,v.jsx)("button",{className:"p-1.5 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground transition-colors",onClick:()=>S(-1),children:(0,v.jsx)(f.irw,{size:16})}),(0,v.jsx)("button",{className:"p-1.5 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground transition-colors",onClick:()=>S(1),children:(0,v.jsx)(f.fOo,{size:16})})]})]}),(0,v.jsx)("div",{className:"grid grid-cols-7 mb-2.5 text-center",children:E.map((e,t)=>(0,v.jsx)("div",{className:"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider py-1.5",children:e.substr(0,1)},t))}),(0,v.jsx)("div",{className:"grid grid-cols-7 gap-y-2",children:b.map((e,r)=>{const{date:a,isCurrentMonth:d}=e,g=u(a,t),m="week"===s&&(e=>{if("week"!==s)return!1;if(i&&l){const t=new Date(e);t.setHours(12,0,0,0);const n=new Date(i);n.setHours(0,0,0,0);const o=new Date(l);return o.setHours(23,59,59,999),t>=n&&t<=o}const n=c(t),o=new Date(n[0]);o.setHours(0,0,0,0);const r=new Date(n[6]);r.setHours(23,59,59,999);const a=new Date(e);return a.setHours(0,0,0,0),a>=o&&a<=r})(a),f=g||m,p=r%7===0,x=r%7===6,b=(e=>o.filter(t=>{const n=new Date(t.start);return u(n,e)}))(a);return(0,v.jsxs)("div",{onClick:()=>(e=>{n&&n(e)})(a),className:(0,h.cn)("relative flex items-center justify-center text-sm cursor-pointer transition-all h-9",f?"w-full":"w-9 mx-auto rounded-lg",f&&"week"===s?(0,h.cn)(p&&"rounded-l-lg",x&&"rounded-r-lg"):"rounded-lg",d||f?f?"text-foreground font-bold":"text-foreground":"text-muted-foreground/30",!f&&"hover:bg-muted/50"),style:f?{backgroundColor:"color-mix(in srgb, var(--color-logo-1), transparent 85%)"}:{},children:[(0,v.jsx)("span",{className:"z-10 relative",children:a.getDate()}),b.length>0&&(0,v.jsx)("div",{className:"absolute bottom-0 flex gap-0.5 justify-center",children:b.length>3?(0,v.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-primary/70"}):b.slice(0,3).map((e,t)=>(0,v.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-primary/60"},t))})]},r)})})]})},b=e=>{let{currentDate:t,setCurrentDate:n,handleDayClick:o,events:r,handleUpcomingEventClick:s,isSidebarCollapsed:i,toggleSidebar:l,view:c,visibleWeekStart:d,visibleWeekEnd:u}=e;const{t:g}=(0,a.Bd)();if(i)return null;const m="undefined"!==typeof window&&window.innerWidth<768;return(0,v.jsxs)("div",{className:(0,h.cn)("h-full flex flex-col overflow-y-auto custom-scrollbar",m?"gap-0":"gap-4"),style:{scrollbarGutter:"stable"},children:[(0,v.jsx)("div",{className:m?"mb-0":"",children:(0,v.jsx)(x,{currentDate:t,onDateClick:o,events:r,view:c,visibleWeekStart:d,visibleWeekEnd:u})}),(0,v.jsxs)("div",{className:(0,h.cn)("flex-1 flex flex-col min-h-0 bg-card border p-0 overflow-hidden shadow-sm",m?"rounded-none border-x-0 border-b-0 border-t":"rounded-xl border-border/60"),children:[(0,v.jsx)("div",{className:"flex items-center justify-center px-4 pt-4 pb-2 border-b border-border/50 bg-muted/20",children:(0,v.jsxs)("h4",{className:"text-sm font-semibold text-foreground flex items-center gap-2 m-0",children:[(0,v.jsx)(f.wIk,{className:"w-4 h-4 text-primary"}),g("calendar:upcomingEvents")]})}),(0,v.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2",style:{scrollbarGutter:"stable"},children:r&&r.length>0?(0,v.jsx)("div",{className:"space-y-1",children:r.filter(e=>new Date(e.start)>new Date).sort((e,t)=>new Date(e.start)-new Date(t.start)).slice(0,5).map((e,t)=>(0,v.jsxs)("div",{className:"group flex gap-3 p-3 rounded-lg hover:bg-muted/50 transition-all duration-200 cursor-pointer border border-transparent hover:border-border/50",onClick:()=>s(e.start),children:[(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center w-12 h-12 rounded-lg bg-primary/5 border border-primary/10 shrink-0 group-hover:bg-primary/10 transition-colors",children:[(0,v.jsx)("span",{className:"text-[10px] uppercase font-bold text-primary/70",children:new Date(e.start).toLocaleDateString(void 0,{month:"short"})}),(0,v.jsx)("span",{className:"text-xl font-bold text-primary leading-none mt-0.5",children:new Date(e.start).getDate()})]}),(0,v.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[(0,v.jsx)("h5",{className:"text-sm font-medium text-foreground truncate",children:e.title||g("calendar:untitledEvent")}),(0,v.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-muted-foreground",children:[(0,v.jsxs)("span",{className:"flex items-center gap-1",style:{fontSize:"var(--font-size-small)"},children:[(0,v.jsx)(f.Ohp,{className:"w-3 h-3"}),(0,v.jsxs)("span",{style:{fontSize:"var(--font-size-small)"},children:[new Date(e.start).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})," - ",new Date(e.end).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})]})]}),e.location&&(0,v.jsxs)("span",{className:"flex items-center gap-1 truncate",children:[(0,v.jsx)(f.HzC,{className:"w-3 h-3"}),(0,v.jsx)("span",{className:"truncate max-w-[100px]",children:e.location})]})]})]}),(0,v.jsx)("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 duration-200",children:(0,v.jsx)(f.fOo,{className:"w-4 h-4 text-muted-foreground"})})]},t))}):(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center h-40 text-center text-muted-foreground",children:[(0,v.jsx)("div",{className:"w-10 h-10 rounded-full bg-muted/50 flex items-center justify-center mb-3",children:(0,v.jsx)(f.wIk,{className:"w-5 h-5 opacity-40"})}),(0,v.jsx)("p",{className:"text-sm font-medium",children:g("calendar:noUpcomingEvents")}),(0,v.jsx)("p",{className:"text-xs opacity-60 mt-1",children:g("calendar:checkBackLater")})]})})]})]})},y=e=>{let{currentDate:t,referenceDate:n,view:o,handleDayClick:r,scrollContainerRef:s,numWeeks:i=7,numDays:l=30}=e;const{t:c,i18n:f}=(0,a.Bd)(),h=new Date,p=n||t;let x;if("day"===o){x=g(p,0,0)}else{const e=m(p,i,i);x=e.flat()}const b=d(f.language);return(0,v.jsx)("div",{className:"flex py-2",style:{width:"".concat("day"===o?100*x.length:x.length*(100/7),"%"),minWidth:"".concat("day"===o?100*x.length:x.length*(100/7),"%")},children:x.map((e,n)=>{const o=u(e,h),a=u(e,t),s=e.getDay(),i=0===s?6:s-1;return(0,v.jsxs)("div",{onClick:()=>r(e),className:"flex flex-col items-center justify-center cursor-pointer transition-colors hover:bg-muted/50 pb-2",style:{width:"".concat(100/x.length,"%"),flexShrink:0,minWidth:"".concat(100/x.length,"%"),minHeight:"3rem"},children:[(0,v.jsx)("div",{className:"text-[10px] uppercase font-semibold text-muted-foreground tracking-wider mb-1",children:b[i]}),(0,v.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold transition-all ".concat(o?"bg-primary text-primary-foreground":a?"bg-muted text-foreground":"text-foreground"),children:e.getDate()})]},n)})})},w=e=>{let{id:t,start:n,end:a,title:s,color:i,color1:l,isSelected:c,isMultiDay:d,isFirstDay:u,isLastDay:g,isRecurring:m=!1,notes:f,location:p,employees:x,style:b,overlapInfo:y,currentDate:w,isOverlapping:D=!1,isDraft:k=!1,onMouseDown:j,onRightClick:N,onClick:C}=e;const[E,S]=(0,r.useState)(!1),A=(0,r.useRef)(null),T=n instanceof Date?n:new Date(n),R=a instanceof Date?a:new Date(a),M=null!==b&&void 0!==b&&b.height?parseInt(b.height):60,I=M<35,L=M<25,F=(e,t)=>{if(!e)return"rgba(0, 0, 0, ".concat(t,")");let n=0,o=0,r=0;return 4===e.length?(n=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16),r=parseInt(e[3]+e[3],16)):7===e.length&&(n=parseInt(e.substring(1,3),16),o=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16)),"rgba(".concat(n,", ").concat(o,", ").concat(r,", ").concat(t,")")},V=i||"#2563eb",z=F(V,k?.25:.15),W=V,O=V,H=(0,r.useCallback)(function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"move";e.stopPropagation(),null===j||void 0===j||j(e,{id:t,start:n,end:a,title:s,color:i,color1:l,notes:f,location:p,employees:x,isRecurring:m},o)},[t,n,a,s,i,l,f,p,x,m,j]),P=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),null===N||void 0===N||N(e,{id:t,start:n,end:a,title:s,color:i,color1:l,notes:f,location:p,employees:x,isRecurring:m})},[t,n,a,s,i,l,f,p,x,m,N]),B=(0,r.useCallback)(e=>{e.stopPropagation(),null===C||void 0===C||C({id:t,start:n,end:a,title:s,color:i,color1:l,notes:f,location:p,employees:x,isRecurring:m},e)},[t,n,a,s,i,l,f,p,x,m,C]),Y=b||{display:"none"};return(0,v.jsxs)("div",{ref:A,"data-event-id":t,className:(0,h.cn)("absolute rounded-md transition-shadow select-none overflow-hidden group","z-1 cursor-grab hover:z-2",c&&"ring-2 ring-offset-1 ring-primary",D&&"opacity-90",k&&"opacity-70 border-dashed"),style:(0,o.A)((0,o.A)({},Y),{},{backgroundColor:z,borderLeft:"3px solid ".concat(W),boxShadow:E?"0 4px 12px rgba(0,0,0,0.15)":"none"}),onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onMouseDown:e=>H(e,"move"),onContextMenu:P,onClick:B,children:[(!d||u)&&(0,v.jsx)("div",{className:(0,h.cn)("absolute top-0 left-0 right-0 h-2 cursor-ns-resize z-2","bg-transparent hover:bg-white/30 transition-colors",E?"opacity-100":"opacity-0"),onMouseDown:e=>{e.stopPropagation(),H(e,"resize-top")}}),(0,v.jsxs)("div",{className:"flex flex-col h-full w-full px-2 py-1 text-xs leading-tight min-h-[0px] relative",children:[(0,v.jsx)("span",{className:"font-semibold truncate",style:{fontSize:"16px",color:O},children:s||(k?"New Event":"(No Title)")}),!L&&(0,v.jsxs)("span",{className:"text-[10px] opacity-80 truncate",style:{color:O},children:[T.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),!I&&" - ".concat(R.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))]}),!I&&p&&(0,v.jsxs)("span",{className:"text-[10px] opacity-70 truncate mt-0.5",style:{color:O},children:["\ud83d\udccd ",p]})]}),m&&(0,v.jsx)("div",{className:"absolute top-1 right-1 text-[8px] opacity-60",style:{color:O},children:(0,v.jsx)("i",{className:"fas fa-redo-alt"})}),(!d||g)&&(0,v.jsx)("div",{className:(0,h.cn)("absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize z-2","bg-transparent hover:bg-white/30 transition-colors",E?"opacity-100":"opacity-0"),onMouseDown:e=>{e.stopPropagation(),H(e,"resize-bottom")}})]})},D=e=>{let{view:t,events:n,selectedEventId:a,currentDate:s,getEventsForCurrentWeek:i,validatedEvents:l,onEventClick:c,onEventRightClick:d,onEventMove:u,onEventResize:f,onCreateEvent:h,scrollContainerRef:p,numWeeks:x=7,numDays:b=30,referenceDate:y}=e;const D=(0,r.useRef)(null),[k,j]=((0,r.useRef)(null),(0,r.useState)(!1)),[N,C]=(0,r.useState)(null),E=(0,r.useRef)(0),S=(0,r.useRef)(null),A=(0,r.useRef)(!1),T=(0,r.useRef)(null),R=y||s;let M;if("day"===t){M=g(R,0,0)}else{const e=m(R,x,x);M=e.flat()}const I=15,L=(0,r.useCallback)(e=>{const t=new Date(e),n=t.getMinutes(),o=n%I;return 0!==o&&(o<7.5?t.setMinutes(n-o):t.setMinutes(n+(I-o))),t.setSeconds(0,0),t},[]),F=(0,r.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);if(e<=0)return o;const r=e/60;let a,s,i;if(n)a=Math.max(0,Math.min(23,Math.floor(r))),s=0,i=0;else{a=Math.max(0,Math.min(23,Math.floor(r)));const e=60*(r-Math.floor(r));s=Math.round(e/I)*I,i=0}const l=new Date(o);return l.setHours(a,s,i,0),l},[]),V=(0,r.useCallback)((e,t)=>{const n=M.length,o=Math.floor(e/t*n);return M[Math.max(0,Math.min(n-1,o))]},[M]),z=(e,t)=>{if(0===e.length)return[];const n=e.map(e=>(0,o.A)((0,o.A)({},e),{},{startTime:new Date(e.start).getTime(),endTime:new Date(e.end).getTime(),column:0,totalColumns:1,isOverlapping:!1}));if(n.sort((e,t)=>e.startTime===t.startTime?e.endTime-t.endTime:e.startTime-t.startTime),"day"===t){const e=6,t=Array(e).fill(null).map(()=>[]);for(const a of n){let n=!1,o=0,r=1/0;for(let s=0;s<e;s++){const e=t[s].filter(e=>a.startTime<e.endTime&&a.endTime>e.startTime).length;if(0===e){t[s].push(a),a.column=s,n=!0;break}e<r&&(r=e,o=s)}n||(t[o].push(a),a.column=o,a.isOverlapping=!0)}const o=new Set(n.map(e=>e.column)),r=Math.min(e,Math.max(1,o.size));n.forEach(e=>{e.totalColumns=r})}else{const e=2,t=new Set;for(let o=0;o<n.length;o++){if(t.has(o))continue;const r=n[o],a=[r];t.add(o);for(let s=o+1;s<n.length;s++){if(t.has(s))continue;const o=n[s];if(r.startTime<o.endTime&&r.endTime>o.startTime){const n=r.startTime<=o.startTime&&r.endTime>=o.endTime,i=o.startTime<=r.startTime&&o.endTime>=r.endTime;if((n||i)&&(a.push(o),t.add(s),a.length>=e))break}}a.length>1&&(a.sort((e,t)=>e.startTime===t.startTime?e.endTime-t.endTime:e.startTime-t.startTime),a.forEach((t,n)=>{t.column=n,t.totalColumns=Math.min(e,a.length)}))}for(let o=0;o<n.length;o++){const e=n[o];if(1===e.totalColumns)for(let t=0;t<n.length;t++){if(o===t)continue;const r=n[t];if(e.startTime<r.endTime&&e.endTime>r.startTime){const t=e.startTime<=r.startTime&&e.endTime>=r.endTime,n=r.startTime<=e.startTime&&r.endTime>=e.endTime;t||n||(e.isOverlapping=!0,r.isOverlapping=!0)}}}}return n},W=(0,r.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"move";if(e.preventDefault(),e.stopPropagation(),0!==e.button)return;A.current=!1;const o=D.current;if(!o)return;E.current=e.clientY;const r=e.clientX,a=new Date(t.start),s=new Date(t.end),i=s.getTime()-a.getTime(),l=(o.getBoundingClientRect(),o.closest(".calendar-scroll-container")||o.closest(".time-slots"));let d=null,g=e.clientY;const m=l?l.scrollTop:0,h=()=>{if(!l)return void(d=null);const e=l.getBoundingClientRect(),t=e.top,n=e.bottom,o=g-t,r=n-g;let a=!1,s=0;if(o<80&&o>0?(a=!0,s=-Math.min(15,Math.floor((80-o)/5))):r<80&&r>0&&(a=!0,s=Math.min(15,Math.floor((80-r)/5))),a&&0!==s){const e=l.scrollTop,t=l.scrollHeight-l.clientHeight,n=Math.max(0,Math.min(t,e+s));l.scrollTop=n,d=requestAnimationFrame(h)}else d=null},v=e=>{g=e.clientY;const o=(l?l.scrollTop:0)-m,c=e.clientY-E.current+o,v=e.clientX-r;(Math.abs(c)>3||Math.abs(v)>3)&&(A.current=!0),!l||"move"!==n&&"resize-top"!==n&&"resize-bottom"!==n||d||(d=requestAnimationFrame(h));const p=1*c,x=Math.round(p/I)*I;if(0!==x)if("resize-top"===n){const e=new Date(a.getTime()+6e4*x),n=L(e);n<s&&(null===f||void 0===f||f(t.id,n,s,!0))}else if("resize-bottom"===n){const e=new Date(s.getTime()+6e4*x),n=L(e);n>a&&(null===f||void 0===f||f(t.id,a,n,!0))}else{let e=new Date(a.getTime()+6e4*x),n=L(e),o=new Date(n.getTime()+i);const r=new Date(a);r.setHours(0,0,0,0);const s=new Date(n);if(s.setHours(0,0,0,0),s.getTime()!==r.getTime()){const e=new Date(r);e.setHours(0,0,0,0);const t=new Date(r);t.setHours(23,59,59,999),n<e?(n=e,o=new Date(n.getTime()+i)):o>t&&(o=t,n=new Date(o.getTime()-i),n<e&&(n=e,o=new Date(n.getTime()+i)))}null===u||void 0===u||u(t.id,n,o,!0)}},p=e=>{if(d&&(cancelAnimationFrame(d),d=null),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",p),!A.current)return void(null===c||void 0===c||c(t,e));const o=(l?l.scrollTop:0)-m,r=1*(e.clientY-E.current+o),g=Math.round(r/I)*I;if(0!==g)if("resize-top"===n){const e=new Date(a.getTime()+6e4*g),n=L(e);n<s&&(null===f||void 0===f||f(t.id,n,s,!1))}else if("resize-bottom"===n){const e=new Date(s.getTime()+6e4*g),n=L(e);n>a&&(null===f||void 0===f||f(t.id,a,n,!1))}else{let e=new Date(a.getTime()+6e4*g),n=L(e),o=new Date(n.getTime()+i);const r=new Date(a);r.setHours(0,0,0,0);const s=new Date(n);if(s.setHours(0,0,0,0),s.getTime()!==r.getTime()){const e=new Date(r);e.setHours(0,0,0,0);const t=new Date(r);t.setHours(23,59,59,999),n<e?(n=e,o=new Date(n.getTime()+i)):o>t&&(o=t,n=new Date(o.getTime()-i),n<e&&(n=e,o=new Date(n.getTime()+i)))}null===u||void 0===u||u(t.id,n,o,!1)}};document.addEventListener("mousemove",v),document.addEventListener("mouseup",p)},[L,u,f,c]),O=(0,r.useCallback)(e=>{console.log("Grid mousedown fired"),console.log("Click target:",e.target),console.log("Target className:",e.target.className),console.log("Target data-event-id:",e.target.getAttribute("data-event-id"));const t=e.target.closest("[data-event-id]");if(console.log("Closest event element:",t),t)return void console.log("Click on event detected, ignoring grid mousedown");if(0!==e.button)return;console.log("Grid mousedown - creating new event"),e.preventDefault();const n=D.current;if(!n)return;const r=n.getBoundingClientRect(),a=e.clientX-r.left,s=e.clientY-r.top,i=V(a,r.width),l=F(s,i,!0),c=new Date(l.getTime()+36e5);A.current=!1,E.current=e.clientY,S.current=l;const d={id:"draft-".concat(Date.now()),title:"",start:l,end:c,isDraft:!0,color:"#3b82f6"};T.current=d,C(d),j(!0);const u=e=>{const t=e.clientY-r.top;Math.abs(e.clientY-E.current)>5&&(A.current=!0);const n=F(t,i,!1),a=new Date(i);a.setHours(0,0,0,0);const s=new Date(i);let l,c;s.setHours(23,59,59,999),n<S.current?(l=L(n),c=L(new Date(S.current.getTime()+36e5))):(l=L(S.current),c=L(n),c.getTime()-l.getTime()<9e5&&(c=new Date(l.getTime()+9e5))),l<a&&(l=a,c=new Date(l.getTime()+36e5)),c>s&&(c=s,c.getTime()-l.getTime()<9e5&&(l=new Date(c.getTime()-9e5),l<a&&(l=a,c=new Date(l.getTime()+9e5))));const d=(0,o.A)((0,o.A)({},T.current),{},{start:l,end:c});T.current=d,C(d)},g=()=>{if(document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",g),j(!1),C(null),A.current)console.log("Creating drag event with panel:",T.current),null===h||void 0===h||h((0,o.A)((0,o.A)({},T.current),{},{id:"temp-".concat(Date.now()),isDraft:!1}),!0);else{const e={id:"temp-".concat(Date.now()),title:"",start:l,end:c,color:"#3b82f6"};console.log("Creating single-click event and opening panel:",e),null===h||void 0===h||h(e,!0)}};document.addEventListener("mousemove",u),document.addEventListener("mouseup",g)},[s,V,F,L,h]),H=(0,r.useCallback)(e=>{if(e.target.closest("[data-event-id]"))return;e.preventDefault();const t=D.current;if(!t)return;const n=t.getBoundingClientRect(),o=e.clientX-n.left,r=e.clientY-n.top,a=V(o,n.width),s=F(r,a,!0),i=new Date(s.getTime()+36e5),l={id:"temp-".concat(Date.now()),title:"",start:s,end:i,color:"#3b82f6"};null===h||void 0===h||h(l,!0)},[s,V,F,h]);return(0,v.jsxs)("div",{className:"relative flex-1 bg-background select-none min-w-max",ref:D,style:{height:"1440px",width:"".concat("day"===t?100*M.length:M.length/7*100,"%"),minWidth:"".concat("day"===t?100*M.length:M.length/7*100,"%")},onMouseDown:O,onDoubleClick:H,children:[Array.from({length:24},(e,t)=>(0,v.jsx)("div",{className:"h-[60px] w-full border-b border-border flex items-start"},t)),(0,v.jsx)("div",{className:"absolute inset-0 flex pointer-events-none h-full",children:M.map((e,t)=>(0,v.jsx)("div",{className:"border-l border-border h-full first:border-l-0",style:{width:"".concat(100/M.length,"%")}},t))}),(0,v.jsx)("div",{className:"absolute inset-0 top-0 left-0 w-full h-full",children:(0,v.jsx)("div",{className:"relative w-full h-full",children:(()=>{let e=[];if(n&&n.length>0){const r=new Date(M[0]);r.setHours(0,0,0,0);new Date(M[M.length-1]).setHours(23,59,59,999);const a=n.filter(e=>e.isBeingMoved||e.isBeingResized),s=n.filter(e=>!e.isBeingMoved&&!e.isBeingResized);M.forEach((n,r)=>{const a=s.filter(e=>{if(!e||!e.start)return!1;const t=new Date(e.start);return t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()}),i=z(a,t).map(e=>(0,o.A)((0,o.A)({},e),{},{dayIndex:r}));e.push(...i)}),s.forEach(n=>{if(!n||!n.start)return;const a=new Date(n.start);if(-1===e.findIndex(e=>e.id===n.id)){let s=M.findIndex(e=>e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear());if(s<0){const e=Math.floor((a-r)/864e5);s=Math.max(0,Math.min(M.length-1,e))}const i=z([n],t).map(e=>(0,o.A)((0,o.A)({},e),{},{dayIndex:s}));e.push(...i)}}),a.forEach(t=>{const n=new Date(t.start);let a=M.findIndex(e=>e.getDate()===n.getDate()&&e.getMonth()===n.getMonth()&&e.getFullYear()===n.getFullYear());if(a<0){const e=Math.floor((n-r)/864e5);a=Math.max(0,Math.min(M.length-1,e))}e.push((0,o.A)((0,o.A)({},t),{},{dayIndex:a,column:0,totalColumns:1,isOverlapping:!1}))})}if(N){const t=new Date(N.start);let n=M.findIndex(e=>e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear());-1===n&&(n=0),e.push((0,o.A)((0,o.A)({},N),{},{dayIndex:n,column:0,totalColumns:1,isOverlapping:!1}))}return e.map(e=>{if(!e||!e.start||void 0===e.dayIndex||e.dayIndex<0)return null;const t=new Date(e.start),n=new Date(e.end),r=60*(t.getHours()+t.getMinutes()/60),s=(n-t)/36e5,i=Math.max(60*s,15),u=M.length,g="".concat(100/u,"%"),m="".concat(e.dayIndex*(100/u),"%");let f={};if(e.isOverlapping){const t=100/u/e.totalColumns;f={top:"".concat(r,"px"),left:"calc(".concat(m," + ").concat(e.column*t,"%)"),width:"calc(".concat(t,"% - 4px)"),height:"".concat(i,"px"),position:"absolute",zIndex:e.isSelected?3:2}}else f={top:"".concat(r,"px"),left:m,width:"calc(".concat(g," - 4px)"),height:"".concat(i,"px"),position:"absolute",zIndex:e.isSelected?3:1};let h=(0,o.A)({},e);return l&&l.has(e.id)&&(h.color="#0f54bc",h.color1="#a8c1ff",h.color2="#4da6fb"),(0,v.jsx)(w,(0,o.A)((0,o.A)({},h),{},{style:f,isOverlapping:e.isOverlapping,isSelected:a===e.id,onMouseDown:W,onRightClick:d,onClick:c}),e.id)}).filter(Boolean)})()})})]})};n(4315),n(9959);const k=e=>{let{event:t,currentDate:n,onConfirm:o,onCancel:s,isRecurring:i}=e;const{t:l}=(0,a.Bd)(),c=null!=t.recurrenceId,d=i||c,u=(0,r.useCallback)(e=>{"Escape"===e.key&&s()},[s]);(0,r.useEffect)(()=>(document.body.style.overflow="hidden",window.addEventListener("keydown",u),()=>{document.body.style.overflow="",window.removeEventListener("keydown",u)}),[u]);return(0,v.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-in fade-in duration-200",style:{backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)"},onClick:e=>{e.target===e.currentTarget&&s()},children:(0,v.jsxs)("div",{className:"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border overflow-hidden flex flex-col transform transition-all duration-200 scale-100 animate-in zoom-in-95",onClick:e=>e.stopPropagation(),style:{backgroundColor:"var(--background-div-color)",borderColor:"var(--grey-2)",boxShadow:"var(--box-shadow-md)"},children:[(0,v.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b",style:{borderBottomColor:"var(--red-2)",backgroundColor:"var(--red-1)"},children:[(0,v.jsxs)("div",{className:"flex items-center gap-3",children:[(0,v.jsx)("div",{className:"p-2 rounded-full",style:{backgroundColor:"var(--red-2)",color:"var(--red-4)"},children:(0,v.jsx)(f.eHT,{size:24})}),(0,v.jsx)("h3",{className:"text-xl font-semibold tracking-tight",style:{color:"var(--red-4)",fontFamily:"var(--font-family-headings)",fontSize:"var(--font-size-large)"},children:d?l("calendar:deleteTitle","Delete Recurring Event"):l("common:deleteConfirmation.title","Delete Event")})]}),(0,v.jsx)("button",{onClick:s,className:"p-2 rounded-full transition-colors hover:bg-black/5",style:{color:"var(--red-4)"},"aria-label":"Close",children:(0,v.jsx)(f.yGN,{size:20})})]}),(0,v.jsxs)("div",{className:"p-6 flex-1",style:{color:"var(--text-color)",fontFamily:"var(--font-family-text)",fontSize:"var(--font-size-medium)",lineHeight:"1.6"},children:[(0,v.jsx)("p",{style:{marginBottom:"var(--spacing-md)"},children:d?l("calendar:deleteMessage","This is a recurring event. Which occurrences would you like to delete?"):l("common:deleteConfirmation.message","Are you sure you want to delete this event?")}),"contract"===t.type&&(0,v.jsx)("div",{className:"p-4 rounded-lg mt-4",style:{backgroundColor:"var(--red-1)",border:"1px solid var(--red-2)",color:"var(--red-4)",fontSize:"var(--font-size-small)"},children:(0,v.jsx)("strong",{children:l("common:deleteConfirmation.contractWarning","WARNING: This is a scheduled appointment. Deleting it may affect your employment status and availability record.")})})]}),(0,v.jsxs)("div",{className:"px-6 py-4 border-t flex justify-end gap-3",style:{borderTopColor:"var(--grey-2)",backgroundColor:"var(--grey-1-light)"},children:[(0,v.jsx)("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",children:l("common:deleteConfirmation.cancel","Cancel")}),d?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("button",{onClick:()=>o("single"),className:"px-4 py-2 text-sm font-medium rounded-md shadow-sm btn-yellow",children:l("common:deleteConfirmation.deleteThisOnly","Delete Only This Event")}),(0,v.jsx)("button",{onClick:()=>o("future"),className:"px-4 py-2 text-sm font-medium rounded-md shadow-sm btn-yellow",children:l("common:deleteConfirmation.deleteAllFuture","Delete This & Future Events")})]}):(0,v.jsx)("button",{onClick:()=>o("single"),className:"px-4 py-2 text-sm font-medium text-white bg-destructive hover:bg-destructive/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95",children:l("common:deleteConfirmation.delete","Delete Event")})]})]})})},j=e=>{let{event:t,position:n,onClose:o,onDelete:i,onColorChange:l,colorOptions:c=s}=e;const{t:d}=(0,a.Bd)(),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&o()},t=e=>{"Escape"===e.key&&o()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[o]);const[g,m]=(0,r.useState)(n);(0,r.useEffect)(()=>{if(u.current){const e=u.current.getBoundingClientRect(),t=window.innerWidth,o=window.innerHeight;let r=n.x,a=n.y;n.x+e.width>t&&(r=t-e.width-10),n.y+e.height>o&&(a=o-e.height-10),m({x:r,y:a})}},[n]);return(0,v.jsxs)("div",{ref:u,className:(0,h.cn)("fixed z-40 min-w-[180px] rounded-lg shadow-xl","bg-card/95 backdrop-blur-md border border-border/60","py-2 animate-in fade-in zoom-in-95 duration-150"),style:{left:"".concat(g.x,"px"),top:"".concat(g.y,"px")},children:[(0,v.jsxs)("div",{className:"px-3 py-2 border-b border-border/40",children:[(0,v.jsx)("span",{className:"text-sm font-medium text-foreground truncate block",children:t.title||d("calendar:noTitle")}),(0,v.jsxs)("span",{className:"text-xs text-muted-foreground",children:[new Date(t.start).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})," - ",new Date(t.end).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})]})]}),(0,v.jsxs)("div",{className:"px-3 py-2 border-b border-border/40",children:[(0,v.jsx)("span",{className:"text-xs text-muted-foreground mb-2 block",children:d("calendar:color")}),(0,v.jsx)("div",{className:"flex gap-1.5 flex-wrap",children:c.map(e=>(0,v.jsx)("button",{className:(0,h.cn)("w-6 h-6 rounded-full border-2 transition-transform hover:scale-110",t.color===e.color?"border-white shadow-md ring-2 ring-offset-1 ring-offset-card":"border-transparent"),style:{backgroundColor:e.color,ringColor:e.color},onClick:()=>{return n=e,null===l||void 0===l||l(t,n),void o();var n},title:e.name||e.color},e.id||e.color))})]}),(0,v.jsx)("div",{className:"px-2 pt-2",children:(0,v.jsxs)("button",{className:(0,h.cn)("w-full px-3 py-2 rounded-md text-sm font-medium","flex items-center gap-2","text-red-500 hover:bg-red-500/10 transition-colors"),onClick:()=>{null===i||void 0===i||i(t),o()},children:[(0,v.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d("calendar:deleteEventAction")]})})]})};var N=n(5242);const C=e=>{let{selectedDays:t,onChange:n}=e;const{i18n:o}=(0,a.Bd)(),r=(e=>{const t=new Date(2e3,0,3);return Array.from({length:7},(n,o)=>{const r=new Date(t);return r.setDate(t.getDate()+o),r.toLocaleString(e,{weekday:"long"})})})(o.language),s=t||[!1,!1,!1,!1,!1,!1,!1];return(0,v.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map((e,o)=>(0,v.jsx)("button",{type:"button",onClick:()=>(e=>{const o=[...t||[!1,!1,!1,!1,!1,!1,!1]];o[e]=!o[e],n(o)})(o),className:(0,h.cn)("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200","border border-input hover:bg-muted",s[o]?"bg-primary text-primary-foreground border-primary":"bg-background text-foreground"),children:e},o))})},E=e=>{let{value:t,onChange:n,className:a}=e;const s=e=>{if(!e)return{day:"",month:"",year:""};try{const t=new Date(e);return isNaN(t.getTime())?{day:"",month:"",year:""}:{day:String(t.getDate()).padStart(2,"0"),month:String(t.getMonth()+1).padStart(2,"0"),year:String(t.getFullYear())}}catch(t){return{day:"",month:"",year:""}}},[i,l]=(0,r.useState)(s(t)),c=(0,r.useRef)(null),d=(0,r.useRef)(null),u=(0,r.useRef)(null),g=(0,r.useRef)(null),m=(0,r.useRef)(null),p=(0,r.useRef)(t);(0,r.useEffect)(()=>{if(t!==p.current){p.current=t;const e="".concat(i.year,"-").concat(i.month,"-").concat(i.day),n=s(t);"".concat(n.year,"-").concat(n.month,"-").concat(n.day)!==e&&l(n)}},[t]);const x=e=>{const{day:t,month:o,year:r}=e;if(t&&o&&r&&4===r.length){const e="".concat(r,"-").concat(o.padStart(2,"0"),"-").concat(t.padStart(2,"0"));isNaN(Date.parse(e))||n(e)}},b=e=>{e.target.select()},y=(e,t)=>{if("Backspace"===e.key&&""===e.target.value){var n,o;if("month"===t)e.preventDefault(),null===(n=c.current)||void 0===n||n.focus();if("year"===t)e.preventDefault(),null===(o=d.current)||void 0===o||o.focus()}var r,a,s,i;"ArrowRight"===e.key&&e.target.selectionStart===e.target.value.length&&("day"===t&&(null===(r=d.current)||void 0===r||r.focus()),"month"===t&&(null===(a=u.current)||void 0===a||a.focus()));"ArrowLeft"===e.key&&0===e.target.selectionStart&&("year"===t&&(null===(s=d.current)||void 0===s||s.focus()),"month"===t&&(null===(i=c.current)||void 0===i||i.focus()))};return(0,v.jsxs)("div",{className:(0,h.cn)("flex items-center gap-0.5 cursor-text relative group min-w-[180px] w-full","bg-background/50 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2","border border-input rounded-md px-3 py-2",a),onClick:e=>{var t,n,o,r;(e.target===g.current||e.target.classList.contains("flex"))&&(i.day?i.month?i.year?null===(r=c.current)||void 0===r||r.focus():null===(o=u.current)||void 0===o||o.focus():null===(n=d.current)||void 0===n||n.focus():null===(t=c.current)||void 0===t||t.focus())},ref:g,children:[(0,v.jsx)("input",{ref:c,type:"text",inputMode:"numeric",placeholder:"DD",value:i.day,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>2&&(t=t.slice(0,2));const n=(0,o.A)((0,o.A)({},i),{},{day:t});var r;(l(n),2===t.length)&&(null===(r=d.current)||void 0===r||r.focus());x(n)},onKeyDown:e=>y(e,"day"),onFocus:b,onClick:b,className:"w-[28px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium",maxLength:2}),(0,v.jsx)("span",{className:"text-muted-foreground/40 select-none",children:"/"}),(0,v.jsx)("input",{ref:d,type:"text",inputMode:"numeric",placeholder:"MM",value:i.month,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>2&&(t=t.slice(0,2));const n=(0,o.A)((0,o.A)({},i),{},{month:t});var r;(l(n),2===t.length)&&(null===(r=u.current)||void 0===r||r.focus());x(n)},onKeyDown:e=>y(e,"month"),onFocus:b,onClick:b,className:"w-[28px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium",maxLength:2}),(0,v.jsx)("span",{className:"text-muted-foreground/40 select-none",children:"/"}),(0,v.jsx)("input",{ref:u,type:"text",inputMode:"numeric",placeholder:"YYYY",value:i.year,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>4&&(t=t.slice(0,4));const n=(0,o.A)((0,o.A)({},i),{},{year:t});l(n),x(n)},onKeyDown:e=>y(e,"year"),onFocus:b,onClick:b,className:"w-[42px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium",maxLength:4}),(0,v.jsxs)("div",{className:"ml-auto pl-2 flex items-center border-l border-border h-5",children:[(0,v.jsx)("button",{type:"button",tabIndex:-1,onClick:e=>{e.preventDefault(),e.stopPropagation();try{var t;null===(t=m.current)||void 0===t||t.showPicker()}catch(n){console.warn("showPicker not supported",n)}},className:"text-muted-foreground hover:text-foreground transition-colors cursor-pointer outline-none focus:text-foreground p-0.5",title:"Open calendar",children:(0,v.jsx)(f.wIk,{size:16})}),(0,v.jsx)("input",{ref:m,type:"date",className:"w-0 h-0 opacity-0 absolute bottom-0 right-0 pointer-events-none",tabIndex:-1,value:t||"",onChange:e=>{const t=e.target.value;if(t){const e=s(t);l(e),x(e)}}})]})]})},S=e=>{let{icon:t,children:n}=e;return(0,v.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mb-1.5 ",children:[t&&(0,v.jsx)(t,{className:"w-4 h-4"}),n]})},A="flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:bg-background",T="flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:bg-background appearance-none cursor-pointer",R="flex min-h-[80px] w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-y transition-all duration-200 hover:bg-background",M=e=>{let{event:t,onClose:n,onSave:s,onDelete:i,colorOptions:l,userData:c,workspaceContext:d={type:"personal"}}=e;const u=(0,r.useRef)(Date.now()),{t:g,i18n:m}=(0,a.Bd)("calendar"),{selectedWorkspace:p}=(0,N.M)(),x=e=>{const t=new Date(2e3,0,3);return Array.from({length:7},(n,o)=>{const r=new Date(t);return r.setDate(t.getDate()+o),r.toLocaleString(e,{weekday:"long"})})},[b,y]=(0,r.useState)({title:"",start:new Date,end:new Date,location:"",notes:"",employee:"",isRecurring:!1,repeatValue:"Every Week",endRepeatValue:"After",endRepeatCount:10,endRepeatDate:null,type:"availability",weeklyDays:[!1,!1,!1,!1,!1,!1,!1],monthlyType:"day",monthlyDay:1,monthlyWeek:"first",monthlyDayOfWeek:0}),[w,D]=(0,r.useState)([]),[k,j]=(0,r.useState)(!1),M=(()=>{if(!b.isRecurring)return null;const e=new Date(b.start);let t=null;if("On Date"===b.endRepeatValue&&b.endRepeatDate)t=new Date(b.endRepeatDate);else if("After"===b.endRepeatValue){const n=b.endRepeatCount||10;b.end.getTime(),b.start.getTime();if("Every Day"===b.repeatValue)t=new Date(e),t.setDate(t.getDate()+(n-1));else if("Every Week"===b.repeatValue){const o=(b.weeklyDays||[!1,!1,!1,!1,!1,!1,!1]).filter(Boolean).length||1,r=Math.ceil(n/o);t=new Date(e),t.setDate(t.getDate()+7*r)}else"Every Month"===b.repeatValue&&(t=new Date(e),t.setMonth(t.getMonth()+(n-1)))}else"Never"===b.endRepeatValue&&(t=new Date(e),t.setFullYear(t.getFullYear()+2));return t})();(0,r.useEffect)(()=>{if(t&&t.start&&t.end){const e=new Date(t.start),n=new Date(t.end);if(isNaN(e.getTime())||isNaN(n.getTime()))return;const o=e.getDay(),r=0===o?6:o-1,a=[!1,!1,!1,!1,!1,!1,!1];a[r]=!0,y({id:t.id,title:t.title||"",start:e,end:n,location:t.location||"",notes:t.notes||"",employee:t.employee||"",isRecurring:t.isRecurring||!1,repeatValue:t.repeatValue||"Every Week",endRepeatValue:t.endRepeatValue||"After",endRepeatCount:t.endRepeatCount||10,endRepeatDate:t.endRepeatDate?new Date(t.endRepeatDate):null,type:t.type||"availability",weeklyDays:t.weeklyDays||a,monthlyType:t.monthlyType||"day",monthlyDay:t.monthlyDay||e.getDate(),monthlyWeek:t.monthlyWeek||"first",monthlyDayOfWeek:void 0!==t.monthlyDayOfWeek?t.monthlyDayOfWeek:r})}else if(!t){const e=new Date,t=new Date(e);t.setMinutes(0,0,0),t.setSeconds(0,0);const n=new Date(t);n.setHours(t.getHours()+1);const o=t.getDay(),r=0===o?6:o-1,a=[!1,!1,!1,!1,!1,!1,!1];a[r]=!0,y({title:"",start:t,end:n,location:"",notes:"",employee:"",isRecurring:!1,repeatValue:"Every Week",endRepeatValue:"After",endRepeatCount:10,endRepeatDate:null,type:"availability",weeklyDays:a,monthlyType:"day",monthlyDay:t.getDate(),monthlyWeek:"first",monthlyDayOfWeek:r})}},[t]);const I=e=>{const{name:t,value:n}=e.target;y(e=>(0,o.A)((0,o.A)({},e),{},{[t]:n}))},L=(e,t)=>{if(e.includes("Date")){const n="startDate"===e?"start":"end",r=new Date(b[n]);if(!t||""===t.trim())return;if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return;const a=new Date(t);if(isNaN(a.getTime()))return;const s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),r.getHours(),r.getMinutes());isNaN(s.getTime())||y(e=>(0,o.A)((0,o.A)({},e),{},{[n]:s}))}if(e.includes("Time")){if(!t||""===t.trim())return;const n="startTime"===e?"start":"end",r=t.split(":");if(2!==r.length)return;const a=parseInt(r[0],10),s=parseInt(r[1],10);if(isNaN(a)||isNaN(s)||a<0||a>23||s<0||s>59)return;const i=new Date(b[n]),l=new Date(i.getFullYear(),i.getMonth(),i.getDate(),a,s);isNaN(l.getTime())||y(e=>(0,o.A)((0,o.A)({},e),{},{[n]:l}))}},F=e=>{if(!e)return"";try{const t=e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return"";const n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(o,"-").concat(r)}catch(t){return""}},V=e=>{if(!e||""===e.trim())return null;if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return null;const t=new Date(e);return isNaN(t.getTime())?null:t},z=e=>{if(!e)return"";try{const t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toTimeString().slice(0,5)}catch(t){return""}};return(0,v.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200 overflow-y-auto p-4",onClick:n,children:(0,v.jsxs)("div",{className:"bg-card w-full rounded-2xl shadow-2xl flex flex-col border border-border animate-in zoom-in-95 duration-200 my-auto relative",style:{maxWidth:b.isRecurring?"1400px":"700px"},onClick:e=>e.stopPropagation(),children:[(0,v.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b border-border bg-muted/20 backdrop-blur-md shrink-0 rounded-t-2xl",children:[(0,v.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,v.jsx)("h3",{className:"font-bold tracking-tight text-foreground m-0",style:{fontSize:"18px"},children:t&&t.id?g("editEvent","Edit Event"):g("createEvent","Create Event")}),(0,v.jsx)("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:b.type})]}),(0,v.jsxs)("div",{className:"flex items-center gap-2",children:[t&&t.id&&i&&(0,v.jsx)("button",{onClick:i,className:"p-2 text-destructive hover:bg-destructive/10 rounded-full transition-colors",title:"Delete",children:(0,v.jsx)(f.IXo,{size:18})}),(0,v.jsx)("button",{onClick:n,className:"p-2 text-muted-foreground hover:bg-muted hover:text-foreground rounded-full transition-colors",children:(0,v.jsx)(f.yGN,{size:20})})]})]}),w.length>0&&(0,v.jsxs)("div",{className:"relative overflow-hidden px-6 py-4 bg-white border-b-2 border-[var(--red-2)] text-[var(--red-4)] animate-in slide-in-from-top-2 shrink-0 flex gap-3",style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[(0,v.jsx)("div",{className:"flex-shrink-0",children:(0,v.jsx)("div",{className:"w-8 h-8 rounded-full bg-[var(--red-2)]/20 flex items-center justify-center border-2 border-[var(--red-2)]",children:(0,v.jsx)(f.y3G,{className:"w-4 h-4 text-[var(--red-4)]"})})}),(0,v.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,v.jsx)("h4",{className:"font-bold text-sm mb-1 text-[var(--red-4)]",children:"Validation Errors"}),w.map((e,t)=>(0,v.jsx)("div",{className:"text-sm leading-relaxed text-[var(--red-4)]/90",children:e},t))]})]}),(0,v.jsx)("div",{className:b.isRecurring?"grid grid-cols-2":"p-6",children:b.isRecurring?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"p-6 space-y-5 bg-background",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.jH2,children:g("title","Title")}),(0,v.jsx)("input",{name:"title",value:b.title,onChange:I,placeholder:"Add title",className:(0,h.cn)(A,"text-base font-medium"),autoFocus:!(null!==t&&void 0!==t&&t.id)})]}),(0,v.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.Ohp,children:"Start"}),(0,v.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,v.jsx)(E,{value:F(b.start),onChange:e=>L("startDate",e),className:A}),(0,v.jsx)("input",{type:"time",value:z(b.start),onChange:e=>L("startTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.Ohp,children:"End"}),(0,v.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,v.jsx)(E,{value:F(b.end),onChange:e=>L("endDate",e),className:A}),(0,v.jsx)("input",{type:"time",value:z(b.end),onChange:e=>L("endTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.HzC,children:g("location","Location")}),(0,v.jsx)("input",{name:"location",value:b.location,onChange:I,placeholder:"Add location",className:A})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.qm6,children:g("notes","Description")}),(0,v.jsx)("textarea",{name:"notes",value:b.notes,onChange:I,placeholder:"Add description...",className:R})]}),(0,v.jsx)("div",{className:"space-y-1.5",children:(0,v.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors",onClick:()=>y(e=>(0,o.A)((0,o.A)({},e),{},{isRecurring:!e.isRecurring})),children:[(0,v.jsx)("div",{className:(0,h.cn)("w-5 h-5 rounded border flex items-center justify-center transition-colors shrink-0",b.isRecurring?"bg-primary border-primary text-primary-foreground":"border-muted-foreground"),children:b.isRecurring&&(0,v.jsx)(f.YrT,{className:"w-3.5 h-3.5"})}),(0,v.jsxs)("div",{className:"flex items-center gap-2",children:[(0,v.jsx)(f.jEl,{className:"w-4 h-4 text-muted-foreground"}),(0,v.jsx)("span",{className:"text-sm font-medium",children:g("recurringEvent","Repeat this event")})]})]})})]}),(0,v.jsxs)("div",{className:"p-6 space-y-5 bg-muted/30",children:[(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.jEl,children:"Repeat"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"repeatValue",value:b.repeatValue,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"Every Day",children:"Every Day"}),(0,v.jsx)("option",{value:"Every Week",children:"Every Week"}),(0,v.jsx)("option",{value:"Every Month",children:"Every Month"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"End Repeat"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"endRepeatValue",value:b.endRepeatValue,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"After",children:"After"}),(0,v.jsx)("option",{value:"On Date",children:"On Date"}),(0,v.jsx)("option",{value:"Never",children:"Never"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),"Every Week"===b.repeatValue&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.wIk,children:g("repeatDays","Repeat on days")}),(0,v.jsx)(C,{selectedDays:b.weeklyDays,onChange:e=>y(t=>(0,o.A)((0,o.A)({},t),{},{weeklyDays:e}))})]}),"Every Month"===b.repeatValue&&(0,v.jsxs)("div",{className:"space-y-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Repeat on"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"monthlyType",value:b.monthlyType,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"day",children:"Day of month"}),(0,v.jsx)("option",{value:"weekday",children:"Day of week"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),"day"===b.monthlyType&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Day number"}),(0,v.jsx)("input",{type:"number",name:"monthlyDay",value:b.monthlyDay,onChange:I,min:"1",max:"31",className:A})]}),"weekday"===b.monthlyType&&(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Week"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"monthlyWeek",value:b.monthlyWeek,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"first",children:"First"}),(0,v.jsx)("option",{value:"second",children:"Second"}),(0,v.jsx)("option",{value:"third",children:"Third"}),(0,v.jsx)("option",{value:"fourth",children:"Fourth"}),(0,v.jsx)("option",{value:"last",children:"Last"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Day of week"}),(0,v.jsx)("div",{className:"flex flex-wrap gap-2",children:x(m.language).map((e,t)=>(0,v.jsx)("button",{type:"button",onClick:()=>y(e=>(0,o.A)((0,o.A)({},e),{},{monthlyDayOfWeek:t})),className:(0,h.cn)("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200","border border-input hover:bg-muted",b.monthlyDayOfWeek===t?"bg-primary text-primary-foreground border-primary":"bg-background text-foreground"),children:e},t))})]})]})]}),("After"===b.endRepeatValue||"On Date"===b.endRepeatValue)&&(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:["After"===b.endRepeatValue&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Number of occurrences"}),(0,v.jsx)("input",{type:"number",name:"endRepeatCount",value:b.endRepeatCount,onChange:I,min:"1",max:"365",className:A})]}),"On Date"===b.endRepeatValue&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"End Date"}),(0,v.jsx)(E,{value:b.endRepeatDate?F(b.endRepeatDate):"",onChange:e=>{const t=V(e);null===t&&""!==e||y(e=>(0,o.A)((0,o.A)({},e),{},{endRepeatDate:t}))},className:A})]})]}),M&&(0,v.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-background/50 border border-border",children:[(0,v.jsx)(f.wIk,{className:"w-4 h-4 text-muted-foreground"}),(0,v.jsxs)("span",{className:"text-sm text-muted-foreground",children:[g("calculatedEndDate","Calculated end date"),":"]}),(0,v.jsx)("span",{className:"text-sm font-medium text-foreground",children:M.toLocaleDateString()})]})]})]}):(0,v.jsxs)("div",{className:"space-y-5",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.jH2,children:g("title","Title")}),(0,v.jsx)("input",{name:"title",value:b.title,onChange:I,placeholder:"Add title",className:(0,h.cn)(A,"text-base font-medium"),autoFocus:!(null!==t&&void 0!==t&&t.id)})]}),(0,v.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.Ohp,children:"Start"}),(0,v.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,v.jsx)(E,{value:F(b.start),onChange:e=>L("startDate",e),className:A}),(0,v.jsx)("input",{type:"time",value:z(b.start),onChange:e=>L("startTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.Ohp,children:"End"}),(0,v.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,v.jsx)(E,{value:F(b.end),onChange:e=>L("endDate",e),className:A}),(0,v.jsx)("input",{type:"time",value:z(b.end),onChange:e=>L("endTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.HzC,children:g("location","Location")}),(0,v.jsx)("input",{name:"location",value:b.location,onChange:I,placeholder:"Add location",className:A})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.qm6,children:g("notes","Description")}),(0,v.jsx)("textarea",{name:"notes",value:b.notes,onChange:I,placeholder:"Add description...",className:R})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors",onClick:()=>y(e=>(0,o.A)((0,o.A)({},e),{},{isRecurring:!e.isRecurring})),children:[(0,v.jsx)("div",{className:(0,h.cn)("w-5 h-5 rounded border flex items-center justify-center transition-colors shrink-0",b.isRecurring?"bg-primary border-primary text-primary-foreground":"border-muted-foreground"),children:b.isRecurring&&(0,v.jsx)(f.YrT,{className:"w-3.5 h-3.5"})}),(0,v.jsxs)("div",{className:"flex items-center gap-2",children:[(0,v.jsx)(f.jEl,{className:"w-4 h-4 text-muted-foreground"}),(0,v.jsx)("span",{className:"text-sm font-medium",children:g("recurringEvent","Repeat this event")})]})]}),b.isRecurring&&(0,v.jsxs)("div",{className:"pl-4 pr-4 py-4 rounded-lg border border-border bg-muted/5 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.jEl,children:"Repeat"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"repeatValue",value:b.repeatValue,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"Every Day",children:"Every Day"}),(0,v.jsx)("option",{value:"Every Week",children:"Every Week"}),(0,v.jsx)("option",{value:"Every Month",children:"Every Month"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"End Repeat"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"endRepeatValue",value:b.endRepeatValue,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"After",children:"After"}),(0,v.jsx)("option",{value:"On Date",children:"On Date"}),(0,v.jsx)("option",{value:"Never",children:"Never"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),"Every Week"===b.repeatValue&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{icon:f.wIk,children:g("repeatDays","Repeat on days")}),(0,v.jsx)(C,{selectedDays:b.weeklyDays,onChange:e=>y(t=>(0,o.A)((0,o.A)({},t),{},{weeklyDays:e}))})]}),"Every Month"===b.repeatValue&&(0,v.jsxs)("div",{className:"space-y-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Repeat on"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"monthlyType",value:b.monthlyType,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"day",children:"Day of month"}),(0,v.jsx)("option",{value:"weekday",children:"Day of week"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),"day"===b.monthlyType&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Day number"}),(0,v.jsx)("input",{type:"number",name:"monthlyDay",value:b.monthlyDay,onChange:I,min:"1",max:"31",className:A})]}),"weekday"===b.monthlyType&&(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Week"}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsxs)("select",{name:"monthlyWeek",value:b.monthlyWeek,onChange:I,className:T,children:[(0,v.jsx)("option",{value:"first",children:"First"}),(0,v.jsx)("option",{value:"second",children:"Second"}),(0,v.jsx)("option",{value:"third",children:"Third"}),(0,v.jsx)("option",{value:"fourth",children:"Fourth"}),(0,v.jsx)("option",{value:"last",children:"Last"})]}),(0,v.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,v.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Day of week"}),(0,v.jsx)("div",{className:"flex flex-wrap gap-2",children:x(m.language).map((e,t)=>(0,v.jsx)("button",{type:"button",onClick:()=>y(e=>(0,o.A)((0,o.A)({},e),{},{monthlyDayOfWeek:t})),className:(0,h.cn)("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200","border border-input hover:bg-muted",b.monthlyDayOfWeek===t?"bg-primary text-primary-foreground border-primary":"bg-background text-foreground"),children:e},t))})]})]})]}),("After"===b.endRepeatValue||"On Date"===b.endRepeatValue)&&(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:["After"===b.endRepeatValue&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"Number of occurrences"}),(0,v.jsx)("input",{type:"number",name:"endRepeatCount",value:b.endRepeatCount,onChange:I,min:"1",max:"365",className:A})]}),"On Date"===b.endRepeatValue&&(0,v.jsxs)("div",{className:"space-y-1.5",children:[(0,v.jsx)(S,{children:"End Date"}),(0,v.jsx)(E,{value:b.endRepeatDate?F(b.endRepeatDate):"",onChange:e=>{const t=V(e);null===t&&""!==e||y(e=>(0,o.A)((0,o.A)({},e),{},{endRepeatDate:t}))},className:A})]})]}),M&&(0,v.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30 border border-border",children:[(0,v.jsx)(f.wIk,{className:"w-4 h-4 text-muted-foreground"}),(0,v.jsxs)("span",{className:"text-sm text-muted-foreground",children:[g("calculatedEndDate","Calculated end date"),":"]}),(0,v.jsx)("span",{className:"text-sm font-medium text-foreground",children:M.toLocaleDateString()})]})]})]})]})}),(0,v.jsxs)("div",{className:"p-5 border-t border-border bg-muted/10 flex justify-end gap-3 backdrop-blur-sm shrink-0 rounded-b-2xl",children:[(0,v.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",children:g("cancel","Cancel")}),(0,v.jsxs)("button",{onClick:()=>{const e=Date.now()-u.current;console.log("handleSaveWrapper called. Time since mount: ".concat(e,"ms")),e<500?console.log("Ignoring click on save button (too soon after mount)"):b.end<=b.start?D(["End time must be after start time"]):(j(!0),setTimeout(()=>{s((0,o.A)((0,o.A)({},b),{},{isValidated:!0,fromDatabase:!0,color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb"}),!0),j(!1)},400))},disabled:k,className:"px-6 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95 disabled:opacity-70 disabled:pointer-events-none flex items-center gap-2",children:[k&&(0,v.jsx)("span",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),g("save","Save Event")]})]})]})})};var I=n(9521),L=n(2383);const F=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;const[t,n]=(0,r.useState)(()=>e instanceof Date?e:new Date),[a,i]=(0,r.useState)("week"),[l,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(0),[g,m]=(0,r.useState)(0),[f,h]=(0,r.useState)(!1),[v,p]=(0,r.useState)(s.map(e=>({name:e.name,color:e.color,checked:!0}))),[x,b]=(0,r.useState)(!1),[y,w]=(0,r.useState)(null),[D,k]=(0,r.useState)(!1),[j,N]=(0,r.useState)({x:0,y:0}),[C,E]=(0,r.useState)(null),S=(0,r.useCallback)(e=>{const o=new Date(t),r=o.getHours(),s=o.getMinutes(),i=o.getSeconds(),l=o.getMilliseconds();"week"===a?(o.setDate(o.getDate()+7*e),u(0)):"day"===a?(c(e>0?"left":"right"),o.setDate(o.getDate()+e),m(0)):o.setMonth(o.getMonth()+e),o.setHours(r,s,i,l),n(o)},[t,a]),A=(0,r.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])u(t=>{const n=t+e;return Math.max(-7,Math.min(7,n))});else if(-1===e){const e=new Date(t);e.setDate(e.getDate()-7),n(e),u(0)}else if(1===e){const e=new Date(t);e.setDate(e.getDate()+7),n(e),u(0)}},[t]),T=(0,r.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])m(t=>{const n=t+e;return Math.max(-7,Math.min(7,n))});else if(-1===e){const e=new Date(t);e.setDate(e.getDate()-1),n(e),m(0)}else if(1===e){const e=new Date(t);e.setDate(e.getDate()+1),n(e),m(0)}},[t]),R=(0,r.useCallback)(e=>{c((e>t?1:-1)>0?"left":"right"),n(e),u(0),m(0),i("day"===a?"day":"week")},[t,a,i]),M=(0,r.useCallback)(e=>{c((e>t?1:-1)>0?"left":"right"),n(new Date(e)),u(0),i("week")},[t]),I=(0,r.useCallback)(e=>{p(t=>{const n=[...t];return n[e]=(0,o.A)((0,o.A)({},n[e]),{},{checked:!n[e].checked}),n})},[]),L=(0,r.useCallback)(e=>{if(e.stopPropagation(),"INPUT"!==e.target.tagName){const t=e.currentTarget.getBoundingClientRect();w({x:0,y:t.height+8}),b(!x)}},[x]),F=(0,r.useCallback)(()=>{h(!f)},[f]),V=(0,r.useCallback)(()=>{},[]),z=(0,r.useCallback)((e,t)=>{E(e),N(t),k(!0)},[]),W=(0,r.useCallback)(()=>{k(!1),E(null)},[]),O=(0,r.useCallback)(()=>{C&&W()},[C,W]),H=(0,r.useCallback)(()=>{C&&W()},[C,W]),P=(0,r.useCallback)(()=>{C&&W()},[C,W]);return{currentDate:t,setCurrentDate:n,view:a,setView:i,slideDirection:l,setSlideDirection:c,weekScrollOffset:d,setWeekScrollOffset:u,dayScrollOffset:g,setDayScrollOffset:m,isSidebarCollapsed:f,setIsSidebarCollapsed:h,categories:v,setCategories:p,showHeaderDateDropdown:x,setShowHeaderDateDropdown:b,dropdownPosition:y,setDropdownPosition:w,showContextMenu:D,contextMenuPosition:j,contextMenuEvent:C,navigateDate:S,handleWeekScroll:A,handleDayScroll:T,handleDayClick:R,handleUpcomingEventClick:M,handleCategoryToggle:I,handleHeaderDateClick:L,toggleSidebar:F,handleBackToMiniCalendar:V,showContextMenuAt:z,hideContextMenu:W,handleContextMenuEdit:O,handleContextMenuDuplicate:H,handleContextMenuDelete:P}};var V=n(6667),z=n(3339),W=n(1889);const O=(0,W.Qg)(z.functions,"saveCalendarEvent"),H=(0,W.Qg)(z.functions,"saveRecurringEvents"),P=async e=>{if(console.log("checkPermissions called with uid:",e),!e)return console.error("checkPermissions failed: User ID is required"),!1;console.log("Auth state in checkPermissions:",{currentUser:z.auth.currentUser?z.auth.currentUser.uid:"null",isInitialized:z.auth._isInitialized}),z.auth._isInitialized||(console.log("Auth not fully initialized, waiting..."),await new Promise(e=>setTimeout(e,1e3)));const t=z.auth.currentUser;return t?t.uid!==e?(console.error("checkPermissions failed: User ID mismatch - current: ".concat(t.uid,", requested: ").concat(e)),!1):(console.log("checkPermissions passed for uid:",e),!0):(console.error("checkPermissions failed: User not authenticated"),!1)},B=async(e,t)=>{console.log("SAVE SINGLE EVENT called with:",{eventId:e.id,userId:t,title:e.title,isAvailability:e.isAvailability});if(!await P(t))return console.error("User does not have permission to save event"),{success:!1,error:"Permission denied"};try{const n={userId:t,title:e.title||"Available",start:e.start.toISOString(),end:e.end.toISOString(),color:e.color,color1:e.color1,color2:e.color2,notes:e.notes||"",location:e.location||"",isAvailability:!1!==e.isAvailability,isValidated:e.isValidated||!0,canton:e.canton||[],area:e.area||[],languages:e.languages||[],experience:e.experience||"",software:e.software||[],certifications:e.certifications||[],workAmount:e.workAmount||""},o=await O(n);return o.data.success?(console.log("Event saved with ID: ".concat(o.data.id)),{success:!0,id:o.data.id}):(console.error("Firebase function returned error:",o.data.error),{success:!1,error:o.data.error||"Failed to save event"})}catch(n){return console.error("Error calling saveEvent Firebase function:",n),{success:!1,error:"Failed to save event: "+n.message}}};const Y=async function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"worker",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{var a;let s=o;"professional"===o&&(s="worker"),console.log("Calling updateCalendarEvent Firebase function with:",{eventId:e,userId:n,originalAccountType:o,mappedAccountType:s,startType:typeof t.start,endType:typeof t.end,start:t.start instanceof Date?t.start.toISOString():t.start,end:t.end instanceof Date?t.end.toISOString():t.end,title:t.title,collectionToUse:"manager"===s?"jobs-listing":"availability",eventHasFromDatabaseFlag:!0===t.fromDatabase,eventHasValidatedFlag:!0===t.isValidated,isForceUpdate:r}),console.log("Auth debug:",{currentUser:null===(a=z.auth.currentUser)||void 0===a?void 0:a.uid,isAuthenticated:!!z.auth.currentUser,userIdParam:n});const i=(0,W.Qg)(z.functions,"updateCalendarEvent"),l=await i({eventId:e,userId:n,accountType:s,title:t.title,start:t.start instanceof Date?t.start.toISOString():t.start,end:t.end instanceof Date?t.end.toISOString():t.end,color:t.color,color1:t.color1,color2:t.color2,notes:t.notes,location:t.location,isValidated:t.isValidated,isRecurring:t.isRecurring,recurrenceId:t.recurrenceId,canton:t.canton,area:t.area,experience:t.experience,software:t.software,certifications:t.certifications,workAmount:t.workAmount,isAvailability:t.isAvailability});return console.log("Update event result:",l.data),l.data}catch(s){return console.error("Error calling updateEvent Firebase function:",s),console.error("Error details:",{message:s.message,code:s.code,details:s.details,stack:s.stack}),"functions/not-found"===s.code?{success:!1,error:"Event not found in database. It may have been deleted or moved."}:"functions/permission-denied"===s.code?{success:!1,error:"Permission denied. You do not have access to update this event."}:"functions/invalid-argument"===s.code?{success:!1,error:"Invalid event data provided."}:s.message.includes("CORS")||s.message.includes("Access-Control-Allow-Origin")?(console.error("CORS error detected - this is a server configuration issue"),{success:!1,error:"Server configuration error. The backend needs to be configured to allow requests from this domain. Please contact your system administrator."}):s.message.includes("net::ERR_FAILED")||s.message.includes("Failed to fetch")?(console.error("Network error detected"),{success:!1,error:"Network error. Please check your internet connection and try again."}):{success:!1,error:"Failed to update event: ".concat(s.code||s.message||"unknown error")}}},U=async(e,t)=>{console.log("SAVE RECURRING EVENTS called with:",{eventId:e.id,userId:t,repeatValue:e.repeatValue,isRecurring:e.isRecurring});try{await P(t);const n={userId:t,baseEvent:{id:e.id,title:e.title||"Available",start:e.start instanceof Date?e.start.toISOString():e.start,end:e.end instanceof Date?e.end.toISOString():e.end,color:e.color,color1:e.color1,color2:e.color2,notes:e.notes||"",location:e.location||"",isAvailability:!1!==e.isAvailability,isValidated:e.isValidated||!0,isRecurring:!0,repeatValue:e.repeatValue||"Every Day",endRepeatValue:e.endRepeatValue||"After",endRepeatCount:e.endRepeatCount||10,endRepeatDate:e.endRepeatDate?e.endRepeatDate instanceof Date?e.endRepeatDate.toISOString():e.endRepeatDate:null,weeklyDays:e.weeklyDays,monthlyType:e.monthlyType,monthlyDay:e.monthlyDay,monthlyWeek:e.monthlyWeek,monthlyDayOfWeek:e.monthlyDayOfWeek,canton:e.canton||[],area:e.area||[],languages:e.languages||[],experience:e.experience||"",software:e.software||[],certifications:e.certifications||[],workAmount:e.workAmount||""}},o=await H(n);return o.data.success?(console.log("Recurring events saved successfully. Count: ".concat(o.data.count)),{success:!0,recurrenceId:o.data.recurrenceId,count:o.data.count}):(console.error("Firebase function returned error:",o.data.error),{success:!1,error:o.data.error||"Failed to save recurring events"})}catch(n){return console.error("Error calling saveRecurringEvents Firebase function:",n),{success:!1,error:"Failed to save recurring events: "+n.message}}};const _=new class{constructor(){this.notifications=[],this.listeners=[],this.currentId=0}showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;const o=this.currentId++,r={id:o,message:e,type:t,timestamp:(new Date).getTime()};return this.notifications.push(r),this.notifyListeners(),n>0&&setTimeout(()=>{this.dismissNotification(o)},n),o}dismissNotification(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.notifyListeners()}clearAll(){this.notifications=[],this.notifyListeners()}getNotifications(){return[...this.notifications]}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){this.listeners.forEach(e=>e(this.getNotifications()))}},G=(e,t,n,a,s,l,c,d)=>{const[u,g]=(0,r.useState)([]),[m,f]=(0,r.useState)(null),[h,v]=(0,r.useState)(null),[p,x]=(0,r.useState)([]),[b,y]=(0,r.useState)(null),[w,D]=(0,r.useState)(new Set),[k,j]=(0,r.useState)(!1),[N,C]=(0,r.useState)(null),[E,S]=(0,r.useState)(!1),[A,T]=(0,r.useState)(null),[R,M]=(0,r.useState)(null),[I,L]=(0,r.useState)(null),[F,V]=(0,r.useState)(!1),[O,H]=(0,r.useState)(null),[P,G]=(0,r.useState)(!1),[q,K]=(0,r.useState)([[]]),[J,X]=(0,r.useState)(0),[Q,Z]=(0,r.useState)(null),[$,ee]=(0,r.useState)(!1),[te,ne]=(0,r.useState)(null),oe=(0,r.useCallback)(e=>{const t=q.slice(0,J+1);t.push([...e]),K(t),X(t.length-1)},[q,J]),re=(0,r.useCallback)((e,t)=>{if(J>0){const e=J-1;X(e),t([...q[e]]);const n=q[e];m&&!n.find(e=>e.id===m.id)&&(f(null),v(null))}},[J,q,m]),ae=(0,r.useCallback)((e,t)=>{if(J<q.length-1){const e=J+1;X(e),t([...q[e]]);const n=q[e];m&&!n.find(e=>e.id===m.id)&&(f(null),v(null))}},[J,q,m]),se=(0,r.useCallback)((e,t,n,r,a)=>{if(console.log("handleEventClick called with event:",e),t.stopPropagation(),t.ctrlKey||t.metaKey)return void x(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]);p.length>0&&x([]);const s=a?Date.now()-a:0;if(r||s<200)return void console.log("Event clicked after drag - not opening panel");console.log("Clean event click detected - opening event panel");const i=n.find(t=>t.id===e.id)||e;y((0,o.A)({id:i.id,start:new Date(i.start),end:new Date(i.end),title:i.title,color:i.color,color1:i.color1,color2:i.color2,notes:i.notes,location:i.location,employees:i.employees},i)),v(e.id),f(i)},[p]),ie=(0,r.useCallback)((e,t,n)=>{console.log("Event double-clicked:",e.id,"- opening event panel"),t.stopPropagation();const r=n.find(t=>t.id===e.id)||e;y((0,o.A)({id:r.id,start:new Date(r.start),end:new Date(r.end),title:r.title,color:r.color,color1:r.color1,color2:r.color2,notes:r.notes,location:r.location,employees:r.employees},r)),v(e.id),f(r)},[]),le=(0,r.useCallback)((e,t)=>{if(console.log("Panel closing, checking if event needs to be restored or removed"),m&&String(m.id).startsWith("temp-")){console.log("Removing unsaved temp event from array:",m.id);return t(e.filter(e=>e.id!==m.id)),f(null),v(null),void y(null)}if(b&&m&&b.id===m.id){console.log("Restoring event to original position:",b);const n=e.findIndex(e=>e.id===m.id);if(-1!==n){const r=e[n],a=r.start instanceof Date?r.start:new Date(r.start),s=r.end instanceof Date?r.end:new Date(r.end),i=b.start instanceof Date?b.start:new Date(b.start),l=b.end instanceof Date?b.end:new Date(b.end);if(a.getTime()!==i.getTime()||s.getTime()!==l.getTime()||(r.title||"")!==(b.title||"")||(r.notes||"")!==(b.notes||"")||(r.location||"")!==(b.location||"")||(r.employees||"")!==(b.employees||"")||(r.color||"")!==(b.color||"")){console.log("Event was modified, restoring to original state");const a=[...e];a[n]=(0,o.A)((0,o.A)({},b),{},{start:new Date(b.start),end:new Date(b.end),fromDatabase:r.fromDatabase||!1,isValidated:r.isValidated||!1}),t(a),oe(a)}else console.log("Event was not modified, no restoration needed")}}f(null),v(null),y(null)},[b,m,oe]),ce=((0,r.useCallback)(function(n,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const l=String(n.id).includes("_")?String(n.id).split("_")[0]:n.id;let c=[...s];const d=c.findIndex(e=>e.id===n.id);if(-1!==d?c[d]=(0,o.A)((0,o.A)({},c[d]),n):c.push(n),n.isRecurring&&r){console.log("Event save details:",{id:n.id,baseId:l,isNowRecurring:n.isRecurring,repeatValue:n.repeatValue,isAvailability:n.isAvailability,shouldClose:r,alreadyProcessed:a});const d=c.filter(e=>e.id!==n.id&&(e.recurrenceId===n.recurrenceId||String(e.id).includes("_")&&String(e.id).split("_")[0]===String(l)));if(console.log("Filtered out ".concat(d.length," existing recurring events")),c=c.filter(e=>!d.includes(e)),r&&e&&!a&&(console.log("Final save: should save recurring events to database"),l!==n.id&&console.log("Updating instance of recurring event with baseId:",l),console.log("Calling saveRecurringEvents with:",n),console.log("userId value:",e),"worker"===t&&!a)){console.log("Making direct call to saveRecurringEvents");const t=(0,o.A)((0,o.A)({},n),{},{userId:e});U(t,e).then(e=>{if(console.log("saveRecurringEvents result:",e),G(!1),e.success){console.log("Recurring events saved successfully",e),_.showNotification("Recurring events saved successfully","success"),D(t=>new Set([...t,e.recurrenceId]));const t=s.map(t=>String(t.id)===String(l)?(0,o.A)((0,o.A)({},t),{},{fromDatabase:!0,recurrenceId:e.recurrenceId,isValidated:!0}):t);i(t)}else console.error("Failed to save recurring events",e.error),_.showNotification("Failed to save recurring events: "+(e.error||"Unknown error"),"error"),console.log("Falling back to saveEvent for recurring event"),ce(n,l)}).catch(e=>{console.error("Error in saveRecurringEvents:",e),G(!1),_.showNotification("Error saving recurring events","error"),ce(n,l)})}}else if(r&&e&&!a){console.log("Saving regular (non-recurring) event to database");const r=(0,o.A)((0,o.A)({},n),{},{userId:e,isAvailability:"worker"===t||n.isAvailability});B(r,e).then(e=>{if(console.log("Regular saveEvent result:",e),G(!1),e.success){console.log("Event saved successfully with ID:",e.id),D(t=>new Set([...t,e.id]));const t=s.map(t=>String(t.id)===String(n.id)?(0,o.A)((0,o.A)({},t),{},{id:e.id,fromDatabase:!0,isValidated:!0}):t);i(t),_.showNotification("Event saved successfully","success")}else console.error("Failed to save event:",e.error),_.showNotification("Failed to save event: "+(e.error||"Unknown error"),"error")}).catch(e=>{console.error("Error saving event:",e),G(!1),_.showNotification("Error saving event","error")})}else r&&G(!1);if(i(c),r)oe(c);else{const e=c.find(e=>String(e.id)===String(n.id))||c.find(e=>String(e.id).startsWith(l));f(e||null),v(e?String(e.id):null)}},[e,t,oe]),(0,r.useCallback)((n,r)=>{console.log("Using saveRecurringEventFallback with direct saveEvent call");const a=(0,o.A)((0,o.A)({},n),{},{id:r,fromDatabase:!0,isAvailability:"worker"===t||n.isAvailability});B(a,e).then(e=>{console.log("Fallback saveEvent result:",e),G(!1),e.success?(console.log("Fallback save successful"),_.showNotification("Event saved successfully","success"),D(e=>new Set([...e,r]))):(console.error("Fallback save failed:",e.error),_.showNotification("Failed to save event: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error in fallback save:",e),G(!1),_.showNotification("Error saving event","error")})},[t,e])),de=(0,r.useCallback)(function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;console.log("handleEventDelete called with:",{eventId:n,deleteType:o});const s=r.find(e=>String(e.id)===String(n));if(!s)return void console.warn("Event not found for deletion:",n);let i;const l=String(s.id).split("-")[0],c=new Date(s.start);"future"===o&&(s.isRecurring||s.recurrenceId||String(s.id).includes("-"))?(console.log("Deleting this and all future occurrences from series"),i=r.filter(e=>{if(!String(e.id).startsWith(l)&&(!e.recurrenceId||e.recurrenceId!==s.recurrenceId))return!0;return new Date(e.start)<c})):"all"===o&&(s.isRecurring||s.recurrenceId)?(console.log("Deleting all occurrences of the series"),i=r.filter(e=>!(String(e.id).startsWith(l)||e.recurrenceId&&e.recurrenceId===s.recurrenceId))):(console.log("Deleting only this occurrence"),i=r.filter(e=>String(e.id)!==String(n))),console.log("Event Delete - Updated events array:",i),a(i),oe(i),e?async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"worker",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"single",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;try{console.log("Deleting event:",e,"for user:",t,"type:",o);const a={eventId:e,userId:t,accountType:n,deleteType:o,recurrenceId:r};console.log("Delete data:",a);const s=(0,W.Qg)(z.functions,"deleteCalendarEvent"),i=await s(a);return console.log("Delete event result:",i.data),i.data}catch(a){return console.error("Error deleting event:",a),a.message.includes("CORS")||a.message.includes("Access-Control-Allow-Origin")?(console.error("CORS error detected during delete - this is a server configuration issue"),{success:!1,error:"Server configuration error. The backend needs to be configured to allow requests from this domain. Please contact your system administrator."}):a.message.includes("net::ERR_FAILED")||a.message.includes("Failed to fetch")?(console.error("Network error detected during delete"),{success:!1,error:"Network error. Please check your internet connection and try again."}):{success:!1,error:"Failed to delete event: ".concat(a.code||"unknown error")}}}(n,e,t,o,s.recurrenceId).then(e=>{e.success?console.log("Event deleted from database successfully"):console.error("Failed to delete event from database:",e.error)}).catch(e=>{console.error("Error deleting event from database:",e)}):console.warn("Auth not ready or user not logged in, event not deleted from database"),f(null),v(null),j(!1),C(null)},[e,t,oe]),ue=(0,r.useCallback)(e=>{const t=new Date(e);t.setHours(9,0,0,0);const n=new Date(t);n.setHours(10,0,0,0);const r={id:"temp-".concat(Date.now()),title:"",start:t,end:n,color:l[0].color,color1:l[0].color1,category:l[0].name,notes:"",location:"",employees:"",isRecurring:!1,position:{x:window.innerWidth/2,y:window.innerHeight/2}};y((0,o.A)((0,o.A)({},r),{},{start:new Date(t),end:new Date(n)})),f(r)},[l]),ge=(0,r.useCallback)((e,t)=>{if(!e||!t)return;const n=new Date(e.start),o=new Date(e.end).getTime()-n.getTime(),r=new Date(t);r.setHours(n.getHours(),n.getMinutes(),0,0);const a=new Date(r.getTime()+o);console.log("Event drop on day:",{draggedEvent:e,targetDate:t,newStart:r,newEnd:a})},[]),me=(0,r.useCallback)((n,r)=>{if(console.log("Saving event:",n),r){console.log("Immediate panel close, mark as validated, and showing loading spinner");const e=u.map(e=>{var t,r,a;return e.id===n.id?(0,o.A)((0,o.A)((0,o.A)({},e),n),{},{isValidated:!0,color:(null===(t=l.find(e=>"blue"===e.id))||void 0===t?void 0:t.color)||e.color,color1:(null===(r=l.find(e=>"blue"===e.id))||void 0===r?void 0:r.color1)||e.color1,color2:(null===(a=l.find(e=>"blue"===e.id))||void 0===a?void 0:a.color2)||e.color2,fromDatabase:!0}):e});var a,s,i;if(-1===u.findIndex(e=>e.id===n.id))e.push((0,o.A)((0,o.A)({},n),{},{isValidated:!0,color:(null===(a=l.find(e=>"blue"===e.id))||void 0===a?void 0:a.color)||n.color,color1:(null===(s=l.find(e=>"blue"===e.id))||void 0===s?void 0:s.color1)||n.color1,color2:(null===(i=l.find(e=>"blue"===e.id))||void 0===i?void 0:i.color2)||n.color2,fromDatabase:!0}));g(e),oe(e),D(e=>new Set([...e,n.id])),f(null),v(null),y(null),G(!0)}const c=u.find(e=>e.id===n.id),d=!(null!==c&&void 0!==c&&c.fromDatabase);if(e&&r){const r=(0,o.A)((0,o.A)({},n),{},{userId:e,isAvailability:"worker"===t||n.isAvailability,isValidated:!0});n.isRecurring&&n.repeatValue&&"None"!==n.repeatValue?(console.log("Saving recurring event to database in background"),U(r,e).then(e=>{console.log("Background recurring save result:",e),G(!1),e.success?_.showNotification("Recurring events saved successfully","success"):(console.error("Failed to save recurring events",e.error),_.showNotification("Failed to save recurring events: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error saving recurring events:",e),G(!1),_.showNotification("Error saving recurring events","error")})):d?(console.log("Saving new event to database in background"),B(r,e).then(e=>{console.log("Background save result:",e),G(!1),e.success?(_.showNotification("Event saved successfully","success"),e.id&&e.id!==n.id&&g(t=>t.map(t=>t.id===n.id?(0,o.A)((0,o.A)({},t),{},{id:e.id}):t))):(console.error("Failed to save event:",e.error),_.showNotification("Failed to save event: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error saving event:",e),G(!1),_.showNotification("Error saving event","error")})):(console.log("Updating existing event in database in background"),Y(n.id,r,e,t).then(e=>{console.log("Background update result:",e),G(!1),e.success?(_.showNotification("Event updated successfully","success"),D(e=>new Set([...e,n.id]))):(console.error("Failed to update event:",e.error),_.showNotification("Failed to update event: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error updating event:",e),G(!1),_.showNotification("Error updating event","error")}))}else{const e=u.map(e=>e.id===n.id?(0,o.A)((0,o.A)({},e),n):e);u.find(e=>e.id===n.id)||e.push(n),g(e),r&&(oe(e),G(!1))}},[u,g,oe,D,f,v,y,G,e,t,l]),fe=(0,r.useCallback)((e,t)=>{t.preventDefault(),t.stopPropagation(),console.log("Event right-clicked:",e)},[]),he=(0,r.useCallback)(function(n,r,a){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=u.find(e=>e.id===n);if(!i)return void console.error("Event not found:",n);s?(ee(!0),ne(Date.now())):setTimeout(()=>{ee(!1)},250);const l=[...u],c=l.findIndex(e=>e.id===n);if(-1===c)return void console.error("Event index not found:",n);if(s)return l[c]=(0,o.A)((0,o.A)({},l[c]),{},{start:r,end:a,isBeingResized:!0}),void g(l);const d=i.isRecurringInstance,m=d?u.find(e=>e.id===i.recurringParentId):i;if(i.isRecurring||(null===m||void 0===m?void 0:m.recurrence)||d||String(n).includes("-")||String(n).includes("_"))return H({type:"resize",eventId:n,event:i,originalEvent:m,newStart:r,newEnd:a}),M({start:i.start instanceof Date?i.start:new Date(i.start),end:i.end instanceof Date?i.end:new Date(i.end)}),L({start:r,end:a}),T(i),void requestAnimationFrame(()=>{S(!0)});l[c]=(0,o.A)((0,o.A)({},l[c]),{},{start:r,end:a,isBeingResized:!1}),g(l),oe(l);const f=!i.isValidated&&!i.fromDatabase;if(e&&!f){const o={id:n,start:r,end:a,title:i.title,color:i.color,color1:i.color1,color2:i.color2,isValidated:i.isValidated||!1,isRecurring:!1,notes:i.notes,location:i.location,employees:i.employees,canton:i.canton,area:i.area,experience:i.experience,software:i.software,certifications:i.certifications,isAvailability:i.isAvailability};console.log("Updating resized event in database:",o),Y(n,o,e,t).then(e=>{e.success?(console.log("Event resize updated in database successfully"),D(e=>new Set([...e,n]))):(console.warn("Database update failed for resize operation:",e.error),_.showNotification("Failed to save resize changes","warning"))}).catch(e=>{console.warn("Database update error for resize operation:",e),_.showNotification("Failed to save resize changes","warning")})}else console.log("Skipping database update - either no userId or event is new");console.log("Event resized successfully")},[u,g,oe,H,M,L,T,S,ee,ne]),ve=(0,r.useCallback)(function(n,r,a){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=u.find(e=>e.id===n);if(!i)return void console.error("Event not found:",n);s?(ee(!0),ne(Date.now())):setTimeout(()=>{ee(!1)},250);const l=r instanceof Date?r:new Date(r),c=a instanceof Date?a:new Date(a),d=i.isRecurringInstance,m=d?u.find(e=>e.id===i.recurringParentId):i,f=[...u],h=f.findIndex(e=>e.id===n);if(-1===h)return void console.error("Event index not found:",n);if(s)return f[h]=(0,o.A)((0,o.A)({},f[h]),{},{start:l,end:c,isBeingMoved:!0}),void g(f);const v=i.isRecurring||(null===m||void 0===m?void 0:m.recurrence)||d||String(n).includes("-")||String(n).includes("_");let p=i.isLastOccurrence||!1;if(v&&i.recurrenceId&&!p){const e=u.filter(e=>e.recurrenceId===i.recurrenceId);if(e.length>0){e.sort((e,t)=>{const n=e.end instanceof Date?e.end:new Date(e.end);return(t.end instanceof Date?t.end:new Date(t.end)).getTime()-n.getTime()});const t=e[0];p=i.id===t.id,console.log("Checking if event ".concat(i.id," is last in series: ").concat(p))}}if(v)return H({type:d?"move_single":"move",eventId:n,event:i,originalEvent:m,newStart:l,newEnd:c}),M({start:i.start instanceof Date?i.start:new Date(i.start),end:i.end instanceof Date?i.end:new Date(i.end)}),L({start:l,end:c}),T((0,o.A)((0,o.A)({},i),{},{isLastOccurrence:p})),void requestAnimationFrame(()=>{S(!0)});f[h]=(0,o.A)((0,o.A)({},f[h]),{},{start:l,end:c,isBeingMoved:!1}),g(f),oe(f);const x=!i.isValidated&&!i.fromDatabase;if(e&&!x){const o={id:n,start:l,end:c,title:i.title,color:i.color,color1:i.color1,color2:i.color2,isValidated:i.isValidated||!1,isRecurring:!1,notes:i.notes,location:i.location,employees:i.employees,canton:i.canton,area:i.area,experience:i.experience,software:i.software,certifications:i.certifications,isAvailability:i.isAvailability};console.log("Updating moved event in database:",o),Y(n,o,e,t).then(e=>{e.success?(console.log("Event move updated in database successfully"),D(e=>new Set([...e,n]))):(console.warn("Database update failed for move operation:",e.error),_.showNotification("Failed to save move changes","warning"))}).catch(e=>{console.warn("Database update error for move operation:",e),_.showNotification("Failed to save move changes","warning")})}else console.log("Skipping database update - either no userId or event is new");console.log("Event moved successfully")},[u,g,oe,H,M,L,T,S,ee,ne]),pe=(0,r.useCallback)(n=>{console.log("Modification confirm:",n),O?(async(e,t,n,r,a,s,l,c,d,u,g,m,f,h,v,p,x)=>{if(console.log("handleModificationConfirm called with type:",e,"pendingModification:",t),!t)return void console.error("handleModificationConfirm called but no pending modification");d(!1);const{type:b,eventId:y,event:w,newStart:D,newEnd:k}=t;if(console.log("Processing event:",y,"with modification type:",b),"cancel"===e){if(b===i.MOVE||b===i.RESIZE||b===i.MOVE_SINGLE){const e=n.map(e=>e.id===y?(0,o.A)((0,o.A)({},e),{},{start:(null===c||void 0===c?void 0:c.start)instanceof Date?c.start:new Date(c.start),end:(null===c||void 0===c?void 0:c.end)instanceof Date?c.end:new Date(c.end),isBeingMoved:!1}):e);r(e),p&&(console.log("Event move canceled, resetting local storage"),p(e)),x&&x(e=>{const t=new Set(e);return t.delete(y),t})}return u(null),g(null),m(null),void f(null)}if("single"===e){const e=n.findIndex(e=>String(e.id)===String(y));if(-1!==e){console.log("Modifying single event ".concat(y," from recurring series"));const t=[...n],i=!!t[e].recurrenceId;if(t[e]=(0,o.A)((0,o.A)({},t[e]),{},{start:D,end:k,isBeingMoved:!1}),i&&(console.log("Removing recurrenceId from single moved event ".concat(y)),delete t[e].recurrenceId,t[e].isRecurring=!1),r(t),a(t),console.log("Single recurring event modification completed"),s){const n={id:y,start:D,end:k,title:t[e].title,color:t[e].color,color1:t[e].color1,color2:t[e].color2,isValidated:t[e].isValidated||!1,isRecurring:!1,notes:t[e].notes,location:t[e].location,employees:t[e].employees,canton:t[e].canton,area:t[e].area,experience:t[e].experience,software:t[e].software,certifications:t[e].certifications,isAvailability:t[e].isAvailability};console.log("Sending update to database for single event:",n),Y(y,n,s,l).then(e=>{e.success?console.log("Single event modified successfully in database"):console.error("Failed to modify single event in database:",e.error)}).catch(e=>{console.error("Error modifying single event in database:",e)})}}}else if("all"===e){const e=new Date(w.start),t=c?new Date(c.start):new Date(w.start),i=String(y).split(/[-_]/)[0],d=w.recurrenceId;console.log("Modifying all future occurrences with baseId: ".concat(i,", recurrenceId: ").concat(d,", eventId: ").concat(y));const u=n.filter(e=>String(e.id).startsWith(i)||d&&e.recurrenceId===d);console.log("Found ".concat(u.length," events in this series"));const g=D.getTime()-t.getTime();console.log("Time difference to apply: ".concat(g,"ms"));const m="".concat(s,"_").concat(Date.now(),"_recurrence");console.log("Generated new recurrenceId for modified events: ".concat(m));const f=[],h=u.findIndex(e=>String(e.id)===String(y));if(-1!==h){console.log("Found current event at index ".concat(h,": ").concat(y));const e=(0,o.A)((0,o.A)({},u[h]),{},{start:D,end:k,recurrenceId:m,isBeingMoved:!1});f.push(e)}else console.warn("Could not find current event ".concat(y," in series events"));for(const n of u)if(String(n.id)!==String(y)&&new Date(n.start)>=e){const e=new Date(n.start.getTime()+g),t=new Date(n.end.getTime()+g);console.log("Modifying event ".concat(n.id," from ").concat(n.start," to ").concat(e));const r=(0,o.A)((0,o.A)({},n),{},{start:e,end:t,recurrenceId:m,isBeingMoved:!1});f.push(r)}console.log("Modified ".concat(f.length," events in total"));const v=[...n.filter(e=>!(String(e.id).startsWith(i)||d&&e.recurrenceId===d)),...f];r(v),a(v),console.log("All recurring event modifications completed"),s&&(console.log("Updating database with modified recurring events"),f.forEach(e=>{const t={id:e.id,start:e.start,end:e.end,title:e.title,color:e.color,color1:e.color1,color2:e.color2,isValidated:e.isValidated||!1,isRecurring:!0,recurrenceId:m,notes:e.notes,location:e.location,employees:e.employees,canton:e.canton,area:e.area,experience:e.experience,software:e.software,certifications:e.certifications,isAvailability:e.isAvailability,isBeingMoved:!1};Y(e.id,t,s,l).then(t=>{t.success?console.log("Event ".concat(e.id," modified successfully in database")):console.error("Failed to modify event ".concat(e.id," in database:"),t.error)}).catch(t=>{console.error("Error modifying event ".concat(e.id," in database:"),t)})}))}u(null),g(null),m(null),f(null)})(n,O,u,g,oe,e,t,R,S,H,T,M,L,0,0,c,d):console.error("handleModificationConfirm called but no pending modification")},[O,u,g,oe,e,t,R,S,H,T,M,L,f,v,c,d]),xe=(0,r.useCallback)(()=>{console.log("Move confirm"),pe("single")},[pe]),be=(0,r.useCallback)(()=>{console.log("Move all confirm"),pe("all")},[pe]),ye=(0,r.useCallback)(()=>{console.log("Move cancel"),pe("cancel")},[pe]),we=(0,r.useCallback)(()=>{console.log("Event change complete"),oe([...u])},[oe,u]);return{events:u,setEvents:g,selectedEvent:m,setSelectedEvent:f,selectedEventId:h,setSelectedEventId:v,selectedEventIds:p,setSelectedEventIds:x,originalEventPosition:b,setOriginalEventPosition:y,validatedEvents:w,setValidatedEvents:D,showDeleteConfirmation:k,setShowDeleteConfirmation:j,eventToDelete:N,setEventToDelete:C,showMoveConfirmation:E,setShowMoveConfirmation:S,movedEvent:A,setMovedEvent:T,originalEventDates:R,setOriginalEventDates:M,newEventDates:I,setNewEventDates:L,showModificationDialog:F,setShowModificationDialog:V,pendingModification:O,setPendingModification:H,isSaving:P,setIsSaving:G,history:q,currentHistoryIndex:J,addToHistory:oe,handleEventClick:se,handleEventDoubleClick:ie,handleEventRightClick:fe,handlePanelClose:le,handleEventSave:me,handleEventDelete:de,handleEventResize:he,handleEventMove:ve,handleModificationConfirm:pe,handleMoveConfirm:xe,handleMoveAllConfirm:be,handleMoveCancel:ye,handleEventChangeComplete:we,handleCreateEventClick:ue,handleEventDropOnDay:ge,undo:re,redo:ae,slideDirection:Q,setSlideDirection:Z,isDragging:$,setIsDragging:ee,dragStartTime:te,setDragStartTime:ne}},q=e=>{let{userData:t}=e;const{t:n}=(0,a.Bd)(["dashboard","calendar"]),{isTutorialActive:i,activeTutorial:l}=(0,L.s8)(),{selectedWorkspace:d}=(0,N.M)(),u=(e=>{var t;return(null===e||void 0===e||null===(t=e.basicInfo)||void 0===t?void 0:t.accountType)||"worker"})(t),g=(e=>{var t,n;const o=[null===e||void 0===e?void 0:e.uid,null===e||void 0===e?void 0:e.firebase_uid,null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.userId,null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.uid,null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.id].find(e=>e&&"string"===typeof e);return o||console.warn("No valid user ID found in userData:",e),o||null})(t),{isMainSidebarCollapsed:x}=(0,I.c)(),[w,C]=(0,r.useState)(!1),E=(0,r.useRef)(null),S=(0,r.useRef)(null),[A,T]=(0,r.useState)(null),R=(()=>{if(!d)return{type:"personal",role:"professional"};let e=d.role;return"admin"===e&&(e="manager"),{type:d.type,role:e}})(),{currentDate:W,setCurrentDate:O,view:H,setView:P,categories:B,setCategories:U,isSidebarCollapsed:_,setIsSidebarCollapsed:q,showHeaderDateDropdown:K,setShowHeaderDateDropdown:J,dropdownPosition:X,navigateDate:Q,handleDayClick:Z,handleUpcomingEventClick:$,handleCategoryToggle:ee,handleHeaderDateClick:te,toggleSidebar:ne}=F(),[oe,re]=(0,r.useState)(()=>{const e=new Date(W),t=e.getDay(),n=0===t?-6:1-t;return e.setDate(e.getDate()+n),e.setHours(0,0,0,0),e}),[ae,se]=(0,r.useState)(()=>{const e=new Date(W),t=e.getDay(),n=0===t?0:7-t;return e.setDate(e.getDate()+n),e.setHours(23,59,59,999),e}),ie=Q,le=Z,ce=$,[de,ue]=(0,r.useState)(30),ge=(0,r.useRef)(de),me=((0,r.useRef)(!1),(0,r.useRef)(!1));(0,r.useLayoutEffect)(()=>{const e=E.current;if(e){if("day"===H&&de>ge.current){const t=de-ge.current,n=e.clientWidth;e.scrollLeft+=t*n}ge.current=de}},[de,H,E]),(0,r.useEffect)(()=>{const e=E.current;if(!e||"week"!==H)return;const t=new Date(W),n=t.getDay(),o=0===n?-6:1-n;t.setDate(t.getDate()+o),t.setHours(0,0,0,0);const r=m(W,0,0);let a=-1;for(let i=0;i<r.length;i++){const e=new Date(r[i][0]);e.setHours(0,0,0,0);const n=new Date(r[i][6]);if(n.setHours(23,59,59,999),t>=e&&t<=n){a=i;break}}if(-1===a)return;r.length;const s=a*e.clientWidth;e.scrollTo({left:s,behavior:me.current?"smooth":"auto"}),me.current||(me.current=!0)},[W,H,0]),(0,r.useEffect)(()=>{const e=E.current;if(!e||"week"!==H)return;let t;const n=()=>{const t=e.scrollLeft,n=e.clientWidth;if(0===n)return;const o=Math.round(t/n),r=m(W,0,0);if(o>=0&&o<r.length){const e=r[o],t=new Date(e[0]);t.setHours(0,0,0,0);const n=new Date(e[6]);n.setHours(23,59,59,999);"".concat(oe.getFullYear(),"-").concat(oe.getMonth(),"-").concat(oe.getDate())!=="".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate())&&(re(t),se(n))}},o=()=>{t&&clearTimeout(t),t=setTimeout(n,150)};return e.addEventListener("scroll",o,{passive:!0}),n(),()=>{e.removeEventListener("scroll",o),t&&clearTimeout(t)}},[E,H,W,0,oe]);const{saveEventsToLocalStorage:fe,setPendingChanges:he,pendingChanges:ve}=((e,t)=>{const[n,a]=(0,r.useState)(new Set),[s,i]=(0,r.useState)(Date.now()),l=(0,r.useCallback)(t=>{try{const n={events:t,timestamp:Date.now(),userId:e};localStorage.setItem("calendar_events_".concat(e),JSON.stringify(n)),console.log("Events saved to local storage")}catch(n){console.error("Error saving events to local storage:",n)}},[e]),c=(0,r.useCallback)(()=>{try{const t=localStorage.getItem("calendar_events_".concat(e));if(t){const n=JSON.parse(t);if(n.userId===e)return console.log("Events loaded from local storage"),n.events.map(e=>(0,o.A)((0,o.A)({},e),{},{start:new Date(e.start),end:new Date(e.end)}))}return null}catch(t){return console.error("Error loading events from local storage:",t),null}},[e]),d=(0,r.useCallback)(e=>{a(t=>new Set([...t,e]))},[]),u=(0,r.useCallback)(async o=>{if(0===n.size||!e)return void console.log("No pending changes or no userId - skipping sync",{pendingChanges:n.size,userId:e});console.log("Syncing ".concat(n.size," pending changes to database"),Array.from(n));const r=Array.from(n);for(const n of r){const r=o.find(e=>e.id===n);if(r)if(r.fromDatabase||r.isValidated||r.id&&!r.id.toString().startsWith("temp-")&&!r.id.toString().startsWith("duplicate-")&&r.id.toString().length>10)try{console.log("Syncing event ".concat(n," to database - fromDB: ").concat(r.fromDatabase,", validated: ").concat(r.isValidated));const o={id:n,start:r.start,end:r.end,title:r.title,color:r.color,color1:r.color1,color2:r.color2,isValidated:r.isValidated||!1,isRecurring:r.isRecurring||!1,recurrenceId:r.recurrenceId,notes:r.notes,location:r.location,employees:r.employees,canton:r.canton,area:r.area,experience:r.experience,software:r.software,certifications:r.certifications,isAvailability:r.isAvailability},s=await Y(n,o,e,t,!0);s.success?(console.log("Successfully synced event ".concat(n," to database")),a(e=>{const t=new Set(e);return t.delete(n),t})):console.warn("Failed to sync event ".concat(n,":"),s.error)}catch(s){console.warn("Error syncing event ".concat(n,":"),s)}else console.log("Skipping sync for event ".concat(n," - appears to be local-only or temporary")),a(e=>{const t=new Set(e);return t.delete(n),t});else console.warn("Event ".concat(n," not found in events array - removing from pending changes")),a(e=>{const t=new Set(e);return t.delete(n),t})}i(Date.now())},[n,e,t]);return(0,r.useEffect)(()=>{const e=setInterval(()=>{n.size>0&&console.log("Periodic sync triggered - syncing pending changes")},3e5);return()=>clearInterval(e)},[n.size]),(0,r.useEffect)(()=>{const e=()=>{n.size>0&&console.log("Page unload detected - syncing pending changes")},t=()=>{"hidden"===document.visibilityState&&n.size>0&&console.log("Page hidden - syncing pending changes")};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[n.size]),{pendingChanges:n,lastSyncTime:s,saveEventsToLocalStorage:l,loadEventsFromLocalStorage:c,markEventForSync:d,syncPendingChanges:u,setPendingChanges:a,setLastSyncTime:i}})(g,u),{events:pe,setEvents:xe,selectedEvent:be,setSelectedEvent:ye,selectedEventId:we,setSelectedEventId:De,history:ke,currentHistoryIndex:je,validatedEvents:Ne,showDeleteConfirmation:Ce,setShowDeleteConfirmation:Ee,eventToDelete:Se,setEventToDelete:Ae,originalEventPosition:Te,setOriginalEventPosition:Re,handleEventSave:Me,handleEventDelete:Ie,handlePanelClose:Le,handleCreateEventClick:Fe,addToHistory:Ve,undo:ze,redo:We}=G(g,u,0,0,0,s,fe,he),Oe=(0,r.useCallback)((e,t)=>{T(null);const n=pe.find(t=>t.id===e.id)||e;Re((0,o.A)({id:n.id,start:new Date(n.start),end:new Date(n.end),title:n.title,color:n.color,color1:n.color1,notes:n.notes,location:n.location,employees:n.employees},n)),De(e.id),ye(n)},[pe,ye,De,Re]),He=(0,r.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),T({event:t,position:{x:e.clientX,y:e.clientY}})},[]),Pe=(0,r.useCallback)(()=>{T(null)},[]),Be=(0,r.useCallback)((e,t)=>{const n=pe.map(n=>n.id===e.id?(0,o.A)((0,o.A)({},n),{},{color:t.color,color1:t.color1,color2:t.color2,category:t.name}):n);xe(n),Ve(n)},[pe,xe,Ve]),Ye=(0,r.useCallback)(e=>{Ae(e),Ee(!0)},[Ae,Ee]),Ue=(0,r.useCallback)(function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=pe.findIndex(t=>t.id===e);if(-1===a)return;const s=pe[a];r&&!s.isBeingMoved&&Re((0,o.A)({id:s.id,start:new Date(s.start),end:new Date(s.end),title:s.title,color:s.color,color1:s.color1,notes:s.notes,location:s.location,employees:s.employees},s));const i=[...pe];if(i[a]=(0,o.A)((0,o.A)({},i[a]),{},{start:t,end:n,isBeingMoved:r}),xe(i),!r){const r=i[a],s=new Date(t);s.setHours(0,0,1,0);const l=new Date(t);l.setHours(23,59,59,999);if(!(t>=s&&t<=l&&n>=s&&n<=l&&n>t)){if(Te&&Te.id===e){const t=[...pe],n=t.findIndex(t=>t.id===e);-1!==n&&(t[n]=(0,o.A)((0,o.A)({},t[n]),{},{start:new Date(Te.start),end:new Date(Te.end),isBeingMoved:!1}),xe(t))}return}console.log("Event moved - opening panel for confirmation"),ye(r),De(r.id)}},[pe,xe,ye,De,Re,Te]),_e=(0,r.useCallback)(function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=pe.findIndex(t=>t.id===e);if(-1===a)return;const s=pe[a];r&&!s.isBeingResized&&(console.log("Resize started - storing original position"),Re((0,o.A)({id:s.id,start:new Date(s.start),end:new Date(s.end),title:s.title,color:s.color,color1:s.color1,notes:s.notes,location:s.location,employees:s.employees},s)));const i=[...pe];if(i[a]=(0,o.A)((0,o.A)({},i[a]),{},{start:t,end:n,isBeingResized:r}),xe(i),!r){const e=i[a];console.log("Event resized - opening panel for confirmation"),ye(e),De(e.id)}},[pe,xe,ye,De,Re]),Ge=(0,r.useCallback)(function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("handleGridCreateEvent called:",{newEvent:e,openPanel:t});const n=(0,o.A)((0,o.A)({},e),{},{color:e.color||s[0].color,color1:e.color1||s[0].color1,color2:s[0].color2,category:s[0].name,title:e.title||"",notes:"",location:"",employees:""});console.log("Event with defaults:",n);const r=[...pe,n];xe(r),Ve(r),console.log("Event added to array, count:",r.length),t?(console.log("Opening panel for event:",n.id),Re((0,o.A)((0,o.A)({},n),{},{start:new Date(n.start),end:new Date(n.end)})),ye(n),De(n.id),console.log("Panel opened, event visible in UI")):console.log("Event added without panel (should not happen now)")},[pe,xe,Ve,ye,De,Re]),{handleKeyboardShortcuts:qe}=((e,t,n,o,a,s)=>{const i=(0,r.useCallback)(r=>{"INPUT"!==r.target.tagName&&"TEXTAREA"!==r.target.tagName&&(r.ctrlKey&&"z"===r.key&&!r.shiftKey?(r.preventDefault(),e&&e()):r.ctrlKey&&r.shiftKey&&"Z"===r.key||r.ctrlKey&&"y"===r.key?(r.preventDefault(),t&&t()):"Delete"===r.key&&n&&!o?(r.preventDefault(),a&&a(n)):"Escape"===r.key&&(r.preventDefault(),n&&s&&s()))},[e,t,n,o,a,s]);return(0,r.useEffect)(()=>(document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}),[i]),{handleKeyboardShortcuts:i}})(()=>ze(pe,xe),()=>We(pe,xe),be,Ce,e=>{Ae(e),Ee(!0)},()=>Le(pe,xe)),Ke=((e,t,n)=>{const o=t.reduce((e,t)=>(t.checked&&e.push(t.color),e),[]);return 0===o.length?e:e.filter(e=>!!e&&(!(!e.id||!String(e.id).startsWith("temp-"))||!!e.isDraft||(!0===e.isValidated?o.includes(n.find(e=>"blue"===e.id).color):!1===e.isValidated?o.includes(n.find(e=>"grey"===e.id).color):o.includes(e.color))))})(pe,B,s),{events:Je}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"worker";const[n,o]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[i,l]=(0,r.useState)(null),{isTutorialActive:c,activeTutorial:d}=(0,L.s8)(),u=(0,r.useCallback)(()=>{if(!c||"calendar"!==d)return[];const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(t);n.setDate(n.getDate()+1);const o=new Date(t);return o.setDate(o.getDate()+7),[{id:"tutorial-availability-1",title:"Available",start:new Date(n.getTime()+324e5),end:new Date(n.getTime()+612e5),color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb",isAvailability:!0,isValidated:!0,fromDatabase:!1,isTutorial:!0},{id:"tutorial-availability-2",title:"Available",start:new Date(o.getTime()+288e5),end:new Date(o.getTime()+576e5),color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb",isAvailability:!0,isValidated:!0,fromDatabase:!1,isTutorial:!0},{id:"tutorial-contract-1",title:"Geneva Hospital - Temporary Contract",start:new Date("2026-02-01"),end:new Date("2026-03-31"),color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",isContract:!0,isValidated:!0,location:"Geneva Hospital, Rue Gabrielle-Perret-Gentil 4, 1205 Geneva",notes:"Emergency Department - Full-time position",fromDatabase:!1,isTutorial:!0},{id:"tutorial-contract-2",title:"Lausanne Clinic - Part-time",start:new Date("2026-04-01"),end:new Date("2026-06-30"),color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",isContract:!0,isValidated:!1,location:"Lausanne Clinic, Avenue de la Gare 28, 1000 Lausanne",notes:"General Practice - Weekends only",fromDatabase:!1,isTutorial:!0}]},[c,d]);return(0,r.useEffect)(()=>{if(!e)return void s(!1);if(c&&"calendar"===d){const e=u();return o(e),s(!1),void l(null)}console.log("Setting up real-time listener for user:",e,"accountType:",t);const n=(0,V.P)((0,V.rJ)(z.db,"availability"),(0,V._M)("userId","==",e)),r=(0,V.aQ)(n,e=>{try{const t=[];e.forEach(e=>{const n=e.data(),o=n.from instanceof V.Dc?n.from.toDate():new Date(n.from),r=n.to instanceof V.Dc?n.to.toDate():new Date(n.to),a=n.isValidated||!1;let s,i,l;a?(s="#0f54bc",i="#a8c1ff",l="#4da6fb"):(s="#8c8c8c",i="#e6e6e6",l="#b3b3b3"),t.push({id:e.id,title:n.title||"Available",start:o,end:r,color:s,color1:i,color2:l,isAvailability:!0,isValidated:a,recurrenceId:n.recurrenceId||null,isRecurring:!!n.recurrenceId,canton:n.locationCountry||[],area:n.LocationArea||[],languages:n.languages||[],experience:n.experience||"",software:n.software||[],certifications:n.certifications||[],workAmount:n.workAmount||"",notes:n.notes||"",location:n.location||"",fromDatabase:!0})}),t.sort((e,t)=>t.start-e.start),console.log("Real-time update: ".concat(t.length," availability events loaded")),o(e=>{const n=e.filter(e=>e.isContract);return[...t,...n]}),s(!1),l(null)}catch(t){console.error("Error processing availability events:",t),l(t.message),s(!1)}},e=>{console.error("Error in availability events listener:",e),l(e.message),s(!1)});let a=null;if("employer"===t||"worker"===t||"professional"===t){const n=(0,V.P)((0,V.rJ)(z.db,"contracts"),(0,V._M)("parties.professional.profileId","==",e)),r=(0,V.P)((0,V.rJ)(z.db,"contracts"),(0,V._M)("parties.employer.profileId","==",e)),s=(0,V.P)((0,V.rJ)(z.db,"contracts"),(0,V._M)("workerId","==",e)),i=(0,V.P)((0,V.rJ)(z.db,"contracts"),(0,V._M)("employerId","==",e)),l=[];("employer"===t?[r,i]:[n,s]).forEach((e,t)=>{const n=(0,V.aQ)(e,e=>{try{const n=[];e.forEach(e=>{var t;const o=e.data(),r=(null===(t=o.statusLifecycle)||void 0===t?void 0:t.currentStatus)||o.status;if("active"!==r&&"pending"!==r&&"pending_professional_approval"!==r&&"pending_facility_approval"!==r)return;const a=o.from instanceof V.Dc?o.from.toDate():new Date(o.from),s=o.to instanceof V.Dc?o.to.toDate():new Date(o.to);n.push({id:e.id,title:o.title||"Contract",start:a,end:s,color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",isContract:!0,isValidated:o.isValidated||!1,location:o.location||"",notes:o.notes||"",fromDatabase:!0})}),console.log("Real-time update: ".concat(n.length," contract events loaded from query ").concat(t+1)),o(e=>{const t=e.filter(e=>e.isAvailability),o=e.filter(e=>e.isContract),r=new Map;return[...o,...n].forEach(e=>{r.has(e.id)||r.set(e.id,e)}),[...t,...Array.from(r.values())]})}catch(n){console.error("Error processing contract events:",n)}},e=>{console.error("Error in contract events listener:",e)});l.push(n)}),a=()=>{l.forEach(e=>e())}}return()=>{console.log("Cleaning up real-time listeners"),r(),a&&a()}},[e,t]),{events:n,loading:a,error:i}}(g,u),Xe=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(Je){if(JSON.stringify(Je.map(e=>{var t,n;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(n=e.end)||void 0===n?void 0:n.getTime()}}))===(Xe.current?JSON.stringify(Xe.current.map(e=>{var t,n;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(n=e.end)||void 0===n?void 0:n.getTime()}})):null))return;Xe.current=Je;const e=Je.map(e=>(0,o.A)((0,o.A)({},e),{},{fromDatabase:!0,isValidated:!0}));xe(t=>{const n=t.filter(e=>!e.fromDatabase),o=t.filter(e=>e.isBeingMoved||e.isBeingResized),r=new Set(o.map(e=>e.id)),a=new Map(e.map(e=>[e.id,e])),s=[];for(const d of e)if(r.has(d.id)){const e=o.find(e=>e.id===d.id);s.push(e)}else s.push(d);for(const e of o)a.has(e.id)||s.push(e);s.push(...n);const i=JSON.stringify(s.map(e=>{var t,n;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(n=e.end)||void 0===n?void 0:n.getTime()}})),l=JSON.stringify(t.map(e=>{var t,n;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(n=e.end)||void 0===n?void 0:n.getTime()}})),c=ke[je]?JSON.stringify(ke[je].map(e=>{var t,n;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(n=e.end)||void 0===n?void 0:n.getTime()}})):null;return i!==l&&i!==c&&Ve(s),s})}},[Je,xe,Ve,ke,je]),(0,r.useEffect)(()=>{const e=document.querySelector(".time-slots");e&&(e.scrollTop=420)},[]),(0,r.useEffect)(()=>{const e=S.current,t=E.current;if(!e||!t)return;let n=!1;const o=()=>{n||(n=!0,e&&(e.scrollLeft=t.scrollLeft),requestAnimationFrame(()=>{n=!1}))},r=()=>{n||(n=!0,t&&(t.scrollLeft=e.scrollLeft),requestAnimationFrame(()=>{n=!1}))};return t.addEventListener("scroll",o),e.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",o),e.removeEventListener("scroll",r)}},[]),(0,r.useEffect)(()=>(document.addEventListener("keydown",qe),()=>document.removeEventListener("keydown",qe)),[qe]),(0,r.useEffect)(()=>{console.log("selectedEvent changed:",be),console.log("selectedEventId changed:",we)},[be,we]),(0,r.useEffect)(()=>{const e=()=>{A&&T(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[A]);const Qe=(0,r.useCallback)(()=>{U(e=>e.map(e=>(0,o.A)((0,o.A)({},e),{},{checked:!0})))},[U]),Ze=B.some(e=>!e.checked);return(0,v.jsxs)("div",{className:"h-full flex flex-col overflow-hidden animate-in fade-in duration-500",children:[(0,v.jsxs)("div",{className:"shrink-0 w-full z-20 bg-card/95 backdrop-blur-sm border-b border-border shadow-sm flex items-center justify-between gap-4 px-6 h-16",children:[i&&"calendar"===l&&(0,v.jsxs)("div",{className:"calendar-view-options flex gap-2 mr-4",children:[(0,v.jsx)("button",{className:"px-3 py-1.5 bg-primary text-primary-foreground rounded-md text-sm font-medium",children:n("calendar:dayView")}),(0,v.jsx)("button",{className:"px-3 py-1.5 bg-muted text-muted-foreground rounded-md text-sm font-medium",children:n("calendar:weekView")}),(0,v.jsx)("button",{className:"px-3 py-1.5 bg-muted text-muted-foreground rounded-md text-sm font-medium",children:n("calendar:monthView")})]}),(0,v.jsx)(p,{currentDate:W,view:H,setView:P,navigateDate:ie,setCurrentDate:O,isSidebarCollapsed:!1,toggleSidebar:()=>q(!_),categories:B,handleCategoryToggle:ee,onResetCategories:Qe,isTopBarMode:!0,onShowFiltersOverlay:C,scrollContainerRef:E})]}),(0,v.jsxs)("div",{className:"flex-1 flex overflow-hidden relative p-4 gap-4",children:[(0,v.jsxs)("div",{className:(0,h.cn)("flex flex-col transition-all duration-300 w-full md:w-[320px] lg:w-[360px]",x?"flex":_?"hidden lg:flex w-0 overflow-hidden":"flex"),children:[i&&"calendar"===l&&(0,v.jsx)("div",{className:"mb-4",children:(0,v.jsxs)("button",{className:"new-appointment-button w-full py-2.5 px-4 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[(0,v.jsx)(f.wIk,{className:"w-4 h-4"}),n("calendar:newAppointment")]})}),(0,v.jsx)(b,{currentDate:W,setCurrentDate:O,handleUpcomingEventClick:ce,events:Ke,isSidebarCollapsed:_,handleCreateEventClick:()=>Fe(W),handleDayClick:le,showHeaderDateDropdown:K,setShowHeaderDateDropdown:J,handleHeaderDateClick:te,dropdownPosition:X,toggleSidebar:ne,view:H,visibleWeekStart:oe,visibleWeekEnd:ae})]}),(0,v.jsx)("div",{className:"flex-1 flex flex-col relative min-w-0 transition-all duration-300 bg-card border border-border/60 rounded-xl overflow-hidden",children:(0,v.jsxs)("div",{className:"flex-1 overflow-hidden relative calendar-grid flex flex-col",children:[(0,v.jsxs)("div",{className:"flex flex-shrink-0",style:{margin:0,padding:0},children:[(0,v.jsx)("div",{className:"flex-shrink-0 bg-background/95 backdrop-blur-sm z-10 flex items-end justify-center pb-2",style:{width:"4rem",minHeight:"3rem",borderLeft:"1px solid hsl(var(--border))",borderRight:"1px solid hsl(var(--border))",boxSizing:"border-box",margin:0,padding:0}}),(0,v.jsx)("div",{className:"flex-1 overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",ref:S,onScroll:e=>{E.current&&(E.current.scrollLeft=e.target.scrollLeft)},children:(0,v.jsx)(y,{currentDate:W,referenceDate:W,view:H,handleDayClick:le,scrollContainerRef:S,numWeeks:0,numDays:de})})]}),(0,v.jsx)("div",{className:"flex-1 time-slots bg-muted/5 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,v.jsxs)("div",{className:"relative min-h-full flex",style:{margin:0,padding:0},children:[(0,v.jsx)("div",{className:"sticky flex-shrink-0 bg-background/95 backdrop-blur-sm z-10",style:{width:"4rem",height:"1440px",position:"sticky",left:0,top:0,alignSelf:"flex-start",borderLeft:"1px solid hsl(var(--border))",borderRight:"1px solid hsl(var(--border))",boxSizing:"border-box",margin:0,padding:0},children:Array.from({length:24},(e,t)=>{const n=t;return(0,v.jsx)("div",{className:"h-[60px] text-[10px] text-muted-foreground text-right pr-4 relative",children:(0,v.jsx)("span",{className:"text-[10px] pb-1",children:n<10?"0".concat(n,":00"):"".concat(n,":00")})},t)})}),(0,v.jsx)("div",{className:"flex-1 calendar-scroll-container overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",style:{scrollSnapType:"x mandatory",scrollBehavior:"smooth"},ref:E,onScroll:e=>{S.current&&(S.current.scrollLeft=e.target.scrollLeft)},children:(0,v.jsx)("div",{className:"relative min-h-full min-w-max",children:(0,v.jsx)("div",{className:"time-grid h-full relative min-w-max",children:(0,v.jsx)(D,{view:H,events:Ke,selectedEventId:we,currentDate:W,referenceDate:W,getEventsForCurrentWeek:()=>((e,t)=>{const n=new Date(t[0]);n.setHours(0,0,0,0);const o=new Date(t[6]);return o.setHours(23,59,59,999),e.filter(e=>{const t=new Date(e.start),r=new Date(e.end);return t<=o&&r>=n})})(pe,c(W)),validatedEvents:Ne,onEventClick:Oe,onEventRightClick:He,onEventMove:Ue,onEventResize:_e,onCreateEvent:Ge,scrollContainerRef:E,numWeeks:0,numDays:de})})})})]})})]})})]}),A&&(0,v.jsx)(j,{event:A.event,position:A.position,onClose:Pe,onDelete:Ye,onColorChange:Be,colorOptions:s}),be&&(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(M,{event:be,onClose:()=>{Le(pe,xe)},onSave:Me,onDelete:()=>{be&&be.id&&(Ae(be),Ee(!0))},colorOptions:s,accountType:u,userData:t,workspaceContext:R})}),Ce&&Se&&(0,v.jsx)(k,{event:Se,currentDate:new Date(Se.start),onConfirm:e=>Ie(Se.id,e,pe,xe),onCancel:()=>{Ee(!1),Ae(null)}}),w&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>C(!1)}),(0,v.jsxs)("div",{className:(0,h.cn)("fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border rounded-t-2xl shadow-2xl","animate-in slide-in-from-bottom duration-300"),style:{height:"75vh"},children:[(0,v.jsxs)("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[(0,v.jsx)("h3",{className:"text-lg font-semibold m-0",children:n("calendar:categoryFilters")}),(0,v.jsx)("button",{onClick:()=>C(!1),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:(0,v.jsx)(f.yGN,{className:"w-5 h-5"})})]}),(0,v.jsxs)("div",{className:"overflow-y-auto p-4 space-y-2",style:{height:"calc(75vh - 73px)",scrollbarGutter:"stable"},children:[B.map((e,t)=>(0,v.jsxs)("label",{className:"flex items-center gap-3 px-3 py-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors",children:[(0,v.jsxs)("div",{className:"relative flex items-center",children:[(0,v.jsx)("input",{type:"checkbox",checked:e.checked,onChange:()=>ee(t),className:"peer h-4 w-4 rounded border text-primary focus:ring-1 focus:ring-primary/20 cursor-pointer transition-all appearance-none bg-background",style:{backgroundColor:e.checked?e.color:"transparent",borderColor:e.color,borderWidth:"1px"}}),(0,v.jsx)("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:(0,v.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]}),(0,v.jsx)("span",{className:"text-sm font-medium",children:e.name})]},t)),Ze&&(0,v.jsx)("button",{onClick:()=>{Qe(),C(!1)},className:"w-full h-10 rounded-lg border border-input bg-background text-sm font-medium hover:bg-muted transition-all mt-4",children:n("calendar:resetAll")})]})]})]})]})}}}]);
//# sourceMappingURL=358.a40b9565.chunk.js.map