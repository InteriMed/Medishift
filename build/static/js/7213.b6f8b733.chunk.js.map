{"version":3,"file":"static/js/7213.b6f8b733.chunk.js","mappings":"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","sources":["dashboard/pages/calendar/utils/constants.js","dashboard/pages/calendar/utils/dateHelpers.js","dashboard/pages/calendar/components/CalendarHeader.js","dashboard/pages/calendar/miniCalendar/MiniCalendar.js","dashboard/pages/calendar/components/CalendarSidebar.js","dashboard/pages/calendar/components/TimeHeaders.js","dashboard/pages/calendar/components/events/Event.js","dashboard/pages/calendar/components/TimeGrid.js","dashboard/pages/calendar/components/DeleteConfirmationDialog.js","dashboard/pages/calendar/components/EventContextMenu.js","components/BoxedInputFields/WeekDaySelector.js","dashboard/pages/calendar/EventPanel/CustomDateInput.js","dashboard/pages/calendar/EventPanel/EventPanel.js","dashboard/pages/calendar/utils/calendar.js","dashboard/pages/calendar/hooks/useCalendarState.js","dashboard/pages/calendar/utils/eventDatabase.js","utils/stores/notificationStore.js","dashboard/pages/calendar/hooks/useEventOperations.js","dashboard/pages/calendar/utils/eventModificationUtils.js","dashboard/components/ColorPicker/ColorPicker.js","dashboard/pages/calendar/components/AddFacilityRoleModal.js","dashboard/pages/calendar/components/ResourceGrid.js","dashboard/pages/calendar/Calendar.js","dashboard/pages/calendar/utils/userHelpers.js","dashboard/pages/calendar/hooks/useAutoSync.js","dashboard/pages/calendar/hooks/useKeyboardShortcuts.js","dashboard/pages/calendar/utils/eventUtils.js"],"sourcesContent":["// Calendar colors definitions\nexport const CALENDAR_COLORS = [\n  { id: 'blue', color: '#0f54bc', color1: '#a8c1ff', color2: '#4da6fb', name: 'Personal' },\n  { id: 'red', color: '#f54455', color1: '#ffbbcf', color2: '#ff6064', name: 'Missing employees' },\n  { id: 'purple', color: '#6c6ce7', color1: '#e6e6ff', color2: '#a08dfc', name: 'Waiting for confirmation' },\n  { id: 'green', color: '#0da71c', color1: '#ccffce', color2: '#32cb65', name: 'Approved employee' },\n  { id: 'grey', color: '#8c8c8c', color1: '#e6e6e6', color2: '#b3b3b3', name: 'Unvalidated' },\n];\n\n// Modification types for event changes\nexport const MODIFICATION_TYPES = {\n  MOVE: 'move',\n  RESIZE: 'resize',\n  PANEL: 'panel'\n}; ","// Helper function to compare only the date part (Y, M, D)\nexport const isDateBefore = (date1, date2) => {\n  const d1 = new Date(date1);\n  const d2 = new Date(date2);\n  d1.setHours(0, 0, 0, 0);\n  d2.setHours(0, 0, 0, 0);\n  return d1 < d2;\n};\n\n// Helper function to get Monday-based day index (Monday = 0, Sunday = 6)\nexport const getMondayBasedDayIndex = (date) => {\n  const jsDay = date.getDay(); // JavaScript's getDay: Sunday = 0, Monday = 1, ..., Saturday = 6\n  return jsDay === 0 ? 6 : jsDay - 1; // Convert to Monday = 0, Sunday = 6\n};\n\n// Get week dates starting from Monday\nexport const getWeekDates = (currentDate) => {\n  const start = new Date(currentDate);\n  const mondayIndex = getMondayBasedDayIndex(start);\n  start.setDate(start.getDate() - mondayIndex); // Start from Monday\n  const dates = [];\n  \n  for (let i = 0; i < 7; i++) {\n    const date = new Date(start);\n    date.setDate(start.getDate() + i);\n    dates.push(date);\n  }\n  return dates;\n};\n\n// Get short day names based on locale, starting from Monday\nexport const getShortDays = (language) => {\n  // Create dates for Monday through Sunday\n  const mondayDate = new Date(2000, 0, 3); // January 3, 2000 was a Monday\n  return Array.from({ length: 7 }, (_, i) => {\n    const date = new Date(mondayDate);\n    date.setDate(mondayDate.getDate() + i);\n    const day = date.toLocaleString(language, { weekday: 'short' }).slice(0, 3);\n    return day.charAt(0).toUpperCase() + day.slice(1);\n  });\n};\n\n// Generate time slots for the day view\nexport const generateTimeSlots = () => {\n  const times = [];\n  for (let i = 0; i < 24; i++) {\n    const hour = i < 10 ? `0${i}:00` : `${i}:00`;\n    times.push(hour);\n  }\n  return times;\n};\n\n// Get the week number for a given date\nexport const getWeekNumber = (date) => {\n  const firstDayOfYear = new Date(date.getFullYear(), 0, 1);\n  const pastDaysOfYear = (date - firstDayOfYear) / 86400000;\n  return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);\n};\n\n// Get days around current date for day view\nexport const getDaysAroundCurrent = (currentDate) => {\n  const days = [];\n  const middleIndex = 3; // We'll show 7 days total, with current day in middle\n  \n  for (let i = -middleIndex; i <= middleIndex; i++) {\n    const date = new Date(currentDate);\n    date.setDate(currentDate.getDate() + i);\n    days.push(date);\n  }\n  return days;\n};\n\n// Get scrollable days around current date for day view with scroll offset\nexport const getScrollableDaysAroundCurrent = (currentDate, scrollOffset = 0) => {\n  const days = [];\n  const middleIndex = 3; // We'll show 7 days total, with current day in middle\n  \n  for (let i = -middleIndex; i <= middleIndex; i++) {\n    const date = new Date(currentDate);\n    date.setDate(currentDate.getDate() + i + scrollOffset);\n    days.push(date);\n  }\n  return days;\n};\n\n/**\n * Check if two dates are the same day\n * @param {Date} date1 - First date to compare\n * @param {Date} date2 - Second date to compare\n * @returns {boolean} True if dates are on the same day\n */\nexport const isSameDay = (date1, date2) => {\n  if (!date1 || !date2) return false;\n  \n  // Ensure we're working with Date objects\n  const d1 = date1 instanceof Date ? date1 : new Date(date1);\n  const d2 = date2 instanceof Date ? date2 : new Date(date2);\n  \n  return (\n    d1.getFullYear() === d2.getFullYear() &&\n    d1.getMonth() === d2.getMonth() &&\n    d1.getDate() === d2.getDate()\n  );\n};\n\n// Get week dates with custom scroll offset (0 = Monday-Sunday, 1 = Tuesday-Monday, etc.)\nexport const getScrollableWeekDates = (currentDate, scrollOffset = 0) => {\n  const start = new Date(currentDate);\n  const mondayIndex = getMondayBasedDayIndex(start);\n  \n  // Start from Monday of the current week, then apply scroll offset\n  // For negative offsets, we need to go backwards in days\n  start.setDate(start.getDate() - mondayIndex + scrollOffset);\n  \n  const dates = [];\n  for (let i = 0; i < 7; i++) {\n    const date = new Date(start);\n    date.setDate(start.getDate() + i);\n    dates.push(date);\n  }\n  return dates;\n};\n\n// Get day index for scrollable week (0-6 where 0 is the first day of the scrolled week)\nexport const getScrollableDayIndex = (date, scrollOffset = 0) => {\n  // Safety check for undefined or null date\n  if (!date || !(date instanceof Date) || isNaN(date.getTime())) {\n    console.warn('Invalid date passed to getScrollableDayIndex:', date);\n    return 0; // Return default index\n  }\n  \n  const dayOfWeek = date.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday\n  \n  // Convert to Monday-based index (0 = Monday, 6 = Sunday)\n  const mondayBasedIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n  \n  // Apply scroll offset and wrap around\n  // Use proper modulo for negative numbers\n  const scrolledIndex = ((mondayBasedIndex - scrollOffset) % 7 + 7) % 7;\n  \n  return scrolledIndex;\n};\n\n// Get short day names for scrollable week\nexport const getScrollableShortDays = (language, scrollOffset = 0) => {\n  // Create dates for Monday through Sunday\n  const mondayDate = new Date(2000, 0, 3); // January 3, 2000 was a Monday\n  const allDays = Array.from({ length: 7 }, (_, i) => {\n    const date = new Date(mondayDate);\n    date.setDate(mondayDate.getDate() + i);\n    const day = date.toLocaleString(language, { weekday: 'short' }).slice(0, 3);\n    return day.charAt(0).toUpperCase() + day.slice(1);\n  });\n  \n  // Apply scroll offset with proper modulo for negative numbers\n  const scrolledDays = [];\n  for (let i = 0; i < 7; i++) {\n    const dayIndex = ((i + scrollOffset) % 7 + 7) % 7;\n    scrolledDays.push(allDays[dayIndex]);\n  }\n  \n  return scrolledDays;\n};\n\n// Check if a date falls within the scrollable week range\nexport const isDateInScrollableWeek = (date, currentDate, scrollOffset = 0) => {\n  const weekDates = getScrollableWeekDates(currentDate, scrollOffset);\n  const weekStart = weekDates[0];\n  const weekEnd = weekDates[6];\n  \n  const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  const weekStartOnly = new Date(weekStart.getFullYear(), weekStart.getMonth(), weekStart.getDate());\n  const weekEndOnly = new Date(weekEnd.getFullYear(), weekEnd.getMonth(), weekEnd.getDate());\n  \n  return dateOnly >= weekStartOnly && dateOnly <= weekEndOnly;\n};\n\n// Get days range for infinite scrolling (daysBefore days before, current, daysAfter days after)\nexport const getDaysRange = (currentDate, daysBefore = 30, daysAfter = 30) => {\n  const dates = [];\n  const startDate = new Date(currentDate);\n  startDate.setDate(startDate.getDate() - daysBefore);\n  \n  const totalDays = daysBefore + 1 + daysAfter;\n  for (let i = 0; i < totalDays; i++) {\n    const date = new Date(startDate);\n    date.setDate(startDate.getDate() + i);\n    dates.push(date);\n  }\n  \n  return dates;\n};\n\n// Get fixed number of days for desktop week view (centered around currentDate)\nexport const getDesktopWeekDays = (currentDate, numDays = 14) => {\n  const dates = [];\n  const startDate = new Date(currentDate);\n  const daysBefore = Math.floor((numDays - 1) / 2);\n  startDate.setDate(startDate.getDate() - daysBefore);\n  \n  for (let i = 0; i < numDays; i++) {\n    const date = new Date(startDate);\n    date.setDate(startDate.getDate() + i);\n    dates.push(date);\n  }\n  \n  return dates;\n};\n\n// Get multiple days for day view horizontal scrolling (daysBefore days before, current day, daysAfter days after)\nexport const getMultipleDays = (currentDate, daysBefore = 30, daysAfter = 30) => {\n  const days = [];\n  const startDate = new Date(currentDate);\n  startDate.setDate(startDate.getDate() - daysBefore);\n  \n  const totalDays = daysBefore + 1 + daysAfter;\n  for (let i = 0; i < totalDays; i++) {\n    const date = new Date(startDate);\n    date.setDate(startDate.getDate() + i);\n    days.push(date);\n  }\n  \n  return days;\n};\n\n// Get multiple weeks for horizontal scrolling (weeksBefore weeks before, current week, weeksAfter weeks after)\nexport const getMultipleWeeks = (currentDate, weeksBefore = 10, weeksAfter = 10) => {\n  const weeks = [];\n  const currentWeekStart = new Date(currentDate);\n  const mondayIndex = getMondayBasedDayIndex(currentWeekStart);\n  currentWeekStart.setDate(currentWeekStart.getDate() - mondayIndex);\n  \n  // Start from weeksBefore weeks before\n  const startWeek = new Date(currentWeekStart);\n  startWeek.setDate(startWeek.getDate() - (weeksBefore * 7));\n  \n  const totalWeeks = weeksBefore + 1 + weeksAfter;\n  for (let i = 0; i < totalWeeks; i++) {\n    const weekStart = new Date(startWeek);\n    weekStart.setDate(startWeek.getDate() + (i * 7));\n    const weekDates = [];\n    for (let j = 0; j < 7; j++) {\n      const date = new Date(weekStart);\n      date.setDate(weekStart.getDate() + j);\n      weekDates.push(date);\n    }\n    weeks.push(weekDates);\n  }\n  \n  return weeks;\n};\n\n// Get the week index (0-based) that contains the given date from a weeks array\nexport const getWeekIndexForDate = (date, weeks) => {\n  const targetDate = new Date(date);\n  targetDate.setHours(0, 0, 0, 0);\n  \n  for (let i = 0; i < weeks.length; i++) {\n    const week = weeks[i];\n    const weekStart = new Date(week[0]);\n    weekStart.setHours(0, 0, 0, 0);\n    const weekEnd = new Date(week[6]);\n    weekEnd.setHours(23, 59, 59, 999);\n    \n    if (targetDate >= weekStart && targetDate <= weekEnd) {\n      return i;\n    }\n  }\n  \n  return Math.floor(weeks.length / 2);\n}; ","import React, { useState, useRef, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport { FiFilter, FiX } from 'react-icons/fi';\nimport { cn } from '../../../../utils/cn';\nconst CalendarHeader = ({\n  currentDate,\n  view,\n  setView,\n  navigateDate,\n  setCurrentDate,\n  categories,\n  handleCategoryToggle,\n  onResetCategories,\n  isTopBarMode = false,\n  onShowFiltersOverlay,\n  scrollContainerRef,\n  isSidebarCollapsed,\n  toggleSidebar,\n  calendarMode,\n  setCalendarMode,\n  isTeamWorkspace = false,\n}) => {\n  const { t } = useTranslation();\n  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);\n  const categoryDropdownRef = useRef(null);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (categoryDropdownRef.current && !categoryDropdownRef.current.contains(event.target)) {\n        setShowCategoryDropdown(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const activeCategoriesCount = categories.filter(cat => cat.checked).length;\n  const totalCategories = categories.length;\n  const hasActiveFilters = activeCategoriesCount < totalCategories;\n\n  return (\n    <div className={cn(\n      \"flex flex-col md:flex-row items-center justify-between gap-4 w-full\",\n      isTopBarMode && \"h-full\"\n    )}>\n      {/* Left: Standardized Controls (Date Title + Filters) */}\n      <div className=\"flex items-center gap-3 flex-1\">\n        {/* Today Button */}\n        <button\n          className={cn(\n            \"flex items-center gap-2 px-3 h-9 text-sm font-medium rounded-lg transition-all border\",\n            \"bg-background border-border text-muted-foreground hover:text-foreground\"\n          )}\n          onClick={() => {\n            const today = new Date();\n            setCurrentDate(today);\n          }}\n          title={t('calendar:today')}\n        >\n          {t('calendar:today')}\n        </button>\n\n        {calendarMode === 'calendar' && (\n          <>\n            <div className=\"h-6 w-px bg-border/50 hidden md:block\" />\n\n            {/* View Toggle - Only show in calendar mode */}\n            <div className=\"flex items-center h-10 px-0.5 py-0.5 bg-muted/50 rounded-lg border border-border/50\">\n              <button\n                className={cn(\n                  \"px-3 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0\",\n                  view === 'day'\n                    ? \"bg-background text-foreground shadow-sm\"\n                    : \"text-muted-foreground hover:text-foreground hover:bg-background/50\"\n                )}\n                style={{ height: '36px', maxHeight: '36px', minHeight: '36px' }}\n                onClick={() => {\n                  setView('day');\n                }}\n              >\n                {t('calendar:dayView')}\n              </button>\n              <button\n                className={cn(\n                  \"px-3 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0\",\n                  view === 'week'\n                    ? \"bg-background text-foreground shadow-sm\"\n                    : \"text-muted-foreground hover:text-foreground hover:bg-background/50\"\n                )}\n                style={{ height: '36px', maxHeight: '36px', minHeight: '36px' }}\n                onClick={() => setView('week')}\n              >\n                {t('calendar:weekView')}\n              </button>\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* Center: Calendar/Team Toggle - Only show for team workspaces */}\n      {isTeamWorkspace && (\n        <div className=\"flex items-center h-10 px-0.5 py-0.5 bg-muted/50 rounded-lg border border-border/50 absolute left-1/2 -translate-x-1/2\">\n          <button\n            className={cn(\n              \"px-4 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0\",\n              calendarMode === 'calendar'\n                ? \"bg-background text-foreground shadow-sm\"\n                : \"text-muted-foreground hover:text-foreground hover:bg-background/50\"\n            )}\n            style={{ height: '36px', maxHeight: '36px', minHeight: '36px' }}\n            onClick={() => setCalendarMode('calendar')}\n          >\n            {t('calendar:calendarView', 'Calendar')}\n          </button>\n          <button\n            className={cn(\n              \"px-4 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0\",\n              calendarMode === 'team'\n                ? \"bg-background text-foreground shadow-sm\"\n                : \"text-muted-foreground hover:text-foreground hover:bg-background/50\"\n            )}\n            style={{ height: '36px', maxHeight: '36px', minHeight: '36px' }}\n            onClick={() => setCalendarMode('team')}\n          >\n            {t('calendar:teamView', 'Team')}\n          </button>\n        </div>\n      )}\n\n      {/* Right: Filters & Actions - Only show in calendar mode */}\n      {calendarMode === 'calendar' && (\n        <div className=\"flex items-center gap-2 flex-1 justify-end\">\n        {/* Category Filter */}\n        <div className=\"relative\" ref={categoryDropdownRef}>\n          <button\n            className={cn(\n              \"flex items-center gap-2 px-3 h-9 text-sm font-medium rounded-lg transition-all border\",\n              showCategoryDropdown\n                ? \"bg-secondary border-border/60 text-foreground\"\n                : \"bg-background border-border text-muted-foreground hover:text-foreground\"\n            )}\n            onClick={() => setShowCategoryDropdown(!showCategoryDropdown)}\n            title={t('calendar:filterCategories')}\n          >\n            <FiFilter className=\"w-3.5 h-3.5\" />\n\n            {hasActiveFilters && (\n              <span className=\"flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[10px] text-primary-foreground font-bold\">\n                {activeCategoriesCount}\n              </span>\n            )}\n          </button>\n\n          {showCategoryDropdown && (\n            <div className=\"absolute right-0 top-full mt-2 w-64 bg-card rounded-lg shadow-xl border border-border p-2 z-30 animate-in fade-in zoom-in-95 duration-200\">\n              <div className=\"px-3 py-2 border-b border-border/50 mb-2 flex justify-between items-center\">\n                <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">{t('calendar:categories')}</span>\n                {hasActiveFilters && (\n                  <button\n                    onClick={onResetCategories}\n                    className=\"text-[10px] text-primary hover:underline\"\n                  >\n                    {t('calendar:reset')}\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1 max-h-[300px] overflow-y-auto\">\n                {categories.map((category, index) => (\n                  <label\n                    key={index}\n                    className=\"flex items-center gap-3 px-3 py-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors group\"\n                  >\n                    <div className=\"relative flex items-center\">\n                      <input\n                        type=\"checkbox\"\n                        checked={category.checked}\n                        onChange={() => handleCategoryToggle(index)}\n                        className=\"peer h-4 w-4 rounded border text-primary focus:ring-1 focus:ring-primary/20 cursor-pointer transition-all appearance-none bg-background\"\n                        style={{\n                          backgroundColor: category.checked ? category.color : 'transparent',\n                          borderColor: category.color,\n                          borderWidth: '1px'\n                        }}\n                      />\n                      <svg\n                        className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"3\"\n                      >\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n                      </svg>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 select-none\">\n                      <span className=\"text-xs font-medium text-foreground\">{category.name}</span>\n                    </div>\n                  </label>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Clear Filters Button */}\n        <button\n          onClick={onResetCategories}\n          className={cn(\n            \"h-9 w-9 flex items-center justify-center rounded-lg border border-border hover:bg-muted text-muted-foreground transition-all\",\n            !hasActiveFilters && \"opacity-50 cursor-not-allowed hover:bg-transparent\"\n          )}\n          disabled={!hasActiveFilters}\n          title={t('calendar:resetAll')}\n        >\n          <FiX className=\"w-3.5 h-3.5\" />\n        </button>\n      </div>\n      )}\n    </div>\n  );\n};\n\nCalendarHeader.propTypes = {\n  currentDate: PropTypes.instanceOf(Date).isRequired,\n  view: PropTypes.oneOf(['day', 'week']).isRequired,\n  setView: PropTypes.func.isRequired,\n  navigateDate: PropTypes.func.isRequired,\n  setCurrentDate: PropTypes.func.isRequired,\n  categories: PropTypes.arrayOf(\n    PropTypes.shape({\n      checked: PropTypes.bool,\n      name: PropTypes.string,\n      color: PropTypes.string\n    })\n  ).isRequired,\n  handleCategoryToggle: PropTypes.func.isRequired,\n  onResetCategories: PropTypes.func.isRequired,\n  isTopBarMode: PropTypes.bool,\n  onShowFiltersOverlay: PropTypes.func,\n  scrollContainerRef: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.shape({ current: PropTypes.instanceOf(Element) })\n  ]),\n  isSidebarCollapsed: PropTypes.bool,\n  toggleSidebar: PropTypes.func,\n  calendarMode: PropTypes.oneOf(['calendar', 'team']),\n  setCalendarMode: PropTypes.func,\n  isTeamWorkspace: PropTypes.bool\n};\n\nexport default CalendarHeader; ","import React, { useState, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiChevronLeft, FiChevronRight, FiCheck } from 'react-icons/fi';\nimport { getShortDays, isSameDay, getWeekDates } from '../utils/dateHelpers';\nimport { cn } from '../../../../utils/cn';\n\nconst MiniCalendar = ({\n  currentDate,\n  onDateClick,\n  events = [],\n  view = 'week',\n  visibleWeekStart,\n  visibleWeekEnd\n}) => {\n  const { t, i18n } = useTranslation();\n  const [calendarDate, setCalendarDate] = useState(new Date(currentDate));\n  const [calendarDays, setCalendarDays] = useState([]);\n  const [showMonthDropdown, setShowMonthDropdown] = useState(false);\n  const [showYearDropdown, setShowYearDropdown] = useState(false);\n  const monthDropdownRef = useRef(null);\n  const yearDropdownRef = useRef(null);\n\n  const shortDays = getShortDays(i18n.language);\n\n  useEffect(() => {\n    const style = document.createElement('style');\n    style.textContent = `\n      .minicalendar-selected-day:hover {\n        background-color: var(--color-logo-2) !important;\n        color: white !important;\n      }\n    `;\n    document.head.appendChild(style);\n    return () => {\n      document.head.removeChild(style);\n    };\n  }, []);\n\n  useEffect(() => {\n    const newDate = new Date(currentDate);\n    setCalendarDate(prevDate => {\n      const currentMonth = prevDate.getMonth();\n      const currentYear = prevDate.getFullYear();\n      const newMonth = newDate.getMonth();\n      const newYear = newDate.getFullYear();\n\n      if (currentMonth !== newMonth || currentYear !== newYear) {\n        return newDate;\n      }\n      return prevDate;\n    });\n  }, [currentDate]);\n\n  // Generate days for the calendar\n  useEffect(() => {\n    const year = calendarDate.getFullYear();\n    const month = calendarDate.getMonth();\n\n    // Get the first day of the month\n    const firstDay = new Date(year, month, 1);\n    // Convert day of week (0-6, Sun-Sat) to (0-6, Mon-Sun)\n    const firstDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;\n\n    // Get the last day of the month\n    const lastDay = new Date(year, month + 1, 0);\n    const daysInMonth = lastDay.getDate();\n\n    // Get days from previous month to fill the first week\n    const prevMonthDays = [];\n    if (firstDayOfWeek > 0) {\n      const prevMonth = new Date(year, month, 0);\n      const prevMonthDaysCount = prevMonth.getDate();\n\n      for (let i = prevMonthDaysCount - firstDayOfWeek + 1; i <= prevMonthDaysCount; i++) {\n        prevMonthDays.push({\n          date: new Date(year, month - 1, i),\n          isCurrentMonth: false\n        });\n      }\n    }\n\n    // Get days of current month\n    const currentMonthDays = [];\n    for (let i = 1; i <= daysInMonth; i++) {\n      currentMonthDays.push({\n        date: new Date(year, month, i),\n        isCurrentMonth: true\n      });\n    }\n\n    // Get days from next month to fill the last week (ensure 6 rows)\n    const nextMonthDays = [];\n    const totalDays = prevMonthDays.length + currentMonthDays.length;\n    const remainingDays = 42 - totalDays; // 6 rows of 7 days\n\n    for (let i = 1; i <= remainingDays; i++) {\n      nextMonthDays.push({\n        date: new Date(year, month + 1, i),\n        isCurrentMonth: false\n      });\n    }\n\n    setCalendarDays([...prevMonthDays, ...currentMonthDays, ...nextMonthDays]);\n  }, [calendarDate]);\n\n  // Handle clicks outside of the dropdowns to close them\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (monthDropdownRef.current && !monthDropdownRef.current.contains(event.target)) {\n        setShowMonthDropdown(false);\n      }\n      if (yearDropdownRef.current && !yearDropdownRef.current.contains(event.target)) {\n        setShowYearDropdown(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  // Navigate to previous/next month\n  const navigateMonth = (direction) => {\n    const newDate = new Date(calendarDate);\n    newDate.setMonth(newDate.getMonth() + direction);\n    setCalendarDate(newDate);\n  };\n\n  // Format the month and year for display\n  const formatMonth = () => {\n    return calendarDate.toLocaleString(i18n.language, { month: 'long' });\n  };\n\n  const formatYear = () => {\n    return calendarDate.getFullYear().toString();\n  };\n\n  // Handle day click\n  const handleDayClick = (date) => {\n    if (onDateClick) {\n      onDateClick(date);\n    }\n  };\n\n  // Get events for a specific day\n  const getEventsForDay = (date) => {\n    return events.filter(event => {\n      const eventDate = new Date(event.start);\n      return isSameDay(eventDate, date);\n    });\n  };\n\n  // Check if a date is in the visible range passed from parent\n  // This uses the actual scroll-calculated bounds instead of deriving from currentDate\n  const isInSameWeek = (date) => {\n    if (view !== 'week') return false;\n\n    // If we have explicit bounds from parent, use them\n    if (visibleWeekStart && visibleWeekEnd) {\n      const checkDate = new Date(date);\n      checkDate.setHours(12, 0, 0, 0); // Normalize to noon to avoid timezone issues\n\n      const start = new Date(visibleWeekStart);\n      start.setHours(0, 0, 0, 0);\n\n      const end = new Date(visibleWeekEnd);\n      end.setHours(23, 59, 59, 999);\n\n      return checkDate >= start && checkDate <= end;\n    }\n\n    // Fallback to calculating from currentDate if bounds not provided\n    const weekDates = getWeekDates(currentDate);\n    const weekStart = new Date(weekDates[0]);\n    weekStart.setHours(0, 0, 0, 0);\n\n    const weekEnd = new Date(weekDates[6]);\n    weekEnd.setHours(23, 59, 59, 999);\n\n    const checkDate = new Date(date);\n    checkDate.setHours(0, 0, 0, 0);\n\n    return checkDate >= weekStart && checkDate <= weekEnd;\n  };\n\n  // Handle month change\n  const handleMonthChange = (monthIndex) => {\n    const newDate = new Date(calendarDate);\n    newDate.setMonth(monthIndex);\n    setCalendarDate(newDate);\n    setShowMonthDropdown(false);\n  };\n\n  // Handle year change\n  const handleYearChange = (year) => {\n    const newDate = new Date(calendarDate);\n    newDate.setFullYear(year);\n    setCalendarDate(newDate);\n    setShowYearDropdown(false);\n  };\n\n  // Generate month options\n  const monthOptions = Array.from({ length: 12 }, (_, i) => {\n    const date = new Date(2024, i, 1);\n    return {\n      value: i,\n      label: date.toLocaleString(i18n.language, { month: 'long' })\n    };\n  });\n\n  // Generate year options (10 years before and after current year)\n  const currentYear = new Date().getFullYear();\n  const yearOptions = Array.from({ length: 21 }, (_, i) => {\n    const year = currentYear - 10 + i;\n    return {\n      value: year,\n      label: year.toString()\n    };\n  });\n\n  return (\n    <div className=\"w-full bg-card rounded-xl border border-border/60 p-4 select-none\">\n      {/* Header with Navigation */}\n      <div className=\"flex items-center justify-between mb-0 px-1\">\n        <div className=\"flex items-center gap-1.5 text-sm font-semibold text-foreground\">\n          <div className=\"relative group cursor-pointer hover:bg-muted/50 px-2.5 py-1.5 rounded-lg transition-colors\"\n            onClick={() => { setShowMonthDropdown(!showMonthDropdown); setShowYearDropdown(false); }}\n            ref={monthDropdownRef}>\n            <span className=\"capitalize\">{formatMonth()}</span>\n            {showMonthDropdown && (\n              <div className=\"absolute top-full left-0 mt-1 w-36 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto z-30 py-1\">\n                {monthOptions.map(m => (\n                  <div key={m.value} className={cn(\"px-3 py-2 hover:bg-muted text-sm cursor-pointer flex justify-between items-center\", calendarDate.getMonth() === m.value && \"bg-primary/10 text-primary font-medium\")}\n                    onClick={(e) => { e.stopPropagation(); handleMonthChange(m.value); }}>\n                    {m.label}\n                    {calendarDate.getMonth() === m.value && <FiCheck size={14} />}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n          <div className=\"relative group cursor-pointer hover:bg-muted/50 px-2.5 py-1.5 rounded-lg transition-colors\"\n            onClick={() => { setShowYearDropdown(!showYearDropdown); setShowMonthDropdown(false); }}\n            ref={yearDropdownRef}>\n            <span>{formatYear()}</span>\n            {showYearDropdown && (\n              <div className=\"absolute top-full left-0 mt-1 w-24 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto z-30 py-1\">\n                {yearOptions.map(y => (\n                  <div key={y.value} className={cn(\"px-3 py-2 hover:bg-muted text-sm cursor-pointer flex justify-between items-center\", calendarDate.getFullYear() === y.value && \"bg-primary/10 text-primary font-medium\")}\n                    onClick={(e) => { e.stopPropagation(); handleYearChange(y.value); }}>\n                    {y.label}\n                    {calendarDate.getFullYear() === y.value && <FiCheck size={14} />}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          <button className=\"p-1.5 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground transition-colors\" onClick={() => navigateMonth(-1)}>\n            <FiChevronLeft size={16} />\n          </button>\n          <button className=\"p-1.5 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground transition-colors\" onClick={() => navigateMonth(1)}>\n            <FiChevronRight size={16} />\n          </button>\n        </div>\n      </div>\n\n      {/* Days Grid */}\n      <div className=\"grid grid-cols-7 mb-2.5 text-center\">\n        {shortDays.map((day, index) => (\n          <div key={index} className=\"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider py-1.5\">\n            {day.substr(0, 1)}\n          </div>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-7 gap-y-2\">\n        {calendarDays.map((dayInfo, index) => {\n          const { date, isCurrentMonth } = dayInfo;\n          const isSelected = isSameDay(date, currentDate);\n          const inVisibleWeek = view === 'week' && isInSameWeek(date);\n          const isHighlight = isSelected || inVisibleWeek;\n\n          const isWeekStart = index % 7 === 0;\n          const isWeekEnd = index % 7 === 6;\n          const dayEvents = getEventsForDay(date);\n\n          return (\n            <div\n              key={index}\n              onClick={() => handleDayClick(date)}\n              className={cn(\n                \"relative flex items-center justify-center text-sm cursor-pointer transition-all h-9\",\n                // Width: Highlighted items fill the cell\n                isHighlight ? \"w-full\" : \"w-9 mx-auto rounded-lg\",\n                // Rounding\n                isHighlight && view === 'week'\n                  ? cn(isWeekStart && \"rounded-l-lg\", isWeekEnd && \"rounded-r-lg\")\n                  : \"rounded-lg\",\n\n                // Text styling\n                !isCurrentMonth && !isHighlight ? \"text-muted-foreground/30\" : isHighlight ? \"text-foreground font-bold\" : \"text-foreground\",\n\n                // Hover effect\n                !isHighlight && \"hover:bg-muted/50\"\n              )}\n              style={\n                isHighlight\n                  ? { backgroundColor: 'color-mix(in srgb, var(--color-logo-1), transparent 85%)' }\n                  : {}\n              }\n            >\n              <span className=\"z-10 relative\">{date.getDate()}</span>\n\n              {/* Event Dots */}\n              {dayEvents.length > 0 && (\n                <div className=\"absolute bottom-0 flex gap-0.5 justify-center\">\n                  {dayEvents.length > 3\n                    ? <span className=\"w-1.5 h-1.5 rounded-full bg-primary/70\" />\n                    : dayEvents.slice(0, 3).map((_, i) => (\n                      <span key={i} className=\"w-1.5 h-1.5 rounded-full bg-primary/60\" />\n                    ))\n                  }\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default MiniCalendar; ","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport MiniCalendar from '../miniCalendar/MiniCalendar';\nimport { cn } from '../../../../utils/cn';\nimport { FiCalendar, FiClock, FiMapPin, FiChevronRight } from 'react-icons/fi';\n\nconst CalendarSidebar = ({\n  currentDate,\n  setCurrentDate,\n  handleDayClick,\n  events,\n  handleUpcomingEventClick,\n  isSidebarCollapsed,\n  toggleSidebar,\n  view,\n  visibleWeekStart,\n  visibleWeekEnd\n}) => {\n  const { t } = useTranslation();\n\n  if (isSidebarCollapsed) {\n    return null;\n  }\n\n  const isMobile = typeof window !== 'undefined' && window.innerWidth < 768;\n\n  return (\n    <div className={cn(\n      \"h-full flex flex-col overflow-y-auto custom-scrollbar\",\n      isMobile ? \"gap-0\" : \"gap-4\"\n    )} style={{ scrollbarGutter: 'stable' }}>\n      {/* Mini Calendar Section */}\n      <div className={isMobile ? \"mb-0\" : \"\"}>\n        <MiniCalendar\n          currentDate={currentDate}\n          onDateClick={handleDayClick}\n          events={events}\n          view={view}\n          visibleWeekStart={visibleWeekStart}\n          visibleWeekEnd={visibleWeekEnd}\n        />\n      </div>\n\n      {/* Upcoming Events Section - Redesigned */}\n      <div className={cn(\n        \"flex-1 flex flex-col min-h-0 bg-card border p-0 overflow-hidden shadow-sm\",\n        isMobile ? \"rounded-none border-x-0 border-b-0 border-t\" : \"rounded-xl border-border/60\"\n      )}>\n        <div className=\"flex items-center justify-center px-4 pt-4 pb-2 border-b border-border/50 bg-muted/20\">\n          <h4 className=\"text-sm font-semibold text-foreground flex items-center gap-2 m-0\">\n            <FiCalendar className=\"w-4 h-4 text-primary\" />\n            {t('calendar:upcomingEvents')}\n          </h4>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto custom-scrollbar p-2\" style={{ scrollbarGutter: 'stable' }}>\n          {events && events.length > 0 ? (\n            <div className=\"space-y-1\">\n              {events\n                .filter(event => new Date(event.start) > new Date())\n                .sort((a, b) => new Date(a.start) - new Date(b.start))\n                .slice(0, 5)\n                .map((event, index) => (\n                  <div\n                    key={index}\n                    className=\"group flex gap-3 p-3 rounded-lg hover:bg-muted/50 transition-all duration-200 cursor-pointer border border-transparent hover:border-border/50\"\n                    onClick={() => handleUpcomingEventClick(event.start)}\n                  >\n                    {/* Date Box */}\n                    <div className=\"flex flex-col items-center justify-center w-12 h-12 rounded-lg bg-primary/5 border border-primary/10 shrink-0 group-hover:bg-primary/10 transition-colors\">\n                      <span className=\"text-[10px] uppercase font-bold text-primary/70\">\n                        {new Date(event.start).toLocaleDateString(undefined, { month: 'short' })}\n                      </span>\n                      <span className=\"text-xl font-bold text-primary leading-none mt-0.5\">\n                        {new Date(event.start).getDate()}\n                      </span>\n                    </div>\n\n                    {/* Event Details */}\n                    <div className=\"flex-1 min-w-0 flex flex-col justify-center\">\n                      <h5 className=\"text-sm font-medium text-foreground truncate\">{event.title || t('calendar:untitledEvent')}</h5>\n                      <div className=\"flex items-center gap-3 mt-1 text-muted-foreground\">\n                        <span className=\"flex items-center gap-1\" style={{ fontSize: 'var(--font-size-small)' }}>\n                          <FiClock className=\"w-3 h-3\" />\n                          <span style={{ fontSize: 'var(--font-size-small)' }}>\n                            {new Date(event.start).toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', hour12: false })} - {new Date(event.end).toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', hour12: false })}\n                          </span>\n                        </span>\n                        {event.location && (\n                          <span className=\"flex items-center gap-1 truncate\">\n                            <FiMapPin className=\"w-3 h-3\" />\n                            <span className=\"truncate max-w-[100px]\">{event.location}</span>\n                          </span>\n                        )}\n                      </div>\n                    </div>\n\n                    {/* Arrow */}\n                    <div className=\"flex items-center opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 duration-200\">\n                      <FiChevronRight className=\"w-4 h-4 text-muted-foreground\" />\n                    </div>\n                  </div>\n                ))}\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center h-40 text-center text-muted-foreground\">\n              <div className=\"w-10 h-10 rounded-full bg-muted/50 flex items-center justify-center mb-3\">\n                <FiCalendar className=\"w-5 h-5 opacity-40\" />\n              </div>\n              <p className=\"text-sm font-medium\">{t('calendar:noUpcomingEvents')}</p>\n              <p className=\"text-xs opacity-60 mt-1\">{t('calendar:checkBackLater')}</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nCalendarSidebar.propTypes = {\n  currentDate: PropTypes.instanceOf(Date).isRequired,\n  setCurrentDate: PropTypes.func.isRequired,\n  handleDayClick: PropTypes.func.isRequired,\n  events: PropTypes.array.isRequired,\n  handleUpcomingEventClick: PropTypes.func.isRequired,\n  isSidebarCollapsed: PropTypes.bool.isRequired,\n  toggleSidebar: PropTypes.func.isRequired,\n  view: PropTypes.oneOf(['day', 'week']),\n  visibleWeekStart: PropTypes.instanceOf(Date),\n  visibleWeekEnd: PropTypes.instanceOf(Date)\n};\n\nexport default CalendarSidebar;","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { getMultipleWeeks, getMultipleDays, getShortDays, isSameDay } from '../utils/dateHelpers';\n\nconst TimeHeaders = ({ currentDate, referenceDate: propReferenceDate, view, handleDayClick, scrollContainerRef, numWeeks = 7, numDays = 30 }) => {\n  const { t, i18n } = useTranslation();\n  const today = new Date();\n  const referenceDate = propReferenceDate || currentDate;\n\n  // Generate days based on view type\n  let allDays;\n  if (view === 'day') {\n    // Day view: generate days centered around current date\n    // Day view: generate single day (current date)\n    const daysBefore = 0;\n    const daysAfter = 0;\n    allDays = getMultipleDays(referenceDate, daysBefore, daysAfter);\n  } else {\n    // Week view: generate weeks and flatten to days\n    const weeksBefore = numWeeks;\n    const weeksAfter = numWeeks;\n    const weeks = getMultipleWeeks(referenceDate, weeksBefore, weeksAfter);\n    allDays = weeks.flat();\n  }\n  const shortDays = getShortDays(i18n.language);\n\n  return (\n    <div\n      className=\"flex py-2\"\n      style={{\n        width: view === 'day' ? `${allDays.length * 100}%` : `${allDays.length * (100 / 7)}%`,\n        minWidth: view === 'day' ? `${allDays.length * 100}%` : `${allDays.length * (100 / 7)}%`\n      }}\n    >\n      {/* Day headers - show all days from multiple weeks */}\n      {allDays.map((date, index) => {\n        const isToday = isSameDay(date, today);\n        const isCurrentDay = isSameDay(date, currentDate);\n        const dayOfWeek = date.getDay();\n        const dayIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Monday = 0, Sunday = 6\n\n        return (\n          <div\n            key={index}\n            onClick={() => handleDayClick(date)}\n            className=\"flex flex-col items-center justify-center cursor-pointer transition-colors hover:bg-muted/50 pb-2\"\n            style={{\n              width: view === 'day' ? `${100 / allDays.length}%` : `${100 / allDays.length}%`,\n              flexShrink: 0,\n              minWidth: view === 'day' ? `${100 / allDays.length}%` : `${100 / allDays.length}%`,\n              minHeight: '3rem'\n            }}\n          >\n            <div className=\"text-[10px] uppercase font-semibold text-muted-foreground tracking-wider mb-1\">\n              {shortDays[dayIndex]}\n            </div>\n            <div\n              className={`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold transition-all ${isToday\n                ? 'bg-primary text-primary-foreground'\n                : isCurrentDay\n                  ? 'bg-muted text-foreground'\n                  : 'text-foreground'\n                }`}\n            >\n              {date.getDate()}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default TimeHeaders; ","import React, { useState, useRef, useCallback } from 'react';\nimport { cn } from '../../../../../utils/cn';\n\n/**\n * Event Component\n * \n * Handles display and interaction of calendar events.\n * \n * Interactions:\n * - Click: Opens event details panel\n * - Right Click: Opens context menu\n * - Drag: Moves event vertically (15-min increments, same day only)\n * - Resize: Drag top/bottom edges to adjust duration\n */\nconst Event = ({\n  id,\n  start,\n  end,\n  title,\n  color,\n  color1,\n  isSelected,\n  isMultiDay,\n  isFirstDay,\n  isLastDay,\n  isRecurring = false,\n  notes,\n  location,\n  employees,\n  style,\n  overlapInfo,\n  currentDate,\n  isOverlapping = false,\n  isDraft = false,\n  // Interaction handlers\n  onMouseDown,\n  onRightClick,\n  onClick,\n}) => {\n  // Hover state for resize handles\n  const [isHovered, setIsHovered] = useState(false);\n  const eventRef = useRef(null);\n\n  // Helper to ensure Date objects\n  const startDate = start instanceof Date ? start : new Date(start);\n  const endDate = end instanceof Date ? end : new Date(end);\n\n  // Calculate event height in pixels (for showing/hiding content)\n  const heightValue = style?.height ? parseInt(style.height) : 60;\n  const isCompact = heightValue < 35;\n  const isVeryCompact = heightValue < 25;\n\n  // Color logic\n  const hexToRgba = (hex, opacity) => {\n    if (!hex) return `rgba(0, 0, 0, ${opacity})`;\n    let r = 0, g = 0, b = 0;\n    if (hex.length === 4) {\n      r = parseInt(hex[1] + hex[1], 16);\n      g = parseInt(hex[2] + hex[2], 16);\n      b = parseInt(hex[3] + hex[3], 16);\n    } else if (hex.length === 7) {\n      r = parseInt(hex.substring(1, 3), 16);\n      g = parseInt(hex.substring(3, 5), 16);\n      b = parseInt(hex.substring(5, 7), 16);\n    }\n    return `rgba(${r}, ${g}, ${b}, ${opacity})`;\n  };\n\n  const baseColor = color || '#2563eb'; // Blue fallback\n  const bgColor = isDraft ? hexToRgba(baseColor, 0.25) : hexToRgba(baseColor, 0.15);\n  const borderColor = baseColor;\n  const textColor = baseColor;\n\n  // Handle mouse down - pass to parent handler with type\n  const handleMouseDown = useCallback((e, type = 'move') => {\n    e.stopPropagation();\n    onMouseDown?.(e, { id, start, end, title, color, color1, notes, location, employees, isRecurring }, type);\n  }, [id, start, end, title, color, color1, notes, location, employees, isRecurring, onMouseDown]);\n\n  // Handle right click\n  const handleContextMenu = useCallback((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onRightClick?.(e, { id, start, end, title, color, color1, notes, location, employees, isRecurring });\n  }, [id, start, end, title, color, color1, notes, location, employees, isRecurring, onRightClick]);\n\n  // Handle click (will be checked in parent if there was drag)\n  const handleClick = useCallback((e) => {\n    e.stopPropagation();\n    onClick?.({ id, start, end, title, color, color1, notes, location, employees, isRecurring }, e);\n  }, [id, start, end, title, color, color1, notes, location, employees, isRecurring, onClick]);\n\n  // Use passed style or fallback\n  const positionStyle = style || { display: 'none' };\n\n  return (\n    <div\n      ref={eventRef}\n      data-event-id={id}\n      className={cn(\n        \"absolute rounded-md transition-shadow select-none overflow-hidden group\",\n        \"z-1 cursor-grab hover:z-2\",\n        isSelected && \"ring-2 ring-offset-1 ring-primary\",\n        isOverlapping && \"opacity-90\",\n        isDraft && \"opacity-70 border-dashed\"\n      )}\n      style={{\n        ...positionStyle,\n        backgroundColor: bgColor,\n        borderLeft: `3px solid ${borderColor}`,\n        boxShadow: isHovered ? '0 4px 12px rgba(0,0,0,0.15)' : 'none',\n      }}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      onMouseDown={(e) => handleMouseDown(e, 'move')}\n      onContextMenu={handleContextMenu}\n      onClick={handleClick}\n    >\n      {/* Top Resize Handle */}\n      {(!isMultiDay || isFirstDay) && (\n        <div\n          className={cn(\n            \"absolute top-0 left-0 right-0 h-2 cursor-ns-resize z-2\",\n            \"bg-transparent hover:bg-white/30 transition-colors\",\n            isHovered ? \"opacity-100\" : \"opacity-0\"\n          )}\n          onMouseDown={(e) => {\n            e.stopPropagation();\n            handleMouseDown(e, 'resize-top');\n          }}\n        />\n      )}\n\n      {/* Event Content */}\n      <div className=\"flex flex-col h-full w-full px-2 py-1 text-xs leading-tight min-h-[0px] relative\">\n        {/* Title - Always show */}\n        <span\n          className=\"font-semibold truncate\"\n          style={{ fontSize: '16px', color: textColor }}\n        >\n          {title || (isDraft ? 'New Event' : '(No Title)')}\n        </span>\n\n        {/* Time - Hide if very compact */}\n        {!isVeryCompact && (\n          <span\n            className=\"text-[10px] opacity-80 truncate\"\n            style={{ color: textColor }}\n          >\n            {startDate.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}\n            {!isCompact && ` - ${endDate.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}`}\n          </span>\n        )}\n\n        {/* Location - Only if enough space */}\n        {!isCompact && location && (\n          <span\n            className=\"text-[10px] opacity-70 truncate mt-0.5\"\n            style={{ color: textColor }}\n          >\n             {location}\n          </span>\n        )}\n      </div>\n\n      {/* Recurring Indicator */}\n      {isRecurring && (\n        <div\n          className=\"absolute top-1 right-1 text-[8px] opacity-60\"\n          style={{ color: textColor }}\n        >\n          <i className=\"fas fa-redo-alt\" />\n        </div>\n      )}\n\n      {/* Bottom Resize Handle */}\n      {(!isMultiDay || isLastDay) && (\n        <div\n          className={cn(\n            \"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize z-2\",\n            \"bg-transparent hover:bg-white/30 transition-colors\",\n            isHovered ? \"opacity-100\" : \"opacity-0\"\n          )}\n          onMouseDown={(e) => {\n            e.stopPropagation();\n            handleMouseDown(e, 'resize-bottom');\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Event;\n","import React, { useRef, useCallback, useState, useEffect } from 'react';\nimport Event from './events/Event';\nimport { getWeekDates, getMultipleWeeks, getMultipleDays, getWeekIndexForDate, isSameDay, getMondayBasedDayIndex } from '../utils/dateHelpers';\nimport { cn } from '../../../../utils/cn';\n\n/**\n * TimeGrid Component\n * \n * Renders the calendar time grid with events in week view.\n * \n * Grid Interactions:\n * - Click (Empty Slot): Creates 1-hour event and opens panel\n * - Double Click (Empty Slot): Creates 1-hour event immediately\n * - Drag (Empty Slot): Creates custom duration event based on drag distance\n */\nconst TimeGrid = ({\n  view,\n  events,\n  selectedEventId,\n  currentDate,\n  getEventsForCurrentWeek,\n  validatedEvents,\n  onEventClick,\n  onEventRightClick,\n  onEventMove,\n  onEventResize,\n  onCreateEvent,\n  scrollContainerRef: externalScrollContainerRef,\n  numWeeks = 7,\n  numDays = 30,\n  referenceDate: propReferenceDate,\n}) => {\n  const gridRef = useRef(null);\n  const internalScrollContainerRef = useRef(null);\n  const scrollContainerRef = externalScrollContainerRef || internalScrollContainerRef;\n\n  // Drag-to-create state\n  const [isCreating, setIsCreating] = useState(false);\n  const [draftEvent, setDraftEvent] = useState(null);\n  const initialMouseY = useRef(0);\n  const initialStartTime = useRef(null);\n  const hasMovedRef = useRef(false);\n  const latestDraftRef = useRef(null); // Track latest draft for drag-to-create\n\n  // Get days/weeks for horizontal scrolling - use dynamic range for infinite scrolling\n  const referenceDate = propReferenceDate || currentDate;\n  let allDays;\n\n  if (view === 'day') {\n    // Day view: generate days centered around current date\n    // Day view: generate single day (current date)\n    const daysBefore = 0;\n    const daysAfter = 0;\n    allDays = getMultipleDays(referenceDate, daysBefore, daysAfter);\n  } else {\n    // Week view: generate weeks and flatten to days\n    const weeksBefore = numWeeks;\n    const weeksAfter = numWeeks;\n    const weeks = getMultipleWeeks(referenceDate, weeksBefore, weeksAfter);\n    allDays = weeks.flat();\n  }\n\n  // Constants\n  const PIXELS_PER_HOUR = 60;\n  const MINUTES_INCREMENT = 15;\n\n  /**\n   * Snap time to nearest 15-minute interval\n   */\n  const snapToInterval = useCallback((date) => {\n    const newDate = new Date(date);\n    const minutes = newDate.getMinutes();\n    const remainder = minutes % MINUTES_INCREMENT;\n\n    if (remainder !== 0) {\n      if (remainder < MINUTES_INCREMENT / 2) {\n        newDate.setMinutes(minutes - remainder);\n      } else {\n        newDate.setMinutes(minutes + (MINUTES_INCREMENT - remainder));\n      }\n    }\n    newDate.setSeconds(0, 0);\n    return newDate;\n  }, []);\n\n  /**\n   * Get time from Y position on grid\n   * @param {number} y - Y position in pixels\n   * @param {Date} referenceDate - Reference date for the calculation\n   * @param {boolean} snapToHour - If true, snap to hour boundaries (for click events)\n   */\n  const getTimeFromY = useCallback((y, referenceDate, snapToHour = false) => {\n    // Normalize reference date to start of day at 00:00:00 (midnight is part of current day)\n    const normalizedDate = new Date(referenceDate.getFullYear(), referenceDate.getMonth(), referenceDate.getDate(), 0, 0, 0, 0);\n\n    // Explicitly handle Y=0 or negative case\n    if (y <= 0) {\n      return normalizedDate; // Already set to 00:00:00\n    }\n\n    const hoursFromTop = y / PIXELS_PER_HOUR;\n\n    let hours, minutes, seconds;\n\n    if (snapToHour) {\n      // For clicks, snap to the hour cell that was clicked\n      hours = Math.max(0, Math.min(23, Math.floor(hoursFromTop)));\n      minutes = 0;\n      seconds = 0;\n    } else {\n      // For drags, use precise timing with 15-min snapping\n      hours = Math.max(0, Math.min(23, Math.floor(hoursFromTop)));\n      const minutesDecimal = (hoursFromTop - Math.floor(hoursFromTop)) * 60;\n      minutes = Math.round(minutesDecimal / MINUTES_INCREMENT) * MINUTES_INCREMENT;\n      seconds = 0;\n    }\n\n    const date = new Date(normalizedDate);\n    date.setHours(hours, minutes, seconds, 0);\n    return date;\n  }, []);\n\n  /**\n   * Get day date from X position in horizontal scrollable weeks\n   */\n  const getDayFromX = useCallback((x, gridWidth) => {\n    const numDays = allDays.length;\n    const dayIndex = Math.floor((x / gridWidth) * numDays);\n    return allDays[Math.max(0, Math.min(numDays - 1, dayIndex))];\n  }, [allDays]);\n\n  const calculateEventOverlaps = (events, currentView) => {\n    if (events.length === 0) return [];\n\n    const eventsWithTimes = events.map(event => ({\n      ...event,\n      startTime: new Date(event.start).getTime(),\n      endTime: new Date(event.end).getTime(),\n      column: 0,\n      totalColumns: 1,\n      isOverlapping: false\n    }));\n\n    eventsWithTimes.sort((a, b) => {\n      if (a.startTime === b.startTime) return a.endTime - b.endTime;\n      return a.startTime - b.startTime;\n    });\n\n    if (currentView === 'day') {\n      const maxColumns = 6;\n      const columns = Array(maxColumns).fill(null).map(() => []);\n\n      for (const event of eventsWithTimes) {\n        let placed = false;\n        let bestColumn = 0;\n        let minOverlaps = Infinity;\n\n        for (let col = 0; col < maxColumns; col++) {\n          const overlappingCount = columns[col].filter(existingEvent => {\n            return event.startTime < existingEvent.endTime && event.endTime > existingEvent.startTime;\n          }).length;\n\n          if (overlappingCount === 0) {\n            columns[col].push(event);\n            event.column = col;\n            placed = true;\n            break;\n          }\n\n          if (overlappingCount < minOverlaps) {\n            minOverlaps = overlappingCount;\n            bestColumn = col;\n          }\n        }\n\n        if (!placed) {\n          columns[bestColumn].push(event);\n          event.column = bestColumn;\n          event.isOverlapping = true;\n        }\n      }\n\n      const usedColumns = new Set(eventsWithTimes.map(e => e.column));\n      const actualMaxColumns = Math.min(maxColumns, Math.max(1, usedColumns.size));\n\n      eventsWithTimes.forEach(event => {\n        event.totalColumns = actualMaxColumns;\n      });\n\n    } else {\n      const maxColumns = 2;\n      const processed = new Set();\n\n      for (let i = 0; i < eventsWithTimes.length; i++) {\n        if (processed.has(i)) continue;\n\n        const currentEvent = eventsWithTimes[i];\n        const containmentGroup = [currentEvent];\n        processed.add(i);\n\n        for (let j = i + 1; j < eventsWithTimes.length; j++) {\n          if (processed.has(j)) continue;\n\n          const otherEvent = eventsWithTimes[j];\n          const overlaps = currentEvent.startTime < otherEvent.endTime && currentEvent.endTime > otherEvent.startTime;\n\n          if (overlaps) {\n            const currentContainsOther = currentEvent.startTime <= otherEvent.startTime && currentEvent.endTime >= otherEvent.endTime;\n            const otherContainsCurrent = otherEvent.startTime <= currentEvent.startTime && otherEvent.endTime >= currentEvent.endTime;\n\n            if (currentContainsOther || otherContainsCurrent) {\n              containmentGroup.push(otherEvent);\n              processed.add(j);\n\n              if (containmentGroup.length >= maxColumns) break;\n            }\n          }\n        }\n\n        if (containmentGroup.length > 1) {\n          containmentGroup.sort((a, b) => {\n            if (a.startTime === b.startTime) return a.endTime - b.endTime;\n            return a.startTime - b.startTime;\n          });\n\n          containmentGroup.forEach((event, index) => {\n            event.column = index;\n            event.totalColumns = Math.min(maxColumns, containmentGroup.length);\n          });\n        }\n      }\n\n      for (let i = 0; i < eventsWithTimes.length; i++) {\n        const currentEvent = eventsWithTimes[i];\n        if (currentEvent.totalColumns === 1) {\n          for (let j = 0; j < eventsWithTimes.length; j++) {\n            if (i === j) continue;\n            const otherEvent = eventsWithTimes[j];\n            const overlaps = currentEvent.startTime < otherEvent.endTime && currentEvent.endTime > otherEvent.startTime;\n\n            if (overlaps) {\n              const currentContainsOther = currentEvent.startTime <= otherEvent.startTime && currentEvent.endTime >= otherEvent.endTime;\n              const otherContainsCurrent = otherEvent.startTime <= currentEvent.startTime && otherEvent.endTime >= currentEvent.endTime;\n\n              if (!currentContainsOther && !otherContainsCurrent) {\n                currentEvent.isOverlapping = true;\n                otherEvent.isOverlapping = true;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return eventsWithTimes;\n  };\n\n  /**\n   * Handle event mouse down - for move/resize\n   */\n  const handleEventMouseDown = useCallback((e, event, type = 'move') => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (e.button !== 0) return;\n\n    hasMovedRef.current = false;\n    const gridElement = gridRef.current;\n    if (!gridElement) return;\n\n    initialMouseY.current = e.clientY;\n    const initialMouseX = e.clientX;\n    const initialStart = new Date(event.start);\n    const initialEnd = new Date(event.end);\n    const duration = initialEnd.getTime() - initialStart.getTime();\n\n    // Get grid for calculating day changes\n    const gridRect = gridElement.getBoundingClientRect();\n\n    // Find scroll container\n    const scrollContainer = gridElement.closest('.calendar-scroll-container') ||\n      gridElement.closest('.time-slots');\n    let autoScrollAnimationFrame = null;\n    let currentMouseY = e.clientY;\n    const initialScrollTop = scrollContainer ? scrollContainer.scrollTop : 0;\n\n    const performAutoScroll = () => {\n      if (!scrollContainer) {\n        autoScrollAnimationFrame = null;\n        return;\n      }\n\n      const containerRect = scrollContainer.getBoundingClientRect();\n      const containerTop = containerRect.top;\n      const containerBottom = containerRect.bottom;\n      const scrollThreshold = 80;\n      const maxScrollSpeed = 15;\n\n      // Calculate distance from mouse to top/bottom of scroll container\n      const distanceFromTop = currentMouseY - containerTop;\n      const distanceFromBottom = containerBottom - currentMouseY;\n\n      let shouldScroll = false;\n      let scrollAmount = 0;\n\n      if (distanceFromTop < scrollThreshold && distanceFromTop > 0) {\n        // Near top - scroll up\n        shouldScroll = true;\n        scrollAmount = -Math.min(maxScrollSpeed, Math.floor((scrollThreshold - distanceFromTop) / 5));\n      } else if (distanceFromBottom < scrollThreshold && distanceFromBottom > 0) {\n        // Near bottom - scroll down\n        shouldScroll = true;\n        scrollAmount = Math.min(maxScrollSpeed, Math.floor((scrollThreshold - distanceFromBottom) / 5));\n      }\n\n      if (shouldScroll && scrollAmount !== 0) {\n        const currentScroll = scrollContainer.scrollTop;\n        const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;\n        const newScroll = Math.max(0, Math.min(maxScroll, currentScroll + scrollAmount));\n        scrollContainer.scrollTop = newScroll;\n        autoScrollAnimationFrame = requestAnimationFrame(performAutoScroll);\n      } else {\n        autoScrollAnimationFrame = null;\n      }\n    };\n\n    const handleMouseMove = (moveEvent) => {\n      // Update current mouse Y for auto-scroll\n      currentMouseY = moveEvent.clientY;\n\n      // Calculate scroll delta to account for auto-scrolling\n      const currentScrollTop = scrollContainer ? scrollContainer.scrollTop : 0;\n      const scrollDelta = currentScrollTop - initialScrollTop;\n\n      // Adjust deltaY to account for scroll changes\n      // When scrolling down (scrollDelta > 0), content moves up, so mouse is further down relative to content\n      // When scrolling up (scrollDelta < 0), content moves down, so mouse is further up relative to content\n      const deltaY = (moveEvent.clientY - initialMouseY.current) + scrollDelta;\n      const deltaX = moveEvent.clientX - initialMouseX;\n\n      if (Math.abs(deltaY) > 3 || Math.abs(deltaX) > 3) {\n        hasMovedRef.current = true;\n      }\n\n      // Start auto-scroll if not already running\n      if (scrollContainer && (type === 'move' || type === 'resize-top' || type === 'resize-bottom') && !autoScrollAnimationFrame) {\n        autoScrollAnimationFrame = requestAnimationFrame(performAutoScroll);\n      }\n\n      // Calculate minutes delta (snapped to 15 min)\n      const minutesPerPixel = 60 / PIXELS_PER_HOUR;\n      const rawMinutes = deltaY * minutesPerPixel;\n      const minutesDelta = Math.round(rawMinutes / MINUTES_INCREMENT) * MINUTES_INCREMENT;\n\n      if (minutesDelta === 0) return;\n\n      if (type === 'resize-top') {\n        const newStart = new Date(initialStart.getTime() + minutesDelta * 60000);\n        const snappedStart = snapToInterval(newStart);\n        if (snappedStart < initialEnd) {\n          onEventResize?.(event.id, snappedStart, initialEnd, true);\n        }\n      } else if (type === 'resize-bottom') {\n        const newEnd = new Date(initialEnd.getTime() + minutesDelta * 60000);\n        const snappedEnd = snapToInterval(newEnd);\n        if (snappedEnd > initialStart) {\n          onEventResize?.(event.id, initialStart, snappedEnd, true);\n        }\n      } else {\n        // Move - only allow time changes, no day changes\n        let newStart = new Date(initialStart.getTime() + minutesDelta * 60000);\n        let snappedStart = snapToInterval(newStart);\n        let snappedEnd = new Date(snappedStart.getTime() + duration);\n\n        // Keep event on the same day as it started\n        const originalDay = new Date(initialStart);\n        originalDay.setHours(0, 0, 0, 0);\n        const newDay = new Date(snappedStart);\n        newDay.setHours(0, 0, 0, 0);\n\n        // If the day changed, clamp back to original day boundaries\n        if (newDay.getTime() !== originalDay.getTime()) {\n          const startOfDay = new Date(originalDay);\n          startOfDay.setHours(0, 0, 0, 0);\n          const endOfDay = new Date(originalDay);\n          endOfDay.setHours(23, 59, 59, 999);\n\n          // Clamp to stay within the original day\n          if (snappedStart < startOfDay) {\n            snappedStart = startOfDay;\n            snappedEnd = new Date(snappedStart.getTime() + duration);\n          } else if (snappedEnd > endOfDay) {\n            snappedEnd = endOfDay;\n            snappedStart = new Date(snappedEnd.getTime() - duration);\n            if (snappedStart < startOfDay) {\n              snappedStart = startOfDay;\n              snappedEnd = new Date(snappedStart.getTime() + duration);\n            }\n          }\n        }\n\n        onEventMove?.(event.id, snappedStart, snappedEnd, true);\n      }\n    };\n\n    const handleMouseUp = (upEvent) => {\n      // Stop auto-scroll\n      if (autoScrollAnimationFrame) {\n        cancelAnimationFrame(autoScrollAnimationFrame);\n        autoScrollAnimationFrame = null;\n      }\n\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n\n      // If no movement, treat as click\n      if (!hasMovedRef.current) {\n        onEventClick?.(event, upEvent);\n        return;\n      }\n\n      // Finalize\n      // Calculate scroll delta to account for auto-scrolling\n      const finalScrollTop = scrollContainer ? scrollContainer.scrollTop : 0;\n      const scrollDelta = finalScrollTop - initialScrollTop;\n\n      // Adjust deltaY to account for scroll changes\n      // When scrolling down (scrollDelta > 0), content moves up, so mouse is further down relative to content\n      // When scrolling up (scrollDelta < 0), content moves down, so mouse is further up relative to content\n      const deltaY = (upEvent.clientY - initialMouseY.current) + scrollDelta;\n      const minutesPerPixel = 60 / PIXELS_PER_HOUR;\n      const rawMinutes = deltaY * minutesPerPixel;\n      const minutesDelta = Math.round(rawMinutes / MINUTES_INCREMENT) * MINUTES_INCREMENT;\n\n      if (minutesDelta === 0) return;\n\n      if (type === 'resize-top') {\n        const newStart = new Date(initialStart.getTime() + minutesDelta * 60000);\n        const snappedStart = snapToInterval(newStart);\n        if (snappedStart < initialEnd) {\n          onEventResize?.(event.id, snappedStart, initialEnd, false);\n        }\n      } else if (type === 'resize-bottom') {\n        const newEnd = new Date(initialEnd.getTime() + minutesDelta * 60000);\n        const snappedEnd = snapToInterval(newEnd);\n        if (snappedEnd > initialStart) {\n          onEventResize?.(event.id, initialStart, snappedEnd, false);\n        }\n      } else {\n        // Move - only allow time changes, no day changes\n        let newStart = new Date(initialStart.getTime() + minutesDelta * 60000);\n        let snappedStart = snapToInterval(newStart);\n        let snappedEnd = new Date(snappedStart.getTime() + duration);\n\n        // Keep event on the same day as it started\n        const originalDay = new Date(initialStart);\n        originalDay.setHours(0, 0, 0, 0);\n        const newDay = new Date(snappedStart);\n        newDay.setHours(0, 0, 0, 0);\n\n        // If the day changed, clamp back to original day boundaries\n        if (newDay.getTime() !== originalDay.getTime()) {\n          const startOfDay = new Date(originalDay);\n          startOfDay.setHours(0, 0, 0, 0);\n          const endOfDay = new Date(originalDay);\n          endOfDay.setHours(23, 59, 59, 999);\n\n          // Clamp to stay within the original day\n          if (snappedStart < startOfDay) {\n            snappedStart = startOfDay;\n            snappedEnd = new Date(snappedStart.getTime() + duration);\n          } else if (snappedEnd > endOfDay) {\n            snappedEnd = endOfDay;\n            snappedStart = new Date(snappedEnd.getTime() - duration);\n            if (snappedStart < startOfDay) {\n              snappedStart = startOfDay;\n              snappedEnd = new Date(snappedStart.getTime() + duration);\n            }\n          }\n        }\n\n        onEventMove?.(event.id, snappedStart, snappedEnd, false);\n      }\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n  }, [snapToInterval, onEventMove, onEventResize, onEventClick]);\n\n  /**\n   * Handle grid mouse down - for drag-to-create\n   */\n  const handleGridMouseDown = useCallback((e) => {\n    // Debug: log what was clicked\n    console.log('Grid mousedown fired');\n    console.log('Click target:', e.target);\n    console.log('Target className:', e.target.className);\n    console.log('Target data-event-id:', e.target.getAttribute('data-event-id'));\n\n    // Check if click is on an event - check target and all parents\n    const clickedEvent = e.target.closest('[data-event-id]');\n    console.log('Closest event element:', clickedEvent);\n\n    if (clickedEvent) {\n      console.log('Click on event detected, ignoring grid mousedown');\n      return; // Let the event handle it\n    }\n\n    // Only handle left button\n    if (e.button !== 0) return;\n\n    console.log('Grid mousedown - creating new event');\n\n    e.preventDefault();\n\n    const gridElement = gridRef.current;\n    if (!gridElement) return;\n\n    const gridRect = gridElement.getBoundingClientRect();\n    const x = e.clientX - gridRect.left;\n    const y = e.clientY - gridRect.top;\n\n    // Determine which day was clicked\n    const dayDate = getDayFromX(x, gridRect.width);\n\n    // For initial click, snap to hour cell boundary\n    const startTime = getTimeFromY(y, dayDate, true); // true = snapToHour\n    const endTime = new Date(startTime.getTime() + 60 * 60 * 1000); // +1 hour default\n\n    hasMovedRef.current = false;\n    initialMouseY.current = e.clientY;\n    initialStartTime.current = startTime;\n\n    // Create draft event\n    const draft = {\n      id: `draft-${Date.now()}`,\n      title: '',\n      start: startTime,\n      end: endTime,\n      isDraft: true,\n      color: '#3b82f6',\n    };\n\n    // Store in ref for mouse events\n    latestDraftRef.current = draft;\n\n    setDraftEvent(draft);\n    setIsCreating(true);\n\n    const handleMouseMove = (moveEvent) => {\n      const currentY = moveEvent.clientY - gridRect.top;\n\n      if (Math.abs(moveEvent.clientY - initialMouseY.current) > 5) {\n        hasMovedRef.current = true;\n      }\n\n      // For drag, use precise timing (not snapped to hour)\n      const currentTime = getTimeFromY(currentY, dayDate, false);\n\n      // Ensure event stays within the same day\n      const dayStart = new Date(dayDate);\n      dayStart.setHours(0, 0, 0, 0);\n      const dayEnd = new Date(dayDate);\n      dayEnd.setHours(23, 59, 59, 999);\n\n      // Determine start and end based on drag direction\n      let newStart, newEnd;\n      if (currentTime < initialStartTime.current) {\n        newStart = snapToInterval(currentTime);\n        newEnd = snapToInterval(new Date(initialStartTime.current.getTime() + 60 * 60 * 1000));\n      } else {\n        newStart = snapToInterval(initialStartTime.current);\n        newEnd = snapToInterval(currentTime);\n        // Ensure minimum 15 min\n        if (newEnd.getTime() - newStart.getTime() < 15 * 60 * 1000) {\n          newEnd = new Date(newStart.getTime() + 15 * 60 * 1000);\n        }\n      }\n\n      // Clamp to day boundaries\n      if (newStart < dayStart) {\n        newStart = dayStart;\n        newEnd = new Date(newStart.getTime() + 60 * 60 * 1000);\n      }\n      if (newEnd > dayEnd) {\n        newEnd = dayEnd;\n        if (newEnd.getTime() - newStart.getTime() < 15 * 60 * 1000) {\n          newStart = new Date(newEnd.getTime() - 15 * 60 * 1000);\n          if (newStart < dayStart) {\n            newStart = dayStart;\n            newEnd = new Date(newStart.getTime() + 15 * 60 * 1000);\n          }\n        }\n      }\n\n      const updatedDraft = {\n        ...latestDraftRef.current,\n        start: newStart,\n        end: newEnd,\n      };\n\n      latestDraftRef.current = updatedDraft;\n      setDraftEvent(updatedDraft);\n    };\n\n    const handleMouseUp = () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n\n      setIsCreating(false);\n      setDraftEvent(null);\n\n      if (hasMovedRef.current) {\n        // Drag create - open panel to fill in details\n        console.log('Creating drag event with panel:', latestDraftRef.current);\n        onCreateEvent?.({\n          ...latestDraftRef.current,\n          id: `temp-${Date.now()}`,\n          isDraft: false,\n        }, true); // true = open panel\n      } else {\n        // Single click - always create event using closure variables\n        const newEvent = {\n          id: `temp-${Date.now()}`,\n          title: '',\n          start: startTime, // From closure - already snapped to hour\n          end: endTime,     // From closure - already 1 hour after start\n          color: '#3b82f6',\n        };\n        console.log('Creating single-click event and opening panel:', newEvent);\n        onCreateEvent?.(newEvent, true); // true = open panel\n      }\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n  }, [currentDate, getDayFromX, getTimeFromY, snapToInterval, onCreateEvent]);\n\n  /**\n   * Handle grid double click - create event immediately\n   */\n  const handleGridDoubleClick = useCallback((e) => {\n    // Don't handle if clicking on an event\n    if (e.target.closest('[data-event-id]')) return;\n\n    e.preventDefault();\n\n    const gridElement = gridRef.current;\n    if (!gridElement) return;\n\n    const gridRect = gridElement.getBoundingClientRect();\n    const x = e.clientX - gridRect.left;\n    const y = e.clientY - gridRect.top;\n\n    const dayDate = getDayFromX(x, gridRect.width);\n\n    // Snap to hour cell boundary for double-click as well\n    const startTime = getTimeFromY(y, dayDate, true); // true = snapToHour\n    const endTime = new Date(startTime.getTime() + 60 * 60 * 1000);\n\n    const newEvent = {\n      id: `temp-${Date.now()}`,\n      title: '',\n      start: startTime,\n      end: endTime,\n      color: '#3b82f6',\n    };\n\n    onCreateEvent?.(newEvent, true); // true = open panel\n  }, [currentDate, getDayFromX, getTimeFromY, onCreateEvent]);\n\n  const renderEvents = () => {\n    let eventsToRender = [];\n\n    // Process existing events only if they exist\n    if (events && events.length > 0) {\n\n      // Use all days from multiple weeks\n      const rangeStart = new Date(allDays[0]);\n      rangeStart.setHours(0, 0, 0, 0);\n      const rangeEnd = new Date(allDays[allDays.length - 1]);\n      rangeEnd.setHours(23, 59, 59, 999);\n\n      // Separate events being moved/resized from normal events\n      const activeEvents = events.filter(e => e.isBeingMoved || e.isBeingResized);\n      const normalEvents = events.filter(e => !e.isBeingMoved && !e.isBeingResized);\n\n      allDays.forEach((date, i) => {\n        const dayEvents = normalEvents.filter(event => {\n          if (!event || !event.start) return false;\n          const eventDate = new Date(event.start);\n          return eventDate.getDate() === date.getDate() &&\n            eventDate.getMonth() === date.getMonth() &&\n            eventDate.getFullYear() === date.getFullYear();\n        });\n        const processed = calculateEventOverlaps(dayEvents, view).map(e => ({ ...e, dayIndex: i }));\n        eventsToRender.push(...processed);\n      });\n\n      // Also handle events that might not match exactly (fallback)\n      normalEvents.forEach(event => {\n        if (!event || !event.start) return;\n        const eventDate = new Date(event.start);\n        const existingIndex = eventsToRender.findIndex(e => e.id === event.id);\n        if (existingIndex === -1) {\n          // Event not matched to any day, find closest day\n          let dayIndex = allDays.findIndex(d =>\n            d.getDate() === eventDate.getDate() &&\n            d.getMonth() === eventDate.getMonth() &&\n            d.getFullYear() === eventDate.getFullYear()\n          );\n          if (dayIndex < 0) {\n            const daysDiff = Math.floor((eventDate - rangeStart) / (1000 * 60 * 60 * 24));\n            dayIndex = Math.max(0, Math.min(allDays.length - 1, daysDiff));\n          }\n          const processed = calculateEventOverlaps([event], view).map(e => ({ ...e, dayIndex }));\n          eventsToRender.push(...processed);\n        }\n      });\n\n      // Add moved/resized events separately - always render them to keep them visible during drag\n      activeEvents.forEach(event => {\n        const eventDate = new Date(event.start);\n        let dayIndex = allDays.findIndex(d =>\n          d.getDate() === eventDate.getDate() &&\n          d.getMonth() === eventDate.getMonth() &&\n          d.getFullYear() === eventDate.getFullYear()\n        );\n\n        if (dayIndex < 0) {\n          const daysDiff = Math.floor((eventDate - rangeStart) / (1000 * 60 * 60 * 24));\n          dayIndex = Math.max(0, Math.min(allDays.length - 1, daysDiff));\n        }\n\n        eventsToRender.push({\n          ...event,\n          dayIndex,\n          column: 0,\n          totalColumns: 1,\n          isOverlapping: false\n        });\n      });\n    }\n\n    // Add draft event if creating\n    if (draftEvent) {\n      const draftDate = new Date(draftEvent.start);\n      let dayIndex = allDays.findIndex(d =>\n        d.getDate() === draftDate.getDate() &&\n        d.getMonth() === draftDate.getMonth() &&\n        d.getFullYear() === draftDate.getFullYear()\n      );\n      if (dayIndex === -1) dayIndex = 0;\n\n      eventsToRender.push({\n        ...draftEvent,\n        dayIndex,\n        column: 0,\n        totalColumns: 1,\n        isOverlapping: false,\n      });\n    }\n\n    return eventsToRender.map(event => {\n      if (!event || !event.start || event.dayIndex === undefined || event.dayIndex < 0) {\n        return null;\n      }\n\n      const eventStart = new Date(event.start);\n      const eventEnd = new Date(event.end);\n      // Grid now starts at 00:00, so use hour directly\n      const hour = eventStart.getHours();\n      const top = (hour + eventStart.getMinutes() / 60) * 60;\n      const duration = (eventEnd - eventStart) / (1000 * 60 * 60);\n      const height = Math.max(duration * 60, 15); // Minimum 15px height\n\n      // Horizontal scrollable weeks: events positioned by day index across all weeks\n      const numDays = allDays.length;\n      const dayWidth = `${100 / numDays}%`;\n      const dayLeft = `${event.dayIndex * (100 / numDays)}%`;\n\n      let style = {};\n      // Use percentage-based layout for all views\n      if (event.isOverlapping) {\n        const dayWidthNum = 100 / numDays;\n        const subWidth = dayWidthNum / event.totalColumns;\n        style = {\n          top: `${top}px`,\n          left: `calc(${dayLeft} + ${event.column * subWidth}%)`,\n          width: `calc(${subWidth}% - 4px)`,\n          height: `${height}px`,\n          position: 'absolute',\n          zIndex: event.isSelected ? 3 : 2,\n        };\n      } else {\n        style = {\n          top: `${top}px`,\n          left: dayLeft,\n          width: `calc(${dayWidth} - 4px)`,\n          height: `${height}px`,\n          position: 'absolute',\n          zIndex: event.isSelected ? 3 : 1,\n        };\n      }\n\n      // Color Logic\n      let eventToRender = { ...event };\n      if (validatedEvents && validatedEvents.has(event.id)) {\n        eventToRender.color = '#0f54bc';\n        eventToRender.color1 = '#a8c1ff';\n        eventToRender.color2 = '#4da6fb';\n      }\n\n      return (\n        <Event\n          key={event.id}\n          {...eventToRender}\n          style={style}\n          isOverlapping={event.isOverlapping}\n          isSelected={selectedEventId === event.id}\n          onMouseDown={handleEventMouseDown}\n          onRightClick={onEventRightClick}\n          onClick={onEventClick}\n        />\n      );\n    }).filter(Boolean);\n  };\n\n  return (\n    <div\n      className=\"relative flex-1 bg-background select-none min-w-max\"\n      ref={gridRef}\n      style={{\n        height: '1440px',\n        width: view === 'day' ? `${allDays.length * 100}%` : `${(allDays.length / 7) * 100}%`,\n        minWidth: view === 'day' ? `${allDays.length * 100}%` : `${(allDays.length / 7) * 100}%`\n      }}\n      onMouseDown={handleGridMouseDown}\n      onDoubleClick={handleGridDoubleClick}\n    >\n      {/* Background Grid Lines (Horizontal for Time) - 24 hours from 00:00 to 23:00 */}\n      {Array.from({ length: 24 }, (_, index) => (\n        <div\n          key={index}\n          className=\"h-[60px] w-full border-b border-border flex items-start\"\n        />\n      ))}\n\n      {/* Vertical Grid Lines (for all days) - Overlay */}\n      <div className=\"absolute inset-0 flex pointer-events-none h-full\">\n        {allDays.map((_, i) => (\n          <div\n            key={i}\n            className=\"border-l border-border h-full first:border-l-0\"\n            style={{ width: `${100 / allDays.length}%` }}\n          />\n        ))}\n      </div>\n\n      {/* Events Layer - MUST have pointer-events enabled for interactions */}\n      <div className=\"absolute inset-0 top-0 left-0 w-full h-full\">\n        <div className=\"relative w-full h-full\">\n          {renderEvents()}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TimeGrid;","import React, { useEffect, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Button from '../../../../components/BoxedInputFields/Button';\nimport { FiX, FiAlertTriangle } from 'react-icons/fi';\nimport '../../../../styles/variables.css';\n\nconst DeleteConfirmationDialog = ({ event, currentDate, onConfirm, onCancel, isRecurring }) => {\n  const { t } = useTranslation();\n\n  const hasRecurrenceId = event.recurrenceId != null;\n  const isRecurringEvent = isRecurring || hasRecurrenceId;\n\n  const handleKeyDown = useCallback((e) => {\n    if (e.key === 'Escape') {\n      onCancel();\n    }\n  }, [onCancel]);\n\n  useEffect(() => {\n    document.body.style.overflow = 'hidden';\n    window.addEventListener('keydown', handleKeyDown);\n    return () => {\n      document.body.style.overflow = '';\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [handleKeyDown]);\n\n  const handleBackdropClick = (e) => {\n    if (e.target === e.currentTarget) {\n      onCancel();\n    }\n  };\n\n  return (\n    <div\n      className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-in fade-in duration-200\"\n      style={{\n        backgroundColor: 'rgba(0, 0, 0, 0.6)',\n        backdropFilter: 'blur(4px)'\n      }}\n      onClick={handleBackdropClick}\n    >\n      <div\n        className=\"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border overflow-hidden flex flex-col transform transition-all duration-200 scale-100 animate-in zoom-in-95\"\n        onClick={(e) => e.stopPropagation()}\n        style={{\n          backgroundColor: 'var(--background-div-color)',\n          borderColor: 'var(--grey-2)',\n          boxShadow: 'var(--box-shadow-md)'\n        }}\n      >\n        <div\n          className=\"flex items-center justify-between px-6 py-5 border-b\"\n          style={{\n            borderBottomColor: 'var(--red-2)',\n            backgroundColor: 'var(--red-1)'\n          }}\n        >\n          <div className=\"flex items-center gap-3\">\n            <div\n              className=\"p-2 rounded-full\"\n              style={{\n                backgroundColor: 'var(--red-2)',\n                color: 'var(--red-4)'\n              }}\n            >\n              <FiAlertTriangle size={24} />\n            </div>\n            <h3\n              className=\"text-xl font-semibold tracking-tight\"\n              style={{\n                color: 'var(--red-4)',\n                fontFamily: 'var(--font-family-headings)',\n                fontSize: 'var(--font-size-large)'\n              }}\n            >\n              {isRecurringEvent\n                ? t('calendar:deleteTitle', 'Delete Recurring Event')\n                : t('common:deleteConfirmation.title', 'Delete Event')}\n            </h3>\n          </div>\n          <button\n            onClick={onCancel}\n            className=\"p-2 rounded-full transition-colors hover:bg-black/5\"\n            style={{\n              color: 'var(--red-4)'\n            }}\n            aria-label=\"Close\"\n          >\n            <FiX size={20} />\n          </button>\n        </div>\n\n        <div\n          className=\"p-6 flex-1\"\n          style={{\n            color: 'var(--text-color)',\n            fontFamily: 'var(--font-family-text)',\n            fontSize: 'var(--font-size-medium)',\n            lineHeight: '1.6'\n          }}\n        >\n          <p style={{ marginBottom: 'var(--spacing-md)' }}>\n            {isRecurringEvent\n              ? t('calendar:deleteMessage', 'This is a recurring event. Which occurrences would you like to delete?')\n              : t('common:deleteConfirmation.message', 'Are you sure you want to delete this event?')}\n          </p>\n          {event.type === 'contract' && (\n            <div\n              className=\"p-4 rounded-lg mt-4\"\n              style={{\n                backgroundColor: 'var(--red-1)',\n                border: '1px solid var(--red-2)',\n                color: 'var(--red-4)',\n                fontSize: 'var(--font-size-small)'\n              }}\n            >\n              <strong>{t('common:deleteConfirmation.contractWarning', 'WARNING: This is a scheduled appointment. Deleting it may affect your employment status and availability record.')}</strong>\n            </div>\n          )}\n        </div>\n\n        <div\n          className=\"px-6 py-4 border-t flex justify-end gap-3\"\n          style={{\n            borderTopColor: 'var(--grey-2)',\n            backgroundColor: 'var(--grey-1-light)'\n          }}\n        >\n          <button\n            onClick={onCancel}\n            className=\"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors\"\n          >\n            {t('common:deleteConfirmation.cancel', 'Cancel')}\n          </button>\n\n          {isRecurringEvent ? (\n            <>\n              <button\n                onClick={() => onConfirm('single')}\n                className=\"px-4 py-2 text-sm font-medium rounded-md shadow-sm btn-yellow\"\n              >\n                {t('common:deleteConfirmation.deleteThisOnly', 'Delete Only This Event')}\n              </button>\n              <button\n                onClick={() => onConfirm('future')}\n                className=\"px-4 py-2 text-sm font-medium rounded-md shadow-sm btn-yellow\"\n              >\n                {t('common:deleteConfirmation.deleteAllFuture', 'Delete This & Future Events')}\n              </button>\n            </>\n          ) : (\n            <button\n              onClick={() => onConfirm('single')}\n              className=\"px-4 py-2 text-sm font-medium text-white bg-destructive hover:bg-destructive/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95\"\n            >\n              {t('common:deleteConfirmation.delete', 'Delete Event')}\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DeleteConfirmationDialog;\n","import React, { useState, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport { cn } from '../../../../utils/cn';\nimport { CALENDAR_COLORS } from '../utils/constants';\n\n/**\n * Event Context Menu Component\n * \n * Shows on right-click with:\n * - Delete button\n * - Color picker\n */\nconst EventContextMenu = ({\n    event,\n    position,\n    onClose,\n    onDelete,\n    onColorChange,\n    colorOptions = CALENDAR_COLORS\n}) => {\n    const { t } = useTranslation();\n    const menuRef = useRef(null);\n\n    // Close on click outside\n    useEffect(() => {\n        const handleClickOutside = (e) => {\n            if (menuRef.current && !menuRef.current.contains(e.target)) {\n                onClose();\n            }\n        };\n\n        const handleEscape = (e) => {\n            if (e.key === 'Escape') {\n                onClose();\n            }\n        };\n\n        document.addEventListener('mousedown', handleClickOutside);\n        document.addEventListener('keydown', handleEscape);\n\n        return () => {\n            document.removeEventListener('mousedown', handleClickOutside);\n            document.removeEventListener('keydown', handleEscape);\n        };\n    }, [onClose]);\n\n    // Adjust position to keep menu in viewport\n    const [adjustedPosition, setAdjustedPosition] = useState(position);\n\n    useEffect(() => {\n        if (menuRef.current) {\n            const rect = menuRef.current.getBoundingClientRect();\n            const viewportWidth = window.innerWidth;\n            const viewportHeight = window.innerHeight;\n\n            let newX = position.x;\n            let newY = position.y;\n\n            if (position.x + rect.width > viewportWidth) {\n                newX = viewportWidth - rect.width - 10;\n            }\n\n            if (position.y + rect.height > viewportHeight) {\n                newY = viewportHeight - rect.height - 10;\n            }\n\n            setAdjustedPosition({ x: newX, y: newY });\n        }\n    }, [position]);\n\n    const handleDelete = () => {\n        onDelete?.(event);\n        onClose();\n    };\n\n    const handleColorSelect = (color) => {\n        onColorChange?.(event, color);\n        onClose();\n    };\n\n    return (\n        <div\n            ref={menuRef}\n            className={cn(\n                \"fixed z-40 min-w-[180px] rounded-lg shadow-xl\",\n                \"bg-card/95 backdrop-blur-md border border-border/60\",\n                \"py-2 animate-in fade-in zoom-in-95 duration-150\"\n            )}\n            style={{\n                left: `${adjustedPosition.x}px`,\n                top: `${adjustedPosition.y}px`,\n            }}\n        >\n            {/* Event Title Header */}\n            <div className=\"px-3 py-2 border-b border-border/40\">\n                <span className=\"text-sm font-medium text-foreground truncate block\">\n                    {event.title || t('calendar:noTitle')}\n                </span>\n                <span className=\"text-xs text-muted-foreground\">\n                    {new Date(event.start).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}\n                    {' - '}\n                    {new Date(event.end).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })}\n                </span>\n            </div>\n\n            {/* Color Picker */}\n            <div className=\"px-3 py-2 border-b border-border/40\">\n                <span className=\"text-xs text-muted-foreground mb-2 block\">{t('calendar:color')}</span>\n                <div className=\"flex gap-1.5 flex-wrap\">\n                    {colorOptions.map((colorOption) => (\n                        <button\n                            key={colorOption.id || colorOption.color}\n                            className={cn(\n                                \"w-6 h-6 rounded-full border-2 transition-transform hover:scale-110\",\n                                event.color === colorOption.color\n                                    ? \"border-white shadow-md ring-2 ring-offset-1 ring-offset-card\"\n                                    : \"border-transparent\"\n                            )}\n                            style={{\n                                backgroundColor: colorOption.color,\n                                ringColor: colorOption.color,\n                            }}\n                            onClick={() => handleColorSelect(colorOption)}\n                            title={colorOption.name || colorOption.color}\n                        />\n                    ))}\n                </div>\n            </div>\n\n            {/* Delete Button */}\n            <div className=\"px-2 pt-2\">\n                <button\n                    className={cn(\n                        \"w-full px-3 py-2 rounded-md text-sm font-medium\",\n                        \"flex items-center gap-2\",\n                        \"text-red-500 hover:bg-red-500/10 transition-colors\"\n                    )}\n                    onClick={handleDelete}\n                >\n                    <svg\n                        className=\"w-4 h-4\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                    >\n                        <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n                        />\n                    </svg>\n                    {t('calendar:deleteEventAction')}\n                </button>\n            </div>\n        </div>\n    );\n};\n\nEventContextMenu.propTypes = {\n    event: PropTypes.object.isRequired,\n    position: PropTypes.shape({\n        x: PropTypes.number.isRequired,\n        y: PropTypes.number.isRequired\n    }).isRequired,\n    onClose: PropTypes.func.isRequired,\n    onDelete: PropTypes.func,\n    onColorChange: PropTypes.func,\n    colorOptions: PropTypes.array\n};\n\nexport default EventContextMenu;\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { cn } from '../../utils/cn';\n\nconst WeekDaySelector = ({ selectedDays, onChange }) => {\n  const { i18n } = useTranslation();\n  \n  const getFullDayNames = (language) => {\n    const mondayDate = new Date(2000, 0, 3);\n    return Array.from({ length: 7 }, (_, i) => {\n      const date = new Date(mondayDate);\n      date.setDate(mondayDate.getDate() + i);\n      return date.toLocaleString(language, { weekday: 'long' });\n    });\n  };\n\n  const dayNames = getFullDayNames(i18n.language);\n  \n  const toggleDay = (index) => {\n    const newSelectedDays = [...(selectedDays || [false, false, false, false, false, false, false])];\n    newSelectedDays[index] = !newSelectedDays[index];\n    onChange(newSelectedDays);\n  };\n\n  const selectedDaysArray = selectedDays || [false, false, false, false, false, false, false];\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      {dayNames.map((dayName, index) => (\n        <button\n          key={index}\n          type=\"button\"\n          onClick={() => toggleDay(index)}\n          className={cn(\n            \"px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200\",\n            \"border border-input hover:bg-muted\",\n            selectedDaysArray[index]\n              ? \"bg-primary text-primary-foreground border-primary\"\n              : \"bg-background text-foreground\"\n          )}\n        >\n          {dayName}\n        </button>\n      ))}\n    </div>\n  );\n};\n\nexport default WeekDaySelector;\n\n\n\n\n\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { cn } from '../../../../utils/cn';\r\n\r\nimport { FiCalendar } from 'react-icons/fi';\r\n\r\nconst CustomDateInput = ({\r\n  value,\r\n  onChange,\r\n  className\r\n}) => {\r\n  // Parse initial value (yyyy-mm-dd) into separate parts\r\n  const parseValue = (val) => {\r\n    if (!val) return { day: '', month: '', year: '' };\r\n    try {\r\n      const date = new Date(val);\r\n      if (isNaN(date.getTime())) return { day: '', month: '', year: '' };\r\n      return {\r\n        day: String(date.getDate()).padStart(2, '0'),\r\n        month: String(date.getMonth() + 1).padStart(2, '0'),\r\n        year: String(date.getFullYear())\r\n      };\r\n    } catch {\r\n      return { day: '', month: '', year: '' };\r\n    }\r\n  };\r\n\r\n  const [dateParts, setDateParts] = useState(parseValue(value));\r\n  const dayRef = useRef(null);\r\n  const monthRef = useRef(null);\r\n  const yearRef = useRef(null);\r\n  const containerRef = useRef(null);\r\n  const hiddenInputRef = useRef(null);\r\n\r\n  const lastValueRef = useRef(value);\r\n\r\n  // Sync with external value changes only if the value actually changes\r\n  useEffect(() => {\r\n    // Check if the value is different from what we last saw\r\n    if (value !== lastValueRef.current) {\r\n      lastValueRef.current = value;\r\n\r\n      const currentStr = `${dateParts.year}-${dateParts.month}-${dateParts.day}`;\r\n      const incoming = parseValue(value);\r\n      const incomingStr = `${incoming.year}-${incoming.month}-${incoming.day}`;\r\n\r\n      // Only update local state if the new value is different from our current local state\r\n      // This allows us to keep local edits (like partial years) without being reset\r\n      // by the parent passing back the old valid value.\r\n      if (incomingStr !== currentStr) {\r\n        setDateParts(incoming);\r\n      }\r\n    }\r\n  }, [value]);\r\n\r\n  const emitChange = (newParts) => {\r\n    const { day, month, year } = newParts;\r\n    // Only emit if we have a potentially valid date (year 4 digits, others present)\r\n    if (day && month && year && year.length === 4) {\r\n      // Validate date object\r\n      const dateStr = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\r\n      if (!isNaN(Date.parse(dateStr))) {\r\n        onChange(dateStr);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleFocus = (e) => {\r\n    e.target.select();\r\n  };\r\n\r\n  const handleDayChange = (e) => {\r\n    let val = e.target.value.replace(/\\D/g, '');\r\n    if (val.length > 2) val = val.slice(0, 2);\r\n\r\n    const newParts = { ...dateParts, day: val };\r\n    setDateParts(newParts);\r\n\r\n    // Auto-switch to month if 2 chars entered\r\n    // This handles \"01\" -> switch case\r\n    if (val.length === 2) {\r\n      monthRef.current?.focus();\r\n    }\r\n\r\n    emitChange(newParts);\r\n  };\r\n\r\n  const handleMonthChange = (e) => {\r\n    let val = e.target.value.replace(/\\D/g, '');\r\n    if (val.length > 2) val = val.slice(0, 2);\r\n\r\n    const newParts = { ...dateParts, month: val };\r\n    setDateParts(newParts);\r\n\r\n    // Auto-switch to year if 2 chars entered\r\n    if (val.length === 2) {\r\n      yearRef.current?.focus();\r\n    }\r\n\r\n    // Handle backspace to day if empty is handled in onKeyDown\r\n\r\n    emitChange(newParts);\r\n  };\r\n\r\n  const handleYearChange = (e) => {\r\n    let val = e.target.value.replace(/\\D/g, '');\r\n    if (val.length > 4) val = val.slice(0, 4);\r\n\r\n    const newParts = { ...dateParts, year: val };\r\n    setDateParts(newParts);\r\n    // Year editing doesn't auto-switch forward, just emits\r\n    emitChange(newParts);\r\n  };\r\n\r\n  const handleHiddenInputChange = (e) => {\r\n    const val = e.target.value;\r\n    if (val) {\r\n      const newParts = parseValue(val);\r\n      setDateParts(newParts);\r\n      emitChange(newParts);\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e, field) => {\r\n    // Backspace navigation\r\n    if (e.key === 'Backspace' && e.target.value === '') {\r\n      if (field === 'month') {\r\n        e.preventDefault();\r\n        dayRef.current?.focus();\r\n      }\r\n      if (field === 'year') {\r\n        e.preventDefault();\r\n        monthRef.current?.focus();\r\n      }\r\n    }\r\n\r\n    // Arrow Key Navigation\r\n    if (e.key === 'ArrowRight' && e.target.selectionStart === e.target.value.length) {\r\n      if (field === 'day') monthRef.current?.focus();\r\n      if (field === 'month') yearRef.current?.focus();\r\n    }\r\n    if (e.key === 'ArrowLeft' && e.target.selectionStart === 0) {\r\n      if (field === 'year') monthRef.current?.focus();\r\n      if (field === 'month') dayRef.current?.focus();\r\n    }\r\n  }\r\n\r\n  // Handle focus on container to focus first input\r\n  const handleContainerClick = (e) => {\r\n    // Check if the click target is the container itself or the gap between inputs\r\n    // but NOT if it's one of the inputs or the icon\r\n    if (e.target === containerRef.current || e.target.classList.contains('flex')) {\r\n      // Find the first empty field or focus day\r\n      if (!dateParts.day) dayRef.current?.focus();\r\n      else if (!dateParts.month) monthRef.current?.focus();\r\n      else if (!dateParts.year) yearRef.current?.focus();\r\n      else dayRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex items-center gap-0.5 cursor-text relative group min-w-[180px] w-full\",\r\n        \"bg-background/50 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2\",\r\n        \"border border-input rounded-md px-3 py-2\", // Match inputClasses padding\r\n        className\r\n      )}\r\n      onClick={handleContainerClick}\r\n      ref={containerRef}\r\n    >\r\n      <input\r\n        ref={dayRef}\r\n        type=\"text\"\r\n        inputMode=\"numeric\"\r\n        placeholder=\"DD\"\r\n        value={dateParts.day}\r\n        onChange={handleDayChange}\r\n        onKeyDown={(e) => handleKeyDown(e, 'day')}\r\n        onFocus={handleFocus}\r\n        onClick={handleFocus}\r\n        className=\"w-[28px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium\"\r\n        maxLength={2}\r\n      />\r\n      <span className=\"text-muted-foreground/40 select-none\">/</span>\r\n      <input\r\n        ref={monthRef}\r\n        type=\"text\"\r\n        inputMode=\"numeric\"\r\n        placeholder=\"MM\"\r\n        value={dateParts.month}\r\n        onChange={handleMonthChange}\r\n        onKeyDown={(e) => handleKeyDown(e, 'month')}\r\n        onFocus={handleFocus}\r\n        onClick={handleFocus}\r\n        className=\"w-[28px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium\"\r\n        maxLength={2}\r\n      />\r\n      <span className=\"text-muted-foreground/40 select-none\">/</span>\r\n      <input\r\n        ref={yearRef}\r\n        type=\"text\"\r\n        inputMode=\"numeric\"\r\n        placeholder=\"YYYY\"\r\n        value={dateParts.year}\r\n        onChange={handleYearChange}\r\n        onKeyDown={(e) => handleKeyDown(e, 'year')}\r\n        onFocus={handleFocus}\r\n        onClick={handleFocus}\r\n        className=\"w-[42px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium\"\r\n        maxLength={4}\r\n      />\r\n\r\n      {/* Calendar Icon & Hidden Input */}\r\n      <div className=\"ml-auto pl-2 flex items-center border-l border-border h-5\">\r\n        <button\r\n          type=\"button\"\r\n          tabIndex={-1}\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            try {\r\n              hiddenInputRef.current?.showPicker();\r\n            } catch (err) {\r\n              console.warn('showPicker not supported', err);\r\n              // Fallback: try to focus/click? \r\n              // Usually showPicker is the only way to open native picker programmatically securely\r\n            }\r\n          }}\r\n          className=\"text-muted-foreground hover:text-foreground transition-colors cursor-pointer outline-none focus:text-foreground p-0.5\"\r\n          title=\"Open calendar\"\r\n        >\r\n          <FiCalendar size={16} />\r\n        </button>\r\n        <input\r\n          ref={hiddenInputRef}\r\n          type=\"date\"\r\n          className=\"w-0 h-0 opacity-0 absolute bottom-0 right-0 pointer-events-none\"\r\n          tabIndex={-1}\r\n          value={value || ''}\r\n          onChange={handleHiddenInputChange}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomDateInput;\r\n","import React, { useState, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiX, FiTrash2, FiClock, FiMapPin, FiFileText, FiRepeat, FiUser, FiCheck, FiAlignLeft, FiCalendar, FiAlertCircle } from 'react-icons/fi';\nimport { useDashboard } from '../../../contexts/DashboardContext';\nimport { cn } from '../../../../utils/cn';\nimport WeekDaySelector from '../../../../components/BoxedInputFields/WeekDaySelector';\nimport CustomDateInput from './CustomDateInput';\n\n// Helper component for label with icon\nconst Label = ({ icon: Icon, children }) => (\n  <label className=\"flex items-center gap-2 text-sm font-medium text-muted-foreground mb-1.5 \">\n    {Icon && <Icon className=\"w-4 h-4\" />}\n    {children}\n  </label>\n);\n\n// Helper for clean input styling\nconst inputClasses = \"flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:bg-background\";\nconst selectClasses = \"flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:bg-background appearance-none cursor-pointer\";\nconst textareaClasses = \"flex min-h-[80px] w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-y transition-all duration-200 hover:bg-background\";\n\n// Define EVENT_TYPES (Simplified for brevity, same logic)\nconst getEventTypesForWorkspace = (workspaceType, userRole, t) => {\n  // ... (Keep logic as is, just rebuilding the list)\n  // For this refactor, we assume the logic holds.\n  // If personal:\n  if (workspaceType === 'personal') return [{ id: 'availability', label: t('eventTypeLabels.availability', 'Availability') }];\n  // If team:\n  if (workspaceType === 'team') {\n    // Placeholder for full logic to avoid massive file bloat in this replacement\n    return [\n      { id: 'meeting', label: 'Meeting' },\n      { id: 'timeOffRequest', label: 'Time Off' },\n      { id: 'shift', label: 'Shift' }\n    ];\n  }\n  return [{ id: 'default', label: 'Event' }];\n};\n\nconst EventPanel = ({\n  event,\n  onClose,\n  onSave,\n  onDelete,\n  colorOptions,\n  userData,\n  workspaceContext = { type: 'personal' }\n}) => {\n  // Ref to track mounting time for phantom click protection\n  const mountTimeRef = useRef(Date.now());\n\n  const { t, i18n } = useTranslation('calendar');\n  const { selectedWorkspace } = useDashboard();\n\n  const getFullDayNames = (language) => {\n    const mondayDate = new Date(2000, 0, 3);\n    return Array.from({ length: 7 }, (_, i) => {\n      const date = new Date(mondayDate);\n      date.setDate(mondayDate.getDate() + i);\n      return date.toLocaleString(language, { weekday: 'long' });\n    });\n  };\n\n  const [formData, setFormData] = useState({\n    title: '',\n    start: new Date(),\n    end: new Date(),\n    location: '',\n    notes: '',\n    employee: '',\n    isRecurring: false,\n    repeatValue: 'Every Week',\n    endRepeatValue: 'After',\n    endRepeatCount: 10,\n    endRepeatDate: null,\n    type: 'availability',\n    weeklyDays: [false, false, false, false, false, false, false],\n    monthlyType: 'day',\n    monthlyDay: 1,\n    monthlyWeek: 'first',\n    monthlyDayOfWeek: 0\n  });\n\n  const [validationErrors, setValidationErrors] = useState([]);\n  const [isValidating, setIsValidating] = useState(false);\n\n  const calculateEndDate = () => {\n    if (!formData.isRecurring) return null;\n\n    const startDate = new Date(formData.start);\n    let endDate = null;\n\n    if (formData.endRepeatValue === 'On Date' && formData.endRepeatDate) {\n      endDate = new Date(formData.endRepeatDate);\n    } else if (formData.endRepeatValue === 'After') {\n      const occurrences = formData.endRepeatCount || 10;\n      const duration = formData.end.getTime() - formData.start.getTime();\n\n      if (formData.repeatValue === 'Every Day') {\n        endDate = new Date(startDate);\n        endDate.setDate(endDate.getDate() + (occurrences - 1));\n      } else if (formData.repeatValue === 'Every Week') {\n        const selectedDays = formData.weeklyDays || [false, false, false, false, false, false, false];\n        const selectedCount = selectedDays.filter(Boolean).length || 1;\n        const weeksNeeded = Math.ceil(occurrences / selectedCount);\n        endDate = new Date(startDate);\n        endDate.setDate(endDate.getDate() + (weeksNeeded * 7));\n      } else if (formData.repeatValue === 'Every Month') {\n        endDate = new Date(startDate);\n        endDate.setMonth(endDate.getMonth() + (occurrences - 1));\n      }\n    } else if (formData.endRepeatValue === 'Never') {\n      endDate = new Date(startDate);\n      endDate.setFullYear(endDate.getFullYear() + 2);\n    }\n\n    return endDate;\n  };\n\n  const calculatedEndDate = calculateEndDate();\n\n  // Initialize\n  useEffect(() => {\n    if (event && event.start && event.end) {\n      const startDate = new Date(event.start);\n      const endDate = new Date(event.end);\n\n      if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {\n        return;\n      }\n\n      const dayOfWeek = startDate.getDay();\n      const mondayIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n      const defaultWeeklyDays = [false, false, false, false, false, false, false];\n      defaultWeeklyDays[mondayIndex] = true;\n\n      setFormData({\n        id: event.id,\n        title: event.title || '',\n        start: startDate,\n        end: endDate,\n        location: event.location || '',\n        notes: event.notes || '',\n        employee: event.employee || '',\n        isRecurring: event.isRecurring || false,\n        repeatValue: event.repeatValue || 'Every Week',\n        endRepeatValue: event.endRepeatValue || 'After',\n        endRepeatCount: event.endRepeatCount || 10,\n        endRepeatDate: event.endRepeatDate ? new Date(event.endRepeatDate) : null,\n        type: event.type || 'availability',\n        weeklyDays: event.weeklyDays || defaultWeeklyDays,\n        monthlyType: event.monthlyType || 'day',\n        monthlyDay: event.monthlyDay || startDate.getDate(),\n        monthlyWeek: event.monthlyWeek || 'first',\n        monthlyDayOfWeek: event.monthlyDayOfWeek !== undefined ? event.monthlyDayOfWeek : mondayIndex\n      });\n    } else if (!event) {\n      const now = new Date();\n      const start = new Date(now);\n      start.setMinutes(0, 0, 0);\n      start.setSeconds(0, 0);\n      const end = new Date(start);\n      end.setHours(start.getHours() + 1);\n      const dayOfWeek = start.getDay();\n      const mondayIndex = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n      const defaultWeeklyDays = [false, false, false, false, false, false, false];\n      defaultWeeklyDays[mondayIndex] = true;\n\n      setFormData({\n        title: '',\n        start,\n        end,\n        location: '',\n        notes: '',\n        employee: '',\n        isRecurring: false,\n        repeatValue: 'Every Week',\n        endRepeatValue: 'After',\n        endRepeatCount: 10,\n        endRepeatDate: null,\n        type: 'availability',\n        weeklyDays: defaultWeeklyDays,\n        monthlyType: 'day',\n        monthlyDay: start.getDate(),\n        monthlyWeek: 'first',\n        monthlyDayOfWeek: mondayIndex\n      });\n    }\n  }, [event]);\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({ ...prev, [name]: value }));\n  };\n\n  const handleDateTimeChange = (field, value) => {\n    if (field.includes('Date')) {\n      const key = field === 'startDate' ? 'start' : 'end';\n      const current = new Date(formData[key]);\n\n      if (!value || value.trim() === '') {\n        return;\n      }\n\n      const datePattern = /^\\d{4}-\\d{2}-\\d{2}$/;\n      if (!datePattern.test(value)) {\n        return;\n      }\n\n      const dateValue = new Date(value);\n      if (isNaN(dateValue.getTime())) {\n        return;\n      }\n\n      const newDate = new Date(dateValue.getFullYear(), dateValue.getMonth(), dateValue.getDate(), current.getHours(), current.getMinutes());\n      if (!isNaN(newDate.getTime())) {\n        setFormData(prev => ({ ...prev, [key]: newDate }));\n      }\n    }\n    if (field.includes('Time')) {\n      if (!value || value.trim() === '') {\n        return;\n      }\n\n      const key = field === 'startTime' ? 'start' : 'end';\n      const timeParts = value.split(':');\n      if (timeParts.length !== 2) {\n        return;\n      }\n\n      const h = parseInt(timeParts[0], 10);\n      const m = parseInt(timeParts[1], 10);\n\n      if (isNaN(h) || isNaN(m) || h < 0 || h > 23 || m < 0 || m > 59) {\n        return;\n      }\n\n      const current = new Date(formData[key]);\n      const newDate = new Date(current.getFullYear(), current.getMonth(), current.getDate(), h, m);\n      if (!isNaN(newDate.getTime())) {\n        setFormData(prev => ({ ...prev, [key]: newDate }));\n      }\n    }\n  };\n\n  const formatDateForInput = (d) => {\n    if (!d) return '';\n    try {\n      const date = d instanceof Date ? d : new Date(d);\n      if (isNaN(date.getTime())) return '';\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    } catch (e) {\n      return '';\n    }\n  };\n\n  const parseDateSafely = (value) => {\n    if (!value || value.trim() === '') {\n      return null;\n    }\n    const datePattern = /^\\d{4}-\\d{2}-\\d{2}$/;\n    if (!datePattern.test(value)) {\n      return null;\n    }\n    const dateValue = new Date(value);\n    if (isNaN(dateValue.getTime())) {\n      return null;\n    }\n    return dateValue;\n  };\n\n  const formatTimeForInput = (d) => {\n    if (!d) return '';\n    try {\n      const date = d instanceof Date ? d : new Date(d);\n      if (isNaN(date.getTime())) return '';\n      return date.toTimeString().slice(0, 5);\n    } catch (e) {\n      return '';\n    }\n  };\n\n  const handleSaveWrapper = () => {\n    // Prevent phantom clicks (immediate submission) by ignoring clicks within 500ms of mount\n    const timeSinceMount = Date.now() - mountTimeRef.current;\n    console.log(`handleSaveWrapper called. Time since mount: ${timeSinceMount}ms`);\n\n    if (timeSinceMount < 500) {\n      console.log('Ignoring click on save button (too soon after mount)');\n      return;\n    }\n\n    if (formData.end <= formData.start) {\n      setValidationErrors(['End time must be after start time']);\n      return;\n    }\n    setIsValidating(true);\n    // Simulate slight delay for UX\n    setTimeout(() => {\n      onSave({\n        ...formData,\n        isValidated: true,\n        fromDatabase: true,\n        color: '#0f54bc',\n        color1: '#a8c1ff',\n        color2: '#4da6fb'\n      }, true); // Pass shouldClose = true\n      setIsValidating(false);\n      // Don't call onClose here - handleEventSave will handle it\n    }, 400);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200 overflow-y-auto p-4\" onClick={onClose}>\n      <div\n        className=\"bg-card w-full rounded-2xl shadow-2xl flex flex-col border border-border animate-in zoom-in-95 duration-200 my-auto relative\"\n        style={{ maxWidth: formData.isRecurring ? '1400px' : '700px' }}\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header - Glassy & Clean */}\n        <div className=\"flex items-center justify-between px-6 py-5 border-b border-border bg-muted/20 backdrop-blur-md shrink-0 rounded-t-2xl\">\n          <div className=\"flex flex-col gap-1\">\n            <h3 className=\"font-bold tracking-tight text-foreground m-0\" style={{ fontSize: '18px' }}>\n              {event && event.id ? t('editEvent', 'Edit Event') : t('createEvent', 'Create Event')}\n            </h3>\n            <span className=\"text-xs text-muted-foreground font-medium uppercase tracking-wider\">\n              {formData.type}\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {event && event.id && onDelete && (\n              <button\n                onClick={onDelete}\n                className=\"p-2 text-destructive hover:bg-destructive/10 rounded-full transition-colors\"\n                title=\"Delete\"\n              >\n                <FiTrash2 size={18} />\n              </button>\n            )}\n            <button\n              onClick={onClose}\n              className=\"p-2 text-muted-foreground hover:bg-muted hover:text-foreground rounded-full transition-colors\"\n            >\n              <FiX size={20} />\n            </button>\n          </div>\n        </div>\n\n        {/* Validation Errors */}\n        {validationErrors.length > 0 && (\n          <div className=\"relative overflow-hidden px-6 py-4 bg-white border-b-2 border-[var(--red-2)] text-[var(--red-4)] animate-in slide-in-from-top-2 shrink-0 flex gap-3\" style={{ boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)' }}>\n            <div className=\"flex-shrink-0\">\n              <div className=\"w-8 h-8 rounded-full bg-[var(--red-2)]/20 flex items-center justify-center border-2 border-[var(--red-2)]\">\n                <FiAlertCircle className=\"w-4 h-4 text-[var(--red-4)]\" />\n              </div>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"font-bold text-sm mb-1 text-[var(--red-4)]\">Validation Errors</h4>\n              {validationErrors.map((err, i) => (\n                <div key={i} className=\"text-sm leading-relaxed text-[var(--red-4)]/90\">{err}</div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Content */}\n        <div className={formData.isRecurring ? \"grid grid-cols-2\" : \"p-6\"}>\n          {formData.isRecurring ? (\n            <>\n              {/* Left Column - Main Fields */}\n              <div className=\"p-6 space-y-5 bg-background\">\n                {/* Title */}\n                <div className=\"space-y-1.5\">\n                  <Label icon={FiFileText}>{t('title', 'Title')}</Label>\n                  <input\n                    name=\"title\"\n                    value={formData.title}\n                    onChange={handleChange}\n                    placeholder=\"Add title\"\n                    className={cn(inputClasses, \"text-base font-medium\")}\n                    autoFocus={!event?.id}\n                  />\n                </div>\n\n                {/* Date & Time Grid */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-1.5\">\n                    <Label icon={FiClock}>Start</Label>\n                    <div className=\"grid grid-cols-[3fr_2fr] gap-2\">\n                      <CustomDateInput value={formatDateForInput(formData.start)} onChange={(val) => handleDateTimeChange('startDate', val)} className={inputClasses} />\n                      <input type=\"time\" value={formatTimeForInput(formData.start)} onChange={(e) => handleDateTimeChange('startTime', e.target.value)} className={cn(inputClasses, \"min-w-0\")} />\n                    </div>\n                  </div>\n                  <div className=\"space-y-1.5\">\n                    <Label icon={FiClock}>End</Label>\n                    <div className=\"grid grid-cols-[3fr_2fr] gap-2\">\n                      <CustomDateInput value={formatDateForInput(formData.end)} onChange={(val) => handleDateTimeChange('endDate', val)} className={inputClasses} />\n                      <input type=\"time\" value={formatTimeForInput(formData.end)} onChange={(e) => handleDateTimeChange('endTime', e.target.value)} className={cn(inputClasses, \"min-w-0\")} />\n                    </div>\n                  </div>\n                </div>\n\n                {/* Location */}\n                <div className=\"space-y-1.5\">\n                  <Label icon={FiMapPin}>{t('location', 'Location')}</Label>\n                  <input\n                    name=\"location\"\n                    value={formData.location}\n                    onChange={handleChange}\n                    placeholder=\"Add location\"\n                    className={inputClasses}\n                  />\n                </div>\n\n                {/* Notes */}\n                <div className=\"space-y-1.5\">\n                  <Label icon={FiAlignLeft}>{t('notes', 'Description')}</Label>\n                  <textarea\n                    name=\"notes\"\n                    value={formData.notes}\n                    onChange={handleChange}\n                    placeholder=\"Add description...\"\n                    className={textareaClasses}\n                  />\n                </div>\n\n                {/* Recurring Toggle */}\n                <div className=\"space-y-1.5\">\n                  <div className=\"flex items-center gap-3 p-3 rounded-lg border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors\" onClick={() => setFormData(p => ({ ...p, isRecurring: !p.isRecurring }))}>\n                    <div className={cn(\"w-5 h-5 rounded border flex items-center justify-center transition-colors shrink-0\", formData.isRecurring ? \"bg-primary border-primary text-primary-foreground\" : \"border-muted-foreground\")}>\n                      {formData.isRecurring && <FiCheck className=\"w-3.5 h-3.5\" />}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <FiRepeat className=\"w-4 h-4 text-muted-foreground\" />\n                      <span className=\"text-sm font-medium\">{t('recurringEvent', 'Repeat this event')}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Right Column - Recurring Configuration */}\n              <div className=\"p-6 space-y-5 bg-muted/30\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  {/* Repeat Frequency */}\n                  <div className=\"space-y-1.5\">\n                    <Label icon={FiRepeat}>Repeat</Label>\n                    <div className=\"relative\">\n                      <select\n                        name=\"repeatValue\"\n                        value={formData.repeatValue}\n                        onChange={handleChange}\n                        className={selectClasses}\n                      >\n                        <option value=\"Every Day\">Every Day</option>\n                        <option value=\"Every Week\">Every Week</option>\n                        <option value=\"Every Month\">Every Month</option>\n                      </select>\n                      <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                        <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* End Repeat Option */}\n                  <div className=\"space-y-1.5\">\n                    <Label>End Repeat</Label>\n                    <div className=\"relative\">\n                      <select\n                        name=\"endRepeatValue\"\n                        value={formData.endRepeatValue}\n                        onChange={handleChange}\n                        className={selectClasses}\n                      >\n                        <option value=\"After\">After</option>\n                        <option value=\"On Date\">On Date</option>\n                        <option value=\"Never\">Never</option>\n                      </select>\n                      <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                        <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Weekly Day Selector */}\n                {formData.repeatValue === 'Every Week' && (\n                  <div className=\"space-y-1.5\">\n                    <Label icon={FiCalendar}>{t('repeatDays', 'Repeat on days')}</Label>\n                    <WeekDaySelector\n                      selectedDays={formData.weeklyDays}\n                      onChange={(days) => setFormData(p => ({ ...p, weeklyDays: days }))}\n                    />\n                  </div>\n                )}\n\n                {/* Monthly Repeat Options */}\n                {formData.repeatValue === 'Every Month' && (\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-1.5\">\n                      <Label>Repeat on</Label>\n                      <div className=\"relative\">\n                        <select\n                          name=\"monthlyType\"\n                          value={formData.monthlyType}\n                          onChange={handleChange}\n                          className={selectClasses}\n                        >\n                          <option value=\"day\">Day of month</option>\n                          <option value=\"weekday\">Day of week</option>\n                        </select>\n                        <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                          <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                          </svg>\n                        </div>\n                      </div>\n                    </div>\n\n                    {formData.monthlyType === 'day' && (\n                      <div className=\"space-y-1.5\">\n                        <Label>Day number</Label>\n                        <input\n                          type=\"number\"\n                          name=\"monthlyDay\"\n                          value={formData.monthlyDay}\n                          onChange={handleChange}\n                          min=\"1\"\n                          max=\"31\"\n                          className={inputClasses}\n                        />\n                      </div>\n                    )}\n\n                    {formData.monthlyType === 'weekday' && (\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-1.5\">\n                          <Label>Week</Label>\n                          <div className=\"relative\">\n                            <select\n                              name=\"monthlyWeek\"\n                              value={formData.monthlyWeek}\n                              onChange={handleChange}\n                              className={selectClasses}\n                            >\n                              <option value=\"first\">First</option>\n                              <option value=\"second\">Second</option>\n                              <option value=\"third\">Third</option>\n                              <option value=\"fourth\">Fourth</option>\n                              <option value=\"last\">Last</option>\n                            </select>\n                            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                              <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                              </svg>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"space-y-1.5\">\n                          <Label>Day of week</Label>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {getFullDayNames(i18n.language).map((dayName, index) => (\n                              <button\n                                key={index}\n                                type=\"button\"\n                                onClick={() => setFormData(p => ({ ...p, monthlyDayOfWeek: index }))}\n                                className={cn(\n                                  \"px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200\",\n                                  \"border border-input hover:bg-muted\",\n                                  formData.monthlyDayOfWeek === index\n                                    ? \"bg-primary text-primary-foreground border-primary\"\n                                    : \"bg-background text-foreground\"\n                                )}\n                              >\n                                {dayName}\n                              </button>\n                            ))}\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n\n                {/* Conditional Fields based on End Repeat */}\n                {(formData.endRepeatValue === 'After' || formData.endRepeatValue === 'On Date') && (\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    {formData.endRepeatValue === 'After' && (\n                      <div className=\"space-y-1.5\">\n                        <Label>Number of occurrences</Label>\n                        <input\n                          type=\"number\"\n                          name=\"endRepeatCount\"\n                          value={formData.endRepeatCount}\n                          onChange={handleChange}\n                          min=\"1\"\n                          max=\"365\"\n                          className={inputClasses}\n                        />\n                      </div>\n                    )}\n\n                    {formData.endRepeatValue === 'On Date' && (\n                      <div className=\"space-y-1.5\">\n                        <Label>End Date</Label>\n                        <CustomDateInput\n                          value={formData.endRepeatDate ? formatDateForInput(formData.endRepeatDate) : ''}\n                          onChange={(val) => {\n                            const parsedDate = parseDateSafely(val);\n                            if (parsedDate !== null || val === '') {\n                              setFormData(p => ({ ...p, endRepeatDate: parsedDate }));\n                            }\n                          }}\n                          className={inputClasses}\n                        />\n                      </div>\n                    )}\n                  </div>\n                )}\n\n                {/* Calculated End Date Display */}\n                {calculatedEndDate && (\n                  <div className=\"flex items-center gap-2 p-3 rounded-lg bg-background/50 border border-border\">\n                    <FiCalendar className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-sm text-muted-foreground\">\n                      {t('calculatedEndDate', 'Calculated end date')}:\n                    </span>\n                    <span className=\"text-sm font-medium text-foreground\">\n                      {calculatedEndDate.toLocaleDateString()}\n                    </span>\n                  </div>\n                )}\n              </div>\n            </>\n          ) : (\n            <div className=\"space-y-5\">\n              {/* Title */}\n              <div className=\"space-y-1.5\">\n                <Label icon={FiFileText}>{t('title', 'Title')}</Label>\n                <input\n                  name=\"title\"\n                  value={formData.title}\n                  onChange={handleChange}\n                  placeholder=\"Add title\"\n                  className={cn(inputClasses, \"text-base font-medium\")}\n                  autoFocus={!event?.id}\n                />\n              </div>\n\n              {/* Date & Time Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-1.5\">\n                  <Label icon={FiClock}>Start</Label>\n                  <div className=\"grid grid-cols-[3fr_2fr] gap-2\">\n                    <CustomDateInput value={formatDateForInput(formData.start)} onChange={(val) => handleDateTimeChange('startDate', val)} className={inputClasses} />\n                    <input type=\"time\" value={formatTimeForInput(formData.start)} onChange={(e) => handleDateTimeChange('startTime', e.target.value)} className={cn(inputClasses, \"min-w-0\")} />\n                  </div>\n                </div>\n                <div className=\"space-y-1.5\">\n                  <Label icon={FiClock}>End</Label>\n                  <div className=\"grid grid-cols-[3fr_2fr] gap-2\">\n                    <CustomDateInput value={formatDateForInput(formData.end)} onChange={(val) => handleDateTimeChange('endDate', val)} className={inputClasses} />\n                    <input type=\"time\" value={formatTimeForInput(formData.end)} onChange={(e) => handleDateTimeChange('endTime', e.target.value)} className={cn(inputClasses, \"min-w-0\")} />\n                  </div>\n                </div>\n              </div>\n\n              {/* Location */}\n              <div className=\"space-y-1.5\">\n                <Label icon={FiMapPin}>{t('location', 'Location')}</Label>\n                <input\n                  name=\"location\"\n                  value={formData.location}\n                  onChange={handleChange}\n                  placeholder=\"Add location\"\n                  className={inputClasses}\n                />\n              </div>\n\n              {/* Notes */}\n              <div className=\"space-y-1.5\">\n                <Label icon={FiAlignLeft}>{t('notes', 'Description')}</Label>\n                <textarea\n                  name=\"notes\"\n                  value={formData.notes}\n                  onChange={handleChange}\n                  placeholder=\"Add description...\"\n                  className={textareaClasses}\n                />\n              </div>\n\n              {/* Recurring Toggle */}\n              <div className=\"space-y-1.5\">\n                <div className=\"flex items-center gap-3 p-3 rounded-lg border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors\" onClick={() => setFormData(p => ({ ...p, isRecurring: !p.isRecurring }))}>\n                  <div className={cn(\"w-5 h-5 rounded border flex items-center justify-center transition-colors shrink-0\", formData.isRecurring ? \"bg-primary border-primary text-primary-foreground\" : \"border-muted-foreground\")}>\n                    {formData.isRecurring && <FiCheck className=\"w-3.5 h-3.5\" />}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <FiRepeat className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"text-sm font-medium\">{t('recurringEvent', 'Repeat this event')}</span>\n                  </div>\n                </div>\n\n                {/* Recurring Configuration - Show when enabled */}\n                {formData.isRecurring && (\n                  <div className=\"pl-4 pr-4 py-4 rounded-lg border border-border bg-muted/5 space-y-4 animate-in slide-in-from-top-2 duration-200\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      {/* Repeat Frequency */}\n                      <div className=\"space-y-1.5\">\n                        <Label icon={FiRepeat}>Repeat</Label>\n                        <div className=\"relative\">\n                          <select\n                            name=\"repeatValue\"\n                            value={formData.repeatValue}\n                            onChange={handleChange}\n                            className={selectClasses}\n                          >\n                            <option value=\"Every Day\">Every Day</option>\n                            <option value=\"Every Week\">Every Week</option>\n                            <option value=\"Every Month\">Every Month</option>\n                          </select>\n                          <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                            <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                            </svg>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* End Repeat Option */}\n                      <div className=\"space-y-1.5\">\n                        <Label>End Repeat</Label>\n                        <div className=\"relative\">\n                          <select\n                            name=\"endRepeatValue\"\n                            value={formData.endRepeatValue}\n                            onChange={handleChange}\n                            className={selectClasses}\n                          >\n                            <option value=\"After\">After</option>\n                            <option value=\"On Date\">On Date</option>\n                            <option value=\"Never\">Never</option>\n                          </select>\n                          <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                            <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                            </svg>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Weekly Day Selector */}\n                    {formData.repeatValue === 'Every Week' && (\n                      <div className=\"space-y-1.5\">\n                        <Label icon={FiCalendar}>{t('repeatDays', 'Repeat on days')}</Label>\n                        <WeekDaySelector\n                          selectedDays={formData.weeklyDays}\n                          onChange={(days) => setFormData(p => ({ ...p, weeklyDays: days }))}\n                        />\n                      </div>\n                    )}\n\n                    {/* Monthly Repeat Options */}\n                    {formData.repeatValue === 'Every Month' && (\n                      <div className=\"space-y-4\">\n                        <div className=\"space-y-1.5\">\n                          <Label>Repeat on</Label>\n                          <div className=\"relative\">\n                            <select\n                              name=\"monthlyType\"\n                              value={formData.monthlyType}\n                              onChange={handleChange}\n                              className={selectClasses}\n                            >\n                              <option value=\"day\">Day of month</option>\n                              <option value=\"weekday\">Day of week</option>\n                            </select>\n                            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                              <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                              </svg>\n                            </div>\n                          </div>\n                        </div>\n\n                        {formData.monthlyType === 'day' && (\n                          <div className=\"space-y-1.5\">\n                            <Label>Day number</Label>\n                            <input\n                              type=\"number\"\n                              name=\"monthlyDay\"\n                              value={formData.monthlyDay}\n                              onChange={handleChange}\n                              min=\"1\"\n                              max=\"31\"\n                              className={inputClasses}\n                            />\n                          </div>\n                        )}\n\n                        {formData.monthlyType === 'weekday' && (\n                          <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-1.5\">\n                              <Label>Week</Label>\n                              <div className=\"relative\">\n                                <select\n                                  name=\"monthlyWeek\"\n                                  value={formData.monthlyWeek}\n                                  onChange={handleChange}\n                                  className={selectClasses}\n                                >\n                                  <option value=\"first\">First</option>\n                                  <option value=\"second\">Second</option>\n                                  <option value=\"third\">Third</option>\n                                  <option value=\"fourth\">Fourth</option>\n                                  <option value=\"last\">Last</option>\n                                </select>\n                                <div className=\"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none\">\n                                  <svg className=\"w-4 h-4 text-muted-foreground\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                                  </svg>\n                                </div>\n                              </div>\n                            </div>\n                            <div className=\"space-y-1.5\">\n                              <Label>Day of week</Label>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {getFullDayNames(i18n.language).map((dayName, index) => (\n                                  <button\n                                    key={index}\n                                    type=\"button\"\n                                    onClick={() => setFormData(p => ({ ...p, monthlyDayOfWeek: index }))}\n                                    className={cn(\n                                      \"px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200\",\n                                      \"border border-input hover:bg-muted\",\n                                      formData.monthlyDayOfWeek === index\n                                        ? \"bg-primary text-primary-foreground border-primary\"\n                                        : \"bg-background text-foreground\"\n                                    )}\n                                  >\n                                    {dayName}\n                                  </button>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Conditional Fields based on End Repeat */}\n                    {(formData.endRepeatValue === 'After' || formData.endRepeatValue === 'On Date') && (\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        {formData.endRepeatValue === 'After' && (\n                          <div className=\"space-y-1.5\">\n                            <Label>Number of occurrences</Label>\n                            <input\n                              type=\"number\"\n                              name=\"endRepeatCount\"\n                              value={formData.endRepeatCount}\n                              onChange={handleChange}\n                              min=\"1\"\n                              max=\"365\"\n                              className={inputClasses}\n                            />\n                          </div>\n                        )}\n\n                        {formData.endRepeatValue === 'On Date' && (\n                          <div className=\"space-y-1.5\">\n                            <Label>End Date</Label>\n                            <CustomDateInput\n                              value={formData.endRepeatDate ? formatDateForInput(formData.endRepeatDate) : ''}\n                              onChange={(val) => {\n                                const parsedDate = parseDateSafely(val);\n                                if (parsedDate !== null || val === '') {\n                                  setFormData(p => ({ ...p, endRepeatDate: parsedDate }));\n                                }\n                              }}\n                              className={inputClasses}\n                            />\n                          </div>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Calculated End Date Display */}\n                    {calculatedEndDate && (\n                      <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/30 border border-border\">\n                        <FiCalendar className=\"w-4 h-4 text-muted-foreground\" />\n                        <span className=\"text-sm text-muted-foreground\">\n                          {t('calculatedEndDate', 'Calculated end date')}:\n                        </span>\n                        <span className=\"text-sm font-medium text-foreground\">\n                          {calculatedEndDate.toLocaleDateString()}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-5 border-t border-border bg-muted/10 flex justify-end gap-3 backdrop-blur-sm shrink-0 rounded-b-2xl\">\n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors\"\n          >\n            {t('cancel', 'Cancel')}\n          </button>\n          <button\n            onClick={handleSaveWrapper}\n            disabled={isValidating}\n            className=\"px-6 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95 disabled:opacity-70 disabled:pointer-events-none flex items-center gap-2\"\n          >\n            {isValidating && <span className=\"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin\" />}\n            {t('save', 'Save Event')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EventPanel;","import { CALENDAR_COLORS } from './constants';\nimport { getShortDays, getDaysAroundCurrent, getWeekDates } from './dateHelpers';\n\nexport const getDefaultCategories = () => {\n  return CALENDAR_COLORS.map(cat => ({\n    name: cat.name,\n    color: cat.color,\n    checked: true\n  }));\n};\n\nexport const safeMap = (array, callback) => {\n  if (!array || !Array.isArray(array)) return [];\n  return array.map(callback);\n};\n\nexport { getShortDays, getDaysAroundCurrent, getWeekDates }; ","import { useState, useCallback } from 'react';\nimport { getDefaultCategories } from '../utils/calendar';\n\n/**\n * Custom hook for managing calendar state\n * Centralizes date, view, navigation, and UI state management\n * \n * Extracted from Calendar.js to reduce component complexity and improve testability\n */\nexport const useCalendarState = (initialDate = new Date()) => {\n  // Date and navigation state\n  const [currentDate, setCurrentDate] = useState(() => {\n    // Ensure we always have a valid Date object\n    if (initialDate instanceof Date) {\n      return initialDate;\n    }\n    return new Date();\n  });\n  const [view, setView] = useState('week'); // 'week' or 'day'\n  const [slideDirection, setSlideDirection] = useState(null);\n\n  // Scroll state for infinite scrolling\n  const [weekScrollOffset, setWeekScrollOffset] = useState(0);\n  const [dayScrollOffset, setDayScrollOffset] = useState(0);\n\n  // Sidebar state\n  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);\n\n  // Filter categories state\n  const [categories, setCategories] = useState(getDefaultCategories());\n\n  // UI component states\n  const [showHeaderDateDropdown, setShowHeaderDateDropdown] = useState(false);\n  const [dropdownPosition, setDropdownPosition] = useState(null);\n\n  // Context menu state\n  const [showContextMenu, setShowContextMenu] = useState(false);\n  const [contextMenuPosition, setContextMenuPosition] = useState({ x: 0, y: 0 });\n  const [contextMenuEvent, setContextMenuEvent] = useState(null);\n\n  // Navigation helpers\n  const navigateDate = useCallback((direction) => {\n    const newDate = new Date(currentDate);\n    // Preserve the time components (hours, minutes, seconds, milliseconds)\n    const hours = newDate.getHours();\n    const minutes = newDate.getMinutes();\n    const seconds = newDate.getSeconds();\n    const milliseconds = newDate.getMilliseconds();\n\n    if (view === 'week') {\n      newDate.setDate(newDate.getDate() + (direction * 7));\n      setWeekScrollOffset(0); // Reset scroll to Monday-Sunday\n    } else if (view === 'day') {\n      setSlideDirection(direction > 0 ? 'left' : 'right');\n      newDate.setDate(newDate.getDate() + direction);\n      setDayScrollOffset(0); // Reset day scroll to center\n    } else {\n      newDate.setMonth(newDate.getMonth() + direction);\n    }\n\n    // Restore the time components after date change\n    newDate.setHours(hours, minutes, seconds, milliseconds);\n    setCurrentDate(newDate);\n  }, [currentDate, view]);\n\n  // Week scroll navigation\n  const handleWeekScroll = useCallback((direction, isInternalScroll = false) => {\n    if (isInternalScroll) {\n      setWeekScrollOffset(prevOffset => {\n        const newOffset = prevOffset + direction;\n        return Math.max(-7, Math.min(7, newOffset));\n      });\n    } else if (direction === -1) {\n      const newDate = new Date(currentDate);\n      newDate.setDate(newDate.getDate() - 7);\n      setCurrentDate(newDate);\n      setWeekScrollOffset(0);\n    } else if (direction === 1) {\n      const newDate = new Date(currentDate);\n      newDate.setDate(newDate.getDate() + 7);\n      setCurrentDate(newDate);\n      setWeekScrollOffset(0);\n    }\n  }, [currentDate]);\n\n  // Day scroll navigation\n  const handleDayScroll = useCallback((direction, isInternalScroll = false) => {\n    if (isInternalScroll) {\n      setDayScrollOffset(prevOffset => {\n        const newOffset = prevOffset + direction;\n        return Math.max(-7, Math.min(7, newOffset));\n      });\n    } else if (direction === -1) {\n      const newDate = new Date(currentDate);\n      newDate.setDate(newDate.getDate() - 1);\n      setCurrentDate(newDate);\n      setDayScrollOffset(0);\n    } else if (direction === 1) {\n      const newDate = new Date(currentDate);\n      newDate.setDate(newDate.getDate() + 1);\n      setCurrentDate(newDate);\n      setDayScrollOffset(0);\n    }\n  }, [currentDate]);\n\n  // Day click handler - switches to the view selected in the header (week or day)\n  const handleDayClick = useCallback((date) => {\n    const direction = date > currentDate ? 1 : -1;\n    setSlideDirection(direction > 0 ? 'left' : 'right');\n    setCurrentDate(date);\n\n    // Reset scroll to center when selecting a specific date\n    setWeekScrollOffset(0);\n    setDayScrollOffset(0);\n\n    // Switch to the view selected in the header\n    // If 'day' is selected in header, switch to day view\n    // If 'week' is selected in header, switch to week view\n    // If no view is selected (sidebar), default to week view\n    if (view === 'day') {\n      setView('day');\n    } else {\n      setView('week');\n    }\n  }, [currentDate, view, setView]);\n\n  // Handle upcoming event click\n  const handleUpcomingEventClick = useCallback((eventDate) => {\n    const direction = eventDate > currentDate ? 1 : -1;\n    setSlideDirection(direction > 0 ? 'left' : 'right');\n    setCurrentDate(new Date(eventDate));\n\n    // Reset scroll to Monday-Sunday when clicking on upcoming events\n    setWeekScrollOffset(0);\n\n    setView('week');\n  }, [currentDate]);\n\n  // Category management\n  const handleCategoryToggle = useCallback((index) => {\n    setCategories(prevCategories => {\n      const newCategories = [...prevCategories];\n      newCategories[index] = {\n        ...newCategories[index],\n        checked: !newCategories[index].checked\n      };\n      return newCategories;\n    });\n  }, []);\n\n  // Header date click handler\n  const handleHeaderDateClick = useCallback((e) => {\n    e.stopPropagation();\n\n    if (e.target.tagName !== 'INPUT') {\n      const rect = e.currentTarget.getBoundingClientRect();\n      setDropdownPosition({\n        x: 0,\n        y: rect.height + 8\n      });\n      setShowHeaderDateDropdown(!showHeaderDateDropdown);\n    }\n  }, [showHeaderDateDropdown]);\n\n  // Sidebar toggle\n  const toggleSidebar = useCallback(() => {\n    setIsSidebarCollapsed(!isSidebarCollapsed);\n  }, [isSidebarCollapsed]);\n\n  // Back to mini calendar\n  const handleBackToMiniCalendar = useCallback(() => {\n    // No-op: kept for API compatibility\n  }, []);\n\n  // Context menu handlers\n  const showContextMenuAt = useCallback((event, position) => {\n    setContextMenuEvent(event);\n    setContextMenuPosition(position);\n    setShowContextMenu(true);\n  }, []);\n\n  const hideContextMenu = useCallback(() => {\n    setShowContextMenu(false);\n    setContextMenuEvent(null);\n  }, []);\n\n  // Context menu edit handler\n  const handleContextMenuEdit = useCallback(() => {\n    if (contextMenuEvent) {\n      // This would be handled by the parent component\n      hideContextMenu();\n    }\n  }, [contextMenuEvent, hideContextMenu]);\n\n  // Context menu duplicate handler\n  const handleContextMenuDuplicate = useCallback(() => {\n    if (contextMenuEvent) {\n      // This would be handled by the parent component\n      hideContextMenu();\n    }\n  }, [contextMenuEvent, hideContextMenu]);\n\n  // Context menu delete handler\n  const handleContextMenuDelete = useCallback(() => {\n    if (contextMenuEvent) {\n      // This would be handled by the parent component\n      hideContextMenu();\n    }\n  }, [contextMenuEvent, hideContextMenu]);\n\n  return {\n    // Date and navigation state\n    currentDate,\n    setCurrentDate,\n    view,\n    setView,\n    slideDirection,\n    setSlideDirection,\n\n    // Scroll state\n    weekScrollOffset,\n    setWeekScrollOffset,\n    dayScrollOffset,\n    setDayScrollOffset,\n\n    // Sidebar state\n    isSidebarCollapsed,\n    setIsSidebarCollapsed,\n\n    // Categories\n    categories,\n    setCategories,\n\n    // UI components\n    showHeaderDateDropdown,\n    setShowHeaderDateDropdown,\n    dropdownPosition,\n    setDropdownPosition,\n\n    // Context menu\n    showContextMenu,\n    contextMenuPosition,\n    contextMenuEvent,\n\n    // Navigation functions\n    navigateDate,\n    handleWeekScroll,\n    handleDayScroll,\n    handleDayClick,\n    handleUpcomingEventClick,\n    handleCategoryToggle,\n    handleHeaderDateClick,\n    toggleSidebar,\n    handleBackToMiniCalendar,\n\n    // Context menu functions\n    showContextMenuAt,\n    hideContextMenu,\n    handleContextMenuEdit,\n    handleContextMenuDuplicate,\n    handleContextMenuDelete\n  };\n}; ","import { collection, getDocs, query, where, orderBy, Timestamp, onSnapshot } from 'firebase/firestore';\nimport { useState, useEffect, useCallback } from 'react';\nimport { db, auth, functions } from '../../../../services/firebase';\nimport { httpsCallable } from 'firebase/functions';\nimport { useTutorial } from '../../../contexts/TutorialContext';\n\nconst saveEventFunction = httpsCallable(functions, 'saveCalendarEvent');\nconst saveRecurringEventsFunction = httpsCallable(functions, 'saveRecurringEvents');\n\nconst checkPermissions = async (uid) => {\n  console.log('checkPermissions called with uid:', uid);\n\n  if (!uid) {\n    console.error('checkPermissions failed: User ID is required');\n    return false;\n  }\n\n  console.log('Auth state in checkPermissions:', {\n    currentUser: auth.currentUser ? auth.currentUser.uid : 'null',\n    isInitialized: auth._isInitialized\n  });\n\n  // If auth is still initializing, wait a bit\n  if (!auth._isInitialized) {\n    console.log('Auth not fully initialized, waiting...');\n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n\n  const currentUser = auth.currentUser;\n\n  if (!currentUser) {\n    console.error('checkPermissions failed: User not authenticated');\n    return false;\n  }\n\n  if (currentUser.uid !== uid) {\n    console.error(`checkPermissions failed: User ID mismatch - current: ${currentUser.uid}, requested: ${uid}`);\n    return false;\n  }\n\n  console.log('checkPermissions passed for uid:', uid);\n  return true;\n};\n\n// Function to fetch events from both availability and contracts collections\nexport const fetchUserEvents = async (userId, accountType = \"worker\") => {\n  try {\n    // Function to fetch all contracts if employer, else fetch only contracts related to the user\n    const fetchContracts = async () => {\n      const contractsRef = collection(db, 'contracts');\n      let contractsQuery;\n\n      if (accountType === 'employer') {\n        // For employers, fetch all contracts they've created\n        contractsQuery = query(contractsRef, where('employerId', '==', userId));\n      } else {\n        // For workers, fetch contracts where they're assigned\n        contractsQuery = query(contractsRef, where('workerId', '==', userId));\n      }\n\n      const contractsSnapshot = await getDocs(contractsQuery);\n      return contractsSnapshot.docs;\n    };\n\n    await checkPermissions(userId);\n\n    const events = [];\n\n    // Fetch availability events\n    if (accountType === 'worker') {\n      console.log('Fetching availability events');\n      const availabilityRef = collection(db, 'availability');\n      const availabilityQuery = query(availabilityRef, where('userId', '==', userId));\n      const availabilitySnapshot = await getDocs(availabilityQuery);\n\n      availabilitySnapshot.forEach(doc => {\n        const data = doc.data();\n        const isValidated = data.isValidated || false;\n\n        // Directly map to category colors\n        let eventColor, color1, color2;\n        if (isValidated) {\n          // Map to blue category - Validated events\n          eventColor = '#0f54bc';  // Match blue category color from Calendar.js\n          color1 = '#a8c1ff';\n          color2 = '#4da6fb';\n          console.log(`Event ${doc.id}: Assigned validated (blue) color`);\n        } else {\n          // Map to grey category - Unvalidated events  \n          eventColor = '#8c8c8c';  // Match grey category color from Calendar.js\n          color1 = '#e6e6e6';\n          color2 = '#b3b3b3';\n          console.log(`Event ${doc.id}: Assigned unvalidated (grey) color`);\n        }\n\n        // Check if this is a recurring event\n        const isRecurring = !!data.recurrenceId;\n\n        events.push({\n          id: doc.id,\n          title: 'Available',\n          start: new Date(data.from),\n          end: new Date(data.to),\n          color: eventColor,\n          color1: color1,\n          color2: color2,\n          // Include all additional fields for filtering\n          canton: data.locationCountry || [],\n          area: data.LocationArea || [],\n          languages: data.languages || [],\n          experience: data.experience || '',\n          software: data.software || [],\n          certifications: data.certifications || [],\n          isAvailability: true, // Mark as availability event\n          isValidated: isValidated,\n          // Add recurring event info\n          recurrenceId: data.recurrenceId || null,\n          isRecurring: isRecurring,\n          fromDatabase: true // Mark as coming from database\n        });\n      });\n\n      // Fetch contracts events\n      console.log('Fetching contracts events');\n      const contractsSnapshot = await fetchContracts();\n\n      contractsSnapshot.forEach(doc => {\n        const data = doc.data();\n        events.push({\n          id: doc.id,\n          title: data.title || 'Contract',\n          start: new Date(data.from),\n          end: new Date(data.to),\n          color: '#f54455', // Red color for contracts\n          color1: '#ffbbcf',\n          color2: '#ff6064',\n          location: data.location || '',\n          notes: data.notes || '',\n          isContract: true, // Mark as contract event\n          isValidated: data.isValidated || false,\n          fromDatabase: true // Mark as coming from database\n        });\n      });\n    }\n\n    console.log(`Fetched ${events.length} events for user:`, userId);\n    return { success: true, events };\n  } catch (error) {\n    console.error('Error fetching events:', error);\n    return {\n      success: false,\n      error: error.message,\n      code: error.code\n    };\n  }\n};\n\n/**\n * Save a single event to database using Firebase functions\n * @param {Object} event - The event to save\n * @param {string} userId - The user ID\n * @returns {Promise<Object>} - Result object with success/error status\n */\nexport const saveEvent = async (event, userId) => {\n  console.log('SAVE SINGLE EVENT called with:', {\n    eventId: event.id,\n    userId,\n    title: event.title,\n    isAvailability: event.isAvailability\n  });\n\n  // First check permissions and authentication\n  const hasPermission = await checkPermissions(userId);\n  if (!hasPermission) {\n    console.error('User does not have permission to save event');\n    return { success: false, error: 'Permission denied' };\n  }\n\n  try {\n    // Prepare event data for Firebase function\n    const eventData = {\n      userId: userId,\n      title: event.title || 'Available',\n      start: event.start.toISOString(),\n      end: event.end.toISOString(),\n      color: event.color,\n      color1: event.color1,\n      color2: event.color2,\n      notes: event.notes || '',\n      location: event.location || '',\n      isAvailability: event.isAvailability !== false, // Default to true\n      isValidated: event.isValidated || true,\n      // Additional fields\n      canton: event.canton || [],\n      area: event.area || [],\n      languages: event.languages || [],\n      experience: event.experience || '',\n      software: event.software || [],\n      certifications: event.certifications || [],\n      workAmount: event.workAmount || ''\n    };\n\n    // Use Firebase function for secure server-side validation and saving\n    const result = await saveEventFunction(eventData);\n\n    if (result.data.success) {\n      console.log(`Event saved with ID: ${result.data.id}`);\n      return {\n        success: true,\n        id: result.data.id\n      };\n    } else {\n      console.error('Firebase function returned error:', result.data.error);\n      return {\n        success: false,\n        error: result.data.error || 'Failed to save event'\n      };\n    }\n  } catch (error) {\n    console.error('Error calling saveEvent Firebase function:', error);\n    return {\n      success: false,\n      error: 'Failed to save event: ' + error.message\n    };\n  }\n};\n\n/**\n * Generate occurrence dates for a recurring event\n * @param {Date} startDate - The start date of the event\n * @param {string} repeatType - The repeat type ('Every Day', 'Every Week', 'Every Month', 'Custom...')\n * @param {string} endType - How the recurrence ends ('After', 'On Date', 'Never')\n * @param {Object} repeatConfig - Custom repeat configuration (for 'Custom...' type)\n * @param {number} endRepeatCount - Number of occurrences (for 'After' endType)\n * @param {Date} endRepeatDate - End date (for 'On Date' endType)\n * @returns {Array<Date>} - Array of occurrence dates\n */\n\nexport function generateRecurringEventDates(\n  startDate,\n  repeatType,\n  endType,\n  repeatConfig = null,\n  endRepeatCount = 10,\n  endRepeatDate = null\n) {\n  console.log(\"generateRecurringEventDates called with params:\", {\n    startDate: startDate instanceof Date ? startDate.toISOString() : startDate,\n    repeatType,\n    endType,\n    repeatConfig,\n    endRepeatCount,\n    endRepeatDate: endRepeatDate instanceof Date ? endRepeatDate.toISOString() : endRepeatDate\n  });\n\n  // Input validation\n  if (!startDate) {\n    console.error(\"No start date provided to generateRecurringEventDates\");\n    return [];\n  }\n\n  // Ensure startDate is a Date object\n  const startDateObj = startDate instanceof Date ? startDate : new Date(startDate);\n  if (isNaN(startDateObj.getTime())) {\n    console.error(\"Invalid start date provided to generateRecurringEventDates:\", startDate);\n    return [];\n  }\n\n  console.log(\"Working with start date:\", startDateObj.toISOString());\n\n  const occurrenceDates = [];\n\n  // First occurrence is always the start date\n  occurrenceDates.push(new Date(startDateObj));\n\n  // Track unique dates to prevent duplicates\n  const dateMap = new Set();\n  dateMap.add(startDateObj.toDateString());\n\n  // Set maximum end date limit (for 'Never' end type) - 2 years from start\n  const MAX_END_DATE = new Date(startDateObj);\n  MAX_END_DATE.setFullYear(MAX_END_DATE.getFullYear() + 2);\n\n  // Safety limit to prevent infinite loops or excessive occurrences\n  const MAX_OCCURRENCES = 200;\n\n  // Determine end date based on end type\n  let endDate = MAX_END_DATE;\n  if (endType === 'On Date' && endRepeatDate) {\n    const endRepeatDateObj = endRepeatDate instanceof Date ?\n      endRepeatDate : new Date(endRepeatDate);\n\n    if (!isNaN(endRepeatDateObj.getTime())) {\n      endDate = endRepeatDateObj;\n      endDate.setHours(23, 59, 59, 999); // Include the entire end day\n    } else {\n      console.warn(\"Invalid endRepeatDate, using default MAX_END_DATE\");\n    }\n  }\n\n  let maxOccurrences = MAX_OCCURRENCES;\n  if (endType === 'After' && endRepeatCount > 0) {\n    maxOccurrences = Math.min(parseInt(endRepeatCount, 10), MAX_OCCURRENCES);\n  }\n\n  console.log(\"Recurring event parameters:\", {\n    startDate: startDateObj.toISOString(),\n    endDate: endDate.toISOString(),\n    maxOccurrences,\n    repeatType\n  });\n\n  // Clone the start date to use as our current position\n  const currentDate = new Date(startDateObj);\n\n  // Standard repeat types \n  if (repeatType === 'Every Day' || repeatType === 'Every Week' || repeatType === 'Every Month') {\n    console.log(`Processing standard repeat type: ${repeatType}`);\n\n    // Process standard repeat types (daily, weekly, monthly)\n    let occurrenceCount = 1; // Start at 1 because we've already added the first occurrence\n\n    if (repeatType === 'Every Week' && repeatConfig && repeatConfig.weeklyDays) {\n      const weeklyDays = repeatConfig.weeklyDays;\n      const selectedDays = weeklyDays.map((selected, index) => selected ? index : null).filter(v => v !== null);\n\n      if (selectedDays.length === 0) {\n        console.warn(\"No days selected for weekly repeat, using start date day\");\n        const startDayOfWeek = startDateObj.getDay();\n        const mondayIndex = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1;\n        selectedDays.push(mondayIndex);\n      }\n\n      let weekOffset = 0;\n      let dayIndex = 0;\n\n      while (occurrenceCount < maxOccurrences && currentDate < endDate) {\n        const checkDate = new Date(startDateObj);\n        checkDate.setDate(startDateObj.getDate() + (weekOffset * 7) + (selectedDays[dayIndex] - selectedDays[0]));\n\n        if (checkDate >= startDateObj && checkDate <= endDate) {\n          const dateKey = checkDate.toDateString();\n          if (!dateMap.has(dateKey)) {\n            dateMap.add(dateKey);\n            occurrenceDates.push(new Date(checkDate));\n            occurrenceCount++;\n          }\n        }\n\n        dayIndex++;\n        if (dayIndex >= selectedDays.length) {\n          dayIndex = 0;\n          weekOffset++;\n        }\n\n        if (checkDate > endDate) break;\n      }\n    } else if (repeatType === 'Every Month' && repeatConfig) {\n      const monthlyType = repeatConfig.monthlyType || 'day';\n\n      let monthOffset = 1;\n\n      while (occurrenceCount < maxOccurrences && currentDate < endDate) {\n        const nextDate = new Date(startDateObj);\n        nextDate.setMonth(startDateObj.getMonth() + monthOffset);\n\n        if (monthlyType === 'day') {\n          const day = repeatConfig.monthlyDay || startDateObj.getDate();\n          const lastDayOfMonth = new Date(nextDate.getFullYear(), nextDate.getMonth() + 1, 0).getDate();\n          nextDate.setDate(Math.min(day, lastDayOfMonth));\n        } else if (monthlyType === 'weekday') {\n          const week = repeatConfig.monthlyWeek || 'first';\n          const dayOfWeek = repeatConfig.monthlyDayOfWeek !== undefined ? repeatConfig.monthlyDayOfWeek : (startDateObj.getDay() === 0 ? 6 : startDateObj.getDay() - 1);\n\n          const firstDay = new Date(nextDate.getFullYear(), nextDate.getMonth(), 1);\n          const firstDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;\n\n          let targetDate;\n          if (week === 'last') {\n            const lastDay = new Date(nextDate.getFullYear(), nextDate.getMonth() + 1, 0);\n            let lastDayOfWeek = lastDay.getDay() === 0 ? 6 : lastDay.getDay() - 1;\n            let daysBack = (lastDayOfWeek - dayOfWeek + 7) % 7;\n            if (daysBack === 0) daysBack = 7;\n            targetDate = new Date(lastDay);\n            targetDate.setDate(lastDay.getDate() - daysBack + 7);\n            if (targetDate.getMonth() !== nextDate.getMonth()) {\n              targetDate.setDate(targetDate.getDate() - 7);\n            }\n          } else {\n            const weekOffset = week === 'first' ? 0 : week === 'second' ? 1 : week === 'third' ? 2 : 3;\n            let daysToAdd = (dayOfWeek - firstDayOfWeek + 7) % 7;\n            if (daysToAdd === 0 && weekOffset > 0) daysToAdd = 7;\n            daysToAdd += weekOffset * 7;\n            targetDate = new Date(firstDay);\n            targetDate.setDate(firstDay.getDate() + daysToAdd);\n          }\n          nextDate.setTime(targetDate.getTime());\n        }\n\n        if (nextDate > endDate) break;\n\n        const dateKey = nextDate.toDateString();\n        if (!dateMap.has(dateKey)) {\n          dateMap.add(dateKey);\n          occurrenceDates.push(new Date(nextDate));\n          occurrenceCount++;\n        }\n\n        monthOffset++;\n      }\n    } else {\n      while (occurrenceCount < maxOccurrences && currentDate < endDate) {\n        const nextDate = new Date(currentDate);\n\n        switch (repeatType) {\n          case 'Every Day':\n            nextDate.setDate(nextDate.getDate() + 1);\n            break;\n\n          case 'Every Week':\n            nextDate.setDate(nextDate.getDate() + 7);\n            break;\n\n          case 'Every Month': {\n            const currentMonth = nextDate.getMonth();\n            nextDate.setMonth(currentMonth + 1);\n            if (nextDate.getMonth() !== (currentMonth + 1) % 12) {\n              nextDate.setDate(0);\n            }\n            break;\n          }\n          default:\n            console.warn(`Unknown repeat type: ${repeatType}`);\n            break;\n        }\n\n        currentDate.setTime(nextDate.getTime());\n\n        if (currentDate > endDate) {\n          console.log(\"Reached end date, stopping recurring generation\");\n          break;\n        }\n\n        const dateKey = currentDate.toDateString();\n        if (!dateMap.has(dateKey)) {\n          dateMap.add(dateKey);\n          occurrenceDates.push(new Date(currentDate));\n          occurrenceCount++;\n\n          if (occurrenceCount % 10 === 0) {\n            console.log(`Added occurrence ${occurrenceCount}: ${currentDate.toISOString()}`);\n          }\n        } else {\n          console.warn(`Skipping duplicate occurrence date: ${dateKey}`);\n        }\n      }\n    }\n  }\n  // Handle custom repeat configuration\n  else if (repeatType === 'Custom...' && repeatConfig) {\n    // Implement custom repeat logic here...\n    console.log(\"Processing custom repeat configuration:\", repeatConfig);\n\n    // ... existing custom repeat code ...\n  }\n  else {\n    console.warn(\"Unsupported repeat type:\", repeatType);\n    // Return just the start date as a fallback\n    return [new Date(startDateObj)];\n  }\n\n  console.log(`Generated ${occurrenceDates.length} occurrence dates for event starting on ${startDateObj.toDateString()}`);\n\n  if (occurrenceDates.length > 0) {\n    console.log(\"First occurrence:\", occurrenceDates[0].toISOString());\n    if (occurrenceDates.length > 1) {\n      console.log(\"Last occurrence:\", occurrenceDates[occurrenceDates.length - 1].toISOString());\n    }\n  }\n\n  return occurrenceDates;\n}\n\n/**\n * Update an existing event using Firebase functions\n * @param {string} eventId - The event ID to update\n * @param {Object} event - The updated event data\n * @param {string} userId - The user ID\n * @param {string} accountType - The account type\n * @returns {Promise<Object>} - Result object with success/error status\n */\nexport const updateEvent = async (eventId, event, userId, accountType = 'worker', forceUpdate = false) => {\n  try {\n    // Map account types properly for Firebase function\n    let mappedAccountType = accountType;\n    if (accountType === 'professional') {\n      mappedAccountType = 'worker'; // Map professional to worker for Firebase function\n    }\n\n    console.log('Calling updateCalendarEvent Firebase function with:', {\n      eventId,\n      userId,\n      originalAccountType: accountType,\n      mappedAccountType: mappedAccountType,\n      startType: typeof event.start,\n      endType: typeof event.end,\n      start: event.start instanceof Date ? event.start.toISOString() : event.start,\n      end: event.end instanceof Date ? event.end.toISOString() : event.end,\n      title: event.title,\n      collectionToUse: mappedAccountType === 'manager' ? 'jobs-listing' : 'availability',\n      eventHasFromDatabaseFlag: event.fromDatabase === true,\n      eventHasValidatedFlag: event.isValidated === true,\n      isForceUpdate: forceUpdate\n    });\n\n    // Debug authentication\n    console.log('Auth debug:', {\n      currentUser: auth.currentUser?.uid,\n      isAuthenticated: !!auth.currentUser,\n      userIdParam: userId\n    });\n\n    const updateEventFunction = httpsCallable(functions, 'updateCalendarEvent');\n    const result = await updateEventFunction({\n      eventId,\n      userId,\n      accountType: mappedAccountType,\n      title: event.title,\n      start: event.start instanceof Date ? event.start.toISOString() : event.start,\n      end: event.end instanceof Date ? event.end.toISOString() : event.end,\n      color: event.color,\n      color1: event.color1,\n      color2: event.color2,\n      notes: event.notes,\n      location: event.location,\n      isValidated: event.isValidated,\n      isRecurring: event.isRecurring,\n      recurrenceId: event.recurrenceId,\n      canton: event.canton,\n      area: event.area,\n      experience: event.experience,\n      software: event.software,\n      certifications: event.certifications,\n      workAmount: event.workAmount,\n      isAvailability: event.isAvailability\n    });\n\n    console.log('Update event result:', result.data);\n    return result.data;\n  } catch (error) {\n    console.error('Error calling updateEvent Firebase function:', error);\n    console.error('Error details:', {\n      message: error.message,\n      code: error.code,\n      details: error.details,\n      stack: error.stack\n    });\n\n    // Check for specific error types\n    if (error.code === 'functions/not-found') {\n      return {\n        success: false,\n        error: 'Event not found in database. It may have been deleted or moved.'\n      };\n    }\n\n    if (error.code === 'functions/permission-denied') {\n      return {\n        success: false,\n        error: 'Permission denied. You do not have access to update this event.'\n      };\n    }\n\n    if (error.code === 'functions/invalid-argument') {\n      return {\n        success: false,\n        error: 'Invalid event data provided.'\n      };\n    }\n\n    // Check for specific CORS errors\n    if (error.message.includes('CORS') || error.message.includes('Access-Control-Allow-Origin')) {\n      console.error('CORS error detected - this is a server configuration issue');\n      return {\n        success: false,\n        error: 'Server configuration error. The backend needs to be configured to allow requests from this domain. Please contact your system administrator.'\n      };\n    }\n\n    // Check for network errors\n    if (error.message.includes('net::ERR_FAILED') || error.message.includes('Failed to fetch')) {\n      console.error('Network error detected');\n      return {\n        success: false,\n        error: 'Network error. Please check your internet connection and try again.'\n      };\n    }\n\n    return {\n      success: false,\n      error: `Failed to update event: ${error.code || error.message || 'unknown error'}`\n    };\n  }\n};\n\n/**\n * Delete an event using Firebase functions\n * @param {string} eventId - The event ID to delete\n * @param {string} userId - The user ID\n * @param {string} accountType - The account type\n * @param {string} deleteType - Type of deletion (single, all, future)\n * @param {string} recurrenceId - The recurrence ID for recurring events\n * @returns {Promise<Object>} - Result object with success/error status\n */\nexport const deleteEvent = async (eventId, userId, accountType = 'worker', deleteType = 'single', recurrenceId = null) => {\n  try {\n    console.log('Deleting event:', eventId, 'for user:', userId, 'type:', deleteType);\n\n    // Prepare the data for the delete operation\n    const deleteData = {\n      eventId,\n      userId,\n      accountType,\n      deleteType,\n      recurrenceId\n    };\n\n    console.log('Delete data:', deleteData);\n\n    const deleteEventFunction = httpsCallable(functions, 'deleteCalendarEvent');\n    const result = await deleteEventFunction(deleteData);\n\n    console.log('Delete event result:', result.data);\n    return result.data;\n  } catch (error) {\n    console.error('Error deleting event:', error);\n\n    // Check for specific CORS errors\n    if (error.message.includes('CORS') || error.message.includes('Access-Control-Allow-Origin')) {\n      console.error('CORS error detected during delete - this is a server configuration issue');\n      return {\n        success: false,\n        error: 'Server configuration error. The backend needs to be configured to allow requests from this domain. Please contact your system administrator.'\n      };\n    }\n\n    // Check for network errors\n    if (error.message.includes('net::ERR_FAILED') || error.message.includes('Failed to fetch')) {\n      console.error('Network error detected during delete');\n      return {\n        success: false,\n        error: 'Network error. Please check your internet connection and try again.'\n      };\n    }\n\n    return {\n      success: false,\n      error: `Failed to delete event: ${error.code || 'unknown error'}`\n    };\n  }\n};\n\n/**\n * Save recurring events using Firebase functions\n * @param {Object} baseEvent - The base event with recurrence settings\n * @param {string} userId - The user ID\n * @returns {Promise<Object>} - Result object with success/error status\n */\nexport const saveRecurringEvents = async (baseEvent, userId) => {\n  console.log('SAVE RECURRING EVENTS called with:', {\n    eventId: baseEvent.id,\n    userId,\n    repeatValue: baseEvent.repeatValue,\n    isRecurring: baseEvent.isRecurring\n  });\n\n  try {\n    await checkPermissions(userId);\n\n    // Prepare recurring event data for Firebase function\n    const recurringData = {\n      userId: userId,\n      baseEvent: {\n        id: baseEvent.id,\n        title: baseEvent.title || 'Available',\n        start: baseEvent.start instanceof Date ? baseEvent.start.toISOString() : baseEvent.start,\n        end: baseEvent.end instanceof Date ? baseEvent.end.toISOString() : baseEvent.end,\n        color: baseEvent.color,\n        color1: baseEvent.color1,\n        color2: baseEvent.color2,\n        notes: baseEvent.notes || '',\n        location: baseEvent.location || '',\n        isAvailability: baseEvent.isAvailability !== false,\n        isValidated: baseEvent.isValidated || true,\n        // Recurrence settings\n        isRecurring: true,\n        repeatValue: baseEvent.repeatValue || 'Every Day',\n        endRepeatValue: baseEvent.endRepeatValue || 'After',\n        endRepeatCount: baseEvent.endRepeatCount || 10,\n        endRepeatDate: baseEvent.endRepeatDate ?\n          (baseEvent.endRepeatDate instanceof Date ? baseEvent.endRepeatDate.toISOString() : baseEvent.endRepeatDate) : null,\n        // Repeat configuration\n        weeklyDays: baseEvent.weeklyDays,\n        monthlyType: baseEvent.monthlyType,\n        monthlyDay: baseEvent.monthlyDay,\n        monthlyWeek: baseEvent.monthlyWeek,\n        monthlyDayOfWeek: baseEvent.monthlyDayOfWeek,\n        // Additional fields\n        canton: baseEvent.canton || [],\n        area: baseEvent.area || [],\n        languages: baseEvent.languages || [],\n        experience: baseEvent.experience || '',\n        software: baseEvent.software || [],\n        certifications: baseEvent.certifications || [],\n        workAmount: baseEvent.workAmount || ''\n      }\n    };\n\n    // Use Firebase function for secure server-side recurring event generation\n    const result = await saveRecurringEventsFunction(recurringData);\n\n    if (result.data.success) {\n      console.log(`Recurring events saved successfully. Count: ${result.data.count}`);\n      return {\n        success: true,\n        recurrenceId: result.data.recurrenceId,\n        count: result.data.count\n      };\n    } else {\n      console.error('Firebase function returned error:', result.data.error);\n      return {\n        success: false,\n        error: result.data.error || 'Failed to save recurring events'\n      };\n    }\n  } catch (error) {\n    console.error('Error calling saveRecurringEvents Firebase function:', error);\n    return {\n      success: false,\n      error: 'Failed to save recurring events: ' + error.message\n    };\n  }\n};\n\n/**\n * Real-time hook for calendar events\n * @param {string} userId - The user ID to fetch events for\n * @param {string} accountType - The account type (worker, employer, etc.)\n * @returns {Object} - Events, loading state, and error state\n */\nexport const useCalendarEvents = (userId, accountType = \"worker\") => {\n  const [events, setEvents] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const { isTutorialActive, activeTutorial } = useTutorial();\n\n  const getMockEvents = useCallback(() => {\n    if (!isTutorialActive || activeTutorial !== 'calendar') return [];\n\n    const now = new Date();\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    \n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    \n    const nextWeek = new Date(today);\n    nextWeek.setDate(nextWeek.getDate() + 7);\n\n    return [\n      {\n        id: 'tutorial-availability-1',\n        title: 'Available',\n        start: new Date(tomorrow.getTime() + 9 * 60 * 60 * 1000),\n        end: new Date(tomorrow.getTime() + 17 * 60 * 60 * 1000),\n        color: '#0f54bc',\n        color1: '#a8c1ff',\n        color2: '#4da6fb',\n        isAvailability: true,\n        isValidated: true,\n        fromDatabase: false,\n        isTutorial: true\n      },\n      {\n        id: 'tutorial-availability-2',\n        title: 'Available',\n        start: new Date(nextWeek.getTime() + 8 * 60 * 60 * 1000),\n        end: new Date(nextWeek.getTime() + 16 * 60 * 60 * 1000),\n        color: '#0f54bc',\n        color1: '#a8c1ff',\n        color2: '#4da6fb',\n        isAvailability: true,\n        isValidated: true,\n        fromDatabase: false,\n        isTutorial: true\n      },\n      {\n        id: 'tutorial-contract-1',\n        title: 'Geneva Hospital - Temporary Contract',\n        start: new Date('2026-02-01'),\n        end: new Date('2026-03-31'),\n        color: '#f54455',\n        color1: '#ffbbcf',\n        color2: '#ff6064',\n        isContract: true,\n        isValidated: true,\n        location: 'Geneva Hospital, Rue Gabrielle-Perret-Gentil 4, 1205 Geneva',\n        notes: 'Emergency Department - Full-time position',\n        fromDatabase: false,\n        isTutorial: true\n      },\n      {\n        id: 'tutorial-contract-2',\n        title: 'Lausanne Clinic - Part-time',\n        start: new Date('2026-04-01'),\n        end: new Date('2026-06-30'),\n        color: '#f54455',\n        color1: '#ffbbcf',\n        color2: '#ff6064',\n        isContract: true,\n        isValidated: false,\n        location: 'Lausanne Clinic, Avenue de la Gare 28, 1000 Lausanne',\n        notes: 'General Practice - Weekends only',\n        fromDatabase: false,\n        isTutorial: true\n      }\n    ];\n  }, [isTutorialActive, activeTutorial]);\n\n  useEffect(() => {\n    if (!userId) {\n      setLoading(false);\n      return;\n    }\n\n    if (isTutorialActive && activeTutorial === 'calendar') {\n      const mockEvents = getMockEvents();\n      setEvents(mockEvents);\n      setLoading(false);\n      setError(null);\n      return;\n    }\n\n    console.log('Setting up real-time listener for user:', userId, 'accountType:', accountType);\n\n    // Set up real-time listener for availability events\n    const availabilityQuery = query(\n      collection(db, 'availability'),\n      where('userId', '==', userId)\n      // orderBy removed to avoid composite index requirement\n    );\n\n    const unsubscribeAvailability = onSnapshot(\n      availabilityQuery,\n      (snapshot) => {\n        try {\n          const availabilityEvents = [];\n\n          snapshot.forEach(doc => {\n            const data = doc.data();\n\n            // Convert Firestore timestamps to JavaScript dates\n            const startDate = data.from instanceof Timestamp ? data.from.toDate() : new Date(data.from);\n            const endDate = data.to instanceof Timestamp ? data.to.toDate() : new Date(data.to);\n\n            // Determine colors based on validation status\n            const isValidated = data.isValidated || false;\n            let eventColor, color1, color2;\n\n            if (isValidated) {\n              eventColor = '#0f54bc';  // Blue for validated\n              color1 = '#a8c1ff';\n              color2 = '#4da6fb';\n            } else {\n              eventColor = '#8c8c8c';  // Grey for unvalidated\n              color1 = '#e6e6e6';\n              color2 = '#b3b3b3';\n            }\n\n            availabilityEvents.push({\n              id: doc.id,\n              title: data.title || 'Available',\n              start: startDate,\n              end: endDate,\n              color: eventColor,\n              color1: color1,\n              color2: color2,\n              isAvailability: true,\n              isValidated: isValidated,\n              recurrenceId: data.recurrenceId || null,\n              isRecurring: !!data.recurrenceId,\n              // Additional metadata\n              canton: data.locationCountry || [],\n              area: data.LocationArea || [],\n              languages: data.languages || [],\n              experience: data.experience || '',\n              software: data.software || [],\n              certifications: data.certifications || [],\n              workAmount: data.workAmount || '',\n              notes: data.notes || '',\n              location: data.location || '',\n              fromDatabase: true\n            });\n          });\n\n          // Sort client-side instead of server-side to avoid index requirement\n          availabilityEvents.sort((a, b) => b.start - a.start);\n\n          console.log(`Real-time update: ${availabilityEvents.length} availability events loaded`);\n\n          setEvents(prevEvents => {\n            // Preserve existing contract events\n            const contractEvents = prevEvents.filter(e => e.isContract);\n            return [...availabilityEvents, ...contractEvents];\n          });\n          setLoading(false);\n          setError(null);\n        } catch (err) {\n          console.error('Error processing availability events:', err);\n          setError(err.message);\n          setLoading(false);\n        }\n      },\n      (err) => {\n        console.error('Error in availability events listener:', err);\n        setError(err.message);\n        setLoading(false);\n      }\n    );\n\n    // Set up real-time listener for contracts if needed\n    let unsubscribeContracts = null;\n    if (accountType === 'employer' || accountType === 'worker' || accountType === 'professional') {\n      // Query contracts using new structure (parties.professional.profileId / parties.employer.profileId)\n      // Also support backward compatibility with old structure (workerId / employerId)\n      const professionalQuery = query(\n        collection(db, 'contracts'),\n        where('parties.professional.profileId', '==', userId)\n      );\n\n      const employerQuery = query(\n        collection(db, 'contracts'),\n        where('parties.employer.profileId', '==', userId)\n      );\n\n      // Backward compatibility queries\n      const workerQuery = query(\n        collection(db, 'contracts'),\n        where('workerId', '==', userId)\n      );\n\n      const oldEmployerQuery = query(\n        collection(db, 'contracts'),\n        where('employerId', '==', userId)\n      );\n\n      // Combine queries based on account type\n      const queriesToUse = accountType === 'employer'\n        ? [employerQuery, oldEmployerQuery]\n        : [professionalQuery, workerQuery];\n\n      // Set up listeners for all relevant queries\n      const unsubscribes = [];\n\n      queriesToUse.forEach((contractQuery, index) => {\n        const unsubscribe = onSnapshot(\n          contractQuery,\n          (snapshot) => {\n            try {\n              const contractEvents = [];\n\n              snapshot.forEach(doc => {\n                const data = doc.data();\n\n                // Only process active contracts\n                const status = data.statusLifecycle?.currentStatus || data.status;\n                if (status !== 'active' && status !== 'pending' && status !== 'pending_professional_approval' && status !== 'pending_facility_approval') {\n                  return;\n                }\n\n                // Convert Firestore timestamps to JavaScript dates\n                const startDate = data.from instanceof Timestamp ? data.from.toDate() : new Date(data.from);\n                const endDate = data.to instanceof Timestamp ? data.to.toDate() : new Date(data.to);\n\n                contractEvents.push({\n                  id: doc.id,\n                  title: data.title || 'Contract',\n                  start: startDate,\n                  end: endDate,\n                  color: '#f54455', // Red color for contracts\n                  color1: '#ffbbcf',\n                  color2: '#ff6064',\n                  isContract: true,\n                  isValidated: data.isValidated || false,\n                  location: data.location || '',\n                  notes: data.notes || '',\n                  fromDatabase: true\n                });\n              });\n\n              console.log(`Real-time update: ${contractEvents.length} contract events loaded from query ${index + 1}`);\n\n              // Combine availability and contract events\n              setEvents(prevEvents => {\n                const availabilityEvents = prevEvents.filter(event => event.isAvailability);\n                const existingContractEvents = prevEvents.filter(event => event.isContract);\n\n                // Merge contract events, avoiding duplicates\n                const contractMap = new Map();\n                [...existingContractEvents, ...contractEvents].forEach(event => {\n                  if (!contractMap.has(event.id)) {\n                    contractMap.set(event.id, event);\n                  }\n                });\n\n                return [...availabilityEvents, ...Array.from(contractMap.values())];\n              });\n\n            } catch (err) {\n              console.error('Error processing contract events:', err);\n            }\n          },\n          (err) => {\n            console.error('Error in contract events listener:', err);\n          }\n        );\n\n        unsubscribes.push(unsubscribe);\n      });\n\n      unsubscribeContracts = () => {\n        unsubscribes.forEach(unsub => unsub());\n      };\n    }\n\n    // Cleanup function\n    return () => {\n      console.log('Cleaning up real-time listeners');\n      unsubscribeAvailability();\n      if (unsubscribeContracts) {\n        unsubscribeContracts();\n      }\n    };\n  }, [userId, accountType]);\n\n  return { events, loading, error };\n};\n\n/**\n * Check and create event with conflict validation\n * @param {Object} eventData - The event data to validate and create\n * @param {string} userId - The user ID\n * @param {Object} workspaceContext - The workspace context\n * @returns {Promise<Object>} - Result object with success/error status\n */\nexport const checkAndCreateEvent = async (eventData, userId, workspaceContext) => {\n  try {\n    console.log('checkAndCreateEvent called with:', { eventData, userId, workspaceContext });\n\n    if (!auth.currentUser) {\n      throw new Error('User not authenticated');\n    }\n\n    // Get the current user's ID token for authentication\n    const idToken = await auth.currentUser.getIdToken();\n\n    const requestData = {\n      workspaceContext,\n      eventType: eventData.type,\n      eventData: {\n        startTime: eventData.start instanceof Date ? eventData.start.toISOString() : eventData.start,\n        endTime: eventData.end instanceof Date ? eventData.end.toISOString() : eventData.end,\n        title: eventData.title,\n        notes: eventData.notes,\n        location: eventData.location\n      },\n      targetUserId: userId,\n      recurrenceSettings: eventData.isRecurring ? {\n        isRecurring: true,\n        repeatValue: eventData.repeatValue,\n        endRepeatValue: eventData.endRepeatValue,\n        endRepeatDate: eventData.endRepeatDate ?\n          (eventData.endRepeatDate instanceof Date ? eventData.endRepeatDate.toISOString() : eventData.endRepeatDate) : null\n      } : null\n    };\n\n    // Call the function as an HTTP request\n    const response = await fetch('https://us-central1-medishift.cloudfunctions.net/checkAndCreateEventHTTP', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${idToken}`\n      },\n      body: JSON.stringify(requestData)\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const result = await response.json();\n    return result;\n  } catch (error) {\n    console.error('Error in checkAndCreateEvent:', error);\n    return {\n      success: false,\n      error: error.message,\n      code: error.code\n    };\n  }\n}; ","/**\n * NotificationStore - Simple state management for notifications\n */\nclass NotificationStore {\n  constructor() {\n    this.notifications = [];\n    this.listeners = [];\n    this.currentId = 0;\n  }\n\n  showNotification(message, type = 'info', duration = 5000) {\n    const id = this.currentId++;\n    const notification = {\n      id,\n      message,\n      type,\n      timestamp: new Date().getTime()\n    };\n    \n    this.notifications.push(notification);\n    this.notifyListeners();\n    \n    // Auto-dismiss after duration\n    if (duration > 0) {\n      setTimeout(() => {\n        this.dismissNotification(id);\n      }, duration);\n    }\n    \n    return id;\n  }\n  \n  dismissNotification(id) {\n    this.notifications = this.notifications.filter(n => n.id !== id);\n    this.notifyListeners();\n  }\n  \n  clearAll() {\n    this.notifications = [];\n    this.notifyListeners();\n  }\n  \n  getNotifications() {\n    return [...this.notifications];\n  }\n  \n  subscribe(listener) {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners = this.listeners.filter(l => l !== listener);\n    };\n  }\n  \n  notifyListeners() {\n    this.listeners.forEach(listener => listener(this.getNotifications()));\n  }\n}\n\n// Export a singleton instance\nconst notificationStore = new NotificationStore();\nexport default notificationStore; ","import { useState, useCallback } from 'react';\nimport { CALENDAR_COLORS } from '../utils/constants';\nimport {\n  saveEvent,\n  updateEvent,\n  deleteEvent,\n  saveRecurringEvents\n} from '../utils/eventDatabase';\nimport { handleModificationConfirm as handleModificationConfirmUtil } from '../utils/eventModificationUtils';\nimport notificationStore from '../../../../utils/stores/notificationStore';\n\n/**\n * Custom hook for event operations\n * Handles event CRUD operations, validation, and database synchronization\n * \n * Extracted from Calendar.js to separate business logic from UI logic\n */\nexport const useEventOperations = (userId, accountType, workspaceContext, currentDate, setCurrentDate, CALENDAR_COLORS, saveEventsToLocalStorage, setPendingChanges) => {\n  // Events state\n  const [events, setEvents] = useState([]);\n  // Event selection state\n  const [selectedEvent, setSelectedEvent] = useState(null);\n  const [selectedEventId, setSelectedEventId] = useState(null);\n  const [selectedEventIds, setSelectedEventIds] = useState([]);\n\n  // Event modification state\n  const [originalEventPosition, setOriginalEventPosition] = useState(null);\n  const [validatedEvents, setValidatedEvents] = useState(new Set());\n\n  // Dialog states\n  const [showDeleteConfirmation, setShowDeleteConfirmation] = useState(false);\n  const [eventToDelete, setEventToDelete] = useState(null);\n  const [showMoveConfirmation, setShowMoveConfirmation] = useState(false);\n  const [movedEvent, setMovedEvent] = useState(null);\n  const [originalEventDates, setOriginalEventDates] = useState(null);\n  const [newEventDates, setNewEventDates] = useState(null);\n  const [showModificationDialog, setShowModificationDialog] = useState(false);\n  const [pendingModification, setPendingModification] = useState(null);\n\n  // Loading state\n  const [isSaving, setIsSaving] = useState(false);\n\n  // History management\n  const [history, setHistory] = useState([[]]);\n  const [currentHistoryIndex, setCurrentHistoryIndex] = useState(0);\n\n  // Slide direction state\n  const [slideDirection, setSlideDirection] = useState(null);\n\n  // Drag states\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStartTime, setDragStartTime] = useState(null);\n\n  // Add to history\n  const addToHistory = useCallback((events) => {\n    const newHistory = history.slice(0, currentHistoryIndex + 1);\n    newHistory.push([...events]);\n    setHistory(newHistory);\n    setCurrentHistoryIndex(newHistory.length - 1);\n  }, [history, currentHistoryIndex]);\n\n  // Undo/Redo functions\n  const undo = useCallback((events, setEvents) => {\n    if (currentHistoryIndex > 0) {\n      const newIndex = currentHistoryIndex - 1;\n      setCurrentHistoryIndex(newIndex);\n      setEvents([...history[newIndex]]);\n\n      // Clear selected event if it no longer exists in the previous state\n      const previousEvents = history[newIndex];\n      if (selectedEvent && !previousEvents.find(e => e.id === selectedEvent.id)) {\n        setSelectedEvent(null);\n        setSelectedEventId(null);\n      }\n    }\n  }, [currentHistoryIndex, history, selectedEvent]);\n\n  const redo = useCallback((events, setEvents) => {\n    if (currentHistoryIndex < history.length - 1) {\n      const newIndex = currentHistoryIndex + 1;\n      setCurrentHistoryIndex(newIndex);\n      setEvents([...history[newIndex]]);\n\n      // Clear selected event if it no longer exists in the next state\n      const nextEvents = history[newIndex];\n      if (selectedEvent && !nextEvents.find(e => e.id === selectedEvent.id)) {\n        setSelectedEvent(null);\n        setSelectedEventId(null);\n      }\n    }\n  }, [currentHistoryIndex, history, selectedEvent]);\n\n  // Event click handler\n  const handleEventClick = useCallback((event, e, events, isDragging, dragStartTime) => {\n    console.log('handleEventClick called with event:', event);\n    e.stopPropagation();\n\n    // Handle multi-selection with Ctrl/Cmd key\n    if (e.ctrlKey || e.metaKey) {\n      setSelectedEventIds(prevSelectedIds => {\n        const isSelected = prevSelectedIds.includes(event.id);\n        if (isSelected) {\n          return prevSelectedIds.filter(id => id !== event.id);\n        } else {\n          return [...prevSelectedIds, event.id];\n        }\n      });\n      return;\n    }\n\n    // Clear multi-selection when clicking without modifier keys\n    if (selectedEventIds.length > 0) {\n      setSelectedEventIds([]);\n    }\n\n    // Check if this was a click after a drag\n    const timeSinceDragStart = dragStartTime ? Date.now() - dragStartTime : 0;\n    const wasRecentDrag = isDragging || timeSinceDragStart < 200;\n\n    if (wasRecentDrag) {\n      console.log('Event clicked after drag - not opening panel');\n      return;\n    }\n\n    // This is a clean click - open the event panel\n    console.log('Clean event click detected - opening event panel');\n\n    // Find the full event data\n    const clickedEvent = events.find(ev => ev.id === event.id) || event;\n\n    // Store original event position for potential restoration\n    setOriginalEventPosition({\n      id: clickedEvent.id,\n      start: new Date(clickedEvent.start),\n      end: new Date(clickedEvent.end),\n      title: clickedEvent.title,\n      color: clickedEvent.color,\n      color1: clickedEvent.color1,\n      color2: clickedEvent.color2,\n      notes: clickedEvent.notes,\n      location: clickedEvent.location,\n      employees: clickedEvent.employees,\n      ...clickedEvent\n    });\n\n    // Open event panel\n    setSelectedEventId(event.id);\n    setSelectedEvent(clickedEvent);\n  }, [selectedEventIds]);\n\n  // Event double-click handler\n  const handleEventDoubleClick = useCallback((event, e, events) => {\n    console.log('Event double-clicked:', event.id, '- opening event panel');\n    e.stopPropagation();\n\n    // Find the full event data\n    const clickedEvent = events.find(ev => ev.id === event.id) || event;\n\n    // Store original event position for potential restoration\n    setOriginalEventPosition({\n      id: clickedEvent.id,\n      start: new Date(clickedEvent.start),\n      end: new Date(clickedEvent.end),\n      title: clickedEvent.title,\n      color: clickedEvent.color,\n      color1: clickedEvent.color1,\n      color2: clickedEvent.color2,\n      notes: clickedEvent.notes,\n      location: clickedEvent.location,\n      employees: clickedEvent.employees,\n      ...clickedEvent\n    });\n\n    // Open event panel for detailed editing\n    setSelectedEventId(event.id);\n    setSelectedEvent(clickedEvent);\n  }, []);\n\n  // Handle panel close\n  const handlePanelClose = useCallback((events, setEvents) => {\n    console.log('Panel closing, checking if event needs to be restored or removed');\n\n    // Check if the selected event was a temporary draft (unsaved NEW event)\n    // Temp events ARE in the array now (for visibility), so we need to remove them\n    if (selectedEvent && String(selectedEvent.id).startsWith('temp-')) {\n      console.log('Removing unsaved temp event from array:', selectedEvent.id);\n      const newEvents = events.filter(e => e.id !== selectedEvent.id);\n      setEvents(newEvents);\n\n      setSelectedEvent(null);\n      setSelectedEventId(null);\n      setOriginalEventPosition(null);\n      return;\n    }\n\n    // If we have an original event position and a currently selected event, restore it\n    if (originalEventPosition && selectedEvent && originalEventPosition.id === selectedEvent.id) {\n      console.log('Restoring event to original position:', originalEventPosition);\n\n      // Find the current event in the events array\n      const currentEventIndex = events.findIndex(e => e.id === selectedEvent.id);\n\n      if (currentEventIndex !== -1) {\n        // Check if the event has been modified by comparing key properties\n        const currentEvent = events[currentEventIndex];\n        const currentStart = currentEvent.start instanceof Date ? currentEvent.start : new Date(currentEvent.start);\n        const currentEnd = currentEvent.end instanceof Date ? currentEvent.end : new Date(currentEvent.end);\n        const originalStart = originalEventPosition.start instanceof Date ? originalEventPosition.start : new Date(originalEventPosition.start);\n        const originalEnd = originalEventPosition.end instanceof Date ? originalEventPosition.end : new Date(originalEventPosition.end);\n        \n        const isModified = (\n          currentStart.getTime() !== originalStart.getTime() ||\n          currentEnd.getTime() !== originalEnd.getTime() ||\n          (currentEvent.title || '') !== (originalEventPosition.title || '') ||\n          (currentEvent.notes || '') !== (originalEventPosition.notes || '') ||\n          (currentEvent.location || '') !== (originalEventPosition.location || '') ||\n          (currentEvent.employees || '') !== (originalEventPosition.employees || '') ||\n          (currentEvent.color || '') !== (originalEventPosition.color || '')\n        );\n\n        if (isModified) {\n          console.log('Event was modified, restoring to original state');\n          // Restore the event to its original state, preserving fromDatabase flag\n          const restoredEvents = [...events];\n          restoredEvents[currentEventIndex] = {\n            ...originalEventPosition,\n            start: new Date(originalEventPosition.start),\n            end: new Date(originalEventPosition.end),\n            fromDatabase: currentEvent.fromDatabase || false,\n            isValidated: currentEvent.isValidated || false\n          };\n\n          setEvents(restoredEvents);\n          addToHistory(restoredEvents);\n        } else {\n          console.log('Event was not modified, no restoration needed');\n        }\n      }\n    }\n\n    // Clear all panel-related state\n    setSelectedEvent(null);\n    setSelectedEventId(null);\n    setOriginalEventPosition(null);\n  }, [originalEventPosition, selectedEvent, addToHistory]);\n\n\n  // Continue event save helper\n  const continueEventSave = useCallback((eventWithDates, shouldClose, isAlreadyProcessedByPanel = false, events, setEvents) => {\n    // Extract baseId from event ID if it's a recurring event instance\n    const baseId = String(eventWithDates.id).includes('_')\n      ? String(eventWithDates.id).split('_')[0]\n      : eventWithDates.id;\n\n    // Create a new copy of events for state update\n    let newEvents = [...events];\n\n    // If we're editing an existing event, replace it\n    const existingEventIndex = newEvents.findIndex(e => e.id === eventWithDates.id);\n\n    if (existingEventIndex !== -1) {\n      // Update single existing event\n      newEvents[existingEventIndex] = {\n        ...newEvents[existingEventIndex],\n        ...eventWithDates\n      };\n    } else {\n      // This is a new event, add it to events array\n      newEvents.push(eventWithDates);\n    }\n\n    // Handle recurring events\n    if (eventWithDates.isRecurring && shouldClose) {\n      console.log('Event save details:', {\n        id: eventWithDates.id,\n        baseId: baseId,\n        isNowRecurring: eventWithDates.isRecurring,\n        repeatValue: eventWithDates.repeatValue,\n        isAvailability: eventWithDates.isAvailability,\n        shouldClose: shouldClose,\n        alreadyProcessed: isAlreadyProcessedByPanel\n      });\n\n      // Filter out any existing recurring events with the same base ID\n      const existingRecurring = newEvents.filter(e =>\n        e.id !== eventWithDates.id && // Don't filter out the event we're editing\n        (e.recurrenceId === eventWithDates.recurrenceId || // Same recurrence ID\n          (String(e.id).includes('_') && String(e.id).split('_')[0] === String(baseId))) // Derived from same base ID\n      );\n\n      console.log(`Filtered out ${existingRecurring.length} existing recurring events`);\n\n      // Remove existing recurring events from the events array before adding new ones\n      newEvents = newEvents.filter(e => !existingRecurring.includes(e));\n\n      // If this is a recurring event being saved to database (shouldClose is true)\n      if (shouldClose && userId && !isAlreadyProcessedByPanel) {\n        console.log('Final save: should save recurring events to database');\n\n        // Check if event has a baseId that's different from its id\n        if (baseId !== eventWithDates.id) {\n          console.log('Updating instance of recurring event with baseId:', baseId);\n        }\n\n        console.log('Calling saveRecurringEvents with:', eventWithDates);\n        console.log('userId value:', userId);\n\n        // Direct call to saveRecurringEvents for worker account recurring events\n        if (accountType === 'worker' && !isAlreadyProcessedByPanel) {\n          console.log('Making direct call to saveRecurringEvents');\n          const eventWithUserData = {\n            ...eventWithDates,\n            userId: userId // Explicitly add userId to the event data\n          };\n\n          // Save recurring events\n          saveRecurringEvents(eventWithUserData, userId)\n            .then(result => {\n              console.log('saveRecurringEvents result:', result);\n              setIsSaving(false); // Hide loading spinner\n\n              if (result.success) {\n                console.log('Recurring events saved successfully', result);\n                notificationStore.showNotification('Recurring events saved successfully', 'success');\n\n                // Mark event as validated\n                setValidatedEvents(prev => new Set([...prev, result.recurrenceId]));\n\n                // Update the UI with recurrence ID\n                const updatedEvents = events.map(event => {\n                  if (String(event.id) === String(baseId)) {\n                    return {\n                      ...event,\n                      fromDatabase: true,\n                      recurrenceId: result.recurrenceId,\n                      isValidated: true\n                    };\n                  }\n                  return event;\n                });\n                setEvents(updatedEvents);\n              } else {\n                console.error('Failed to save recurring events', result.error);\n                notificationStore.showNotification('Failed to save recurring events: ' + (result.error || 'Unknown error'), 'error');\n\n                // Fall back to saveEvent as a backup\n                console.log('Falling back to saveEvent for recurring event');\n                saveRecurringEventFallback(eventWithDates, baseId);\n              }\n            })\n            .catch(error => {\n              console.error('Error in saveRecurringEvents:', error);\n              setIsSaving(false); // Hide loading spinner\n              notificationStore.showNotification('Error saving recurring events', 'error');\n\n              // Fall back to saveEvent on error\n              saveRecurringEventFallback(eventWithDates, baseId);\n            });\n        }\n      }\n    }\n    // If this is not a recurring event and we're saving to the database\n    else if (shouldClose && userId && !isAlreadyProcessedByPanel) {\n      console.log('Saving regular (non-recurring) event to database');\n\n      const eventToSave = {\n        ...eventWithDates,\n        userId: userId,\n        isAvailability: accountType === 'worker' ? true : eventWithDates.isAvailability\n      };\n\n      // Direct call to saveEvent for non-recurring events\n      saveEvent(eventToSave, userId)\n        .then(result => {\n          console.log('Regular saveEvent result:', result);\n          setIsSaving(false); // Hide loading spinner\n\n          if (result.success) {\n            console.log('Event saved successfully with ID:', result.id);\n\n            // Mark event as validated\n            setValidatedEvents(prev => new Set([...prev, result.id]));\n\n            // Find the saved event in our state and mark it as fromDatabase\n            const updatedEvents = events.map(event => {\n              if (String(event.id) === String(eventWithDates.id)) {\n                return {\n                  ...event,\n                  id: result.id, // Use the ID returned from the server\n                  fromDatabase: true,\n                  isValidated: true\n                };\n              }\n              return event;\n            });\n\n            setEvents(updatedEvents);\n            notificationStore.showNotification('Event saved successfully', 'success');\n          } else {\n            console.error('Failed to save event:', result.error);\n            notificationStore.showNotification('Failed to save event: ' + (result.error || 'Unknown error'), 'error');\n          }\n        })\n        .catch(error => {\n          console.error('Error saving event:', error);\n          setIsSaving(false); // Hide loading spinner\n          notificationStore.showNotification('Error saving event', 'error');\n        });\n    } else {\n      // For non-database saves, just hide the loading spinner\n      if (shouldClose) {\n        setIsSaving(false);\n      }\n    }\n\n    // Update UI state regardless of database operations\n    setEvents(newEvents);\n\n    if (shouldClose) {\n      addToHistory(newEvents);\n    } else {\n      // If not closing, update the selected event state to reflect the changes made\n      const currentlySelectedInstance = newEvents.find(e => String(e.id) === String(eventWithDates.id)) ||\n        newEvents.find(e => String(e.id).startsWith(baseId));\n      setSelectedEvent(currentlySelectedInstance || null);\n      setSelectedEventId(currentlySelectedInstance ? String(currentlySelectedInstance.id) : null);\n    }\n  }, [userId, accountType, addToHistory]);\n\n  // Helper function to fall back to normal saveEvent for recurring events\n  const saveRecurringEventFallback = useCallback((eventWithDates, baseId) => {\n    console.log('Using saveRecurringEventFallback with direct saveEvent call');\n\n    const eventToSave = {\n      ...eventWithDates,\n      id: baseId,\n      fromDatabase: true,\n      isAvailability: accountType === 'worker' ? true : eventWithDates.isAvailability\n    };\n\n    // Direct call to saveEvent\n    saveEvent(eventToSave, userId)\n      .then(result => {\n        console.log('Fallback saveEvent result:', result);\n        setIsSaving(false); // Hide loading spinner\n\n        if (result.success) {\n          console.log('Fallback save successful');\n          notificationStore.showNotification('Event saved successfully', 'success');\n\n          // Mark event as validated\n          setValidatedEvents(prev => new Set([...prev, baseId]));\n        } else {\n          console.error('Fallback save failed:', result.error);\n          notificationStore.showNotification('Failed to save event: ' + (result.error || 'Unknown error'), 'error');\n        }\n      })\n      .catch(error => {\n        console.error('Error in fallback save:', error);\n        setIsSaving(false); // Hide loading spinner\n        notificationStore.showNotification('Error saving event', 'error');\n      });\n  }, [accountType, userId]);\n\n  // Event delete handler\n  const handleEventDelete = useCallback((eventId, deleteType = 'single', events, setEvents) => {\n    console.log('handleEventDelete called with:', { eventId, deleteType });\n    const event = events.find(e => String(e.id) === String(eventId));\n    if (!event) {\n      console.warn('Event not found for deletion:', eventId);\n      return;\n    }\n\n    let newEvents;\n    // Extract the base ID or use the full ID if it doesn't contain a separator\n    const baseId = String(event.id).split('-')[0];\n    const currentEventDate = new Date(event.start);\n\n    // First update the local events state\n    if (deleteType === 'future' && (event.isRecurring || event.recurrenceId || String(event.id).includes('-'))) {\n      console.log('Deleting this and all future occurrences from series');\n      // Delete this and all future occurrences\n      newEvents = events.filter(e => {\n        if (!String(e.id).startsWith(baseId) &&\n          !(e.recurrenceId && e.recurrenceId === event.recurrenceId)) {\n          return true; // Keep events from other series\n        }\n        const eventDate = new Date(e.start);\n        return eventDate < currentEventDate; // Keep only past events from this series\n      });\n    } else if (deleteType === 'all' && (event.isRecurring || event.recurrenceId)) {\n      console.log('Deleting all occurrences of the series');\n      // Delete all occurrences of this series\n      newEvents = events.filter(e =>\n        !(String(e.id).startsWith(baseId) ||\n          (e.recurrenceId && e.recurrenceId === event.recurrenceId))\n      );\n    } else {\n      // Delete only this occurrence\n      console.log('Deleting only this occurrence');\n      newEvents = events.filter(e => String(e.id) !== String(eventId));\n    }\n\n    console.log('Event Delete - Updated events array:', newEvents);\n    setEvents(newEvents);\n    addToHistory(newEvents);\n\n    // Delete from database\n    if (userId) {\n      // Pass the recurrenceId to help database identify recurring events series\n      deleteEvent(eventId, userId, accountType, deleteType, event.recurrenceId)\n        .then(result => {\n          if (result.success) {\n            console.log('Event deleted from database successfully');\n          } else {\n            console.error('Failed to delete event from database:', result.error);\n          }\n        })\n        .catch(error => {\n          console.error('Error deleting event from database:', error);\n        });\n    } else {\n      console.warn('Auth not ready or user not logged in, event not deleted from database');\n    }\n\n    setSelectedEvent(null);\n    setSelectedEventId(null);\n    setShowDeleteConfirmation(false);\n    setEventToDelete(null);\n  }, [userId, accountType, addToHistory]);\n\n  // Create new event\n  const handleCreateEventClick = useCallback((currentDate) => {\n    const startTime = new Date(currentDate);\n    startTime.setHours(9, 0, 0, 0); // Fixed time: 9:00 AM\n\n    const endTime = new Date(startTime);\n    endTime.setHours(10, 0, 0, 0); // Fixed time: 10:00 AM\n\n    const newEvent = {\n      id: `temp-${Date.now()}`,\n      title: '',\n      start: startTime,\n      end: endTime,\n      color: CALENDAR_COLORS[0].color,\n      color1: CALENDAR_COLORS[0].color1,\n      category: CALENDAR_COLORS[0].name,\n      notes: '',\n      location: '',\n      employees: '',\n      isRecurring: false,\n      position: { x: window.innerWidth / 2, y: window.innerHeight / 2 }\n    };\n\n    // Store original position for new events too\n    setOriginalEventPosition({\n      ...newEvent,\n      start: new Date(startTime),\n      end: new Date(endTime)\n    });\n\n    setSelectedEvent(newEvent);\n  }, [CALENDAR_COLORS]);\n\n  // Handle event drop on day headers for cross-day dragging\n  const handleEventDropOnDay = useCallback((draggedEvent, targetDate) => {\n    if (!draggedEvent || !targetDate) return;\n\n    // Calculate the time difference to maintain the same time when moving to a different day\n    const originalStart = new Date(draggedEvent.start);\n    const originalEnd = new Date(draggedEvent.end);\n    const duration = originalEnd.getTime() - originalStart.getTime();\n\n    // Create new start and end times on the target date\n    const newStart = new Date(targetDate);\n    newStart.setHours(originalStart.getHours(), originalStart.getMinutes(), 0, 0);\n\n    const newEnd = new Date(newStart.getTime() + duration);\n\n    // Use the existing handleEventMove function to handle the move\n    // Note: This would need to be implemented or passed from the drag hook\n    console.log('Event drop on day:', { draggedEvent, targetDate, newStart, newEnd });\n  }, []);\n\n  // Event save handler\n  const handleEventSave = useCallback((updatedEvent, shouldClose) => {\n    console.log(\"Saving event:\", updatedEvent);\n\n    // If shouldClose is true, immediately close the panel, mark as validated, and show loading\n    if (shouldClose) {\n      console.log('Immediate panel close, mark as validated, and showing loading spinner');\n\n      // Immediately mark the event as validated and change color to blue\n      const updatedEvents = events.map(e => {\n        if (e.id === updatedEvent.id) {\n          return {\n            ...e,\n            ...updatedEvent,\n            isValidated: true,\n            color: CALENDAR_COLORS.find(c => c.id === 'blue')?.color || e.color,\n            color1: CALENDAR_COLORS.find(c => c.id === 'blue')?.color1 || e.color1,\n            color2: CALENDAR_COLORS.find(c => c.id === 'blue')?.color2 || e.color2,\n            fromDatabase: true\n          };\n        }\n        return e;\n      });\n\n      // If it's a new event, add it to the array\n      const existingEventIndex = events.findIndex(e => e.id === updatedEvent.id);\n      if (existingEventIndex === -1) {\n        updatedEvents.push({\n          ...updatedEvent,\n          isValidated: true,\n          color: CALENDAR_COLORS.find(c => c.id === 'blue')?.color || updatedEvent.color,\n          color1: CALENDAR_COLORS.find(c => c.id === 'blue')?.color1 || updatedEvent.color1,\n          color2: CALENDAR_COLORS.find(c => c.id === 'blue')?.color2 || updatedEvent.color2,\n          fromDatabase: true\n        });\n      }\n\n      // Update events immediately\n      setEvents(updatedEvents);\n      addToHistory(updatedEvents);\n\n      // Mark as validated immediately\n      setValidatedEvents(prev => new Set([...prev, updatedEvent.id]));\n\n      // Close panel immediately\n      setSelectedEvent(null);\n      setSelectedEventId(null);\n      setOriginalEventPosition(null);\n      setIsSaving(true);\n    }\n\n    // Continue with database save operation (async in background)\n    const existingEvent = events.find(e => e.id === updatedEvent.id);\n    const isNewEvent = !existingEvent?.fromDatabase;\n\n    if (userId && shouldClose) {\n      const eventToSave = {\n        ...updatedEvent,\n        userId: userId,\n        isAvailability: accountType === 'worker' ? true : updatedEvent.isAvailability,\n        isValidated: true // Mark as validated for database\n      };\n\n      // Save to database in background\n      if (updatedEvent.isRecurring && updatedEvent.repeatValue && updatedEvent.repeatValue !== 'None') {\n        console.log('Saving recurring event to database in background');\n        saveRecurringEvents(eventToSave, userId)\n          .then(result => {\n            console.log('Background recurring save result:', result);\n            setIsSaving(false);\n            if (result.success) {\n              notificationStore.showNotification('Recurring events saved successfully', 'success');\n            } else {\n              console.error('Failed to save recurring events', result.error);\n              notificationStore.showNotification('Failed to save recurring events: ' + (result.error || 'Unknown error'), 'error');\n            }\n          })\n          .catch(error => {\n            console.error('Error saving recurring events:', error);\n            setIsSaving(false);\n            notificationStore.showNotification('Error saving recurring events', 'error');\n          });\n      } else if (isNewEvent) {\n        // New event - save to database\n        console.log('Saving new event to database in background');\n        saveEvent(eventToSave, userId)\n          .then(result => {\n            console.log('Background save result:', result);\n            setIsSaving(false);\n            if (result.success) {\n              notificationStore.showNotification('Event saved successfully', 'success');\n\n              // Update the event with the database ID if needed\n              if (result.id && result.id !== updatedEvent.id) {\n                setEvents(prevEvents => prevEvents.map(e =>\n                  e.id === updatedEvent.id ? { ...e, id: result.id } : e\n                ));\n              }\n            } else {\n              console.error('Failed to save event:', result.error);\n              notificationStore.showNotification('Failed to save event: ' + (result.error || 'Unknown error'), 'error');\n            }\n          })\n          .catch(error => {\n            console.error('Error saving event:', error);\n            setIsSaving(false);\n            notificationStore.showNotification('Error saving event', 'error');\n          });\n      } else {\n        // Existing event - update in database\n        console.log('Updating existing event in database in background');\n        updateEvent(updatedEvent.id, eventToSave, userId, accountType)\n          .then(result => {\n            console.log('Background update result:', result);\n            setIsSaving(false);\n            if (result.success) {\n              notificationStore.showNotification('Event updated successfully', 'success');\n              // Mark event as validated\n              setValidatedEvents(prev => new Set([...prev, updatedEvent.id]));\n            } else {\n              console.error('Failed to update event:', result.error);\n              notificationStore.showNotification('Failed to update event: ' + (result.error || 'Unknown error'), 'error');\n            }\n          })\n          .catch(error => {\n            console.error('Error updating event:', error);\n            setIsSaving(false);\n            notificationStore.showNotification('Error updating event', 'error');\n          });\n      }\n    } else {\n      // For non-database saves, just update the events and close\n      const updatedEvents = events.map(e =>\n        e.id === updatedEvent.id ? { ...e, ...updatedEvent } : e\n      );\n\n      if (!events.find(e => e.id === updatedEvent.id)) {\n        updatedEvents.push(updatedEvent);\n      }\n\n      setEvents(updatedEvents);\n      if (shouldClose) {\n        addToHistory(updatedEvents);\n        setIsSaving(false);\n      }\n    }\n  }, [events, setEvents, addToHistory, setValidatedEvents, setSelectedEvent, setSelectedEventId, setOriginalEventPosition, setIsSaving, userId, accountType, CALENDAR_COLORS]);\n\n  // Placeholder event handlers (these need to be properly implemented)\n  const handleEventRightClick = useCallback((event, e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    console.log('Event right-clicked:', event);\n  }, []);\n\n  const handleEventResize = useCallback((eventId, newStart, newEnd, isTemporary = false) => {\n    const event = events.find(e => e.id === eventId);\n\n    if (!event) {\n      console.error('Event not found:', eventId);\n      return;\n    }\n\n    // Track drag state for resize\n    if (isTemporary) {\n      setIsDragging(true);\n      setDragStartTime(Date.now());\n    } else {\n      // End of resize - reset after a delay\n      setTimeout(() => {\n        setIsDragging(false);\n      }, 250);\n    }\n\n    const updatedEvents = [...events];\n    const eventIndex = updatedEvents.findIndex(e => e.id === eventId);\n\n    if (eventIndex === -1) {\n      console.error('Event index not found:', eventId);\n      return;\n    }\n\n    if (isTemporary) {\n      // Update visual position during resize\n      updatedEvents[eventIndex] = {\n        ...updatedEvents[eventIndex],\n        start: newStart,\n        end: newEnd,\n        isBeingResized: true\n      };\n\n      setEvents(updatedEvents);\n      return;\n    }\n\n    // Check if this is a recurring event\n    const isRecurringInstance = event.isRecurringInstance;\n    const originalEvent = isRecurringInstance ?\n      events.find(e => e.id === event.recurringParentId) :\n      event;\n\n    const isRecurringEvent = event.isRecurring || originalEvent?.recurrence ||\n      isRecurringInstance || String(eventId).includes('-') || String(eventId).includes('_');\n\n    // If this is a recurring event, show confirmation dialog\n    if (isRecurringEvent) {\n      // Store the pending modification for the dialog\n      setPendingModification({\n        type: 'resize',\n        eventId: eventId,\n        event: event,\n        originalEvent: originalEvent,\n        newStart: newStart,\n        newEnd: newEnd\n      });\n\n      // Store original and new dates for the dialog\n      setOriginalEventDates({\n        start: event.start instanceof Date ? event.start : new Date(event.start),\n        end: event.end instanceof Date ? event.end : new Date(event.end)\n      });\n      setNewEventDates({\n        start: newStart,\n        end: newEnd\n      });\n      setMovedEvent(event);\n\n      // Ensure the dialog shows up even with quick mouse movements\n      // Use requestAnimationFrame to make sure it appears in the next frame\n      requestAnimationFrame(() => {\n        setShowMoveConfirmation(true);\n      });\n      return;\n    }\n\n    // For non-recurring events, proceed with the resize\n    updatedEvents[eventIndex] = {\n      ...updatedEvents[eventIndex],\n      start: newStart,\n      end: newEnd,\n      isBeingResized: false\n    };\n\n    setEvents(updatedEvents);\n    addToHistory(updatedEvents);\n\n    // Update in database if it's an existing event\n    const isNewEvent = !event.isValidated && !event.fromDatabase;\n\n    if (userId && !isNewEvent) {\n      const eventForUpdate = {\n        id: eventId,\n        start: newStart,\n        end: newEnd,\n        title: event.title,\n        color: event.color,\n        color1: event.color1,\n        color2: event.color2,\n        isValidated: event.isValidated || false,\n        isRecurring: false, // Set to false since we're detaching from recurrence for single resizes\n        notes: event.notes,\n        location: event.location,\n        employees: event.employees,\n        canton: event.canton,\n        area: event.area,\n        experience: event.experience,\n        software: event.software,\n        certifications: event.certifications,\n        isAvailability: event.isAvailability\n      };\n\n      console.log('Updating resized event in database:', eventForUpdate);\n\n      updateEvent(eventId, eventForUpdate, userId, accountType)\n        .then(result => {\n          if (result.success) {\n            console.log('Event resize updated in database successfully');\n            // Mark event as validated\n            setValidatedEvents(prev => new Set([...prev, eventId]));\n          } else {\n            console.warn('Database update failed for resize operation:', result.error);\n            notificationStore.showNotification('Failed to save resize changes', 'warning');\n          }\n        })\n        .catch(error => {\n          console.warn('Database update error for resize operation:', error);\n          notificationStore.showNotification('Failed to save resize changes', 'warning');\n        });\n    } else {\n      console.log('Skipping database update - either no userId or event is new');\n    }\n\n    console.log('Event resized successfully');\n  }, [events, setEvents, addToHistory, setPendingModification, setOriginalEventDates, setNewEventDates, setMovedEvent, setShowMoveConfirmation, setIsDragging, setDragStartTime]);\n\n  const handleEventMove = useCallback((eventId, newStartDate, newEndDate, isTemporary = false) => {\n    const currentEvent = events.find(e => e.id === eventId);\n\n    if (!currentEvent) {\n      console.error('Event not found:', eventId);\n      return;\n    }\n\n    // Track drag state\n    if (isTemporary) {\n      setIsDragging(true);\n      setDragStartTime(Date.now());\n    } else {\n      // End of drag - reset after a delay\n      setTimeout(() => {\n        setIsDragging(false);\n      }, 250);\n    }\n\n    // Ensure dates are proper Date objects\n    const newStart = newStartDate instanceof Date ? newStartDate : new Date(newStartDate);\n    const newEnd = newEndDate instanceof Date ? newEndDate : new Date(newEndDate);\n\n    const isRecurringInstance = currentEvent.isRecurringInstance;\n    const originalEvent = isRecurringInstance ?\n      events.find(e => e.id === currentEvent.recurringParentId) :\n      currentEvent;\n\n    // Create a copy of events to modify\n    const updatedEvents = [...events];\n    const eventIndex = updatedEvents.findIndex(e => e.id === eventId);\n\n    if (eventIndex === -1) {\n      console.error('Event index not found:', eventId);\n      return;\n    }\n\n    if (isTemporary) {\n      // For temporary moves (during drag), update the current event's visual position\n      updatedEvents[eventIndex] = {\n        ...updatedEvents[eventIndex],\n        start: newStart,\n        end: newEnd,\n        isBeingMoved: true\n      };\n\n      setEvents(updatedEvents);\n      return;\n    }\n\n    // Check if this is a recurring event\n    const isRecurringEvent = currentEvent.isRecurring || originalEvent?.recurrence ||\n      isRecurringInstance || String(eventId).includes('-') || String(eventId).includes('_');\n\n    // Check if this is the last occurrence in the series\n    let isLastOccurrence = currentEvent.isLastOccurrence || false;\n\n    if (isRecurringEvent && currentEvent.recurrenceId && !isLastOccurrence) {\n      // If not explicitly marked, check if this is the last occurrence by comparing with other events\n      const seriesEvents = events.filter(e => e.recurrenceId === currentEvent.recurrenceId);\n\n      if (seriesEvents.length > 0) {\n        // Sort events by end date\n        seriesEvents.sort((a, b) => {\n          const aEnd = a.end instanceof Date ? a.end : new Date(a.end);\n          const bEnd = b.end instanceof Date ? b.end : new Date(b.end);\n          return bEnd.getTime() - aEnd.getTime();\n        });\n\n        // Check if this is the last event in the series\n        const latestEvent = seriesEvents[0]; // After sorting, first is latest\n        isLastOccurrence = currentEvent.id === latestEvent.id;\n        console.log(`Checking if event ${currentEvent.id} is last in series: ${isLastOccurrence}`);\n      }\n    }\n\n    // If this is a recurring event, show confirmation dialog\n    if (isRecurringEvent) {\n      // Store the pending modification for the dialog\n      setPendingModification({\n        type: isRecurringInstance ? 'move_single' : 'move',\n        eventId: eventId,\n        event: currentEvent,\n        originalEvent: originalEvent,\n        newStart: newStart,\n        newEnd: newEnd\n      });\n\n      // Store original and new dates for the dialog\n      setOriginalEventDates({\n        start: currentEvent.start instanceof Date ? currentEvent.start : new Date(currentEvent.start),\n        end: currentEvent.end instanceof Date ? currentEvent.end : new Date(currentEvent.end)\n      });\n      setNewEventDates({\n        start: newStart,\n        end: newEnd\n      });\n\n      // Add isLastOccurrence flag to the moved event for the dialog\n      setMovedEvent({\n        ...currentEvent,\n        isLastOccurrence: isLastOccurrence\n      });\n\n      // Ensure the dialog shows up even with quick mouse movements\n      requestAnimationFrame(() => {\n        setShowMoveConfirmation(true);\n      });\n      return;\n    }\n\n    // For non-recurring events, update immediately\n    updatedEvents[eventIndex] = {\n      ...updatedEvents[eventIndex],\n      start: newStart,\n      end: newEnd,\n      isBeingMoved: false\n    };\n\n    setEvents(updatedEvents);\n    addToHistory(updatedEvents);\n\n    // Update in database if it's an existing event\n    const isNewEvent = !currentEvent.isValidated && !currentEvent.fromDatabase;\n\n    if (userId && !isNewEvent) {\n      const eventForUpdate = {\n        id: eventId,\n        start: newStart,\n        end: newEnd,\n        title: currentEvent.title,\n        color: currentEvent.color,\n        color1: currentEvent.color1,\n        color2: currentEvent.color2,\n        isValidated: currentEvent.isValidated || false,\n        isRecurring: false, // Set to false since we're detaching from recurrence for single moves\n        notes: currentEvent.notes,\n        location: currentEvent.location,\n        employees: currentEvent.employees,\n        canton: currentEvent.canton,\n        area: currentEvent.area,\n        experience: currentEvent.experience,\n        software: currentEvent.software,\n        certifications: currentEvent.certifications,\n        isAvailability: currentEvent.isAvailability\n      };\n\n      console.log('Updating moved event in database:', eventForUpdate);\n\n      updateEvent(eventId, eventForUpdate, userId, accountType)\n        .then(result => {\n          if (result.success) {\n            console.log('Event move updated in database successfully');\n            // Mark event as validated\n            setValidatedEvents(prev => new Set([...prev, eventId]));\n          } else {\n            console.warn('Database update failed for move operation:', result.error);\n            notificationStore.showNotification('Failed to save move changes', 'warning');\n          }\n        })\n        .catch(error => {\n          console.warn('Database update error for move operation:', error);\n          notificationStore.showNotification('Failed to save move changes', 'warning');\n        });\n    } else {\n      console.log('Skipping database update - either no userId or event is new');\n    }\n\n    console.log('Event moved successfully');\n  }, [events, setEvents, addToHistory, setPendingModification, setOriginalEventDates, setNewEventDates, setMovedEvent, setShowMoveConfirmation, setIsDragging, setDragStartTime]);\n\n  const handleModificationConfirm = useCallback((modificationType) => {\n    console.log('Modification confirm:', modificationType);\n    \n    if (!pendingModification) {\n      console.error('handleModificationConfirm called but no pending modification');\n      return;\n    }\n    \n    handleModificationConfirmUtil(\n      modificationType,\n      pendingModification,\n      events,\n      setEvents,\n      addToHistory,\n      userId,\n      accountType,\n      originalEventDates,\n      setShowMoveConfirmation,\n      setPendingModification,\n      setMovedEvent,\n      setOriginalEventDates,\n      setNewEventDates,\n      setSelectedEvent,\n      setSelectedEventId,\n      saveEventsToLocalStorage,\n      setPendingChanges\n    );\n  }, [pendingModification, events, setEvents, addToHistory, userId, accountType, originalEventDates, setShowMoveConfirmation, setPendingModification, setMovedEvent, setOriginalEventDates, setNewEventDates, setSelectedEvent, setSelectedEventId, saveEventsToLocalStorage, setPendingChanges]);\n\n  const handleMoveConfirm = useCallback(() => {\n    console.log('Move confirm');\n    handleModificationConfirm('single');\n  }, [handleModificationConfirm]);\n\n  const handleMoveAllConfirm = useCallback(() => {\n    console.log('Move all confirm');\n    handleModificationConfirm('all');\n  }, [handleModificationConfirm]);\n\n  const handleMoveCancel = useCallback(() => {\n    console.log('Move cancel');\n    handleModificationConfirm('cancel');\n  }, [handleModificationConfirm]);\n\n  const handleEventChangeComplete = useCallback(() => {\n    console.log('Event change complete');\n    addToHistory([...events]);\n  }, [addToHistory, events]);\n\n  return {\n    // Events state\n    events,\n    setEvents,\n    // Event selection state\n    selectedEvent,\n    setSelectedEvent,\n    selectedEventId,\n    setSelectedEventId,\n    selectedEventIds,\n    setSelectedEventIds,\n\n    // Event modification state\n    originalEventPosition,\n    setOriginalEventPosition,\n    validatedEvents,\n    setValidatedEvents,\n\n    // Dialog states\n    showDeleteConfirmation,\n    setShowDeleteConfirmation,\n    eventToDelete,\n    setEventToDelete,\n    showMoveConfirmation,\n    setShowMoveConfirmation,\n    movedEvent,\n    setMovedEvent,\n    originalEventDates,\n    setOriginalEventDates,\n    newEventDates,\n    setNewEventDates,\n    showModificationDialog,\n    setShowModificationDialog,\n    pendingModification,\n    setPendingModification,\n\n    // Loading state\n    isSaving,\n    setIsSaving,\n\n    // History\n    history,\n    currentHistoryIndex,\n    addToHistory,\n\n    // Event handlers\n    handleEventClick,\n    handleEventDoubleClick,\n    handleEventRightClick,\n    handlePanelClose,\n    handleEventSave,\n    handleEventDelete,\n    handleEventResize,\n    handleEventMove,\n    handleModificationConfirm,\n    handleMoveConfirm,\n    handleMoveAllConfirm,\n    handleMoveCancel,\n    handleEventChangeComplete,\n    handleCreateEventClick,\n    handleEventDropOnDay,\n    undo,\n    redo,\n\n    // Slide direction\n    slideDirection,\n    setSlideDirection,\n\n    // Drag states\n    isDragging,\n    setIsDragging,\n    dragStartTime,\n    setDragStartTime\n  };\n}; ","import { MODIFICATION_TYPES } from './constants';\nimport { updateEvent } from './eventDatabase';\n\n/**\n * Event modification utilities\n * Handles complex event move and resize operations for recurring and non-recurring events\n * \n * Extracted from Calendar.js to separate business logic\n */\n\n// Handle event resize operations\nexport const handleEventResize = async (\n  eventId, \n  newStart, \n  newEnd, \n  isTemporary, \n  events, \n  setEvents, \n  addToHistory, \n  markEventForSync, \n  userId, \n  accountType,\n  setPendingModification,\n  setOriginalEventDates,\n  setNewEventDates,\n  setMovedEvent,\n  setShowMoveConfirmation\n) => {\n  const event = events.find(e => e.id === eventId);\n  \n  if (!event) {\n    console.error('Event not found:', eventId);\n    return;\n  }\n  \n  const updatedEvents = [...events];\n  const eventIndex = updatedEvents.findIndex(e => e.id === eventId);\n  \n  if (eventIndex === -1) {\n    console.error('Event index not found:', eventId);\n    return;\n  }\n  \n  if (isTemporary) {\n    // Update visual position during resize\n    updatedEvents[eventIndex] = {\n      ...updatedEvents[eventIndex],\n      start: newStart,\n      end: newEnd,\n      isBeingResized: true\n    };\n    \n    setEvents(updatedEvents);\n    return;\n  }\n  \n  // Check if this is a recurring event\n  const isRecurringInstance = event.isRecurringInstance;\n  const originalEvent = isRecurringInstance ? \n    events.find(e => e.id === event.recurringParentId) : \n    event;\n  \n  const isRecurringEvent = event.isRecurring || originalEvent.recurrence || \n    isRecurringInstance || String(eventId).includes('-') || String(eventId).includes('_');\n  \n  // If this is a recurring event, show confirmation dialog\n  if (isRecurringEvent) {\n    // Store the pending modification for the dialog\n    setPendingModification({\n      type: MODIFICATION_TYPES.RESIZE,\n      eventId: eventId,\n      event: event,\n      originalEvent: originalEvent,\n      newStart: newStart,\n      newEnd: newEnd\n    });\n    \n    // Store original and new dates for the dialog\n    setOriginalEventDates({\n      start: event.start instanceof Date ? event.start : new Date(event.start),\n      end: event.end instanceof Date ? event.end : new Date(event.end)\n    });\n    setNewEventDates({\n      start: newStart,\n      end: newEnd\n    });\n    setMovedEvent(event);\n    \n    // Ensure the dialog shows up even with quick mouse movements\n    requestAnimationFrame(() => {\n      setShowMoveConfirmation(true);\n    });\n    return;\n  }\n  \n  // For non-recurring events, proceed with the resize\n  updatedEvents[eventIndex] = {\n    ...updatedEvents[eventIndex],\n    start: newStart,\n    end: newEnd,\n    isBeingResized: false\n  };\n  \n  setEvents(updatedEvents);\n  addToHistory(updatedEvents);\n  \n  // Save changes to local storage immediately and mark for sync\n  console.log('Event resized, saving to local storage');\n  markEventForSync(eventId);\n  \n  // Check if the event exists in the database before updating\n  const isNewEvent = !event.isValidated && !event.fromDatabase;\n  \n  // Only update in the database if we have userId and it's not a new event\n  if (userId && !isNewEvent) {\n    console.log('Skipping database update for resize operation (temporary fix for Firebase function issue):', {\n      eventId: eventId,\n      reason: 'Firebase function updateCalendarEvent is throwing internal errors',\n      uiResizeCompleted: true,\n      willRetryOnSave: true\n    });\n  } else {\n    console.log('Skipping database resize update for new event that will be saved later');\n  }\n};\n\n// Handle event move operations\nexport const handleEventMove = async (\n  eventId, \n  newStartDate, \n  newEndDate, \n  isTemporary, \n  events, \n  setEvents, \n  addToHistory, \n  markEventForSync, \n  userId, \n  accountType,\n  setPendingModification,\n  setOriginalEventDates,\n  setNewEventDates,\n  setMovedEvent,\n  setShowMoveConfirmation\n) => {\n  const currentEvent = events.find(e => e.id === eventId);\n  \n  if (!currentEvent) {\n    console.error('Event not found:', eventId);\n    return;\n  }\n\n  // Ensure dates are proper Date objects\n  const newStart = newStartDate instanceof Date ? newStartDate : new Date(newStartDate);\n  const newEnd = newEndDate instanceof Date ? newEndDate : new Date(newEndDate);\n\n  const isRecurringInstance = currentEvent.isRecurringInstance;\n  const originalEvent = isRecurringInstance ? \n    events.find(e => e.id === currentEvent.recurringParentId) : \n    currentEvent;\n\n  // Create a copy of events to modify\n  const updatedEvents = [...events];\n  const eventIndex = updatedEvents.findIndex(e => e.id === eventId);\n\n  if (eventIndex === -1) {\n    console.error('Event index not found:', eventId);\n    return;\n  }\n\n  if (isTemporary) {\n    // For temporary moves (during drag), update the current event's visual position\n    updatedEvents[eventIndex] = {\n      ...updatedEvents[eventIndex],\n      start: newStart,\n      end: newEnd,\n      isBeingMoved: true\n    };\n    \n    setEvents(updatedEvents);\n    return;\n  }\n\n  // Check if this is a recurring event\n  const isRecurringEvent = currentEvent.isRecurring || originalEvent.recurrence || \n    isRecurringInstance || String(eventId).includes('-') || String(eventId).includes('_');\n\n  // Check if this is the last occurrence in the series\n  let isLastOccurrence = currentEvent.isLastOccurrence || false;\n  \n  if (isRecurringEvent && currentEvent.recurrenceId && !isLastOccurrence) {\n    // If not explicitly marked, check if this is the last occurrence by comparing with other events\n    const seriesEvents = events.filter(e => e.recurrenceId === currentEvent.recurrenceId);\n    \n    if (seriesEvents.length > 0) {\n      // Sort events by end date\n      seriesEvents.sort((a, b) => {\n        const aEnd = a.end instanceof Date ? a.end : new Date(a.end);\n        const bEnd = b.end instanceof Date ? b.end : new Date(b.end);\n        return bEnd.getTime() - aEnd.getTime();\n      });\n      \n      // Check if this is the last event in the series\n      const latestEvent = seriesEvents[0]; // After sorting, first is latest\n      isLastOccurrence = currentEvent.id === latestEvent.id;\n      console.log(`Checking if event ${currentEvent.id} is last in series: ${isLastOccurrence}`);\n    }\n  }\n  \n  // Create a common structure to store original and new dates for the dialog\n  const originalEventDatesObj = {\n    start: currentEvent.start instanceof Date ? currentEvent.start : new Date(currentEvent.start),\n    end: currentEvent.end instanceof Date ? currentEvent.end : new Date(currentEvent.end)\n  };\n  \n  const newEventDatesObj = {\n    start: newStart,\n    end: newEnd\n  };\n\n  // If this is a recurring event, show confirmation dialog\n  if (isRecurringEvent) {\n    // Store the pending modification for the dialog\n    setPendingModification({\n      type: isRecurringInstance ? MODIFICATION_TYPES.MOVE_SINGLE : MODIFICATION_TYPES.MOVE,\n      eventId: eventId,\n      event: currentEvent,\n      originalEvent: originalEvent,\n      newStart: newStart,\n      newEnd: newEnd\n    });\n    \n    // Store original and new dates for the dialog\n    setOriginalEventDates(originalEventDatesObj);\n    setNewEventDates(newEventDatesObj);\n    \n    // Add isLastOccurrence flag to the moved event for the dialog\n    setMovedEvent({\n      ...currentEvent,\n      isLastOccurrence: isLastOccurrence\n    });\n    \n    // Ensure the dialog shows up even with quick mouse movements\n    requestAnimationFrame(() => {\n      setShowMoveConfirmation(true);\n    });\n    return;\n  }\n\n  // For non-recurring events, update immediately\n  updatedEvents[eventIndex] = {\n    ...updatedEvents[eventIndex],\n    start: newStart,\n    end: newEnd,\n    isBeingMoved: false\n  };\n  \n  setEvents(updatedEvents);\n  addToHistory(updatedEvents);\n  \n  // Save changes to local storage immediately and mark for sync\n  console.log('Event moved, saving to local storage');\n  markEventForSync(eventId);\n  \n  // Update in database if it's an existing event\n  const isNewEvent = !currentEvent.isValidated && !currentEvent.fromDatabase;\n  \n  console.log('Event move - database update check:', {\n    eventId: eventId,\n    isValidated: currentEvent.isValidated,\n    fromDatabase: currentEvent.fromDatabase,\n    isNewEvent: isNewEvent,\n    userId: userId,\n    willUpdateDatabase: userId && !isNewEvent\n  });\n  \n  if (userId && !isNewEvent) {\n    console.log('Skipping database update for move operation (temporary fix for Firebase function issue):', {\n      eventId: eventId,\n      reason: 'Firebase function updateCalendarEvent is throwing internal errors',\n      uiMoveCompleted: true,\n      willRetryOnSave: true\n    });\n  } else {\n    console.log('Skipping database update - either no userId or event is new');\n  }\n};\n\n// Handle modification confirmations for recurring events\nexport const handleModificationConfirm = async (\n  modificationType,\n  pendingModification,\n  events,\n  setEvents,\n  addToHistory,\n  userId,\n  accountType,\n  originalEventDates,\n  setShowMoveConfirmation,\n  setPendingModification,\n  setMovedEvent,\n  setOriginalEventDates,\n  setNewEventDates,\n  setSelectedEvent,\n  setSelectedEventId,\n  saveEventsToLocalStorage,\n  setPendingChanges\n) => {\n  console.log('handleModificationConfirm called with type:', modificationType, 'pendingModification:', pendingModification);\n  if (!pendingModification) {\n    console.error('handleModificationConfirm called but no pending modification');\n    return;\n  }\n  \n  // Reset dialog states\n  setShowMoveConfirmation(false);\n  \n  const { type, eventId, event, newStart, newEnd } = pendingModification;\n  console.log('Processing event:', eventId, 'with modification type:', type);\n  \n  if (modificationType === 'cancel') {\n    // Reset the event's position to original state\n    if (type === MODIFICATION_TYPES.MOVE || type === MODIFICATION_TYPES.RESIZE || type === MODIFICATION_TYPES.MOVE_SINGLE) {\n      // Find the event and reset its position\n      const updatedEvents = events.map(e => {\n        if (e.id === eventId) {\n          return {\n            ...e,\n            start: originalEventDates?.start instanceof Date ? originalEventDates.start : new Date(originalEventDates.start),\n            end: originalEventDates?.end instanceof Date ? originalEventDates.end : new Date(originalEventDates.end),\n            isBeingMoved: false\n          };\n        }\n        return e;\n      });\n      \n      // Update state to refresh the event's position\n      setEvents(updatedEvents);\n      \n      // Save reverted events to local storage\n      if (saveEventsToLocalStorage) {\n        console.log('Event move canceled, resetting local storage');\n        saveEventsToLocalStorage(updatedEvents);\n      }\n      \n      // Remove event from pending changes\n      if (setPendingChanges) {\n        setPendingChanges(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(eventId);\n          return newSet;\n        });\n      }\n    }\n    \n    // Reset all states\n    setPendingModification(null);\n    setMovedEvent(null);\n    setOriginalEventDates(null);\n    setNewEventDates(null);\n    return;\n  }\n\n  // Handle single event modifications\n  if (modificationType === 'single') {\n    // Update only this occurrence\n    const index = events.findIndex(e => String(e.id) === String(eventId));\n    if (index !== -1) {\n      console.log(`Modifying single event ${eventId} from recurring series`);\n      \n      const newEvents = [...events];\n      // Check if the event had a recurrenceId before updating\n      const hadRecurrenceId = !!newEvents[index].recurrenceId;\n      \n      // Update this specific event\n      newEvents[index] = {\n        ...newEvents[index],\n        start: newStart,\n        end: newEnd,\n        isBeingMoved: false // Clear the drag flag\n      };\n      \n      // Remove recurrenceId when moving a single child event\n      if (hadRecurrenceId) {\n        console.log(`Removing recurrenceId from single moved event ${eventId}`);\n        delete newEvents[index].recurrenceId;\n        newEvents[index].isRecurring = false;\n      }\n      \n      // Update state\n      setEvents(newEvents);\n      addToHistory(newEvents);\n      \n      console.log('Single recurring event modification completed');\n      \n      // Update in database\n      if (userId) {\n        const eventForUpdate = {\n          id: eventId,\n          start: newStart,\n          end: newEnd,\n          title: newEvents[index].title,\n          color: newEvents[index].color,\n          color1: newEvents[index].color1,\n          color2: newEvents[index].color2,\n          isValidated: newEvents[index].isValidated || false,\n          isRecurring: false, // Set to false since we're detaching from recurrence\n          notes: newEvents[index].notes,\n          location: newEvents[index].location,\n          employees: newEvents[index].employees,\n          canton: newEvents[index].canton,\n          area: newEvents[index].area,\n          experience: newEvents[index].experience,\n          software: newEvents[index].software,\n          certifications: newEvents[index].certifications,\n          isAvailability: newEvents[index].isAvailability\n        };\n\n        console.log('Sending update to database for single event:', eventForUpdate);\n\n        updateEvent(eventId, eventForUpdate, userId, accountType)\n          .then(result => {\n            if (result.success) {\n              console.log('Single event modified successfully in database');\n            } else {\n              console.error('Failed to modify single event in database:', result.error);\n            }\n          })\n          .catch(error => {\n            console.error('Error modifying single event in database:', error);\n          });\n      }\n    }\n  } \n  // Handle all future occurrences modifications\n  else if (modificationType === 'all') {\n    const eventDate = new Date(event.start);\n    const originalDate = originalEventDates ? new Date(originalEventDates.start) : new Date(event.start);\n    const baseId = String(eventId).split(/[-_]/)[0];\n    const recurrenceId = event.recurrenceId;\n    \n    console.log(`Modifying all future occurrences with baseId: ${baseId}, recurrenceId: ${recurrenceId}, eventId: ${eventId}`);\n    \n    // First, identify all events in this series\n    const seriesEvents = events.filter(e => {\n      const isInSeries = String(e.id).startsWith(baseId) || \n                         (recurrenceId && e.recurrenceId === recurrenceId);\n      return isInSeries;\n    });\n    \n    console.log(`Found ${seriesEvents.length} events in this series`);\n    \n    // Calculate the time difference between original and new times\n    const timeDiff = newStart.getTime() - originalDate.getTime();\n    console.log(`Time difference to apply: ${timeDiff}ms`);\n    \n    // Generate a new recurrenceId for this set of modified events\n    const newRecurrenceId = `${userId}_${Date.now()}_recurrence`;\n    console.log(`Generated new recurrenceId for modified events: ${newRecurrenceId}`);\n    \n    // Create a set of modified events for the series\n    const modifiedSeriesEvents = [];\n    \n    // First, ensure the current event is properly updated\n    const currentEventIndex = seriesEvents.findIndex(e => String(e.id) === String(eventId));\n    if (currentEventIndex !== -1) {\n      console.log(`Found current event at index ${currentEventIndex}: ${eventId}`);\n      \n      const updatedEvent = {\n        ...seriesEvents[currentEventIndex],\n        start: newStart,\n        end: newEnd,\n        recurrenceId: newRecurrenceId,\n        isBeingMoved: false\n      };\n      \n      modifiedSeriesEvents.push(updatedEvent);\n    } else {\n      console.warn(`Could not find current event ${eventId} in series events`);\n    }\n    \n    // Now process the rest of the events\n    for (const e of seriesEvents) {\n      // Skip the current event since we already processed it\n      if (String(e.id) === String(eventId)) {\n        continue;\n      }\n      \n      const eDate = new Date(e.start);\n      \n      // Only include future events\n      if (eDate >= eventDate) {\n        // Apply the same time shift\n        const newStart = new Date(e.start.getTime() + timeDiff);\n        const newEnd = new Date(e.end.getTime() + timeDiff);\n        \n        console.log(`Modifying event ${e.id} from ${e.start} to ${newStart}`);\n        \n        const updatedEvent = {\n          ...e,\n          start: newStart,\n          end: newEnd,\n          recurrenceId: newRecurrenceId,\n          isBeingMoved: false\n        };\n        \n        modifiedSeriesEvents.push(updatedEvent);\n      }\n    }\n    \n    console.log(`Modified ${modifiedSeriesEvents.length} events in total`);\n    \n    // Replace the entire series in the events array\n    const eventsWithoutSeries = events.filter(e => {\n      return !(String(e.id).startsWith(baseId) || \n              (recurrenceId && e.recurrenceId === recurrenceId));\n    });\n    \n    const updatedEvents = [...eventsWithoutSeries, ...modifiedSeriesEvents];\n    \n    // Update state with the new events\n    setEvents(updatedEvents);\n    addToHistory(updatedEvents);\n    \n    console.log('All recurring event modifications completed');\n    \n    // Update in database\n    if (userId) {\n      console.log('Updating database with modified recurring events');\n      \n      // For each modified event, update it in the database\n      modifiedSeriesEvents.forEach(e => {\n        const eventForUpdate = {\n          id: e.id,\n          start: e.start,\n          end: e.end,\n          title: e.title,\n          color: e.color,\n          color1: e.color1,\n          color2: e.color2,\n          isValidated: e.isValidated || false,\n          isRecurring: true,\n          recurrenceId: newRecurrenceId,\n          notes: e.notes,\n          location: e.location,\n          employees: e.employees,\n          canton: e.canton,\n          area: e.area,\n          experience: e.experience,\n          software: e.software,\n          certifications: e.certifications,\n          isAvailability: e.isAvailability,\n          isBeingMoved: false\n        };\n        \n        updateEvent(e.id, eventForUpdate, userId, accountType)\n          .then(result => {\n            if (result.success) {\n              console.log(`Event ${e.id} modified successfully in database`);\n            } else {\n              console.error(`Failed to modify event ${e.id} in database:`, result.error);\n            }\n          })\n          .catch(error => {\n            console.error(`Error modifying event ${e.id} in database:`, error);\n          });\n      });\n    }\n  }\n  \n  // Reset all states\n  setPendingModification(null);\n  setMovedEvent(null);\n  setOriginalEventDates(null);\n  setNewEventDates(null);\n}; ","import React, { useState, useRef, useEffect } from 'react';\nimport { FiX } from 'react-icons/fi';\nimport { HexColorPicker } from 'react-colorful';\nimport { CALENDAR_COLORS } from '../../pages/calendar/utils/constants';\nimport { cn } from '../../../utils/cn';\n\nconst ColorPicker = ({ \n  color, \n  color1, \n  onChange, \n  size = 32,\n  className = ''\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [customColor, setCustomColor] = useState(color || CALENDAR_COLORS[0].color);\n  const [brightness, setBrightness] = useState(100);\n  const pickerRef = useRef(null);\n  const buttonRef = useRef(null);\n  const popupRef = useRef(null);\n  const [popupPosition, setPopupPosition] = useState({ top: 0, left: 0 });\n  const [showPopup, setShowPopup] = useState(false);\n  const positionTimeoutRef = useRef(null);\n\n  useEffect(() => {\n    if (color) {\n      setCustomColor(color);\n    }\n  }, [color]);\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (\n        pickerRef.current && \n        popupRef.current &&\n        !pickerRef.current.contains(event.target) &&\n        !popupRef.current.contains(event.target)\n      ) {\n        setIsOpen(false);\n        setShowPopup(false);\n      }\n    };\n\n    if (isOpen && showPopup) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [isOpen, showPopup]);\n\n  useEffect(() => {\n    if (isOpen && buttonRef.current) {\n      const calculatePosition = () => {\n        const buttonRect = buttonRef.current.getBoundingClientRect();\n        const popupHeight = 450;\n        const popupWidth = 320;\n        const spaceBelow = window.innerHeight - buttonRect.bottom;\n        const spaceAbove = buttonRect.top;\n        \n        let top = buttonRect.bottom + window.scrollY + 8;\n        let left = buttonRect.left + window.scrollX + (buttonRect.width / 2) - (popupWidth / 2);\n        \n        if (spaceBelow < popupHeight && spaceAbove > spaceBelow) {\n          top = buttonRect.top + window.scrollY - popupHeight - 8;\n        }\n        \n        if (left < 8) left = 8;\n        if (left + popupWidth > window.innerWidth - 8) {\n          left = window.innerWidth - popupWidth - 8;\n        }\n        \n        setPopupPosition({ top, left });\n        \n        positionTimeoutRef.current = setTimeout(() => {\n          setShowPopup(true);\n        }, 100);\n      };\n      \n      setShowPopup(false);\n      calculatePosition();\n      \n      return () => {\n        if (positionTimeoutRef.current) {\n          clearTimeout(positionTimeoutRef.current);\n        }\n      };\n    } else {\n      setShowPopup(false);\n    }\n  }, [isOpen]);\n\n  const adjustBrightness = (hex, percent) => {\n    const num = parseInt(hex.replace('#', ''), 16);\n    const r = Math.min(255, Math.floor((num >> 16) * (percent / 100)));\n    const g = Math.min(255, Math.floor(((num >> 8) & 0x00FF) * (percent / 100)));\n    const b = Math.min(255, Math.floor((num & 0x0000FF) * (percent / 100)));\n    return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n  };\n\n  const handlePresetColorClick = (colorOption) => {\n    const newColor = colorOption.color;\n    const newColor1 = colorOption.color1;\n    setCustomColor(newColor);\n    onChange(newColor, newColor1);\n    setIsOpen(false);\n    setShowPopup(false);\n  };\n\n  const handleColorChange = (newColor) => {\n    setCustomColor(newColor);\n    const adjustedColor1 = adjustBrightness(newColor, brightness);\n    onChange(newColor, adjustedColor1);\n  };\n\n  const handleBrightnessChange = (e) => {\n    const newBrightness = parseInt(e.target.value);\n    setBrightness(newBrightness);\n    const adjustedColor1 = adjustBrightness(customColor, newBrightness);\n    onChange(customColor, adjustedColor1);\n  };\n\n  const displayColor = color1 || color || CALENDAR_COLORS[0].color1;\n\n  return (\n    <>\n      <div className={cn(\"relative\", className)} ref={pickerRef}>\n        <button\n          ref={buttonRef}\n          type=\"button\"\n          onClick={(e) => {\n            e.stopPropagation();\n            if (isOpen) {\n              setIsOpen(false);\n              setShowPopup(false);\n            } else {\n              setIsOpen(true);\n            }\n          }}\n          className=\"rounded-full border-2 transition-all hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2\"\n          style={{\n            width: `${size}px`,\n            height: `${size}px`,\n            backgroundColor: displayColor,\n            borderColor: 'rgba(37, 99, 235, 0.3)',\n            boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)'\n          }}\n          aria-label=\"Select color\"\n        />\n      </div>\n\n      {isOpen && showPopup && (\n        <div \n          ref={popupRef}\n          className=\"fixed p-4 bg-white rounded-xl shadow-2xl border border-border\"\n          style={{ \n            width: '320px',\n            top: `${popupPosition.top}px`,\n            left: `${popupPosition.left}px`,\n            maxHeight: '90vh',\n            overflowY: 'auto',\n            zIndex: 'var(--z-index-popup, 11000)'\n          }}\n          onClick={(e) => e.stopPropagation()}\n        >\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"text-sm font-semibold text-foreground\">Select Color</h4>\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsOpen(false);\n                setShowPopup(false);\n              }}\n              className=\"p-1 hover:bg-muted rounded transition-colors\"\n              aria-label=\"Close\"\n            >\n              <FiX className=\"w-4 h-4 text-muted-foreground\" />\n            </button>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-xs font-medium text-muted-foreground mb-2\">\n                Preset Colors\n              </label>\n              <div className=\"flex gap-2 flex-wrap\">\n                {CALENDAR_COLORS.map((colorOption) => {\n                  const isSelected = color === colorOption.color;\n                  return (\n                    <button\n                      key={colorOption.id}\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handlePresetColorClick(colorOption);\n                      }}\n                      className={cn(\n                        \"w-8 h-8 rounded-full border-2 transition-all hover:scale-110\",\n                        isSelected ? '' : 'border-transparent'\n                      )}\n                      style={{\n                        backgroundColor: colorOption.color1 || colorOption.color,\n                        borderColor: isSelected ? 'var(--color-logo-1)' : 'transparent',\n                        boxShadow: isSelected ? '0 0 0 2px var(--color-logo-1), 0 0 0 4px rgba(37, 99, 235, 0.1)' : 'none'\n                      }}\n                      title={colorOption.name}\n                      aria-label={colorOption.name}\n                    />\n                  );\n                })}\n              </div>\n            </div>\n\n            <div className=\"border-t border-border pt-4\">\n              <label className=\"block text-xs font-medium text-muted-foreground mb-2\">\n                Custom Color\n              </label>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-center\">\n                  <HexColorPicker\n                    color={customColor}\n                    onChange={handleColorChange}\n                    style={{ width: '100%' }}\n                  />\n                </div>\n                \n                <div className=\"flex items-center gap-3\">\n                  <input\n                    type=\"text\"\n                    value={customColor}\n                    onChange={(e) => {\n                      const newColor = e.target.value;\n                      if (/^#[0-9A-F]{6}$/i.test(newColor)) {\n                        handleColorChange(newColor);\n                      }\n                    }}\n                    className=\"flex-1 px-2 py-1 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-primary\"\n                    placeholder=\"#000000\"\n                    onClick={(e) => e.stopPropagation()}\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-xs font-medium text-muted-foreground mb-2\">\n                    Brightness: {brightness}%\n                  </label>\n                  <input\n                    type=\"range\"\n                    min=\"20\"\n                    max=\"100\"\n                    value={brightness}\n                    onChange={handleBrightnessChange}\n                    className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\n                    style={{\n                      background: `linear-gradient(to right, ${adjustBrightness(customColor, 20)} 0%, ${adjustBrightness(customColor, 100)} 100%)`\n                    }}\n                    onClick={(e) => e.stopPropagation()}\n                  />\n                  <div className=\"mt-1 text-xs text-muted-foreground\">\n                    Preview: <span style={{ color: adjustBrightness(customColor, brightness) }}></span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default ColorPicker;\n","import React, { useState, useCallback, useMemo, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiX, FiPlus, FiTrash2, FiAlertTriangle, FiShare2, FiMail, FiCopy, FiLoader } from 'react-icons/fi';\nimport { FaWhatsapp } from 'react-icons/fa';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { CALENDAR_COLORS } from '../utils/constants';\nimport { get } from 'lodash';\nimport InputField from '../../../../components/BoxedInputFields/Personnalized-InputField';\nimport Button from '../../../../components/BoxedInputFields/Button';\nimport DropdownField from '../../../../components/BoxedInputFields/Dropdown-Field';\nimport { cn } from '../../../../utils/cn';\nimport { useDashboard } from '../../../contexts/DashboardContext';\nimport { db } from '../../../../services/firebase';\nimport { doc, getDoc } from 'firebase/firestore';\nimport ColorPicker from '../../../components/ColorPicker/ColorPicker';\nimport { generateFacilityRoleInvitation } from '../../../../services/cloudFunctions';\nimport { useNotification } from '../../../../contexts/NotificationContext';\n\nconst DAYS_OF_WEEK = [\n  { key: 'monday', labelKey: 'operations.monday' },\n  { key: 'tuesday', labelKey: 'operations.tuesday' },\n  { key: 'wednesday', labelKey: 'operations.wednesday' },\n  { key: 'thursday', labelKey: 'operations.thursday' },\n  { key: 'friday', labelKey: 'operations.friday' },\n  { key: 'saturday', labelKey: 'operations.saturday' },\n  { key: 'sunday', labelKey: 'operations.sunday' }\n];\n\nconst WORKER_TYPES = [\n  { value: 'pharmacist', labelKey: 'operations.workerTypes.pharmacist' },\n  { value: 'cashier', labelKey: 'operations.workerTypes.cashier' },\n  { value: 'assistant', labelKey: 'operations.workerTypes.assistant' },\n  { value: 'pharmacy_technician', labelKey: 'operations.workerTypes.pharmacyTechnician' },\n  { value: 'other', labelKey: 'operations.workerTypes.other' }\n];\n\nconst AddFacilityRoleModal = ({ isOpen, onClose, profileData, onSave, editingRole = null, onDelete = null }) => {\n  const { t } = useTranslation(['dashboardProfile', 'common']);\n  const { selectedWorkspace } = useDashboard();\n  const [formData, setFormData] = useState({\n    workerType: 'none',\n    workerTypeOther: '',\n    assignedWorkers: [],\n    appliesToAllDays: false,\n    specificDays: []\n  });\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const [teamMembers, setTeamMembers] = useState([]);\n  const [loadingTeamMembers, setLoadingTeamMembers] = useState(false);\n  const [showWorkerSelect, setShowWorkerSelect] = useState(null);\n  const [selectedHeaderColor, setSelectedHeaderColor] = useState(null);\n  const [workerErrors, setWorkerErrors] = useState({});\n  const [fieldErrors, setFieldErrors] = useState({});\n  const [workerInvitations, setWorkerInvitations] = useState({});\n  const [generatingInvitation, setGeneratingInvitation] = useState({});\n  const { showSuccess, showError } = useNotification();\n  const previousWorkerTypeRef = useRef(null);\n  const previousWorkerTypeOtherRef = useRef(null);\n\n  useEffect(() => {\n    if (editingRole) {\n      const assignedWorkers = editingRole.assignedWorkers || [];\n      if (assignedWorkers.length === 0 && (editingRole.assignedPharmacistId || editingRole.placeholderName)) {\n        const defaultColor = CALENDAR_COLORS[0];\n        assignedWorkers.push({\n          id: Date.now().toString(),\n          workerId: editingRole.assignedPharmacistId || '',\n          placeholderName: editingRole.placeholderName || '',\n          color: editingRole.color || defaultColor.color,\n          color1: editingRole.color1 || defaultColor.color1\n        });\n      }\n      setFormData({\n        workerType: editingRole.workerType || 'pharmacist',\n        workerTypeOther: editingRole.workerTypeOther || '',\n        assignedWorkers: assignedWorkers,\n        appliesToAllDays: editingRole.appliesToAllDays || false,\n        specificDays: editingRole.specificDays || []\n      });\n      const firstWorkerColor = assignedWorkers.length > 0 && assignedWorkers[0].color \n        ? assignedWorkers[0].color \n        : (editingRole.color || CALENDAR_COLORS[0].color);\n      setSelectedHeaderColor(firstWorkerColor);\n    } else {\n      setFormData({\n        workerType: 'none',\n        workerTypeOther: '',\n        assignedWorkers: [],\n        appliesToAllDays: false,\n        specificDays: []\n      });\n      setSelectedHeaderColor(null);\n    }\n    setWorkerErrors({});\n    setFieldErrors({});\n    setWorkerInvitations({});\n  }, [editingRole, isOpen]);\n\n  const getUnusedColor = useCallback(() => {\n    const allExistingRoles = get(profileData, 'operationalSettings.workerRequirements') || [];\n    const usedColors = new Set();\n    \n    allExistingRoles.forEach(role => {\n      const workers = role.assignedWorkers || [];\n      workers.forEach(worker => {\n        if (worker.color) {\n          usedColors.add(worker.color);\n        }\n      });\n      if (role.color) {\n        usedColors.add(role.color);\n      }\n    });\n    \n    const currentWorkers = formData.assignedWorkers || [];\n    currentWorkers.forEach(worker => {\n      if (worker.color) {\n        usedColors.add(worker.color);\n      }\n    });\n    \n    const availableColor = CALENDAR_COLORS.find(color => !usedColors.has(color.color));\n    return availableColor || CALENDAR_COLORS[0];\n  }, [profileData, formData.assignedWorkers]);\n\n  useEffect(() => {\n    if (!editingRole && isOpen && formData.workerType && formData.workerType !== 'none') {\n      const isInitialSelection = previousWorkerTypeRef.current === null;\n      const workerTypeChanged = previousWorkerTypeRef.current !== null && \n                                previousWorkerTypeRef.current !== formData.workerType;\n      const workerTypeOtherChanged = formData.workerType === 'other' && \n                                     previousWorkerTypeOtherRef.current !== formData.workerTypeOther &&\n                                     formData.workerTypeOther?.trim() !== '';\n\n      if (isInitialSelection || workerTypeChanged || workerTypeOtherChanged) {\n        const allExistingRoles = get(profileData, 'operationalSettings.workerRequirements') || [];\n        const existingRole = allExistingRoles.find(role => {\n          if (formData.workerType === 'other') {\n            return role.workerType === 'other' && \n                   role.workerTypeOther === formData.workerTypeOther &&\n                   formData.workerTypeOther?.trim() !== '';\n          }\n          return role.workerType === formData.workerType && role.workerType !== 'other';\n        });\n\n        if (existingRole) {\n          const existingWorkers = existingRole.assignedWorkers || [];\n          const mergedWorkers = existingWorkers.map(worker => ({\n            ...worker,\n            id: worker.id || Date.now().toString() + Math.random()\n          }));\n\n          setFormData(prev => ({\n            ...prev,\n            assignedWorkers: mergedWorkers,\n            appliesToAllDays: existingRole.appliesToAllDays || prev.appliesToAllDays,\n            specificDays: existingRole.specificDays || prev.specificDays\n          }));\n\n          if (mergedWorkers.length > 0) {\n            const firstWorkerColor = mergedWorkers[0].color || CALENDAR_COLORS[0].color;\n            setSelectedHeaderColor(firstWorkerColor);\n          }\n        } else {\n          setFormData(prev => ({\n            ...prev,\n            assignedWorkers: [],\n            appliesToAllDays: false,\n            specificDays: []\n          }));\n          \n          setSelectedHeaderColor(null);\n          setShowWorkerSelect(null);\n        }\n      }\n\n      previousWorkerTypeRef.current = formData.workerType;\n      previousWorkerTypeOtherRef.current = formData.workerTypeOther;\n    } else if (!isOpen) {\n      previousWorkerTypeRef.current = null;\n      previousWorkerTypeOtherRef.current = null;\n    }\n  }, [formData.workerType, formData.workerTypeOther, editingRole, isOpen, profileData, getUnusedColor]);\n\n  useEffect(() => {\n    const fetchTeamMembers = async () => {\n      if (!isOpen || !selectedWorkspace?.facilityId) return;\n      \n      setLoadingTeamMembers(true);\n      try {\n        const facilityRef = doc(db, 'facilityProfiles', selectedWorkspace.facilityId);\n        const facilitySnap = await getDoc(facilityRef);\n        \n        if (facilitySnap.exists()) {\n          const facilityData = facilitySnap.data();\n          const employeesList = facilityData.employees || [];\n          const admins = employeesList.filter(emp => emp.rights === 'admin').map(emp => emp.uid);\n          const employees = employeesList.filter(emp => emp.rights !== 'admin').map(emp => emp.uid);\n          const allMemberIds = [...new Set([...admins, ...employees])];\n          \n          const memberPromises = allMemberIds.map(async (userId) => {\n            try {\n              const professionalProfileRef = doc(db, 'professionalProfiles', userId);\n              const professionalProfileSnap = await getDoc(professionalProfileRef);\n              \n              if (professionalProfileSnap.exists()) {\n                const professionalData = professionalProfileSnap.data();\n                const identity = professionalData.identity || {};\n                const firstName = identity.legalFirstName || identity.firstName || '';\n                const lastName = identity.legalLastName || identity.lastName || '';\n                \n                return {\n                  uid: userId,\n                  firstName: firstName,\n                  lastName: lastName,\n                  email: professionalData.contact?.primaryEmail || '',\n                  isAdmin: admins.includes(userId)\n                };\n              } else {\n                const userRef = doc(db, 'users', userId);\n                const userSnap = await getDoc(userRef);\n                \n                if (userSnap.exists()) {\n                  const userData = userSnap.data();\n                  return {\n                    uid: userId,\n                    firstName: userData.firstName || '',\n                    lastName: userData.lastName || '',\n                    email: userData.email || '',\n                    isAdmin: admins.includes(userId)\n                  };\n                }\n              }\n            } catch (error) {\n              console.error(`Error fetching profile for user ${userId}:`, error);\n            }\n            return null;\n          });\n          \n          const members = (await Promise.all(memberPromises)).filter(m => m !== null);\n          setTeamMembers(members);\n        }\n      } catch (error) {\n        console.error('Error fetching team members:', error);\n      } finally {\n        setLoadingTeamMembers(false);\n      }\n    };\n    \n    if (isOpen && formData.workerType && formData.workerType !== 'none') {\n      fetchTeamMembers();\n    }\n  }, [isOpen, selectedWorkspace?.facilityId, formData.workerType]);\n\n  useEffect(() => {\n    const workers = formData.assignedWorkers || [];\n    if (workers.length > 0) {\n      const firstWorkerWithColor = workers.find(w => w.color) || workers[0];\n      if (firstWorkerWithColor && firstWorkerWithColor.color) {\n        setSelectedHeaderColor(firstWorkerWithColor.color);\n      }\n    } else if (!editingRole) {\n      setSelectedHeaderColor(null);\n    }\n  }, [formData.assignedWorkers, editingRole]);\n\n  const openingHours = useMemo(() => {\n    const hours = get(profileData, 'operationalSettings.standardOpeningHours') || {};\n    return DAYS_OF_WEEK.map(day => {\n      const dayValue = hours[day.key] || '';\n      const isClosed = dayValue === 'closed' || dayValue === '';\n      let openingTime = '08:00';\n      let closingTime = '18:00';\n\n      if (!isClosed && dayValue.includes('-')) {\n        const parts = dayValue.split('-');\n        openingTime = parts[0]?.trim() || '08:00';\n        closingTime = parts[1]?.trim() || '18:00';\n      }\n\n      return {\n        ...day,\n        isClosed,\n        openingTime,\n        closingTime,\n        rawValue: dayValue\n      };\n    });\n  }, [profileData]);\n\n  const getWorkerTypeOptions = useCallback(() => {\n    const options = [\n      { value: 'none', label: t('operations.workerTypes.none', 'None') }\n    ];\n    return [...options, ...WORKER_TYPES.map(type => ({\n      value: type.value,\n      label: t(type.labelKey)\n    }))];\n  }, [t]);\n\n  const getPharmacistOptions = useCallback(() => {\n    const options = [\n      { value: '', label: t('operations.selectPharmacistOrPlaceholder', 'Select Pharmacist or Enter Placeholder') }\n    ];\n    \n    teamMembers.forEach(member => {\n      const firstName = member.firstName || '';\n      const lastName = member.lastName || '';\n      const fullName = `${firstName} ${lastName}`.trim();\n      options.push({\n        value: member.uid,\n        label: fullName || `${firstName}${lastName}` || 'Unknown'\n      });\n    });\n    \n    options.push({\n      value: 'placeholder',\n      label: t('operations.usePlaceholderName', 'Enter Placeholder Name')\n    });\n    \n    return options;\n  }, [teamMembers, t]);\n\n  const handleUpdateField = useCallback((field, value) => {\n    setFormData(prev => {\n      if (field === 'appliesToAllDays') {\n        return { ...prev, appliesToAllDays: value, specificDays: value ? [] : prev.specificDays };\n      }\n      if (field === 'toggleDay') {\n        const dayIndex = prev.specificDays.indexOf(value);\n        const newDays = dayIndex >= 0\n          ? prev.specificDays.filter(d => d !== value)\n          : [...prev.specificDays, value];\n        return { ...prev, specificDays: newDays };\n      }\n      if (field === 'workerType') {\n        if (value === 'none') {\n          return { ...prev, [field]: value, workerTypeOther: '', assignedWorkers: [] };\n        }\n        if (value !== 'other') {\n          return { ...prev, [field]: value, workerTypeOther: '' };\n        }\n      }\n      return { ...prev, [field]: value };\n    });\n    \n    if (field === 'workerType') {\n      setFieldErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors.workerType;\n        return newErrors;\n      });\n    }\n    \n    if (field === 'workerTypeOther') {\n      setFieldErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors.workerTypeOther;\n        return newErrors;\n      });\n    }\n\n  }, []);\n\n  const handleAddWorker = useCallback(() => {\n    if (!formData.workerType || formData.workerType === 'none') {\n      setFieldErrors({ workerType: t('operations.workerTypeRequired', 'Role type is required') });\n      showError(t('operations.workerTypeRequired', 'Role type is required'));\n      return;\n    }\n\n    if (formData.workerType === 'other' && !formData.workerTypeOther?.trim()) {\n      setFieldErrors({ workerTypeOther: t('operations.workerTypeOtherRequired', 'Role type name is required') });\n      showError(t('operations.workerTypeOtherRequired', 'Role type name is required'));\n      return;\n    }\n\n    const currentWorkers = formData.assignedWorkers || [];\n    let workerColor;\n    \n    if (currentWorkers.length > 0) {\n      const lastWorker = currentWorkers[currentWorkers.length - 1];\n      workerColor = {\n        color: lastWorker.color || CALENDAR_COLORS[0].color,\n        color1: lastWorker.color1 || CALENDAR_COLORS[0].color1\n      };\n    } else {\n      workerColor = CALENDAR_COLORS[0];\n    }\n    \n    const newWorker = {\n      id: Date.now().toString(),\n      workerId: '',\n      placeholderName: '',\n      color: workerColor.color,\n      color1: workerColor.color1\n    };\n    setFormData(prev => ({\n      ...prev,\n      assignedWorkers: [...(prev.assignedWorkers || []), newWorker]\n    }));\n    setSelectedHeaderColor(workerColor.color);\n    setShowWorkerSelect(newWorker.id);\n  }, [formData.assignedWorkers, formData.workerType, formData.workerTypeOther, t, showError]);\n\n  const handleRemoveWorker = useCallback((workerId) => {\n    setFormData(prev => ({\n      ...prev,\n      assignedWorkers: (prev.assignedWorkers || []).filter(w => w.id !== workerId)\n    }));\n    setWorkerErrors(prev => {\n      const newErrors = { ...prev };\n      delete newErrors[`${workerId}_workerId`];\n      delete newErrors[`${workerId}_placeholderName`];\n      if (Object.keys(newErrors).length === 1 && newErrors._general) {\n        delete newErrors._general;\n      }\n      return newErrors;\n    });\n  }, []);\n\n  const handleUpdateWorker = useCallback((workerId, field, value) => {\n    setFormData(prev => ({\n      ...prev,\n      assignedWorkers: (prev.assignedWorkers || []).map(worker => {\n        if (worker.id === workerId) {\n          if (field === 'color') {\n            const colorOption = CALENDAR_COLORS.find(c => c.color === value);\n            const updatedWorker = {\n              ...worker,\n              color: value,\n              color1: colorOption?.color1 || value\n            };\n            setSelectedHeaderColor(value);\n            return updatedWorker;\n          }\n          return { ...worker, [field]: value };\n        }\n        return worker;\n      })\n    }));\n    \n    if (field === 'workerId' || field === 'placeholderName') {\n      setWorkerErrors(prev => {\n        const newErrors = { ...prev };\n        if (field === 'workerId') {\n          delete newErrors[`${workerId}_workerId`];\n          if (value === 'placeholder') {\n            delete newErrors[`${workerId}_placeholderName`];\n          }\n        } else if (field === 'placeholderName') {\n          delete newErrors[`${workerId}_placeholderName`];\n        }\n        return newErrors;\n      });\n    }\n  }, []);\n\n  const validateWorkers = useCallback(() => {\n    const errors = {};\n    const fieldErrs = {};\n    let isValid = true;\n    \n    if (!formData.workerType || formData.workerType === 'none') {\n      isValid = false;\n      fieldErrs.workerType = t('operations.workerTypeRequired', 'Role type is required');\n    }\n    \n    if (formData.workerType === 'other' && !formData.workerTypeOther?.trim()) {\n      isValid = false;\n      fieldErrs.workerTypeOther = t('operations.workerTypeOtherRequired', 'Role type name is required');\n    }\n    \n    if (formData.workerType && formData.workerType !== 'none') {\n      const workers = formData.assignedWorkers || [];\n      \n      if (workers.length === 0) {\n        isValid = false;\n        errors._general = t('operations.atLeastOneWorkerRequired', 'At least one worker is required');\n      }\n      \n      workers.forEach(worker => {\n      const workerId = worker.workerId || '';\n      const placeholderName = worker.placeholderName || '';\n      \n      if (!workerId || workerId === '') {\n        isValid = false;\n        errors[`${worker.id}_workerId`] = t('operations.workerSelectionRequired', 'Worker selection is required');\n      } else if (workerId === 'placeholder' && !placeholderName.trim()) {\n        isValid = false;\n        errors[`${worker.id}_placeholderName`] = t('operations.placeholderNameRequired', 'Placeholder name is required');\n      }\n      });\n    }\n    \n    setWorkerErrors(errors);\n    setFieldErrors(fieldErrs);\n    return isValid;\n  }, [formData.assignedWorkers, formData.workerType, formData.workerTypeOther, t]);\n\n  const validateInvitation = useCallback(() => {\n    if (!formData.workerType || formData.workerType === 'none') {\n      setFieldErrors({ workerType: t('operations.workerTypeRequired', 'Role type is required') });\n      return false;\n    }\n    if (formData.workerType === 'other' && !formData.workerTypeOther?.trim()) {\n      setFieldErrors({ workerTypeOther: t('operations.workerTypeOtherRequired', 'Role type name is required') });\n      return false;\n    }\n    setFieldErrors({});\n    return true;\n  }, [formData.workerType, formData.workerTypeOther, t]);\n\n  const handleGenerateInvitation = useCallback(async (workerId) => {\n    if (!selectedWorkspace?.facilityId) {\n      showError(t('operations.facilityRequired', 'Facility is required'));\n      return;\n    }\n\n    if (!formData.workerType || formData.workerType === 'none') {\n      setFieldErrors({ workerType: t('operations.workerTypeRequired', 'Role type is required') });\n      showError(t('operations.workerTypeRequired', 'Role type is required'));\n      return;\n    }\n\n    if (formData.workerType === 'other' && !formData.workerTypeOther?.trim()) {\n      setFieldErrors({ workerTypeOther: t('operations.workerTypeOtherRequired', 'Role type name is required') });\n      showError(t('operations.workerTypeOtherRequired', 'Role type name is required'));\n      return;\n    }\n\n    setGeneratingInvitation(prev => ({ ...prev, [workerId]: true }));\n    try {\n      const currentRequirements = get(profileData, 'operationalSettings.workerRequirements') || [];\n      let roleId;\n      \n      if (editingRole) {\n        roleId = editingRole.id;\n      } else {\n        roleId = Date.now().toString();\n      }\n\n      const result = await generateFacilityRoleInvitation(\n        selectedWorkspace.facilityId,\n        roleId,\n        formData.workerType,\n        formData.workerTypeOther,\n        workerId\n      );\n\n      if (result.success) {\n        const baseUrl = window.location.origin;\n        const link = `${baseUrl}/invite/${result.invitationToken}`;\n        setWorkerInvitations(prev => ({\n          ...prev,\n          [workerId]: {\n            link,\n            token: result.invitationToken\n          }\n        }));\n        showSuccess(t('operations.invitationGenerated', 'Invitation link generated successfully'));\n      } else {\n        showError(result.error || t('operations.invitationGenerationFailed', 'Failed to generate invitation'));\n      }\n    } catch (error) {\n      console.error('Error generating invitation:', error);\n      showError(t('operations.invitationGenerationFailed', 'Failed to generate invitation'));\n    } finally {\n      setGeneratingInvitation(prev => ({ ...prev, [workerId]: false }));\n    }\n  }, [formData, profileData, selectedWorkspace, editingRole, t, showSuccess, showError]);\n\n  const handleCopyLink = useCallback((link) => {\n    navigator.clipboard.writeText(link);\n    showSuccess(t('common.linkCopied', 'Link copied to clipboard'));\n  }, [t, showSuccess]);\n\n  const handleShareEmail = useCallback((link) => {\n    const subject = encodeURIComponent(t('operations.invitationEmailSubject', 'Join our facility team'));\n    const body = encodeURIComponent(t('operations.invitationEmailBody', `You've been invited to join our facility team. Click the link to accept: ${link}`));\n    window.location.href = `mailto:?subject=${subject}&body=${body}`;\n  }, [t]);\n\n  const handleShareWhatsApp = useCallback((link) => {\n    const text = encodeURIComponent(t('operations.invitationWhatsAppMessage', `You've been invited to join our facility team. Click here: ${link}`));\n    window.open(`https://wa.me/?text=${text}`, '_blank');\n  }, [t]);\n\n  const handleSave = useCallback(() => {\n    if (!validateWorkers()) {\n      return;\n    }\n    \n    const currentRequirements = get(profileData, 'operationalSettings.workerRequirements') || [];\n    let updated;\n    \n    if (editingRole) {\n      updated = currentRequirements.map(req => \n        req.id === editingRole.id \n          ? { ...req, ...formData }\n          : req\n      );\n    } else {\n      const existingRoleIndex = currentRequirements.findIndex(role => {\n        if (formData.workerType === 'other') {\n          return role.workerType === 'other' && \n                 role.workerTypeOther === formData.workerTypeOther &&\n                 formData.workerTypeOther?.trim() !== '';\n        }\n        return role.workerType === formData.workerType && role.workerType !== 'other';\n      });\n\n      if (existingRoleIndex >= 0) {\n        updated = currentRequirements.map((req, index) => \n          index === existingRoleIndex\n            ? { \n                ...req, \n                ...formData\n              }\n            : req\n        );\n      } else {\n        const newRequirement = {\n          id: Date.now().toString(),\n          ...formData\n        };\n        updated = [...currentRequirements, newRequirement];\n      }\n    }\n    \n    onSave(updated);\n    onClose();\n    setFormData({\n      workerType: 'none',\n      workerTypeOther: '',\n      assignedWorkers: [],\n      appliesToAllDays: false,\n      specificDays: []\n    });\n    setShowWorkerSelect(null);\n    setWorkerErrors({});\n    setWorkerInvitations({});\n  }, [formData, profileData, onSave, onClose, editingRole, validateWorkers]);\n\n  const handleDelete = useCallback(() => {\n    if (onDelete && editingRole) {\n      const currentRequirements = get(profileData, 'operationalSettings.workerRequirements') || [];\n      const updated = currentRequirements.filter(req => req.id !== editingRole.id);\n      onDelete(updated);\n      setShowDeleteConfirm(false);\n      onClose();\n    }\n  }, [onDelete, editingRole, profileData, onClose]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\"\n      onClick={(e) => {\n        if (e.target === e.currentTarget) {\n          onClose();\n        }\n      }}\n    >\n      <div \n        className=\"bg-card rounded-xl shadow-xl max-w-[448px] w-full max-h-[600px] min-h-[600px] flex flex-col\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div \n          className=\"p-6 border-b border-border flex items-center justify-between rounded-t-xl transition-colors shrink-0\"\n          style={{ \n            backgroundColor: selectedHeaderColor || 'transparent',\n            borderBottomColor: selectedHeaderColor ? 'rgba(255, 255, 255, 0.2)' : undefined\n          }}\n        >\n          <h3 \n            className=\"text-xl font-semibold transition-colors\"\n            style={{ color: selectedHeaderColor ? '#ffffff' : undefined }}\n          >\n            {editingRole ? t('operations.editWorkerRequirement', 'Edit Facility Role') : t('operations.addWorkerRequirement')}\n          </h3>\n          <div className=\"flex items-center gap-2\">\n            {editingRole && onDelete && (\n              <button\n                onClick={() => setShowDeleteConfirm(true)}\n                className=\"p-2 hover:bg-destructive/10 rounded-lg transition-colors\"\n                style={{ \n                  color: selectedHeaderColor ? '#ffffff' : undefined,\n                  backgroundColor: selectedHeaderColor ? 'rgba(255, 255, 255, 0.1)' : undefined\n                }}\n                onMouseEnter={(e) => {\n                  if (selectedHeaderColor) {\n                    e.currentTarget.style.backgroundColor = 'rgba(239, 68, 68, 0.3)';\n                  }\n                }}\n                onMouseLeave={(e) => {\n                  if (selectedHeaderColor) {\n                    e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';\n                  }\n                }}\n                aria-label=\"Delete\"\n              >\n                <FiTrash2 className=\"w-5 h-5\" />\n              </button>\n            )}\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-muted rounded-lg transition-colors\"\n              style={{ \n                color: selectedHeaderColor ? '#ffffff' : undefined,\n                backgroundColor: selectedHeaderColor ? 'rgba(255, 255, 255, 0.1)' : undefined\n              }}\n              onMouseEnter={(e) => {\n                if (selectedHeaderColor) {\n                  e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';\n                }\n              }}\n              onMouseLeave={(e) => {\n                if (selectedHeaderColor) {\n                  e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';\n                }\n              }}\n              aria-label=\"Close\"\n            >\n              <FiX className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        <div className=\"p-6 space-y-6 flex-1 overflow-y-auto\">\n            <div className=\"mb-4\">\n              <DropdownField\n                label={t('operations.workerType', 'Role Type')}\n                options={getWorkerTypeOptions()}\n                value={formData.workerType}\n                onChange={(value) => handleUpdateField('workerType', value)}\n                placeholder={t('operations.selectWorkerType')}\n                required={true}\n                error={fieldErrors.workerType}\n              />\n            </div>\n\n            {formData.workerType === 'other' && (\n              <div className=\"mb-4\">\n                <InputField\n                  label={t('operations.workerTypeOther')}\n                  type=\"text\"\n                  value={formData.workerTypeOther || ''}\n                  onChange={(e) => handleUpdateField('workerTypeOther', e.target.value)}\n                  placeholder={t('operations.workerTypeOtherPlaceholder')}\n                  required={true}\n                  error={fieldErrors.workerTypeOther}\n                />\n              </div>\n            )}\n\n            {formData.workerType && formData.workerType !== 'none' && (\n            <div className=\"mb-4\">\n              {(() => {\n                const allWorkers = formData.assignedWorkers || [];\n                const assignedWorkers = allWorkers.filter(worker => worker.workerId || worker.placeholderName);\n                const newWorkers = allWorkers.filter(worker => !worker.workerId && !worker.placeholderName && showWorkerSelect === worker.id);\n                \n                return (\n                  <>\n                    {assignedWorkers.length > 0 && (\n                      <div className=\"space-y-2 mb-4\">\n                        {assignedWorkers.map((worker) => {\n                const workerName = worker.workerId && worker.workerId !== 'placeholder'\n                  ? (() => {\n                      const member = teamMembers.find(m => m.uid === worker.workerId);\n                      return member ? `${member.firstName} ${member.lastName}`.trim() : 'Unknown';\n                    })()\n                  : worker.placeholderName || t('operations.placeholder', 'Placeholder');\n                \n                const allExistingRoles = get(profileData, 'operationalSettings.workerRequirements') || [];\n                const otherRoles = editingRole \n                  ? allExistingRoles.filter(r => r.id !== editingRole.id)\n                  : allExistingRoles;\n                \n                const assignedWorkerIdsFromOtherRoles = new Set(\n                  otherRoles.flatMap(role => \n                    (role.assignedWorkers || [])\n                      .filter(w => \n                        w.workerId && \n                        w.workerId !== '' && \n                        w.workerId !== 'placeholder'\n                      )\n                      .map(w => String(w.workerId))\n                  )\n                );\n                \n                const assignedWorkerIdsFromCurrentForm = new Set(\n                  (formData.assignedWorkers || [])\n                    .filter(w => \n                      w.id !== worker.id && \n                      w.workerId && \n                      w.workerId !== '' && \n                      w.workerId !== 'placeholder'\n                    )\n                    .map(w => String(w.workerId))\n                );\n                \n                const allAssignedWorkerIds = new Set([\n                  ...assignedWorkerIdsFromOtherRoles,\n                  ...assignedWorkerIdsFromCurrentForm\n                ]);\n                \n                const currentWorkerId = worker.workerId && worker.workerId !== 'placeholder' ? String(worker.workerId) : null;\n                \n                const availableTeamMembers = (teamMembers || []).filter(m => {\n                  if (!m || !m.uid) return false;\n                  const memberId = String(m.uid);\n                  const isAssigned = allAssignedWorkerIds.has(memberId);\n                  const isCurrent = memberId === currentWorkerId;\n                  return !isAssigned || isCurrent;\n                });\n                \n                return (\n                  <div key={worker.id} className=\"space-y-2\">\n                    <div \n                      className=\"flex items-center gap-3 p-3 border border-border rounded-lg bg-card/50\"\n                    >\n                      <ColorPicker\n                        color={worker.color}\n                        color1={worker.color1}\n                        onChange={(color, color1) => handleUpdateWorker(worker.id, 'color', color)}\n                        size={32}\n                      />\n                      <div className=\"flex-1\">\n                        {showWorkerSelect === worker.id || (!worker.workerId && !worker.placeholderName) ? (\n                          <div className=\"space-y-2\">\n                            <DropdownField\n                              key={`${worker.id}-${allAssignedWorkerIds.size}-${availableTeamMembers.length}`}\n                              label={t('operations.selectWorkerOrPlaceholder', 'Select Worker or Placeholder')}\n                              options={[\n                                { value: '', label: t('operations.selectWorkerOrPlaceholder', 'Select Worker or Placeholder') },\n                                ...availableTeamMembers.map(m => ({\n                                  value: m.uid,\n                                  label: `${m.firstName} ${m.lastName}`.trim() || 'Unknown'\n                                })),\n                                { value: 'placeholder', label: t('operations.usePlaceholderName', 'Enter Placeholder Name') }\n                              ]}\n                              value={worker.workerId === 'placeholder' ? 'placeholder' : (worker.workerId || '')}\n                              onChange={(value) => {\n                                if (value === 'placeholder') {\n                                  handleUpdateWorker(worker.id, 'workerId', 'placeholder');\n                                  handleUpdateWorker(worker.id, 'placeholderName', '');\n                                  setShowWorkerSelect(worker.id);\n                                } else if (value) {\n                                  handleUpdateWorker(worker.id, 'workerId', value);\n                                  handleUpdateWorker(worker.id, 'placeholderName', '');\n                                  setShowWorkerSelect(null);\n                                } else {\n                                  handleUpdateWorker(worker.id, 'workerId', '');\n                                  handleUpdateWorker(worker.id, 'placeholderName', '');\n                                  setShowWorkerSelect(null);\n                                }\n                              }}\n                              required={true}\n                              error={workerErrors[`${worker.id}_workerId`]}\n                            />\n                            {worker.workerId === 'placeholder' && (\n                              <InputField\n                                label={t('operations.placeholderName', 'Placeholder Name')}\n                                type=\"text\"\n                                value={worker.placeholderName || ''}\n                                onChange={(e) => {\n                                  handleUpdateWorker(worker.id, 'placeholderName', e.target.value);\n                                }}\n                                placeholder={t('operations.placeholderNamePlaceholder', 'Enter name')}\n                                required={true}\n                                error={workerErrors[`${worker.id}_placeholderName`]}\n                              />\n                            )}\n                          </div>\n                        ) : (\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-sm font-medium\">{workerName}</span>\n                            <button\n                              type=\"button\"\n                              onClick={() => setShowWorkerSelect(worker.id)}\n                              className=\"p-1 text-muted-foreground hover:bg-muted rounded transition-colors text-xs\"\n                            >\n                              {t('common.edit', 'Edit')}\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {(!worker.workerId || worker.workerId === 'placeholder') && (\n                          <button\n                            type=\"button\"\n                            onClick={() => handleGenerateInvitation(worker.id)}\n                            disabled={generatingInvitation[worker.id] || !formData.workerType || formData.workerType === 'none' || (formData.workerType === 'other' && !formData.workerTypeOther?.trim())}\n                            className=\"p-1 text-primary hover:bg-primary/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                            title={(!formData.workerType || formData.workerType === 'none') ? t('operations.workerTypeRequired', 'Role type is required') : generatingInvitation[worker.id] ? t('operations.generatingInvitation', 'Generating...') : t('operations.generateInvitationLink', 'Generate Invitation Link')}\n                          >\n                            {generatingInvitation[worker.id] ? (\n                              <FiLoader size={16} className=\"animate-spin\" />\n                            ) : (\n                              <FiShare2 size={16} />\n                            )}\n                          </button>\n                        )}\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveWorker(worker.id)}\n                          className=\"p-1 text-destructive hover:bg-destructive/10 rounded transition-colors\"\n                        >\n                          <FiTrash2 size={16} />\n                        </button>\n                      </div>\n                    </div>\n                    {workerInvitations[worker.id] && (\n                      <div className=\"p-3 border border-border rounded-lg bg-card/50 space-y-2\">\n                        <div className=\"flex items-center justify-between\">\n                          <h5 className=\"text-xs font-semibold\">{t('operations.sendInvitation', 'Send Invitation')}</h5>\n                          <button\n                            onClick={() => setWorkerInvitations(prev => {\n                              const next = { ...prev };\n                              delete next[worker.id];\n                              return next;\n                            })}\n                            className=\"p-1 text-muted-foreground hover:text-foreground\"\n                          >\n                            <FiX size={12} />\n                          </button>\n                        </div>\n                        <div className=\"flex flex-col items-center gap-2\">\n                          <div className=\"p-2 bg-white rounded-lg\">\n                            <QRCodeSVG value={workerInvitations[worker.id].link} size={120} />\n                          </div>\n                          <InputField\n                            type=\"text\"\n                            value={workerInvitations[worker.id].link}\n                            readOnly\n                            className=\"w-full text-xs\"\n                          />\n                          <div className=\"flex gap-2 w-full\">\n                            <Button\n                              onClick={() => handleCopyLink(workerInvitations[worker.id].link)}\n                              variant=\"secondary\"\n                              className=\"flex-1 text-xs py-1\"\n                            >\n                              <FiCopy size={12} className=\"mr-1\" />\n                              {t('common.copy', 'Copy')}\n                            </Button>\n                            <Button\n                              onClick={() => handleShareEmail(workerInvitations[worker.id].link)}\n                              variant=\"secondary\"\n                              className=\"flex-1 text-xs py-1\"\n                            >\n                              <FiMail size={12} className=\"mr-1\" />\n                              {t('operations.shareEmail', 'Email')}\n                            </Button>\n                            <Button\n                              onClick={() => handleShareWhatsApp(workerInvitations[worker.id].link)}\n                              variant=\"secondary\"\n                              className=\"flex-1 text-xs py-1\"\n                            >\n                              <FaWhatsapp size={12} className=\"mr-1\" />\n                              {t('operations.shareWhatsApp', 'WhatsApp')}\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n                        })}\n                      </div>\n                    )}\n                    \n                    {assignedWorkers.length > 0 && (\n                      <div className=\"my-4 border-t border-border\"></div>\n                    )}\n                    \n                    <div className=\"space-y-2\">\n                      {assignedWorkers.length === 0 && (!formData.assignedWorkers || formData.assignedWorkers.length === 0 || (formData.assignedWorkers.every(w => !w.workerId && !w.placeholderName) && !showWorkerSelect)) && (\n                        <div>\n                          <p className=\"text-xs text-muted-foreground text-center py-2\">\n                            {t('operations.noWorkersAssigned', 'No workers assigned. Click \"Add Worker\" to assign.')}\n                          </p>\n                          {workerErrors._general && (\n                            <p className=\"text-xs text-destructive text-center py-1\">\n                              {workerErrors._general}\n                            </p>\n                          )}\n                        </div>\n                      )}\n                      \n                      {newWorkers.map((worker) => {\n                const allExistingRoles = get(profileData, 'operationalSettings.workerRequirements') || [];\n                const otherRoles = editingRole \n                  ? allExistingRoles.filter(r => r.id !== editingRole.id)\n                  : allExistingRoles;\n                \n                const assignedWorkerIdsFromOtherRoles = new Set(\n                  otherRoles.flatMap(role => \n                    (role.assignedWorkers || [])\n                      .filter(w => \n                        w.workerId && \n                        w.workerId !== '' && \n                        w.workerId !== 'placeholder'\n                      )\n                      .map(w => String(w.workerId))\n                  )\n                );\n                \n                const assignedWorkerIdsFromCurrentForm = new Set(\n                  (formData.assignedWorkers || [])\n                    .filter(w => \n                      w.id !== worker.id && \n                      w.workerId && \n                      w.workerId !== '' && \n                      w.workerId !== 'placeholder'\n                    )\n                    .map(w => String(w.workerId))\n                );\n                \n                const allAssignedWorkerIds = new Set([\n                  ...assignedWorkerIdsFromOtherRoles,\n                  ...assignedWorkerIdsFromCurrentForm\n                ]);\n                \n                const currentWorkerId = worker.workerId && worker.workerId !== 'placeholder' ? String(worker.workerId) : null;\n                \n                const availableTeamMembers = (teamMembers || []).filter(m => {\n                  if (!m || !m.uid) return false;\n                  const memberId = String(m.uid);\n                  const isAssigned = allAssignedWorkerIds.has(memberId);\n                  const isCurrent = memberId === currentWorkerId;\n                  return !isAssigned || isCurrent;\n                });\n                \n                return (\n                  <div key={worker.id} className=\"space-y-2\">\n                    <div \n                      className=\"flex items-center gap-3 p-3 border border-border rounded-lg bg-card/50\"\n                    >\n                      <ColorPicker\n                        color={worker.color}\n                        color1={worker.color1}\n                        onChange={(color, color1) => handleUpdateWorker(worker.id, 'color', color)}\n                        size={32}\n                      />\n                      <div className=\"flex-1\">\n                        <div className=\"space-y-2\">\n                          <DropdownField\n                            key={`${worker.id}-${allAssignedWorkerIds.size}-${availableTeamMembers.length}`}\n                            label={t('operations.selectWorkerOrPlaceholder', 'Select Worker or Placeholder')}\n                            options={[\n                              { value: '', label: t('operations.selectWorkerOrPlaceholder', 'Select Worker or Placeholder') },\n                              ...availableTeamMembers.map(m => ({\n                                value: m.uid,\n                                label: `${m.firstName} ${m.lastName}`.trim() || 'Unknown'\n                              })),\n                              { value: 'placeholder', label: t('operations.usePlaceholderName', 'Enter Placeholder Name') }\n                            ]}\n                            value={worker.workerId === 'placeholder' ? 'placeholder' : (worker.workerId || '')}\n                            onChange={(value) => {\n                              if (value === 'placeholder') {\n                                handleUpdateWorker(worker.id, 'workerId', 'placeholder');\n                                handleUpdateWorker(worker.id, 'placeholderName', '');\n                                setShowWorkerSelect(worker.id);\n                              } else if (value) {\n                                handleUpdateWorker(worker.id, 'workerId', value);\n                                handleUpdateWorker(worker.id, 'placeholderName', '');\n                                setShowWorkerSelect(null);\n                              } else {\n                                handleRemoveWorker(worker.id);\n                              }\n                            }}\n                            required={true}\n                            error={workerErrors[`${worker.id}_workerId`]}\n                          />\n                          {worker.workerId === 'placeholder' && (\n                            <InputField\n                              label={t('operations.placeholderName', 'Placeholder Name')}\n                              type=\"text\"\n                              value={worker.placeholderName || ''}\n                              onChange={(e) => {\n                                handleUpdateWorker(worker.id, 'placeholderName', e.target.value);\n                              }}\n                              placeholder={t('operations.placeholderNamePlaceholder', 'Enter name')}\n                              required={true}\n                              error={workerErrors[`${worker.id}_placeholderName`]}\n                            />\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <button\n                          type=\"button\"\n                          onClick={() => handleGenerateInvitation(worker.id)}\n                          disabled={generatingInvitation[worker.id] || !formData.workerType || formData.workerType === 'none' || (formData.workerType === 'other' && !formData.workerTypeOther?.trim())}\n                          className=\"p-1 text-primary hover:bg-primary/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                          title={(!formData.workerType || formData.workerType === 'none') ? t('operations.workerTypeRequired', 'Role type is required') : generatingInvitation[worker.id] ? t('operations.generatingInvitation', 'Generating...') : t('operations.generateInvitationLink', 'Generate Invitation Link')}\n                        >\n                          {generatingInvitation[worker.id] ? (\n                            <FiLoader size={16} className=\"animate-spin\" />\n                          ) : (\n                            <FiShare2 size={16} />\n                          )}\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveWorker(worker.id)}\n                          className=\"p-1 text-destructive hover:bg-destructive/10 rounded transition-colors\"\n                        >\n                          <FiTrash2 size={16} />\n                        </button>\n                      </div>\n                    </div>\n                    {workerInvitations[worker.id] && (\n                      <div className=\"p-3 border border-border rounded-lg bg-card/50 space-y-2\">\n                        <div className=\"flex items-center justify-between\">\n                          <h5 className=\"text-xs font-semibold\">{t('operations.sendInvitation', 'Send Invitation')}</h5>\n                          <button\n                            onClick={() => setWorkerInvitations(prev => {\n                              const next = { ...prev };\n                              delete next[worker.id];\n                              return next;\n                            })}\n                            className=\"p-1 text-muted-foreground hover:text-foreground\"\n                          >\n                            <FiX size={12} />\n                          </button>\n                        </div>\n                        <div className=\"flex flex-col items-center gap-2\">\n                          <div className=\"p-2 bg-white rounded-lg\">\n                            <QRCodeSVG value={workerInvitations[worker.id].link} size={120} />\n                          </div>\n                          <InputField\n                            type=\"text\"\n                            value={workerInvitations[worker.id].link}\n                            readOnly\n                            className=\"w-full text-xs\"\n                          />\n                          <div className=\"flex gap-2 w-full\">\n                            <Button\n                              onClick={() => handleCopyLink(workerInvitations[worker.id].link)}\n                              variant=\"secondary\"\n                              className=\"flex-1 text-xs py-1\"\n                            >\n                              <FiCopy size={12} className=\"mr-1\" />\n                              {t('common.copy', 'Copy')}\n                            </Button>\n                            <Button\n                              onClick={() => handleShareEmail(workerInvitations[worker.id].link)}\n                              variant=\"secondary\"\n                              className=\"flex-1 text-xs py-1\"\n                            >\n                              <FiMail size={12} className=\"mr-1\" />\n                              {t('operations.shareEmail', 'Email')}\n                            </Button>\n                            <Button\n                              onClick={() => handleShareWhatsApp(workerInvitations[worker.id].link)}\n                              variant=\"secondary\"\n                              className=\"flex-1 text-xs py-1\"\n                            >\n                              <FaWhatsapp size={12} className=\"mr-1\" />\n                              {t('operations.shareWhatsApp', 'WhatsApp')}\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n                      })}\n                      \n                      <div className=\"mt-3\">\n                        <Button\n                          onClick={handleAddWorker}\n                          variant=\"secondary\"\n                          className=\"text-xs py-1 px-2\"\n                        >\n                          <FiPlus className=\"w-3 h-3 mr-1\" />\n                          {t('operations.addWorker', 'Add Worker')}\n                        </Button>\n                      </div>\n                    </div>\n                  </>\n                );\n              })()}\n            </div>\n            )}\n        </div>\n\n        <div className=\"p-6 border-t border-border flex gap-3 justify-end shrink-0 bg-card rounded-b-xl\">\n          <Button \n            onClick={onClose} \n            variant=\"secondary\"\n            className=\"px-6 py-2.5 bg-white border-2 border-border text-foreground hover:bg-muted\"\n          >\n            {t('common.cancel', 'Cancel')}\n          </Button>\n          <Button \n            onClick={handleSave} \n            variant=\"confirmation\"\n            className=\"px-6 py-2.5\"\n          >\n            {t('common.save', 'Save')}\n          </Button>\n        </div>\n      </div>\n\n      {showDeleteConfirm && (\n        <div\n          className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-in fade-in duration-200\"\n          style={{\n            backgroundColor: 'rgba(0, 0, 0, 0.6)',\n            backdropFilter: 'blur(4px)'\n          }}\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowDeleteConfirm(false);\n            }\n          }}\n        >\n          <div\n            className=\"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border overflow-hidden flex flex-col transform transition-all duration-200 scale-100 animate-in zoom-in-95\"\n            onClick={(e) => e.stopPropagation()}\n            style={{\n              backgroundColor: 'var(--background-div-color)',\n              borderColor: 'var(--grey-2)',\n              boxShadow: 'var(--box-shadow-md)'\n            }}\n          >\n            <div\n              className=\"flex items-center justify-between px-6 py-5 border-b\"\n              style={{\n                borderBottomColor: 'var(--red-2)',\n                backgroundColor: 'var(--red-1)'\n              }}\n            >\n              <div className=\"flex items-center gap-3\">\n                <div\n                  className=\"p-2 rounded-full\"\n                  style={{\n                    backgroundColor: 'var(--white)',\n                    color: 'var(--red-4)'\n                  }}\n                >\n                  <FiAlertTriangle size={24} />\n                </div>\n                <h3\n                  className=\"text-xl font-semibold tracking-tight\"\n                  style={{\n                    color: 'var(--red-4)',\n                    fontFamily: 'var(--font-family-headings)',\n                    fontSize: 'var(--font-size-large)'\n                  }}\n                >\n                  {t('common:deleteConfirmation.title', 'Delete Facility Role')}\n                </h3>\n              </div>\n              <button\n                onClick={() => setShowDeleteConfirm(false)}\n                className=\"p-2 rounded-full transition-colors hover:bg-black/5\"\n                style={{\n                  color: 'var(--red-4)'\n                }}\n                aria-label=\"Close\"\n              >\n                <FiX size={20} />\n              </button>\n            </div>\n\n            <div\n              className=\"p-6 flex-1\"\n              style={{\n                color: 'var(--text-color)',\n                fontFamily: 'var(--font-family-text)',\n                fontSize: 'var(--font-size-medium)',\n                lineHeight: '1.6'\n              }}\n            >\n              <p style={{ marginBottom: 'var(--spacing-md)' }}>\n                {t('common:deleteConfirmation.message', 'Are you sure you want to delete this facility role? This action cannot be undone.')}\n              </p>\n            </div>\n\n            <div\n              className=\"px-6 py-4 border-t flex justify-end gap-3\"\n              style={{\n                borderTopColor: 'var(--grey-2)',\n                backgroundColor: 'var(--grey-1-light)'\n              }}\n            >\n              <button\n                onClick={() => setShowDeleteConfirm(false)}\n                className=\"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors\"\n              >\n                {t('common:deleteConfirmation.cancel', 'Cancel')}\n              </button>\n              <button\n                onClick={handleDelete}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-destructive hover:bg-destructive/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95\"\n              >\n                {t('common:deleteConfirmation.delete', 'Delete')}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n    </div>\n  );\n};\n\nexport default AddFacilityRoleModal;\n\n","import React, { useMemo, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { getWeekDates, isSameDay } from '../utils/dateHelpers';\nimport { cn } from '../../../../utils/cn';\nimport { useTranslation } from 'react-i18next';\nimport { FiSettings, FiPlus } from 'react-icons/fi';\nimport { get } from 'lodash';\nimport AddFacilityRoleModal from './AddFacilityRoleModal';\nimport { useDashboard } from '../../../contexts/DashboardContext';\nimport { db } from '../../../../services/firebase';\nimport { doc, getDoc } from 'firebase/firestore';\n\nconst ResourceGrid = ({\n    currentDate,\n    events,\n    employees,\n    onEventClick,\n    onCreateEvent,\n    view = 'week',\n    onDateClick,\n    onEventMove,\n    profileData,\n    onUpdateProfileData,\n    isLoadingProfile = false\n}) => {\n    const { t } = useTranslation(['calendar', 'dashboard', 'dashboardProfile']);\n    const navigate = useNavigate();\n    const { selectedWorkspace } = useDashboard();\n    const [showAddRoleModal, setShowAddRoleModal] = useState(false);\n    const [editingRole, setEditingRole] = useState(null);\n    const [teamMembers, setTeamMembers] = useState([]);\n\n    // Generate dates based on view\n    const dates = useMemo(() => {\n        if (view === 'day') {\n            return [currentDate];\n        }\n        return getWeekDates(currentDate);\n    }, [currentDate, view]);\n\n    // Debug View State\n    // console.log('ResourceGrid Render:', { view, currentDate, datesLength: dates.length });\n\n    // Group events by employee and date for efficient rendering\n    const eventsByEmployee = useMemo(() => {\n        const grouped = {};\n        if (!events) return grouped;\n\n        events.forEach(event => {\n            // Find which employee this event belongs to\n            // Logic: Check if event.workerId or event.employees (array) matches\n            // For now assume event.workerId matches employee.id or event.employeeId\n            const workerId = event.workerId || event.employeeId || event.userId;\n\n            if (workerId) {\n                if (!grouped[workerId]) {\n                    grouped[workerId] = [];\n                }\n                grouped[workerId].push(event);\n            } else if (event.employees && Array.isArray(event.employees)) {\n                // Handle array of employees if applicable\n                event.employees.forEach(empId => {\n                    if (!grouped[empId]) grouped[empId] = [];\n                    grouped[empId].push(event);\n                });\n            }\n        });\n        return grouped;\n    }, [events]);\n\n    const handleCellClick = (employee, date) => {\n        // Create a new event for this employee on this date\n        // Set time to default (e.g., 9 AM - 5 PM) or just the date\n        const start = new Date(date);\n        start.setHours(9, 0, 0, 0);\n        const end = new Date(date);\n        end.setHours(17, 0, 0, 0);\n\n        const newEvent = {\n            id: `temp-${Date.now()}`,\n            start,\n            end,\n            workerId: employee.id,\n            employeeName: `${employee.firstName} ${employee.lastName}`,\n            title: 'New Assignment',\n            // Pre-fill role/color based on employee if needed\n        };\n        onCreateEvent(newEvent, true);\n    };\n\n    const facilityRoles = useMemo(() => {\n        if (!profileData) return [];\n        return get(profileData, 'operationalSettings.workerRequirements') || [];\n    }, [profileData]);\n\n    const expandedFacilityRoles = useMemo(() => {\n        const expanded = [];\n        facilityRoles.forEach(role => {\n            const assignedWorkers = role.assignedWorkers || [];\n            if (assignedWorkers.length === 0) {\n                const defaultColor = { color: '#cbd5e1', color1: '#e2e8f0' };\n                expanded.push({\n                    ...role,\n                    worker: null,\n                    color: defaultColor.color,\n                    color1: defaultColor.color1,\n                    rowIndex: 0,\n                    uniqueKey: `${role.id}-0`\n                });\n            } else {\n                assignedWorkers.forEach((worker, index) => {\n                    expanded.push({\n                        ...role,\n                        worker: worker,\n                        color: worker.color || role.color || '#cbd5e1',\n                        color1: worker.color1 || role.color1 || '#e2e8f0',\n                        rowIndex: index,\n                        uniqueKey: `${role.id}-${worker.id || index}`\n                    });\n                });\n            }\n        });\n        return expanded;\n    }, [facilityRoles]);\n\n    // Determine if we should show loading or empty state\n    // Only show empty state if profileData has been fully loaded with operationalSettings\n    // This prevents flickering when profileData is initially an empty object {}\n    const hasOperationalSettings = profileData && typeof profileData === 'object' && 'operationalSettings' in profileData;\n    const hasLoadedData = hasOperationalSettings || (profileData !== null && profileData !== undefined && !isLoadingProfile && Object.keys(profileData).length > 0);\n    const shouldShowEmptyState = hasLoadedData && !isLoadingProfile && facilityRoles.length === 0;\n    const shouldShowLoading = isLoadingProfile || !hasLoadedData || (profileData !== null && !hasOperationalSettings && Object.keys(profileData || {}).length === 0);\n\n    useEffect(() => {\n        const fetchTeamMembers = async () => {\n            if (!selectedWorkspace?.facilityId) return;\n            \n            try {\n                const facilityRef = doc(db, 'facilityProfiles', selectedWorkspace.facilityId);\n                const facilitySnap = await getDoc(facilityRef);\n                \n                if (facilitySnap.exists()) {\n                    const facilityData = facilitySnap.data();\n                    const employeesList = facilityData.employees || [];\n                    const admins = employeesList.filter(emp => emp.rights === 'admin').map(emp => emp.uid);\n                    const employees = employeesList.filter(emp => emp.rights !== 'admin').map(emp => emp.uid);\n                    const allMemberIds = [...new Set([...admins, ...employees])];\n                    \n                    const memberPromises = allMemberIds.map(async (userId) => {\n                        try {\n                            const professionalProfileRef = doc(db, 'professionalProfiles', userId);\n                            const professionalProfileSnap = await getDoc(professionalProfileRef);\n                            \n                            if (professionalProfileSnap.exists()) {\n                                const professionalData = professionalProfileSnap.data();\n                                const identity = professionalData.identity || {};\n                                const firstName = identity.legalFirstName || identity.firstName || '';\n                                const lastName = identity.legalLastName || identity.lastName || '';\n                                \n                                return {\n                                    uid: userId,\n                                    id: userId,\n                                    firstName: firstName,\n                                    lastName: lastName,\n                                    email: professionalData.contact?.primaryEmail || ''\n                                };\n                            } else {\n                                const userRef = doc(db, 'users', userId);\n                                const userSnap = await getDoc(userRef);\n                                \n                                if (userSnap.exists()) {\n                                    const userData = userSnap.data();\n                                    return {\n                                        uid: userId,\n                                        id: userId,\n                                        firstName: userData.firstName || '',\n                                        lastName: userData.lastName || '',\n                                        email: userData.email || ''\n                                    };\n                                }\n                            }\n                        } catch (error) {\n                            console.error(`Error fetching profile for user ${userId}:`, error);\n                        }\n                        return null;\n                    });\n                    \n                    const members = (await Promise.all(memberPromises)).filter(m => m !== null);\n                    setTeamMembers(members);\n                }\n            } catch (error) {\n                console.error('Error fetching team members:', error);\n            }\n        };\n        \n        fetchTeamMembers();\n    }, [selectedWorkspace?.facilityId]);\n\n    const getWorkerTypeLabel = (workerType, workerTypeOther) => {\n        if (workerType === 'other' && workerTypeOther) {\n            return workerTypeOther;\n        }\n        const workerTypeMap = {\n            'pharmacist': t('dashboardProfile:operations.workerTypes.pharmacist'),\n            'cashier': t('dashboardProfile:operations.workerTypes.cashier'),\n            'assistant': t('dashboardProfile:operations.workerTypes.assistant'),\n            'pharmacy_technician': t('dashboardProfile:operations.workerTypes.pharmacyTechnician'),\n            'other': t('dashboardProfile:operations.workerTypes.other')\n        };\n        return workerTypeMap[workerType] || workerType;\n    };\n\n    const getWorkerName = (workerId) => {\n        if (!workerId || workerId === 'placeholder') return null;\n        \n        const teamMember = teamMembers.find(m => m.uid === workerId || m.id === workerId);\n        if (teamMember) {\n            return `${teamMember.firstName} ${teamMember.lastName}`.trim();\n        }\n        \n        const employee = employees?.find(e => e.id === workerId);\n        if (employee) {\n            return `${employee.firstName} ${employee.lastName}`.trim();\n        }\n        \n        return null;\n    };\n\n    const handleSaveRole = async (updatedRequirements) => {\n        if (onUpdateProfileData) {\n            const updatedData = {\n                ...profileData,\n                operationalSettings: {\n                    ...get(profileData, 'operationalSettings', {}),\n                    workerRequirements: updatedRequirements\n                }\n            };\n            await onUpdateProfileData(updatedData, { forceRefresh: true });\n        }\n    };\n\n    const handleDeleteRole = async (updatedRequirements) => {\n        if (onUpdateProfileData) {\n            const updatedData = {\n                ...profileData,\n                operationalSettings: {\n                    ...get(profileData, 'operationalSettings', {}),\n                    workerRequirements: updatedRequirements\n                }\n            };\n            await onUpdateProfileData(updatedData, { forceRefresh: true });\n        }\n    };\n\n    return (\n        <div className=\"flex flex-1 overflow-hidden h-full bg-background border rounded-lg shadow-sm\" style={{ minHeight: '600px' }}>\n            {/* Sidebar: Facility Roles List */}\n            <div className=\"w-56 flex-shrink-0 border-r border-border bg-card z-10 flex flex-col\">\n                {/* Header Spacer - Clickable for Organization Settings */}\n                <button\n                    className=\"h-20 border-b border-border flex items-center justify-center gap-2 px-4 bg-muted/30 w-full hover:bg-muted/50 transition-colors group\"\n                    onClick={() => navigate('/dashboard/organization?tab=organigram')}\n                    title={t('dashboard:dashboard.sidebar.organization')}\n                >\n                    <FiSettings className=\"w-4 h-4 text-muted-foreground group-hover:text-primary transition-all duration-300 group-hover:rotate-90 group-hover:scale-110\" />\n                    <span className=\"text-xs font-semibold text-muted-foreground group-hover:text-foreground uppercase tracking-wider transition-colors\">\n                        {t('dashboardProfile:operations.facilityRolesTitle')}\n                    </span>\n                </button>\n\n                {/* Add Team Member Button */}\n                <button\n                    className=\"h-12 border-b border-border flex items-center justify-center gap-2 px-4 bg-primary/5 hover:bg-primary/10 w-full transition-colors group\"\n                    onClick={() => navigate('/dashboard/organization?tab=organigram')}\n                    title={t('dashboardProfile:operations.addTeamMember', 'Add Team Member')}\n                >\n                    <FiPlus className=\"w-4 h-4 text-primary group-hover:scale-110 transition-all\" />\n                    <span className=\"text-xs font-semibold text-primary\">\n                        {t('dashboardProfile:operations.addTeamMember', 'Add Team Member')}\n                    </span>\n                </button>\n\n                {/* Facility Roles Rows */}\n                <div className=\"flex-1 overflow-hidden overflow-y-auto custom-scrollbar\">\n                    {shouldShowLoading ? (\n                        <div className=\"flex items-center justify-center h-full min-h-[200px]\">\n                            <div className=\"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n                        </div>\n                    ) : (\n                        expandedFacilityRoles.map(role => (\n                            <div\n                                key={role.uniqueKey}\n                                className=\"h-16 border-b border-border flex items-center px-4 relative group hover:bg-muted/50 transition-colors cursor-pointer\"\n                                onClick={(e) => {\n                                    e.stopPropagation();\n                                    const originalRole = facilityRoles.find(r => r.id === role.id);\n                                    setEditingRole(originalRole);\n                                    setShowAddRoleModal(true);\n                                }}\n                            >\n                                {/* Color Strip */}\n                                <div\n                                    className=\"absolute left-0 top-0 bottom-0 w-1\"\n                                    style={{ backgroundColor: role.color || '#cbd5e1' }}\n                                />\n                                <div className=\"pl-2 overflow-hidden flex-1\">\n                                    <div className=\"font-medium text-sm truncate text-foreground\">\n                                        {role.worker?.workerId && role.worker.workerId !== 'placeholder'\n                                          ? getWorkerName(role.worker.workerId) || 'Unknown Worker'\n                                          : role.worker?.placeholderName || getWorkerTypeLabel(role.workerType, role.workerTypeOther)}\n                                    </div>\n                                    <div\n                                        className=\"text-xs truncate font-medium mt-0.5\"\n                                        style={{ color: role.color || '#94a3b8' }}\n                                    >\n                                        {getWorkerTypeLabel(role.workerType, role.workerTypeOther)}\n                                    </div>\n                                </div>\n                                {/* Settings Icon with Hover Animation */}\n                                <button\n                                    onClick={(e) => {\n                                        e.stopPropagation();\n                                        const originalRole = facilityRoles.find(r => r.id === role.id);\n                                        setEditingRole(originalRole);\n                                        setShowAddRoleModal(true);\n                                    }}\n                                    className=\"opacity-0 group-hover:opacity-100 transition-all duration-300 p-2 hover:bg-muted rounded-lg ml-2 flex-shrink-0\"\n                                    title={t('dashboardProfile:operations.editWorkerRequirement', 'Edit Facility Role')}\n                                >\n                                    <FiSettings className=\"w-4 h-4 text-muted-foreground group-hover:text-primary transition-all duration-300 group-hover:rotate-90 group-hover:scale-110\" />\n                                </button>\n                            </div>\n                        ))\n                    )}\n\n                    {/* Add Role Button */}\n                    <button\n                        onClick={() => {\n                            setEditingRole(null);\n                            setShowAddRoleModal(true);\n                        }}\n                        className=\"h-16 border-t border-border flex items-center justify-center gap-2 px-4 bg-muted/30 w-full hover:bg-muted/50 transition-colors group\"\n                    >\n                        <FiPlus className=\"w-4 h-4 text-muted-foreground group-hover:text-primary transition-all\" />\n                        <span className=\"text-xs font-semibold text-muted-foreground group-hover:text-foreground transition-colors\">\n                            {t('dashboardProfile:operations.addWorkerRequirement')}\n                        </span>\n                    </button>\n                </div>\n            </div>\n\n            {/* Main Grid: Days & Events */}\n            <div className=\"flex-1 overflow-auto custom-scrollbar\">\n                <div className=\"min-w-max\">\n                    {/* Header Row: Dates */}\n                    <div className=\"flex h-20 border-b border-border sticky top-0 bg-card z-10 shadow-sm\">\n                        {dates.map(date => {\n                            const isToday = isSameDay(date, new Date());\n                            return (\n                                <div\n                                    key={date.toISOString()}\n                                    className={cn(\n                                        \"flex-1 min-w-[160px] flex flex-col items-center justify-center border-r border-border px-2 cursor-pointer hover:bg-muted/30 transition-colors\",\n                                        isToday && \"bg-primary/5\"\n                                    )}\n                                    onClick={() => onDateClick && onDateClick(date)}\n                                >\n                                    <span className={cn(\n                                        \"text-xs font-medium uppercase tracking-wider\",\n                                        isToday ? \"text-primary\" : \"text-muted-foreground\"\n                                    )}>\n                                        {date.toLocaleDateString(undefined, { weekday: 'short' })}\n                                    </span>\n                                    <span className={cn(\n                                        \"text-sm font-semibold mt-0.5 w-7 h-7 flex items-center justify-center rounded-full\",\n                                        isToday ? \"bg-primary text-primary-foreground\" : \"text-foreground\"\n                                    )}>\n                                        {date.getDate()}\n                                    </span>\n                                </div>\n                            );\n                        })}\n                    </div>\n\n                    {/* Grid Rows - One row per facility role */}\n                    {shouldShowLoading ? (\n                        <div className=\"flex items-center justify-center h-full min-h-[200px]\">\n                            <div className=\"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n                        </div>\n                    ) : shouldShowEmptyState ? (\n                        <div className=\"flex items-center justify-center h-full min-h-[200px] p-4\">\n                            <div className=\"text-center\">\n                                <p className=\"text-sm text-muted-foreground mb-4\">\n                                    {t('dashboardProfile:operations.noWorkerRequirements')}\n                                </p>\n                                <button\n                                    onClick={() => {\n                                        setEditingRole(null);\n                                        setShowAddRoleModal(true);\n                                    }}\n                                    className=\"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors\"\n                                >\n                                    <FiPlus className=\"w-4 h-4\" />\n                                    {t('dashboardProfile:operations.addWorkerRequirement')}\n                                </button>\n                            </div>\n                        </div>\n                    ) : (\n                        expandedFacilityRoles.map(role => (\n                            <div key={role.uniqueKey} className=\"flex h-16 border-b border-border\">\n                                {dates.map(date => {\n                                    const roleEvents = events.filter(e => {\n                                        const eventDate = new Date(e.start);\n                                        if (!isSameDay(eventDate, date)) return false;\n                                        \n                                        if (role.worker) {\n                                            if (role.worker.workerId && role.worker.workerId !== 'placeholder') {\n                                                return (e.workerId === role.worker.workerId || e.employeeId === role.worker.workerId);\n                                            } else if (role.worker.placeholderName) {\n                                                return (e.workerName === role.worker.placeholderName || e.employeeName === role.worker.placeholderName);\n                                            }\n                                        }\n                                        \n                                        const eventRole = e.workerRole || e.employeeRole;\n                                        const eventWorkerType = e.workerType;\n                                        return (eventRole === role.workerType ||\n                                            eventWorkerType === role.workerType ||\n                                            (role.workerType === 'other' && eventRole === role.workerTypeOther));\n                                    });\n                                    const isToday = isSameDay(date, new Date());\n\n                                    return (\n                                        <div\n                                            key={date.toISOString()}\n                                            className={cn(\n                                                \"flex-1 min-w-[160px] border-r border-border p-1.5 flex flex-col gap-1 relative group hover:bg-muted/30 transition-colors\",\n                                                isToday && \"bg-primary/5 hover:bg-primary/10\"\n                                            )}\n                                            onClick={() => {\n                                                const start = new Date(date);\n                                                start.setHours(9, 0, 0, 0);\n                                                const end = new Date(date);\n                                                end.setHours(17, 0, 0, 0);\n                                                const newEvent = {\n                                                    id: `temp-${Date.now()}`,\n                                                    start,\n                                                    end,\n                                                    workerType: role.workerType,\n                                                    workerRole: role.workerType === 'other' ? role.workerTypeOther : role.workerType,\n                                                    workerId: role.worker?.workerId || null,\n                                                    workerName: role.worker?.placeholderName || null,\n                                                    title: role.worker?.workerId && role.worker.workerId !== 'placeholder'\n                                                      ? getWorkerName(role.worker.workerId) || 'Unknown'\n                                                      : role.worker?.placeholderName || getWorkerTypeLabel(role.workerType, role.workerTypeOther),\n                                                    color: role.color,\n                                                    color1: role.color1 || role.color\n                                                };\n                                                onCreateEvent(newEvent, true);\n                                            }}\n                                        >\n                                            {roleEvents.map(event => (\n                                                <div\n                                                    key={event.id}\n                                                    className=\"text-xs p-1.5 rounded border shadow-sm cursor-pointer hover:shadow-md transition-all truncate\"\n                                                    style={{\n                                                        backgroundColor: event.color1 || role.color || '#e2e8f0',\n                                                        borderColor: event.color || role.color || '#cbd5e1',\n                                                        color: '#1e293b'\n                                                    }}\n                                                    onClick={(e) => { e.stopPropagation(); onEventClick(event, e); }}\n                                                >\n                                                    <div className=\"font-medium truncate\">{event.title || 'Assignment'}</div>\n                                                    {event.start && (\n                                                        <div className=\"text-[10px] opacity-80\">\n                                                            {new Date(event.start).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                                            -\n                                                            {new Date(event.end).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                                        </div>\n                                                    )}\n                                                </div>\n                                            ))}\n\n                                            {/* Add Button Placeholder -> Visible on Hover */}\n                                            <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                <div className=\"bg-primary/10 text-primary rounded-full p-1\">\n                                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line></svg>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                        ))\n                    )}\n                </div>\n            </div>\n\n            {/* Add/Edit Facility Role Modal */}\n            <AddFacilityRoleModal\n                isOpen={showAddRoleModal}\n                onClose={() => {\n                    setShowAddRoleModal(false);\n                    setEditingRole(null);\n                }}\n                profileData={profileData}\n                onSave={handleSaveRole}\n                onDelete={handleDeleteRole}\n                editingRole={editingRole}\n            />\n        </div>\n    );\n};\n\nexport default ResourceGrid;\n","import React, { useState, useEffect, useCallback, useRef, useLayoutEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useParams } from 'react-router-dom';\nimport { CALENDAR_COLORS } from './utils/constants';\nimport { getWeekDates, getMultipleWeeks } from './utils/dateHelpers';\nimport { getUserTypeFromData, getUserIdFromData } from './utils/userHelpers';\nimport { getEventsForCurrentWeek, filterEventsByCategories } from './utils/eventUtils';\nimport CalendarHeader from './components/CalendarHeader';\nimport CalendarSidebar from './components/CalendarSidebar';\nimport TimeHeaders from './components/TimeHeaders';\nimport TimeGrid from './components/TimeGrid';\nimport DeleteConfirmationDialog from './components/DeleteConfirmationDialog';\nimport EventContextMenu from './components/EventContextMenu';\nimport EventPanel from './EventPanel/EventPanel';\nimport { useDashboard } from '../../contexts/DashboardContext';\nimport { useSidebar } from '../../contexts/SidebarContext';\nimport { useTutorial } from '../../contexts/TutorialContext';\nimport { useCalendarState } from './hooks/useCalendarState';\nimport { useEventOperations } from './hooks/useEventOperations';\nimport { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts';\nimport { useAutoSync } from './hooks/useAutoSync';\nimport { useCalendarEvents } from './utils/eventDatabase';\nimport { cn } from '../../../utils/cn';\nimport { FiX, FiCalendar } from 'react-icons/fi';\nimport ResourceGrid from './components/ResourceGrid';\nimport useProfileData from '../../hooks/useProfileData';\n\nimport PropTypes from 'prop-types';\n\nconst Calendar = ({ userData }) => {\n  const { t } = useTranslation(['dashboard', 'calendar']);\n  const { isTutorialActive, activeTutorial } = useTutorial();\n  const { selectedWorkspace } = useDashboard();\n\n  const accountType = getUserTypeFromData(userData);\n  const userId = getUserIdFromData(userData);\n  const { isMainSidebarCollapsed } = useSidebar();\n  const [showFiltersOverlay, setShowFiltersOverlay] = useState(false);\n  const scrollContainerRef = useRef(null);\n  const headerScrollRef = useRef(null);\n\n  const [calendarMode, setCalendarMode] = useState('calendar');\n\n  const isTeamWorkspace = selectedWorkspace?.type === 'team';\n  \n  const { profileData, isLoading: isLoadingProfile, updateProfileData } = useProfileData();\n\n  const [contextMenu, setContextMenu] = useState(null);\n\n  const getWorkspaceContext = () => {\n    if (!selectedWorkspace) {\n      return { type: 'personal', role: 'professional' };\n    }\n    let role = selectedWorkspace.role;\n    if (role === 'admin') role = 'manager';\n    return { type: selectedWorkspace.type, role: role };\n  };\n\n  const workspaceContext = getWorkspaceContext();\n\n  const {\n    currentDate, setCurrentDate, view, setView,\n    categories, setCategories, isSidebarCollapsed, setIsSidebarCollapsed,\n    showHeaderDateDropdown, setShowHeaderDateDropdown, dropdownPosition,\n    navigateDate: originalNavigateDate,\n    handleDayClick: originalHandleDayClick,\n    handleUpcomingEventClick: originalHandleUpcomingEventClick,\n    handleCategoryToggle,\n    handleHeaderDateClick, toggleSidebar\n  } = useCalendarState();\n\n  // Track the actual visible week for MiniCalendar highlighting\n  // These are calculated from the horizontal scroll position of the grid\n  const [visibleWeekStart, setVisibleWeekStart] = useState(() => {\n    const start = new Date(currentDate);\n    const day = start.getDay();\n    const diff = day === 0 ? -6 : 1 - day; // Monday\n    start.setDate(start.getDate() + diff);\n    start.setHours(0, 0, 0, 0);\n    return start;\n  });\n  const [visibleWeekEnd, setVisibleWeekEnd] = useState(() => {\n    const end = new Date(currentDate);\n    const day = end.getDay();\n    const diff = day === 0 ? 0 : 7 - day; // Sunday\n    end.setDate(end.getDate() + diff);\n    end.setHours(23, 59, 59, 999);\n    return end;\n  });\n\n  // Use original navigation handlers directly\n  const navigateDate = originalNavigateDate;\n  const handleDayClick = originalHandleDayClick;\n  const handleUpcomingEventClick = originalHandleUpcomingEventClick;\n\n  // Single week display mode (no horizontal scrolling buffer)\n  // Only render the current week to ensure stability and correct focus\n  const numWeeks = 0;\n  const [numDays, setNumDays] = useState(30);\n  const prevNumDays = useRef(numDays);\n\n  const isLoadingMoreDays = useRef(false);\n  const hasInitialScrolled = useRef(false);\n\n  // Scroll Compensation for day view only (week view uses fixed numWeeks)\n  useLayoutEffect(() => {\n    const gridScroll = scrollContainerRef.current;\n    if (!gridScroll) return;\n\n    if (view === 'day' && numDays > prevNumDays.current) {\n      const delta = numDays - prevNumDays.current;\n      const widthPerDay = gridScroll.clientWidth;\n      gridScroll.scrollLeft += delta * widthPerDay;\n    }\n\n    prevNumDays.current = numDays;\n  }, [numDays, view, scrollContainerRef]);\n\n\n\n  // Scroll to selected date when it changes (navigation, minicalendar click, etc.)\n  useEffect(() => {\n    const gridScroll = scrollContainerRef.current;\n    if (!gridScroll || view !== 'week') return;\n\n    // Calculate which week contains currentDate\n    const weekStart = new Date(currentDate);\n    const day = weekStart.getDay();\n    const diff = day === 0 ? -6 : 1 - day; // Monday\n    weekStart.setDate(weekStart.getDate() + diff);\n    weekStart.setHours(0, 0, 0, 0);\n\n    // Generate all weeks in the grid\n    const weeks = getMultipleWeeks(currentDate, numWeeks, numWeeks);\n\n    // Find which week index contains our target date\n    let targetWeekIndex = -1;\n    for (let i = 0; i < weeks.length; i++) {\n      const wStart = new Date(weeks[i][0]);\n      wStart.setHours(0, 0, 0, 0);\n      const wEnd = new Date(weeks[i][6]);\n      wEnd.setHours(23, 59, 59, 999);\n\n      if (weekStart >= wStart && weekStart <= wEnd) {\n        targetWeekIndex = i;\n        break;\n      }\n    }\n\n    if (targetWeekIndex === -1) return;\n\n    // Calculate scroll position to center the target week\n    const totalWeeks = weeks.length;\n    const containerWidth = gridScroll.clientWidth;\n    const targetScrollLeft = targetWeekIndex * containerWidth;\n\n    // Scroll to position (smooth on subsequent navigations, instant on first load)\n    gridScroll.scrollTo({\n      left: targetScrollLeft,\n      behavior: hasInitialScrolled.current ? 'smooth' : 'auto'\n    });\n\n    if (!hasInitialScrolled.current) {\n      hasInitialScrolled.current = true;\n    }\n  }, [currentDate, view, numWeeks]);\n\n  // Track scroll position to update visible week for mini calendar highlighting\n  useEffect(() => {\n    const gridScroll = scrollContainerRef.current;\n    if (!gridScroll || view !== 'week') return;\n\n    let scrollTimeout;\n    const handleScrollUpdate = () => {\n      const scrollLeft = gridScroll.scrollLeft;\n      const containerWidth = gridScroll.clientWidth;\n\n      if (containerWidth === 0) return;\n\n      // Calculate which week is currently visible (centered in viewport)\n      const visibleWeekIndex = Math.round(scrollLeft / containerWidth);\n\n      // Generate all weeks\n      const weeks = getMultipleWeeks(currentDate, numWeeks, numWeeks);\n\n      if (visibleWeekIndex >= 0 && visibleWeekIndex < weeks.length) {\n        const visibleWeek = weeks[visibleWeekIndex];\n\n        const weekStart = new Date(visibleWeek[0]);\n        weekStart.setHours(0, 0, 0, 0);\n\n        const weekEnd = new Date(visibleWeek[6]);\n        weekEnd.setHours(23, 59, 59, 999);\n\n        // Only update if the week actually changed\n        const currentStartKey = `${visibleWeekStart.getFullYear()}-${visibleWeekStart.getMonth()}-${visibleWeekStart.getDate()}`;\n        const newStartKey = `${weekStart.getFullYear()}-${weekStart.getMonth()}-${weekStart.getDate()}`;\n\n        if (currentStartKey !== newStartKey) {\n          setVisibleWeekStart(weekStart);\n          setVisibleWeekEnd(weekEnd);\n        }\n      }\n    };\n\n    // Debounce scroll updates\n    const throttledScrollUpdate = () => {\n      if (scrollTimeout) clearTimeout(scrollTimeout);\n      scrollTimeout = setTimeout(handleScrollUpdate, 150);\n    };\n\n    gridScroll.addEventListener('scroll', throttledScrollUpdate, { passive: true });\n\n    // Initial update\n    handleScrollUpdate();\n\n    return () => {\n      gridScroll.removeEventListener('scroll', throttledScrollUpdate);\n      if (scrollTimeout) clearTimeout(scrollTimeout);\n    };\n  }, [scrollContainerRef, view, currentDate, numWeeks, visibleWeekStart]);\n\n  const { saveEventsToLocalStorage, setPendingChanges, pendingChanges } = useAutoSync(userId, accountType);\n\n  const {\n    events, setEvents, selectedEvent, setSelectedEvent, selectedEventId, setSelectedEventId,\n    history, currentHistoryIndex, validatedEvents,\n    showDeleteConfirmation, setShowDeleteConfirmation, eventToDelete, setEventToDelete,\n    originalEventPosition, setOriginalEventPosition,\n    handleEventSave, handleEventDelete, handlePanelClose, handleCreateEventClick,\n    addToHistory, undo, redo\n  } = useEventOperations(userId, accountType, workspaceContext, currentDate, setCurrentDate, CALENDAR_COLORS, saveEventsToLocalStorage, setPendingChanges);\n\n  /**\n   * Handle event click - opens event panel\n   */\n  const handleEventClick = useCallback((event, e) => {\n    // Close context menu if open\n    setContextMenu(null);\n\n    // Find full event data\n    const fullEvent = events.find(ev => ev.id === event.id) || event;\n\n    // Store original position for potential restoration\n    setOriginalEventPosition({\n      id: fullEvent.id,\n      start: new Date(fullEvent.start),\n      end: new Date(fullEvent.end),\n      title: fullEvent.title,\n      color: fullEvent.color,\n      color1: fullEvent.color1,\n      notes: fullEvent.notes,\n      location: fullEvent.location,\n      employees: fullEvent.employees,\n      ...fullEvent\n    });\n\n    // Open event panel\n    setSelectedEventId(event.id);\n    setSelectedEvent(fullEvent);\n  }, [events, setSelectedEvent, setSelectedEventId, setOriginalEventPosition]);\n\n  /**\n   * Handle event right-click - opens context menu\n   */\n  const handleEventRightClick = useCallback((e, event) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    setContextMenu({\n      event: event,\n      position: { x: e.clientX, y: e.clientY }\n    });\n  }, []);\n\n  /**\n   * Handle context menu close\n   */\n  const handleContextMenuClose = useCallback(() => {\n    setContextMenu(null);\n  }, []);\n\n  /**\n   * Handle event color change from context menu\n   */\n  const handleEventColorChange = useCallback((event, colorOption) => {\n    const updatedEvents = events.map(e => {\n      if (e.id === event.id) {\n        return {\n          ...e,\n          color: colorOption.color,\n          color1: colorOption.color1,\n          color2: colorOption.color2,\n          category: colorOption.name\n        };\n      }\n      return e;\n    });\n\n    setEvents(updatedEvents);\n    addToHistory(updatedEvents);\n  }, [events, setEvents, addToHistory]);\n\n  /**\n   * Handle event delete from context menu\n   */\n  const handleContextMenuDelete = useCallback((event) => {\n    setEventToDelete(event);\n    setShowDeleteConfirmation(true);\n  }, [setEventToDelete, setShowDeleteConfirmation]);\n\n  /**\n   * Handle grid event move (15-min increments, same day only)\n   */\n  const handleGridEventMove = useCallback((eventId, newStart, newEnd, isTemporary = false) => {\n    // Find the event\n    const eventIndex = events.findIndex(e => e.id === eventId);\n    if (eventIndex === -1) return;\n\n    const currentEvent = events[eventIndex];\n\n    // On first move (temporary), store the original position\n    // Check if we're starting a new drag (event is not currently being moved)\n    if (isTemporary && !currentEvent.isBeingMoved) {\n      setOriginalEventPosition({\n        id: currentEvent.id,\n        start: new Date(currentEvent.start),\n        end: new Date(currentEvent.end),\n        title: currentEvent.title,\n        color: currentEvent.color,\n        color1: currentEvent.color1,\n        notes: currentEvent.notes,\n        location: currentEvent.location,\n        employees: currentEvent.employees,\n        ...currentEvent\n      });\n    }\n\n    const updatedEvents = [...events];\n    updatedEvents[eventIndex] = {\n      ...updatedEvents[eventIndex],\n      start: newStart,\n      end: newEnd,\n      isBeingMoved: isTemporary\n    };\n\n    setEvents(updatedEvents);\n\n    // When drag completes (not temporary), open panel for confirmation\n    if (!isTemporary) {\n      const movedEvent = updatedEvents[eventIndex];\n\n      // Validate that the event is within valid time boundaries (00:00:01 to 23:59:59)\n      // Grid starts at 00:00:01 to prevent date shifts to previous day\n      const startOfDay = new Date(newStart);\n      startOfDay.setHours(0, 0, 1, 0);\n      const endOfDay = new Date(newStart);\n      endOfDay.setHours(23, 59, 59, 999);\n\n      // Check if event is within valid day boundaries\n      const isValidPosition = newStart >= startOfDay && newStart <= endOfDay &&\n        newEnd >= startOfDay && newEnd <= endOfDay &&\n        newEnd > newStart;\n\n      if (!isValidPosition) {\n        // Event is outside valid boundaries, don't open panel\n        // Restore to original position if available\n        if (originalEventPosition && originalEventPosition.id === eventId) {\n          const restoredEvents = [...events];\n          const restoreIndex = restoredEvents.findIndex(e => e.id === eventId);\n          if (restoreIndex !== -1) {\n            restoredEvents[restoreIndex] = {\n              ...restoredEvents[restoreIndex],\n              start: new Date(originalEventPosition.start),\n              end: new Date(originalEventPosition.end),\n              isBeingMoved: false\n            };\n            setEvents(restoredEvents);\n          }\n        }\n        return;\n      }\n\n      console.log('Event moved - opening panel for confirmation');\n\n      // Open panel to confirm or cancel the move\n      setSelectedEvent(movedEvent);\n      setSelectedEventId(movedEvent.id);\n\n      // Don't auto-save - let user confirm via Save button\n      // If they cancel, handlePanelClose will restore originalEventPosition\n    }\n  }, [events, setEvents, setSelectedEvent, setSelectedEventId, setOriginalEventPosition, originalEventPosition]);\n\n  /**\n   * Handle grid event resize (15-min increments)\n   */\n  const handleGridEventResize = useCallback((eventId, newStart, newEnd, isTemporary = false) => {\n    // Find the event\n    const eventIndex = events.findIndex(e => e.id === eventId);\n    if (eventIndex === -1) return;\n\n    const currentEvent = events[eventIndex];\n\n    // On first resize (temporary), store the original position\n    if (isTemporary && !currentEvent.isBeingResized) {\n      console.log('Resize started - storing original position');\n      setOriginalEventPosition({\n        id: currentEvent.id,\n        start: new Date(currentEvent.start),\n        end: new Date(currentEvent.end),\n        title: currentEvent.title,\n        color: currentEvent.color,\n        color1: currentEvent.color1,\n        notes: currentEvent.notes,\n        location: currentEvent.location,\n        employees: currentEvent.employees,\n        ...currentEvent\n      });\n    }\n\n    const updatedEvents = [...events];\n    updatedEvents[eventIndex] = {\n      ...updatedEvents[eventIndex],\n      start: newStart,\n      end: newEnd,\n      isBeingResized: isTemporary\n    };\n\n    setEvents(updatedEvents);\n\n    // When resize completes, open panel for confirmation\n    if (!isTemporary) {\n      const resizedEvent = updatedEvents[eventIndex];\n\n      console.log('Event resized - opening panel for confirmation');\n\n      // Open panel to confirm or cancel the resize\n      setSelectedEvent(resizedEvent);\n      setSelectedEventId(resizedEvent.id);\n\n      // Don't auto-save - let user confirm via Save button\n    }\n  }, [events, setEvents, setSelectedEvent, setSelectedEventId, setOriginalEventPosition]);\n\n  /**\n   * Handle grid event creation\n   */\n  const handleGridCreateEvent = useCallback((newEvent, openPanel = true) => {\n    console.log('handleGridCreateEvent called:', { newEvent, openPanel });\n\n    // Add default color if not set\n    const eventWithDefaults = {\n      ...newEvent,\n      color: newEvent.color || CALENDAR_COLORS[0].color,\n      color1: newEvent.color1 || CALENDAR_COLORS[0].color1,\n      color2: CALENDAR_COLORS[0].color2,\n      category: CALENDAR_COLORS[0].name,\n      title: newEvent.title || '',\n      notes: '',\n      location: '',\n      employees: '',\n    };\n\n    console.log('Event with defaults:', eventWithDefaults);\n\n    // ALWAYS add to events array immediately so it's visible in the UI\n    const updatedEvents = [...events, eventWithDefaults];\n    setEvents(updatedEvents);\n    addToHistory(updatedEvents);\n    console.log('Event added to array, count:', updatedEvents.length);\n\n    if (openPanel) {\n      console.log('Opening panel for event:', eventWithDefaults.id);\n\n      // Store original position\n      setOriginalEventPosition({\n        ...eventWithDefaults,\n        start: new Date(eventWithDefaults.start),\n        end: new Date(eventWithDefaults.end)\n      });\n\n      // Open the panel\n      setSelectedEvent(eventWithDefaults);\n      setSelectedEventId(eventWithDefaults.id);\n\n      console.log('Panel opened, event visible in UI');\n    } else {\n      console.log('Event added without panel (should not happen now)');\n    }\n  }, [events, setEvents, addToHistory, setSelectedEvent, setSelectedEventId, setOriginalEventPosition]);\n\n  const { handleKeyboardShortcuts } = useKeyboardShortcuts(\n    () => undo(events, setEvents),\n    () => redo(events, setEvents),\n    selectedEvent,\n    showDeleteConfirmation,\n    // onDeleteEvent wrapper\n    (event) => {\n      setEventToDelete(event);\n      setShowDeleteConfirmation(true);\n    },\n    // onPanelClose wrapper\n    () => handlePanelClose(events, setEvents)\n  );\n\n  const filteredEvents = filterEventsByCategories(events, categories, CALENDAR_COLORS);\n\n  const { events: calendarEvents } = useCalendarEvents(userId, accountType);\n  const prevCalendarEventsRef = useRef(null);\n\n  useEffect(() => {\n    if (calendarEvents) {\n      const calendarEventsKey = JSON.stringify(calendarEvents.map(e => ({ id: e.id, start: e.start?.getTime(), end: e.end?.getTime() })));\n      const prevCalendarEventsKey = prevCalendarEventsRef.current ? \n        JSON.stringify(prevCalendarEventsRef.current.map(e => ({ id: e.id, start: e.start?.getTime(), end: e.end?.getTime() }))) : null;\n      \n      if (calendarEventsKey === prevCalendarEventsKey) {\n        return;\n      }\n      \n      prevCalendarEventsRef.current = calendarEvents;\n      \n      const eventsWithDbFlag = calendarEvents.map(event => ({\n        ...event, fromDatabase: true, isValidated: true\n      }));\n      \n      setEvents(prevEvents => {\n        const tempEvents = prevEvents.filter(e => !e.fromDatabase);\n        \n        const activeEvents = prevEvents.filter(e => e.isBeingMoved || e.isBeingResized);\n        const activeEventIds = new Set(activeEvents.map(e => e.id));\n        \n        const dbEventsMap = new Map(eventsWithDbFlag.map(e => [e.id, e]));\n        \n        const mergedEvents = [];\n        \n        for (const dbEvent of eventsWithDbFlag) {\n          if (activeEventIds.has(dbEvent.id)) {\n            const activeEvent = activeEvents.find(e => e.id === dbEvent.id);\n            mergedEvents.push(activeEvent);\n          } else {\n            mergedEvents.push(dbEvent);\n          }\n        }\n        \n        for (const activeEvent of activeEvents) {\n          if (!dbEventsMap.has(activeEvent.id)) {\n            mergedEvents.push(activeEvent);\n          }\n        }\n        \n        mergedEvents.push(...tempEvents);\n        \n        const mergedEventsKey = JSON.stringify(mergedEvents.map(e => ({ id: e.id, start: e.start?.getTime(), end: e.end?.getTime() })));\n        const prevEventsKey = JSON.stringify(prevEvents.map(e => ({ id: e.id, start: e.start?.getTime(), end: e.end?.getTime() })));\n        const historyKey = history[currentHistoryIndex] ? \n          JSON.stringify(history[currentHistoryIndex].map(e => ({ id: e.id, start: e.start?.getTime(), end: e.end?.getTime() }))) : null;\n        \n        if (mergedEventsKey !== prevEventsKey && mergedEventsKey !== historyKey) {\n          addToHistory(mergedEvents);\n        }\n        \n        return mergedEvents;\n      });\n    }\n  }, [calendarEvents, setEvents, addToHistory, history, currentHistoryIndex]);\n\n  // Auto-scroll to 8 AM\n  useEffect(() => {\n    const timeSlots = document.querySelector('.time-slots');\n    if (timeSlots) timeSlots.scrollTop = (8 - 1) * 60;\n  }, []);\n\n  // Sync header and grid horizontal scroll\n  useEffect(() => {\n    const headerScroll = headerScrollRef.current;\n    const gridScroll = scrollContainerRef.current;\n\n    if (!headerScroll || !gridScroll) return;\n\n    let isSyncing = false;\n\n    const syncFromGrid = () => {\n      if (!isSyncing) {\n        isSyncing = true;\n        if (headerScroll) headerScroll.scrollLeft = gridScroll.scrollLeft;\n        requestAnimationFrame(() => { isSyncing = false; });\n      }\n    };\n\n    const syncFromHeader = () => {\n      if (!isSyncing) {\n        isSyncing = true;\n        if (gridScroll) gridScroll.scrollLeft = headerScroll.scrollLeft;\n        requestAnimationFrame(() => { isSyncing = false; });\n      }\n    };\n\n    gridScroll.addEventListener('scroll', syncFromGrid);\n    headerScroll.addEventListener('scroll', syncFromHeader);\n\n    return () => {\n      gridScroll.removeEventListener('scroll', syncFromGrid);\n      headerScroll.removeEventListener('scroll', syncFromHeader);\n    };\n  }, []);\n\n\n  useEffect(() => {\n    document.addEventListener('keydown', handleKeyboardShortcuts);\n    return () => document.removeEventListener('keydown', handleKeyboardShortcuts);\n  }, [handleKeyboardShortcuts]);\n\n  // Debug: Log when selectedEvent changes\n  useEffect(() => {\n    console.log('selectedEvent changed:', selectedEvent);\n    console.log('selectedEventId changed:', selectedEventId);\n  }, [selectedEvent, selectedEventId]);\n\n  // Close context menu on outside click\n  useEffect(() => {\n    const handleGlobalClick = () => {\n      if (contextMenu) {\n        setContextMenu(null);\n      }\n    };\n\n    document.addEventListener('click', handleGlobalClick);\n    return () => document.removeEventListener('click', handleGlobalClick);\n  }, [contextMenu]);\n\n  const handleResetCategories = useCallback(() => {\n    setCategories(prev => prev.map(c => ({ ...c, checked: true })));\n  }, [setCategories]);\n\n  const hasActiveFilters = categories.some(cat => !cat.checked);\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden animate-in fade-in duration-500\">\n      {/* 1. Top Bar */}\n      <div className=\"shrink-0 w-full z-20 bg-card/95 backdrop-blur-sm border-b border-border shadow-sm flex items-center justify-between gap-4 px-6 h-16\">\n        {/* Tutorial Mock: Calendar View Options */}\n        {isTutorialActive && activeTutorial === 'calendar' && (\n          <div className=\"calendar-view-options flex gap-2 mr-4\">\n            <button className=\"px-3 py-1.5 bg-primary text-primary-foreground rounded-md text-sm font-medium\">{t('calendar:dayView')}</button>\n            <button className=\"px-3 py-1.5 bg-muted text-muted-foreground rounded-md text-sm font-medium\">{t('calendar:weekView')}</button>\n            <button className=\"px-3 py-1.5 bg-muted text-muted-foreground rounded-md text-sm font-medium\">{t('calendar:monthView')}</button>\n          </div>\n        )}\n        <CalendarHeader\n          currentDate={currentDate}\n          view={view}\n          setView={setView}\n          navigateDate={navigateDate}\n          setCurrentDate={setCurrentDate}\n          isSidebarCollapsed={false}\n          toggleSidebar={() => setIsSidebarCollapsed(!isSidebarCollapsed)}\n          categories={categories}\n          handleCategoryToggle={handleCategoryToggle}\n          onResetCategories={handleResetCategories}\n          isTopBarMode={true}\n          onShowFiltersOverlay={setShowFiltersOverlay}\n          scrollContainerRef={scrollContainerRef}\n          calendarMode={calendarMode}\n          setCalendarMode={setCalendarMode}\n          isTeamWorkspace={isTeamWorkspace}\n        />\n      </div>\n\n      {/* 2. Main Split Content */}\n      <div className={cn(\n        \"flex-1 flex overflow-hidden relative\",\n        calendarMode === 'team' ? \"p-0\" : \"p-4 gap-4\"\n      )}>\n        {calendarMode === 'team' && isTeamWorkspace ? (\n          <div className=\"w-full h-full\">\n            <ResourceGrid\n              currentDate={currentDate}\n              events={filteredEvents}\n              employees={[]}\n              onEventClick={handleEventClick}\n              onCreateEvent={handleGridCreateEvent}\n              view={view}\n              onDateClick={handleDayClick}\n              onEventMove={handleGridEventMove}\n              profileData={profileData}\n              onUpdateProfileData={updateProfileData}\n              isLoadingProfile={isLoadingProfile}\n            />\n          </div>\n        ) : (\n          <>\n            {/* Left: Sidebar */}\n            <div className={cn(\n              \"flex flex-col transition-all duration-300 w-full md:w-[320px] lg:w-[360px]\",\n              isMainSidebarCollapsed ? \"flex\" : (isSidebarCollapsed ? \"hidden lg:flex w-0 overflow-hidden\" : \"flex\")\n            )}>\n              {/* Tutorial Mock: New Appointment Button */}\n              {isTutorialActive && activeTutorial === 'calendar' && (\n                <div className=\"mb-4\">\n                  <button className=\"new-appointment-button w-full py-2.5 px-4 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2\">\n                    <FiCalendar className=\"w-4 h-4\" />\n                    {t('calendar:newAppointment')}\n                  </button>\n                </div>\n              )}\n              <CalendarSidebar\n                currentDate={currentDate}\n                setCurrentDate={setCurrentDate}\n                handleUpcomingEventClick={handleUpcomingEventClick}\n                events={filteredEvents}\n                isSidebarCollapsed={isSidebarCollapsed}\n                handleCreateEventClick={() => handleCreateEventClick(currentDate)}\n                handleDayClick={handleDayClick}\n                showHeaderDateDropdown={showHeaderDateDropdown}\n                setShowHeaderDateDropdown={setShowHeaderDateDropdown}\n                handleHeaderDateClick={handleHeaderDateClick}\n                dropdownPosition={dropdownPosition}\n                toggleSidebar={toggleSidebar}\n                view={view}\n                visibleWeekStart={visibleWeekStart}\n                visibleWeekEnd={visibleWeekEnd}\n              />\n            </div>\n\n            {/* Right: Main Calendar Grid */}\n        <div className=\"flex-1 flex flex-col relative min-w-0 transition-all duration-300 bg-card border border-border/60 rounded-xl overflow-hidden\">\n          <div className=\"flex-1 overflow-hidden relative calendar-grid flex flex-col\">\n            {/* Time Headers - scrollable horizontally (no scrollbar) */}\n            <div className=\"flex flex-shrink-0\" style={{ margin: 0, padding: 0 }}>\n              {/* Time column header - above day headers */}\n              <div\n                className=\"flex-shrink-0 bg-background/95 backdrop-blur-sm z-10 flex items-end justify-center pb-2\"\n                style={{\n                  width: '4rem',\n                  minHeight: '3rem',\n                  borderLeft: '1px solid hsl(var(--border))',\n                  borderRight: '1px solid hsl(var(--border))',\n                  boxSizing: 'border-box',\n                  margin: 0,\n                  padding: 0\n                }}\n              >\n                {/* Empty space for time column alignment */}\n              </div>\n\n              {/* Scrollable day headers */}\n              <div\n                className=\"flex-1 overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\"\n                ref={headerScrollRef}\n                onScroll={(e) => {\n                  if (scrollContainerRef.current) {\n                    scrollContainerRef.current.scrollLeft = e.target.scrollLeft;\n                  }\n                }}\n              >\n                <TimeHeaders\n                  currentDate={currentDate}\n                  referenceDate={currentDate}\n                  view={view}\n                  handleDayClick={handleDayClick}\n                  scrollContainerRef={headerScrollRef}\n                  numWeeks={numWeeks}\n                  numDays={numDays}\n                />\n              </div>\n            </div>\n\n            {/* Scrollable Grid Area (no scrollbars) */}\n            <div className=\"flex-1 time-slots bg-muted/5 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\">\n              <div className=\"relative min-h-full flex\" style={{ margin: 0, padding: 0 }}>\n                {/* Time Labels - fixed, doesn't scroll horizontally - OUTSIDE scroll container */}\n                <div\n                  className=\"sticky flex-shrink-0 bg-background/95 backdrop-blur-sm z-10\"\n                  style={{\n                    width: '4rem',\n                    height: '1440px',\n                    position: 'sticky',\n                    left: 0,\n                    top: 0,\n                    alignSelf: 'flex-start',\n                    borderLeft: '1px solid hsl(var(--border))',\n                    borderRight: '1px solid hsl(var(--border))',\n                    boxSizing: 'border-box',\n                    margin: 0,\n                    padding: 0\n                  }}\n                >\n                  {Array.from({ length: 24 }, (_, i) => {\n                    const hour = i;\n                    return (\n                      <div key={i} className=\"h-[60px] text-[10px] text-muted-foreground text-right pr-4 relative\">\n                        <span className=\"text-[10px] pb-1\">\n                          {hour < 10 ? `0${hour}:00` : `${hour}:00`}\n                        </span>\n                      </div>\n                    );\n                  })}\n                </div>\n\n                {/* Scrollable Grid Container - horizontal scroll only with week snapping */}\n                <div\n                  className=\"flex-1 calendar-scroll-container overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\"\n                  style={{ scrollSnapType: 'x mandatory', scrollBehavior: 'smooth' }}\n                  ref={scrollContainerRef}\n                  onScroll={(e) => {\n                    if (headerScrollRef.current) {\n                      headerScrollRef.current.scrollLeft = e.target.scrollLeft;\n                    }\n                  }}\n                >\n                  <div className=\"relative min-h-full min-w-max\">\n                    {/* The Actual Grid */}\n                    <div className=\"time-grid h-full relative min-w-max\">\n                      <TimeGrid\n                        view={view}\n                        events={filteredEvents}\n                        selectedEventId={selectedEventId}\n                        currentDate={currentDate}\n                        referenceDate={currentDate}\n                        getEventsForCurrentWeek={() => getEventsForCurrentWeek(events, getWeekDates(currentDate))}\n                        validatedEvents={validatedEvents}\n                        onEventClick={handleEventClick}\n                        onEventRightClick={handleEventRightClick}\n                        onEventMove={handleGridEventMove}\n                        onEventResize={handleGridEventResize}\n                        onCreateEvent={handleGridCreateEvent}\n                        scrollContainerRef={scrollContainerRef}\n                        numWeeks={numWeeks}\n                        numDays={numDays}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n          </>\n        )}\n      </div>\n\n      {/* Context Menu */}\n      {contextMenu && (\n        <EventContextMenu\n          event={contextMenu.event}\n          position={contextMenu.position}\n          onClose={handleContextMenuClose}\n          onDelete={handleContextMenuDelete}\n          onColorChange={handleEventColorChange}\n          colorOptions={CALENDAR_COLORS}\n        />\n      )}\n\n      {/* Event Panel */}\n      {selectedEvent && (\n        <>\n\n          <EventPanel\n            event={selectedEvent}\n            onClose={() => {\n              handlePanelClose(events, setEvents);\n            }}\n            onSave={handleEventSave}\n            onDelete={() => {\n              if (selectedEvent && selectedEvent.id) {\n                setEventToDelete(selectedEvent);\n                setShowDeleteConfirmation(true);\n              }\n            }}\n            colorOptions={CALENDAR_COLORS}\n            accountType={accountType}\n            userData={userData}\n            workspaceContext={workspaceContext}\n          />\n        </>\n      )}\n\n      {/* Delete Confirmation Dialog */}\n      {showDeleteConfirmation && eventToDelete && (\n        <DeleteConfirmationDialog\n          event={eventToDelete}\n          currentDate={new Date(eventToDelete.start)}\n          onConfirm={(deleteType) => handleEventDelete(eventToDelete.id, deleteType, events, setEvents)}\n          onCancel={() => { setShowDeleteConfirmation(false); setEventToDelete(null); }}\n        />\n      )}\n\n      {/* Filters Overlay */}\n      {showFiltersOverlay && (\n        <>\n          <div\n            className=\"fixed inset-0 bg-black/50 z-40\"\n            onClick={() => setShowFiltersOverlay(false)}\n          />\n          <div className={cn(\n            \"fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border rounded-t-2xl shadow-2xl\",\n            \"animate-in slide-in-from-bottom duration-300\"\n          )} style={{ height: '75vh' }}>\n            <div className=\"p-4 border-b border-border flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold m-0\">{t('calendar:categoryFilters')}</h3>\n              <button\n                onClick={() => setShowFiltersOverlay(false)}\n                className=\"p-2 hover:bg-muted rounded-lg transition-colors\"\n              >\n                <FiX className=\"w-5 h-5\" />\n              </button>\n            </div>\n            <div className=\"overflow-y-auto p-4 space-y-2\" style={{ height: 'calc(75vh - 73px)', scrollbarGutter: 'stable' }}>\n              {categories.map((category, index) => (\n                <label\n                  key={index}\n                  className=\"flex items-center gap-3 px-3 py-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors\"\n                >\n                  <div className=\"relative flex items-center\">\n                    <input\n                      type=\"checkbox\"\n                      checked={category.checked}\n                      onChange={() => handleCategoryToggle(index)}\n                      className=\"peer h-4 w-4 rounded border text-primary focus:ring-1 focus:ring-primary/20 cursor-pointer transition-all appearance-none bg-background\"\n                      style={{\n                        backgroundColor: category.checked ? category.color : 'transparent',\n                        borderColor: category.color,\n                        borderWidth: '1px'\n                      }}\n                    />\n                    <svg\n                      className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"3\"\n                    >\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                  </div>\n                  <span className=\"text-sm font-medium\">{category.name}</span>\n                </label>\n              ))}\n              {hasActiveFilters && (\n                <button\n                  onClick={() => {\n                    handleResetCategories();\n                    setShowFiltersOverlay(false);\n                  }}\n                  className=\"w-full h-10 rounded-lg border border-input bg-background text-sm font-medium hover:bg-muted transition-all mt-4\"\n                >\n                  {t('calendar:resetAll')}\n                </button>\n              )}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nCalendar.propTypes = {\n  userData: PropTypes.object\n};\n\nexport default Calendar;","// Extract user type from user data\nexport const getUserTypeFromData = (userData) => {\n  return userData?.basicInfo?.accountType || 'worker';\n};\n\n// Extract user ID from user data\nexport const getUserIdFromData = (userData) => {\n  // Try multiple possible locations for user ID\n  const possibleIds = [\n    userData?.uid,\n    userData?.firebase_uid,\n    userData?.id,\n    userData?.userId,\n    userData?.user?.uid,\n    userData?.user?.id\n  ];\n  \n  const userId = possibleIds.find(id => id && typeof id === 'string');\n  \n  if (!userId) {\n    console.warn('No valid user ID found in userData:', userData);\n  }\n  \n  return userId || null;\n}; ","import { useState, useEffect, useCallback } from 'react';\nimport { updateEvent } from '../utils/eventDatabase';\n\n/**\n * Custom hook for auto-sync functionality\n * Handles local storage management and automatic database synchronization\n * \n * Extracted from Calendar.js to separate data persistence logic\n */\nexport const useAutoSync = (userId, accountType) => {\n  // Track pending changes for database sync\n  const [pendingChanges, setPendingChanges] = useState(new Set());\n  const [lastSyncTime, setLastSyncTime] = useState(Date.now());\n  \n  // Local storage functions\n  const saveEventsToLocalStorage = useCallback((eventsToSave) => {\n  }, [userId]);\n\n  const loadEventsFromLocalStorage = useCallback(() => {\n    return null;\n  }, [userId]);\n\n  // Mark event as having pending changes\n  const markEventForSync = useCallback((eventId) => {\n    setPendingChanges(prev => new Set([...prev, eventId]));\n  }, []);\n\n  // Sync pending changes to database\n  const syncPendingChanges = useCallback(async (events) => {\n    if (pendingChanges.size === 0 || !userId) {\n      console.log('No pending changes or no userId - skipping sync', { \n        pendingChanges: pendingChanges.size, \n        userId \n      });\n      return;\n    }\n\n    console.log(`Syncing ${pendingChanges.size} pending changes to database`, Array.from(pendingChanges));\n    const changesToSync = Array.from(pendingChanges);\n    \n    for (const eventId of changesToSync) {\n      const event = events.find(e => e.id === eventId);\n      if (event) {\n        // Check if event should be synced to database\n        const shouldSync = event.fromDatabase || \n                          event.isValidated || \n                          (event.id && !event.id.toString().startsWith('temp-') && \n                           !event.id.toString().startsWith('duplicate-') && \n                           event.id.toString().length > 10);\n        \n        if (shouldSync) {\n          try {\n            console.log(`Syncing event ${eventId} to database - fromDB: ${event.fromDatabase}, validated: ${event.isValidated}`);\n            \n            // Re-enable database updates for sync\n            const eventForUpdate = {\n              id: eventId,\n              start: event.start,\n              end: event.end,\n              title: event.title,\n              color: event.color,\n              color1: event.color1,\n              color2: event.color2,\n              isValidated: event.isValidated || false,\n              isRecurring: event.isRecurring || false,\n              recurrenceId: event.recurrenceId,\n              notes: event.notes,\n              location: event.location,\n              employees: event.employees,\n              canton: event.canton,\n              area: event.area,\n              experience: event.experience,\n              software: event.software,\n              certifications: event.certifications,\n              isAvailability: event.isAvailability\n            };\n\n            const result = await updateEvent(eventId, eventForUpdate, userId, accountType, true); // forceUpdate = true for sync\n            if (result.success) {\n              console.log(`Successfully synced event ${eventId} to database`);\n              setPendingChanges(prev => {\n                const newSet = new Set(prev);\n                newSet.delete(eventId);\n                return newSet;\n              });\n            } else {\n              console.warn(`Failed to sync event ${eventId}:`, result.error);\n            }\n          } catch (error) {\n            console.warn(`Error syncing event ${eventId}:`, error);\n          }\n        } else {\n          console.log(`Skipping sync for event ${eventId} - appears to be local-only or temporary`);\n          // Remove from pending changes since it shouldn't be synced\n          setPendingChanges(prev => {\n            const newSet = new Set(prev);\n            newSet.delete(eventId);\n            return newSet;\n          });\n        }\n      } else {\n        console.warn(`Event ${eventId} not found in events array - removing from pending changes`);\n        // Remove from pending changes if event no longer exists\n        setPendingChanges(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(eventId);\n          return newSet;\n        });\n      }\n    }\n    \n    setLastSyncTime(Date.now());\n  }, [pendingChanges, userId, accountType]);\n\n  // Periodic sync to database every 5 minutes\n  useEffect(() => {\n    const syncInterval = setInterval(() => {\n      if (pendingChanges.size > 0) {\n        console.log('Periodic sync triggered - syncing pending changes');\n        // Note: syncPendingChanges needs events parameter, will be called from component\n      }\n    }, 5 * 60 * 1000); // 5 minutes\n\n    return () => clearInterval(syncInterval);\n  }, [pendingChanges.size]);\n\n  // Sync on page leave\n  useEffect(() => {\n    const handleBeforeUnload = () => {\n      if (pendingChanges.size > 0) {\n        console.log('Page unload detected - syncing pending changes');\n        // Use sendBeacon for reliable delivery during page unload\n        // Note: syncPendingChanges needs events parameter, will be called from component\n      }\n    };\n\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'hidden' && pendingChanges.size > 0) {\n        console.log('Page hidden - syncing pending changes');\n        // Note: syncPendingChanges needs events parameter, will be called from component\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [pendingChanges.size]);\n\n  return {\n    // State\n    pendingChanges,\n    lastSyncTime,\n    \n    // Local storage functions\n    saveEventsToLocalStorage,\n    loadEventsFromLocalStorage,\n    \n    // Sync functions\n    markEventForSync,\n    syncPendingChanges,\n    \n    // Setters\n    setPendingChanges,\n    setLastSyncTime\n  };\n}; ","import { useEffect, useCallback } from 'react';\r\n\r\n/**\r\n * Custom hook for keyboard shortcuts\r\n * Handles undo/redo, delete, escape, and other keyboard interactions\r\n * \r\n * Extracted from Calendar.js to separate input handling logic\r\n */\r\nexport const useKeyboardShortcuts = (\r\n  undo, \r\n  redo, \r\n  selectedEvent, \r\n  showDeleteConfirmation,\r\n  onDeleteEvent,\r\n  onPanelClose\r\n) => {\r\n  \r\n  // Keyboard shortcut handler\r\n  const handleKeyboardShortcuts = useCallback((e) => {\r\n    // Only handle shortcuts if no input is focused\r\n    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;\r\n\r\n    // Ctrl+Z for undo\r\n    if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      if (undo) {\r\n        undo();\r\n      }\r\n    }\r\n    // Ctrl+Shift+Z or Ctrl+Y for redo\r\n    else if ((e.ctrlKey && e.shiftKey && e.key === 'Z') || (e.ctrlKey && e.key === 'y')) {\r\n      e.preventDefault();\r\n      if (redo) {\r\n        redo();\r\n      }\r\n    }\r\n    // Delete key for deleting selected event\r\n    else if (e.key === 'Delete' && selectedEvent && !showDeleteConfirmation) {\r\n      e.preventDefault();\r\n      if (onDeleteEvent) {\r\n        onDeleteEvent(selectedEvent);\r\n      }\r\n    }\r\n    // Escape key for closing panels/dialogs\r\n    else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      if (selectedEvent && onPanelClose) {\r\n        onPanelClose();\r\n      }\r\n    }\r\n  }, [undo, redo, selectedEvent, showDeleteConfirmation, onDeleteEvent, onPanelClose]);\r\n\r\n  // Register keyboard event listeners\r\n  useEffect(() => {\r\n    document.addEventListener('keydown', handleKeyboardShortcuts);\r\n    \r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyboardShortcuts);\r\n    };\r\n  }, [handleKeyboardShortcuts]);\r\n\r\n  return {\r\n    handleKeyboardShortcuts\r\n  };\r\n}; ","// Filter events for current week\nexport const getEventsForCurrentWeek = (events, weekDates) => {\n  const weekStart = new Date(weekDates[0]);\n  weekStart.setHours(0, 0, 0, 0);\n\n  const weekEnd = new Date(weekDates[6]);\n  weekEnd.setHours(23, 59, 59, 999);\n\n  return events.filter(event => {\n    const eventStart = new Date(event.start);\n    const eventEnd = new Date(event.end);\n    return eventStart <= weekEnd && eventEnd >= weekStart;\n  });\n};\n\n// Filter events based on active categories\nexport const filterEventsByCategories = (events, categories, calendarColors) => {\n  // Get active category colors\n  const activeCategories = categories.reduce((acc, category) => {\n    if (category.checked) {\n      acc.push(category.color);\n    }\n    return acc;\n  }, []);\n\n  // If no categories are active, show all events\n  if (activeCategories.length === 0) {\n    return events;\n  }\n\n  // Filter events based on category colors\n  return events.filter(event => {\n    if (!event) return false;\n    \n    // ALWAYS show temp events (newly created, not yet saved)\n    if (event.id && String(event.id).startsWith('temp-')) {\n      return true;\n    }\n    \n    // ALWAYS show draft events\n    if (event.isDraft) {\n      return true;\n    }\n\n    // Handle validated events\n    if (event.isValidated === true) {\n      return activeCategories.includes(calendarColors.find(c => c.id === 'blue').color);\n    }\n\n    // Handle unvalidated events\n    if (event.isValidated === false) {\n      return activeCategories.includes(calendarColors.find(c => c.id === 'grey').color);\n    }\n\n    // For events with explicit category colors, use direct matching\n    return activeCategories.includes(event.color);\n  });\n}; "],"names":["CALENDAR_COLORS","id","color","color1","color2","name","MODIFICATION_TYPES","MOVE","RESIZE","PANEL","getMondayBasedDayIndex","date","jsDay","getDay","getWeekDates","currentDate","start","Date","mondayIndex","setDate","getDate","dates","i","push","getShortDays","language","mondayDate","Array","from","length","_","day","toLocaleString","weekday","slice","charAt","toUpperCase","isSameDay","date1","date2","d1","d2","getFullYear","getMonth","getMultipleDays","daysBefore","arguments","undefined","daysAfter","days","startDate","totalDays","getMultipleWeeks","weeksBefore","weeksAfter","weeks","currentWeekStart","startWeek","totalWeeks","weekStart","weekDates","j","_ref","view","setView","navigateDate","setCurrentDate","categories","handleCategoryToggle","onResetCategories","isTopBarMode","onShowFiltersOverlay","scrollContainerRef","isSidebarCollapsed","toggleSidebar","calendarMode","setCalendarMode","isTeamWorkspace","t","useTranslation","showCategoryDropdown","setShowCategoryDropdown","useState","categoryDropdownRef","useRef","useEffect","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","activeCategoriesCount","filter","cat","checked","hasActiveFilters","_jsxs","className","cn","children","_jsx","onClick","today","title","_Fragment","style","height","maxHeight","minHeight","ref","FiFilter","map","category","index","type","onChange","backgroundColor","borderColor","borderWidth","fill","viewBox","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","disabled","FiX","onDateClick","events","visibleWeekStart","visibleWeekEnd","i18n","calendarDate","setCalendarDate","calendarDays","setCalendarDays","showMonthDropdown","setShowMonthDropdown","showYearDropdown","setShowYearDropdown","monthDropdownRef","yearDropdownRef","shortDays","createElement","textContent","head","appendChild","removeChild","newDate","prevDate","currentMonth","currentYear","newMonth","newYear","year","month","firstDay","firstDayOfWeek","daysInMonth","prevMonthDays","prevMonthDaysCount","isCurrentMonth","currentMonthDays","nextMonthDays","remainingDays","navigateMonth","direction","setMonth","monthOptions","value","label","yearOptions","toString","m","e","stopPropagation","monthIndex","handleMonthChange","FiCheck","size","y","setFullYear","handleYearChange","FiChevronLeft","FiChevronRight","substr","dayInfo","isSelected","inVisibleWeek","checkDate","setHours","end","weekEnd","isInSameWeek","isHighlight","isWeekStart","isWeekEnd","dayEvents","eventDate","getEventsForDay","handleDayClick","handleUpcomingEventClick","isMobile","window","innerWidth","scrollbarGutter","MiniCalendar","FiCalendar","sort","a","b","toLocaleDateString","fontSize","FiClock","toLocaleTimeString","hour","minute","hour12","location","FiMapPin","referenceDate","propReferenceDate","numWeeks","numDays","allDays","flat","width","concat","minWidth","isToday","isCurrentDay","dayOfWeek","dayIndex","flexShrink","isMultiDay","isFirstDay","isLastDay","isRecurring","notes","employees","overlapInfo","isOverlapping","isDraft","onMouseDown","onRightClick","isHovered","setIsHovered","eventRef","endDate","heightValue","parseInt","isCompact","isVeryCompact","hexToRgba","hex","opacity","r","g","substring","baseColor","bgColor","textColor","handleMouseDown","useCallback","handleContextMenu","preventDefault","handleClick","positionStyle","display","_objectSpread","borderLeft","boxShadow","onMouseEnter","onMouseLeave","onContextMenu","selectedEventId","getEventsForCurrentWeek","validatedEvents","onEventClick","onEventRightClick","onEventMove","onEventResize","onCreateEvent","externalScrollContainerRef","gridRef","isCreating","setIsCreating","draftEvent","setDraftEvent","initialMouseY","initialStartTime","hasMovedRef","latestDraftRef","MINUTES_INCREMENT","snapToInterval","minutes","getMinutes","remainder","setMinutes","setSeconds","getTimeFromY","snapToHour","normalizedDate","hoursFromTop","hours","seconds","Math","max","min","floor","minutesDecimal","round","getDayFromX","x","gridWidth","calculateEventOverlaps","currentView","eventsWithTimes","startTime","getTime","endTime","column","totalColumns","maxColumns","columns","placed","bestColumn","minOverlaps","Infinity","col","overlappingCount","existingEvent","usedColumns","Set","actualMaxColumns","forEach","processed","has","currentEvent","containmentGroup","add","otherEvent","currentContainsOther","otherContainsCurrent","handleEventMouseDown","button","gridElement","clientY","initialMouseX","clientX","initialStart","initialEnd","duration","scrollContainer","getBoundingClientRect","closest","autoScrollAnimationFrame","currentMouseY","initialScrollTop","scrollTop","performAutoScroll","containerRect","containerTop","top","containerBottom","bottom","distanceFromTop","distanceFromBottom","shouldScroll","scrollAmount","currentScroll","maxScroll","scrollHeight","clientHeight","newScroll","requestAnimationFrame","handleMouseMove","moveEvent","scrollDelta","deltaY","deltaX","abs","rawMinutes","minutesDelta","newStart","snappedStart","newEnd","snappedEnd","originalDay","newDay","startOfDay","endOfDay","handleMouseUp","upEvent","cancelAnimationFrame","handleGridMouseDown","console","log","getAttribute","clickedEvent","gridRect","left","dayDate","draft","now","currentY","currentTime","dayStart","dayEnd","updatedDraft","newEvent","handleGridDoubleClick","onDoubleClick","renderEvents","eventsToRender","rangeStart","activeEvents","isBeingMoved","isBeingResized","normalEvents","findIndex","daysDiff","draftDate","eventStart","eventEnd","getHours","dayWidth","dayLeft","subWidth","position","zIndex","eventToRender","Event","Boolean","onConfirm","onCancel","hasRecurrenceId","recurrenceId","isRecurringEvent","handleKeyDown","key","body","overflow","backdropFilter","currentTarget","borderBottomColor","FiAlertTriangle","fontFamily","lineHeight","marginBottom","border","borderTopColor","onClose","onDelete","onColorChange","colorOptions","menuRef","handleEscape","adjustedPosition","setAdjustedPosition","rect","viewportWidth","viewportHeight","innerHeight","newX","newY","colorOption","ringColor","handleColorSelect","handleDelete","selectedDays","dayNames","getFullDayNames","selectedDaysArray","dayName","newSelectedDays","toggleDay","parseValue","val","isNaN","String","padStart","_unused","dateParts","setDateParts","dayRef","monthRef","yearRef","containerRef","hiddenInputRef","lastValueRef","currentStr","incoming","emitChange","newParts","dateStr","parse","handleFocus","select","field","_dayRef$current","_monthRef$current2","focus","_monthRef$current3","_yearRef$current2","_monthRef$current4","_dayRef$current2","selectionStart","_dayRef$current3","_monthRef$current5","_yearRef$current3","_dayRef$current4","classList","inputMode","placeholder","replace","_monthRef$current","onKeyDown","onFocus","maxLength","_yearRef$current","tabIndex","_hiddenInputRef$curre","showPicker","err","warn","Label","icon","Icon","inputClasses","selectClasses","textareaClasses","_ref2","onSave","userData","workspaceContext","mountTimeRef","selectedWorkspace","useDashboard","formData","setFormData","employee","repeatValue","endRepeatValue","endRepeatCount","endRepeatDate","weeklyDays","monthlyType","monthlyDay","monthlyWeek","monthlyDayOfWeek","validationErrors","setValidationErrors","isValidating","setIsValidating","calculatedEndDate","calculateEndDate","occurrences","selectedCount","weeksNeeded","ceil","defaultWeeklyDays","handleChange","prev","handleDateTimeChange","includes","trim","test","dateValue","timeParts","split","h","formatDateForInput","parseDateSafely","formatTimeForInput","toTimeString","maxWidth","FiTrash2","FiAlertCircle","FiFileText","autoFocus","CustomDateInput","FiAlignLeft","p","FiRepeat","WeekDaySelector","parsedDate","handleSaveWrapper","timeSinceMount","setTimeout","isValidated","fromDatabase","useCalendarState","initialDate","slideDirection","setSlideDirection","weekScrollOffset","setWeekScrollOffset","dayScrollOffset","setDayScrollOffset","setIsSidebarCollapsed","setCategories","showHeaderDateDropdown","setShowHeaderDateDropdown","dropdownPosition","setDropdownPosition","showContextMenu","setShowContextMenu","contextMenuPosition","setContextMenuPosition","contextMenuEvent","setContextMenuEvent","getSeconds","milliseconds","getMilliseconds","handleWeekScroll","prevOffset","newOffset","handleDayScroll","prevCategories","newCategories","handleHeaderDateClick","tagName","handleBackToMiniCalendar","showContextMenuAt","hideContextMenu","handleContextMenuEdit","handleContextMenuDuplicate","handleContextMenuDelete","saveEventFunction","httpsCallable","functions","saveRecurringEventsFunction","checkPermissions","async","uid","error","currentUser","auth","isInitialized","_isInitialized","Promise","resolve","saveEvent","userId","eventId","isAvailability","success","eventData","toISOString","canton","area","languages","experience","software","certifications","workAmount","result","data","message","updateEvent","accountType","forceUpdate","_auth$currentUser","mappedAccountType","originalAccountType","startType","endType","collectionToUse","eventHasFromDatabaseFlag","eventHasValidatedFlag","isForceUpdate","isAuthenticated","userIdParam","updateEventFunction","code","details","stack","saveRecurringEvents","baseEvent","recurringData","count","notificationStore","constructor","this","notifications","listeners","currentId","showNotification","notification","timestamp","notifyListeners","dismissNotification","n","clearAll","getNotifications","subscribe","listener","l","useEventOperations","saveEventsToLocalStorage","setPendingChanges","setEvents","selectedEvent","setSelectedEvent","setSelectedEventId","selectedEventIds","setSelectedEventIds","originalEventPosition","setOriginalEventPosition","setValidatedEvents","showDeleteConfirmation","setShowDeleteConfirmation","eventToDelete","setEventToDelete","showMoveConfirmation","setShowMoveConfirmation","movedEvent","setMovedEvent","originalEventDates","setOriginalEventDates","newEventDates","setNewEventDates","showModificationDialog","setShowModificationDialog","pendingModification","setPendingModification","isSaving","setIsSaving","history","setHistory","currentHistoryIndex","setCurrentHistoryIndex","isDragging","setIsDragging","dragStartTime","setDragStartTime","addToHistory","newHistory","undo","newIndex","previousEvents","find","redo","nextEvents","handleEventClick","ctrlKey","metaKey","prevSelectedIds","timeSinceDragStart","ev","handleEventDoubleClick","handlePanelClose","startsWith","currentEventIndex","currentStart","currentEnd","originalStart","originalEnd","restoredEvents","saveRecurringEventFallback","eventWithDates","shouldClose","isAlreadyProcessedByPanel","baseId","newEvents","existingEventIndex","isNowRecurring","alreadyProcessed","existingRecurring","eventWithUserData","then","updatedEvents","catch","eventToSave","currentlySelectedInstance","handleEventDelete","deleteType","currentEventDate","deleteData","deleteEventFunction","deleteEvent","handleCreateEventClick","handleEventDropOnDay","draggedEvent","targetDate","handleEventSave","updatedEvent","_CALENDAR_COLORS$find","_CALENDAR_COLORS$find2","_CALENDAR_COLORS$find3","c","_CALENDAR_COLORS$find4","_CALENDAR_COLORS$find5","_CALENDAR_COLORS$find6","isNewEvent","prevEvents","handleEventRightClick","handleEventResize","isTemporary","eventIndex","isRecurringInstance","originalEvent","recurringParentId","recurrence","eventForUpdate","handleEventMove","newStartDate","newEndDate","isLastOccurrence","seriesEvents","aEnd","latestEvent","handleModificationConfirm","modificationType","MOVE_SINGLE","newSet","delete","hadRecurrenceId","originalDate","timeDiff","newRecurrenceId","modifiedSeriesEvents","handleModificationConfirmUtil","handleMoveConfirm","handleMoveAllConfirm","handleMoveCancel","handleEventChangeComplete","isOpen","setIsOpen","customColor","setCustomColor","brightness","setBrightness","pickerRef","buttonRef","popupRef","popupPosition","setPopupPosition","showPopup","setShowPopup","positionTimeoutRef","calculatePosition","buttonRect","spaceBelow","spaceAbove","scrollY","scrollX","popupWidth","clearTimeout","adjustBrightness","percent","num","handleColorChange","newColor","adjustedColor1","displayColor","overflowY","newColor1","handlePresetColorClick","HexColorPicker","newBrightness","background","DAYS_OF_WEEK","labelKey","WORKER_TYPES","profileData","editingRole","workerType","workerTypeOther","assignedWorkers","appliesToAllDays","specificDays","showDeleteConfirm","setShowDeleteConfirm","teamMembers","setTeamMembers","loadingTeamMembers","setLoadingTeamMembers","showWorkerSelect","setShowWorkerSelect","selectedHeaderColor","setSelectedHeaderColor","workerErrors","setWorkerErrors","fieldErrors","setFieldErrors","workerInvitations","setWorkerInvitations","generatingInvitation","setGeneratingInvitation","showSuccess","showError","useNotification","previousWorkerTypeRef","previousWorkerTypeOtherRef","assignedPharmacistId","placeholderName","defaultColor","workerId","firstWorkerColor","getUnusedColor","allExistingRoles","get","usedColors","role","worker","_formData$workerTypeO","isInitialSelection","workerTypeChanged","workerTypeOtherChanged","existingRole","_formData$workerTypeO2","mergedWorkers","random","facilityId","facilityRef","doc","db","facilitySnap","getDoc","exists","employeesList","admins","emp","rights","memberPromises","professionalProfileRef","professionalProfileSnap","_professionalData$con","professionalData","identity","firstName","legalFirstName","lastName","legalLastName","email","contact","primaryEmail","isAdmin","userRef","userSnap","members","all","fetchTeamMembers","workers","firstWorkerWithColor","w","useMemo","dayValue","isClosed","openingTime","closingTime","_parts$","_parts$2","parts","rawValue","getWorkerTypeOptions","handleUpdateField","options","member","fullName","newDays","indexOf","newErrors","handleAddWorker","_formData$workerTypeO3","currentWorkers","workerColor","lastWorker","newWorker","handleRemoveWorker","Object","keys","_general","handleUpdateWorker","updatedWorker","validateWorkers","_formData$workerTypeO4","errors","fieldErrs","isValid","handleGenerateInvitation","_formData$workerTypeO5","_formData$workerTypeO6","roleId","generateFacilityRoleInvitation","baseUrl","origin","link","invitationToken","token","handleCopyLink","navigator","clipboard","writeText","handleShareEmail","subject","encodeURIComponent","href","handleShareWhatsApp","text","open","handleSave","currentRequirements","updated","req","existingRoleIndex","_formData$workerTypeO7","newRequirement","DropdownField","required","InputField","allWorkers","newWorkers","_formData$workerTypeO8","workerName","otherRoles","assignedWorkerIdsFromOtherRoles","flatMap","assignedWorkerIdsFromCurrentForm","allAssignedWorkerIds","currentWorkerId","availableTeamMembers","memberId","ColorPicker","FiLoader","FiShare2","next","QRCodeSVG","readOnly","Button","variant","FiCopy","FiMail","FaWhatsapp","every","_formData$workerTypeO9","FiPlus","onUpdateProfileData","isLoadingProfile","navigate","useNavigate","showAddRoleModal","setShowAddRoleModal","setEditingRole","facilityRoles","grouped","employeeId","isArray","empId","expandedFacilityRoles","expanded","rowIndex","uniqueKey","hasOperationalSettings","hasLoadedData","shouldShowEmptyState","shouldShowLoading","getWorkerTypeLabel","getWorkerName","teamMember","FiSettings","_role$worker","_role$worker2","originalRole","roleEvents","employeeName","eventRole","workerRole","employeeRole","eventWorkerType","_role$worker3","_role$worker4","_role$worker5","_role$worker6","xmlns","x1","y1","x2","y2","AddFacilityRoleModal","updatedData","operationalSettings","workerRequirements","updatedRequirements","forceRefresh","isTutorialActive","activeTutorial","useTutorial","_userData$basicInfo","basicInfo","getUserTypeFromData","_userData$user","_userData$user2","firebase_uid","user","getUserIdFromData","isMainSidebarCollapsed","useSidebar","showFiltersOverlay","setShowFiltersOverlay","headerScrollRef","isLoading","updateProfileData","useProfileData","contextMenu","setContextMenu","getWorkspaceContext","originalNavigateDate","originalHandleDayClick","originalHandleUpcomingEventClick","setVisibleWeekStart","diff","setVisibleWeekEnd","setNumDays","prevNumDays","hasInitialScrolled","useLayoutEffect","gridScroll","delta","widthPerDay","clientWidth","scrollLeft","targetWeekIndex","wStart","wEnd","targetScrollLeft","scrollTo","behavior","scrollTimeout","handleScrollUpdate","containerWidth","visibleWeekIndex","visibleWeek","throttledScrollUpdate","passive","pendingChanges","useAutoSync","lastSyncTime","setLastSyncTime","eventsToSave","loadEventsFromLocalStorage","markEventForSync","syncPendingChanges","changesToSync","syncInterval","setInterval","clearInterval","handleBeforeUnload","handleVisibilityChange","visibilityState","fullEvent","handleContextMenuClose","handleEventColorChange","handleGridEventMove","restoreIndex","handleGridEventResize","resizedEvent","handleGridCreateEvent","openPanel","eventWithDefaults","handleKeyboardShortcuts","useKeyboardShortcuts","onDeleteEvent","onPanelClose","shiftKey","filteredEvents","filterEventsByCategories","calendarColors","activeCategories","reduce","acc","calendarEvents","loading","setLoading","setError","getMockEvents","tomorrow","nextWeek","isTutorial","isContract","mockEvents","availabilityQuery","query","collection","where","unsubscribeAvailability","onSnapshot","snapshot","availabilityEvents","Timestamp","toDate","to","eventColor","locationCountry","LocationArea","contractEvents","unsubscribeContracts","professionalQuery","employerQuery","workerQuery","oldEmployerQuery","unsubscribes","contractQuery","unsubscribe","_data$statusLifecycle","status","statusLifecycle","currentStatus","existingContractEvents","contractMap","Map","set","values","unsub","useCalendarEvents","prevCalendarEventsRef","JSON","stringify","_e$start","_e$end","_e$start2","_e$end2","eventsWithDbFlag","tempEvents","activeEventIds","dbEventsMap","mergedEvents","dbEvent","activeEvent","mergedEventsKey","_e$start3","_e$end3","prevEventsKey","_e$start4","_e$end4","historyKey","_e$start5","_e$end5","timeSlots","querySelector","headerScroll","isSyncing","syncFromGrid","syncFromHeader","handleGlobalClick","handleResetCategories","some","CalendarHeader","ResourceGrid","CalendarSidebar","margin","padding","borderRight","boxSizing","onScroll","TimeHeaders","alignSelf","scrollSnapType","scrollBehavior","TimeGrid","EventContextMenu","EventPanel","DeleteConfirmationDialog"],"ignoreList":[],"sourceRoot":""}