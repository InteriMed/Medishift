"use strict";(self.webpackChunkmedishift_deployment_server=self.webpackChunkmedishift_deployment_server||[]).push([[963],{963(e,r,a){a.r(r),a.d(r,{default:()=>u});var i=a(9379),s=a(2483),t=a(7958),n=a(7186),o=a(5821),l=a(2206),d=a(2504),c=a(6935),m=a(2598),x=a(5892),g=a(6723);const u=()=>{var e,r,a,u,f;const{t:h}=(0,t.Bd)(["organization","common"]),{currentUser:p}=(0,d.A)(),{showNotification:b}=(0,c.h)(),[j,y]=(0,s.useState)(null),[N,v]=(0,s.useState)([]),[z,w]=(0,s.useState)(!0),[F,C]=(0,s.useState)(!1),[S,_]=(0,s.useState)(!1),[k,G]=(0,s.useState)(""),I=(0,s.useCallback)(async()=>{if(p){w(!0);try{const r=(0,o.P)((0,o.rJ)(l.db,"organizations"),(0,o._M)("admins","array-contains",p.uid)),a=await(0,o.GG)(r);if(a.empty){const e=(0,o.P)((0,o.rJ)(l.db,"facilityProfiles"),(0,o._M)("__name__","==",p.uid)),r=await(0,o.GG)(e);if(!r.empty){const e=r.docs[0].data();if(e.organizationId){const r=(0,o.P)((0,o.rJ)(l.db,"organizations"),(0,o._M)("__name__","==",e.organizationId)),a=await(0,o.GG)(r);a.empty||y((0,i.A)({id:a.docs[0].id},a.docs[0].data()))}}}else{var e;const r=a.docs[0],s=(0,i.A)({id:r.id},r.data());if(y(s),(null===(e=s.memberFacilityIds)||void 0===e?void 0:e.length)>0){const e=s.memberFacilityIds.map(async e=>{const r=(0,o.P)((0,o.rJ)(l.db,"facilityProfiles"),(0,o._M)("__name__","==",e)),a=await(0,o.GG)(r);return a.empty?null:(0,i.A)({id:a.docs[0].id},a.docs[0].data())}),r=(await Promise.all(e)).filter(Boolean);v(r)}}}catch(r){console.error("Error fetching organization:",r),b(h("organization:errors.fetchFailed","Failed to load organization"),"error")}finally{w(!1)}}},[p,b,h]);(0,s.useEffect)(()=>{I()},[I]);const O=async()=>{if(k.trim()){C(!0);try{const e=(0,n.Qg)(l.functions,"createOrganization");(await e({name:k,type:"group",initialFacilityIds:[p.uid],settings:{sharedStaffPool:!0,crossFacilityScheduling:!0}})).data.success&&(b(h("organization:success.created","Organization created successfully!"),"success"),_(!1),G(""),I())}catch(e){console.error("Error creating organization:",e),b(e.message||h("organization:errors.createFailed","Failed to create organization"),"error")}finally{C(!1)}}else b(h("organization:errors.nameRequired","Organization name is required"),"warning")},P=null===j||void 0===j||null===(e=j.admins)||void 0===e?void 0:e.includes(null===p||void 0===p?void 0:p.uid),R=e=>{var r,a,i;let{facility:s,canRemove:t}=e;return(0,g.jsxs)("div",{className:"bg-card border border-border rounded-xl p-5 hover:shadow-md transition-shadow",children:[(0,g.jsxs)("div",{className:"flex items-start justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3",children:[(0,g.jsx)("div",{className:"p-2.5 rounded-lg bg-primary/10 text-primary",children:(0,g.jsx)(m.V5Y,{className:"w-5 h-5"})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{className:"font-medium text-foreground",children:s.facilityName||s.companyName||h("organization:labels.unnamedFacility")}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground",children:[null===(r=s.address)||void 0===r?void 0:r.city,", ",null===(a=s.address)||void 0===a?void 0:a.canton]}),s.glnNumber&&(0,g.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["GLN: ",s.glnNumber]})]})]}),t&&(0,g.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(h("organization:confirm.removeFacility","Remove this facility from the organization?")))try{const r=(0,n.Qg)(l.functions,"removeFacilityFromOrganization");(await r({organizationId:j.id,facilityId:e})).data.success&&(b(h("organization:success.facilityRemoved","Facility removed successfully!"),"success"),I())}catch(r){console.error("Error removing facility:",r),b(r.message||h("organization:errors.removeFacilityFailed","Failed to remove facility"),"error")}})(s.id),className:"p-2 text-muted-foreground hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:h("organization:actions.remove","Remove from organization"),children:(0,g.jsx)(m.yGN,{className:"w-4 h-4"})})]}),(null===(i=s.chainAdmins)||void 0===i?void 0:i.length)>0&&(0,g.jsx)("div",{className:"mt-3 pt-3 border-t border-border",children:(0,g.jsxs)("div",{className:"flex items-center gap-2 text-xs text-green-600",children:[(0,g.jsx)(m.pcC,{className:"w-3.5 h-3.5"}),(0,g.jsx)("span",{children:h("organization:labels.chainAdminsSynced","Chain admins synced")})]})})]})},A=()=>(0,g.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,g.jsxs)("div",{className:"bg-card rounded-xl shadow-xl max-w-md w-full",children:[(0,g.jsxs)("div",{className:"p-6 border-b border-border",children:[(0,g.jsx)("h3",{className:"text-xl font-semibold text-foreground",children:h("organization:create.title","Create Organization")}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:h("organization:create.subtitle","Create a new pharmacy chain or group")})]}),(0,g.jsxs)("div",{className:"p-6",children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:h("organization:create.nameLabel","Organization Name")}),(0,g.jsx)("input",{type:"text",value:k,onChange:e=>G(e.target.value),placeholder:h("organization:create.namePlaceholder","e.g., Amavita Geneva Group"),className:"w-full px-4 py-2.5 rounded-lg border border-border bg-background text-foreground focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all"})]}),(0,g.jsxs)("div",{className:"p-6 border-t border-border flex gap-3 justify-end",children:[(0,g.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 text-muted-foreground hover:text-foreground transition-colors",children:h("common:cancel","Cancel")}),(0,g.jsx)("button",{onClick:O,disabled:F||!k.trim(),className:(0,x.cn)("px-4 py-2 bg-primary text-primary-foreground rounded-lg font-medium","hover:bg-primary/90 transition-colors",(F||!k.trim())&&"opacity-50 cursor-not-allowed"),children:F?(0,g.jsxs)("span",{className:"flex items-center gap-2",children:[(0,g.jsx)(m.jTZ,{className:"w-4 h-4 animate-spin"}),h("common:creating","Creating...")]}):h("common:create","Create")})]})]})}),T=()=>(0,g.jsxs)("div",{className:"text-center py-16",children:[(0,g.jsx)("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-primary/10 flex items-center justify-center",children:(0,g.jsx)(m.cfS,{className:"w-10 h-10 text-primary"})}),(0,g.jsx)("h3",{className:"text-xl font-semibold text-foreground mb-2",children:h("organization:empty.title","No Organization Yet")}),(0,g.jsx)("p",{className:"text-muted-foreground max-w-md mx-auto mb-6",children:h("organization:empty.description","Create an organization to manage multiple pharmacy locations, share staff, and consolidate billing.")}),(0,g.jsxs)("button",{onClick:()=>_(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors",children:[(0,g.jsx)(m.GGD,{className:"w-4 h-4"}),h("organization:actions.create","Create Organization")]})]});return(0,g.jsxs)("div",{className:"h-full flex flex-col overflow-hidden animate-in fade-in duration-500",children:[(0,g.jsx)("div",{className:"shrink-0 p-6 border-b border-border bg-card/50",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:(null===j||void 0===j?void 0:j.name)||h("organization:title","Organization")}),(0,g.jsx)("p",{className:"text-muted-foreground mt-1",children:j?h("organization:subtitle","Manage your pharmacy chain"):h("organization:noOrg","Create or join an organization")})]}),j&&(0,g.jsxs)("button",{onClick:I,disabled:z,className:(0,x.cn)("flex items-center gap-2 px-4 py-2 rounded-lg border border-border","hover:bg-muted transition-colors",z&&"opacity-50 cursor-not-allowed"),children:[(0,g.jsx)(m.jTZ,{className:(0,x.cn)("w-4 h-4",z&&"animate-spin")}),h("common:refresh","Refresh")]})]})}),(0,g.jsx)("div",{className:"flex-1 overflow-auto p-6",children:z?(0,g.jsx)("div",{className:"flex items-center justify-center py-16",children:(0,g.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}):j?(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"bg-card border border-border rounded-xl p-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,g.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:h("organization:sections.info","Organization Info")}),P&&(0,g.jsxs)("button",{className:"text-sm text-primary hover:text-primary/80 flex items-center gap-1",children:[(0,g.jsx)(m.VSk,{className:"w-4 h-4"}),h("common:settings","Settings")]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg",children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:h("organization:labels.type","Type")}),(0,g.jsx)("p",{className:"font-medium capitalize",children:j.type||h("organization:labels.group")})]}),(0,g.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg",children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:h("organization:labels.facilities","Facilities")}),(0,g.jsx)("p",{className:"font-medium",children:N.length})]}),(0,g.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg",children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:h("organization:labels.admins","Admins")}),(0,g.jsx)("p",{className:"font-medium",children:(null===(r=j.admins)||void 0===r?void 0:r.length)||0})]})]}),(0,g.jsx)("div",{className:"mt-4 pt-4 border-t border-border",children:(0,g.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(null===(a=j.settings)||void 0===a?void 0:a.sharedStaffPool)&&(0,g.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-transparent text-green-700 border border-green-700",children:[(0,g.jsx)(m.YrT,{className:"w-3 h-3"}),h("organization:settings.sharedStaff","Shared Staff Pool")]}),(null===(u=j.settings)||void 0===u?void 0:u.crossFacilityScheduling)&&(0,g.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-transparent text-blue-700 border border-blue-700",children:[(0,g.jsx)(m.YrT,{className:"w-3 h-3"}),h("organization:settings.crossScheduling","Cross-Facility Scheduling")]}),(null===(f=j.settings)||void 0===f?void 0:f.consolidatedBilling)&&(0,g.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-transparent text-purple-700 border border-purple-700",children:[(0,g.jsx)(m.YrT,{className:"w-3 h-3"}),h("organization:settings.consolidatedBilling","Consolidated Billing")]})]})})]}),(0,g.jsxs)("div",{className:"bg-card border border-border rounded-xl p-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,g.jsxs)("h3",{className:"text-lg font-semibold text-foreground",children:[h("organization:sections.facilities","Member Facilities"),N.length>0&&(0,g.jsxs)("span",{className:"ml-2 text-sm font-normal text-muted-foreground",children:["(",N.length,")"]})]}),P&&(0,g.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg font-medium text-sm hover:bg-primary/90 transition-colors",children:[(0,g.jsx)(m.ayE,{className:"w-4 h-4"}),h("organization:actions.addFacility","Add Facility")]})]}),0===N.length?(0,g.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:h("organization:facilities.empty","No facilities in this organization yet.")}):(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(e=>(0,g.jsx)(R,{facility:e,canRemove:P&&N.length>1},e.id))})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,g.jsx)("div",{className:"p-2 rounded-lg bg-blue-100 text-blue-600",children:(0,g.jsx)(m.cfS,{className:"w-5 h-5"})}),(0,g.jsx)("h4",{className:"font-semibold text-blue-900",children:h("organization:features.internalInterim.title","Internal Interim")})]}),(0,g.jsx)("p",{className:"text-sm text-blue-700",children:h("organization:features.internalInterim.description","Share staff between facilities. When understaffed, borrow workers from other locations in your organization first.")})]}),(0,g.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200 rounded-xl p-6",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,g.jsx)("div",{className:"p-2 rounded-lg bg-purple-100 text-purple-600",children:(0,g.jsx)(m.V5Y,{className:"w-5 h-5"})}),(0,g.jsx)("h4",{className:"font-semibold text-purple-900",children:h("organization:features.crossReports.title","Cross-Facility Reports")})]}),(0,g.jsx)("p",{className:"text-sm text-purple-700",children:h("organization:features.crossReports.description","Track hours borrowed between locations. View consolidated reports for the entire organization.")})]})]})]}):(0,g.jsx)(T,{})}),S&&(0,g.jsx)(A,{})]})}}}]);
//# sourceMappingURL=963.8b81bf53.chunk.js.map