"use strict";(self.webpackChunkmedishift_deployment_server=self.webpackChunkmedishift_deployment_server||[]).push([[7213],{7213(e,t,r){r.r(t),r.d(t,{default:()=>de});var o=r(9379),n=r(2483),a=r(7958);const s=[{id:"blue",color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb",name:"Personal"},{id:"red",color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",name:"Missing employees"},{id:"purple",color:"#6c6ce7",color1:"#e6e6ff",color2:"#a08dfc",name:"Waiting for confirmation"},{id:"green",color:"#0da71c",color1:"#ccffce",color2:"#32cb65",name:"Approved employee"},{id:"grey",color:"#8c8c8c",color1:"#e6e6e6",color2:"#b3b3b3",name:"Unvalidated"}],i={MOVE:"move",RESIZE:"resize",PANEL:"panel"},l=e=>{const t=e.getDay();return 0===t?6:t-1},c=e=>{const t=new Date(e),r=l(t);t.setDate(t.getDate()-r);const o=[];for(let n=0;n<7;n++){const e=new Date(t);e.setDate(t.getDate()+n),o.push(e)}return o},d=e=>{const t=new Date(2e3,0,3);return Array.from({length:7},(r,o)=>{const n=new Date(t);n.setDate(t.getDate()+o);const a=n.toLocaleString(e,{weekday:"short"}).slice(0,3);return a.charAt(0).toUpperCase()+a.slice(1)})},u=(e,t)=>{if(!e||!t)return!1;const r=e instanceof Date?e:new Date(e),o=t instanceof Date?t:new Date(t);return r.getFullYear()===o.getFullYear()&&r.getMonth()===o.getMonth()&&r.getDate()===o.getDate()},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;const o=[],n=new Date(e);n.setDate(n.getDate()-t);const a=t+1+r;for(let s=0;s<a;s++){const e=new Date(n);e.setDate(n.getDate()+s),o.push(e)}return o},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const o=[],n=new Date(e),a=l(n);n.setDate(n.getDate()-a);const s=new Date(n);s.setDate(s.getDate()-7*t);const i=t+1+r;for(let l=0;l<i;l++){const e=new Date(s);e.setDate(s.getDate()+7*l);const t=[];for(let r=0;r<7;r++){const o=new Date(e);o.setDate(e.getDate()+r),t.push(o)}o.push(t)}return o};var p=r(2598),h=r(5892),f=r(6723);const v=e=>{let{currentDate:t,view:r,setView:o,navigateDate:s,setCurrentDate:i,categories:l,handleCategoryToggle:c,onResetCategories:d,isTopBarMode:u=!1,onShowFiltersOverlay:m,scrollContainerRef:g,isSidebarCollapsed:v,toggleSidebar:x,calendarMode:y,setCalendarMode:b,isTeamWorkspace:w=!1}=e;const{t:k}=(0,a.Bd)(),[D,j]=(0,n.useState)(!1),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{const e=e=>{N.current&&!N.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const C=l.filter(e=>e.checked).length,T=C<l.length;return(0,f.jsxs)("div",{className:(0,h.cn)("flex flex-col md:flex-row items-center justify-between gap-4 w-full",u&&"h-full"),children:[(0,f.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,f.jsx)("button",{className:(0,h.cn)("flex items-center gap-2 px-3 h-9 text-sm font-medium rounded-lg transition-all border","bg-background border-border text-muted-foreground hover:text-foreground"),onClick:()=>{const e=new Date;i(e)},title:k("calendar:today"),children:k("calendar:today")}),"calendar"===y&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"h-6 w-px bg-border/50 hidden md:block"}),(0,f.jsxs)("div",{className:"flex items-center h-10 px-0.5 py-0.5 bg-muted/50 rounded-lg border border-border/50",children:[(0,f.jsx)("button",{className:(0,h.cn)("px-3 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0","day"===r?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),style:{height:"36px",maxHeight:"36px",minHeight:"36px"},onClick:()=>{o("day")},children:k("calendar:dayView")}),(0,f.jsx)("button",{className:(0,h.cn)("px-3 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0","week"===r?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),style:{height:"36px",maxHeight:"36px",minHeight:"36px"},onClick:()=>o("week"),children:k("calendar:weekView")})]})]})]}),w&&(0,f.jsxs)("div",{className:"flex items-center h-10 px-0.5 py-0.5 bg-muted/50 rounded-lg border border-border/50 absolute left-1/2 -translate-x-1/2",children:[(0,f.jsx)("button",{className:(0,h.cn)("px-4 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0","calendar"===y?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),style:{height:"36px",maxHeight:"36px",minHeight:"36px"},onClick:()=>b("calendar"),children:k("calendar:calendarView","Calendar")}),(0,f.jsx)("button",{className:(0,h.cn)("px-4 text-xs font-medium rounded-md transition-all flex items-center justify-center focus:outline-none h-9 shrink-0","team"===y?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),style:{height:"36px",maxHeight:"36px",minHeight:"36px"},onClick:()=>b("team"),children:k("calendar:teamView","Team")})]}),"calendar"===y&&(0,f.jsxs)("div",{className:"flex items-center gap-2 flex-1 justify-end",children:[(0,f.jsxs)("div",{className:"relative",ref:N,children:[(0,f.jsxs)("button",{className:(0,h.cn)("flex items-center gap-2 px-3 h-9 text-sm font-medium rounded-lg transition-all border",D?"bg-secondary border-border/60 text-foreground":"bg-background border-border text-muted-foreground hover:text-foreground"),onClick:()=>j(!D),title:k("calendar:filterCategories"),children:[(0,f.jsx)(p.K7R,{className:"w-3.5 h-3.5"}),T&&(0,f.jsx)("span",{className:"flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[10px] text-primary-foreground font-bold",children:C})]}),D&&(0,f.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-64 bg-card rounded-lg shadow-xl border border-border p-2 z-30 animate-in fade-in zoom-in-95 duration-200",children:[(0,f.jsxs)("div",{className:"px-3 py-2 border-b border-border/50 mb-2 flex justify-between items-center",children:[(0,f.jsx)("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:k("calendar:categories")}),T&&(0,f.jsx)("button",{onClick:d,className:"text-[10px] text-primary hover:underline",children:k("calendar:reset")})]}),(0,f.jsx)("div",{className:"space-y-1 max-h-[300px] overflow-y-auto",children:l.map((e,t)=>(0,f.jsxs)("label",{className:"flex items-center gap-3 px-3 py-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors group",children:[(0,f.jsxs)("div",{className:"relative flex items-center",children:[(0,f.jsx)("input",{type:"checkbox",checked:e.checked,onChange:()=>c(t),className:"peer h-4 w-4 rounded border text-primary focus:ring-1 focus:ring-primary/20 cursor-pointer transition-all appearance-none bg-background",style:{backgroundColor:e.checked?e.color:"transparent",borderColor:e.color,borderWidth:"1px"}}),(0,f.jsx)("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]}),(0,f.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,f.jsx)("span",{className:"text-xs font-medium text-foreground",children:e.name})})]},t))})]})]}),(0,f.jsx)("button",{onClick:d,className:(0,h.cn)("h-9 w-9 flex items-center justify-center rounded-lg border border-border hover:bg-muted text-muted-foreground transition-all",!T&&"opacity-50 cursor-not-allowed hover:bg-transparent"),disabled:!T,title:k("calendar:resetAll"),children:(0,f.jsx)(p.yGN,{className:"w-3.5 h-3.5"})})]})]})},x=e=>{let{currentDate:t,onDateClick:r,events:o=[],view:s="week",visibleWeekStart:i,visibleWeekEnd:l}=e;const{t:m,i18n:g}=(0,a.Bd)(),[v,x]=(0,n.useState)(new Date(t)),[y,b]=(0,n.useState)([]),[w,k]=(0,n.useState)(!1),[D,j]=(0,n.useState)(!1),N=(0,n.useRef)(null),C=(0,n.useRef)(null),T=d(g.language);(0,n.useEffect)(()=>{const e=document.createElement("style");return e.textContent="\n      .minicalendar-selected-day:hover {\n        background-color: var(--color-logo-2) !important;\n        color: white !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,n.useEffect)(()=>{const e=new Date(t);x(t=>{const r=t.getMonth(),o=t.getFullYear(),n=e.getMonth(),a=e.getFullYear();return r!==n||o!==a?e:t})},[t]),(0,n.useEffect)(()=>{const e=v.getFullYear(),t=v.getMonth(),r=new Date(e,t,1),o=0===r.getDay()?6:r.getDay()-1,n=new Date(e,t+1,0).getDate(),a=[];if(o>0){const r=new Date(e,t,0).getDate();for(let n=r-o+1;n<=r;n++)a.push({date:new Date(e,t-1,n),isCurrentMonth:!1})}const s=[];for(let c=1;c<=n;c++)s.push({date:new Date(e,t,c),isCurrentMonth:!0});const i=[],l=42-(a.length+s.length);for(let c=1;c<=l;c++)i.push({date:new Date(e,t+1,c),isCurrentMonth:!1});b([...a,...s,...i])},[v]),(0,n.useEffect)(()=>{const e=e=>{N.current&&!N.current.contains(e.target)&&k(!1),C.current&&!C.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const S=e=>{const t=new Date(v);t.setMonth(t.getMonth()+e),x(t)},E=Array.from({length:12},(e,t)=>({value:t,label:new Date(2024,t,1).toLocaleString(g.language,{month:"long"})})),A=(new Date).getFullYear(),I=Array.from({length:21},(e,t)=>{const r=A-10+t;return{value:r,label:r.toString()}});return(0,f.jsxs)("div",{className:"w-full bg-card rounded-xl border border-border/60 p-4 select-none",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-0 px-1",children:[(0,f.jsxs)("div",{className:"flex items-center gap-1.5 text-sm font-semibold text-foreground",children:[(0,f.jsxs)("div",{className:"relative group cursor-pointer hover:bg-muted/50 px-2.5 py-1.5 rounded-lg transition-colors",onClick:()=>{k(!w),j(!1)},ref:N,children:[(0,f.jsx)("span",{className:"capitalize",children:v.toLocaleString(g.language,{month:"long"})}),w&&(0,f.jsx)("div",{className:"absolute top-full left-0 mt-1 w-36 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto z-30 py-1",children:E.map(e=>(0,f.jsxs)("div",{className:(0,h.cn)("px-3 py-2 hover:bg-muted text-sm cursor-pointer flex justify-between items-center",v.getMonth()===e.value&&"bg-primary/10 text-primary font-medium"),onClick:t=>{t.stopPropagation(),(e=>{const t=new Date(v);t.setMonth(e),x(t),k(!1)})(e.value)},children:[e.label,v.getMonth()===e.value&&(0,f.jsx)(p.YrT,{size:14})]},e.value))})]}),(0,f.jsxs)("div",{className:"relative group cursor-pointer hover:bg-muted/50 px-2.5 py-1.5 rounded-lg transition-colors",onClick:()=>{j(!D),k(!1)},ref:C,children:[(0,f.jsx)("span",{children:v.getFullYear().toString()}),D&&(0,f.jsx)("div",{className:"absolute top-full left-0 mt-1 w-24 bg-popover border border-border rounded-lg shadow-lg max-h-48 overflow-y-auto z-30 py-1",children:I.map(e=>(0,f.jsxs)("div",{className:(0,h.cn)("px-3 py-2 hover:bg-muted text-sm cursor-pointer flex justify-between items-center",v.getFullYear()===e.value&&"bg-primary/10 text-primary font-medium"),onClick:t=>{t.stopPropagation(),(e=>{const t=new Date(v);t.setFullYear(e),x(t),j(!1)})(e.value)},children:[e.label,v.getFullYear()===e.value&&(0,f.jsx)(p.YrT,{size:14})]},e.value))})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)("button",{className:"p-1.5 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground transition-colors",onClick:()=>S(-1),children:(0,f.jsx)(p.irw,{size:16})}),(0,f.jsx)("button",{className:"p-1.5 hover:bg-muted rounded-lg text-muted-foreground hover:text-foreground transition-colors",onClick:()=>S(1),children:(0,f.jsx)(p.fOo,{size:16})})]})]}),(0,f.jsx)("div",{className:"grid grid-cols-7 mb-2.5 text-center",children:T.map((e,t)=>(0,f.jsx)("div",{className:"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider py-1.5",children:e.substr(0,1)},t))}),(0,f.jsx)("div",{className:"grid grid-cols-7 gap-y-2",children:y.map((e,n)=>{const{date:a,isCurrentMonth:d}=e,m=u(a,t),g="week"===s&&(e=>{if("week"!==s)return!1;if(i&&l){const t=new Date(e);t.setHours(12,0,0,0);const r=new Date(i);r.setHours(0,0,0,0);const o=new Date(l);return o.setHours(23,59,59,999),t>=r&&t<=o}const r=c(t),o=new Date(r[0]);o.setHours(0,0,0,0);const n=new Date(r[6]);n.setHours(23,59,59,999);const a=new Date(e);return a.setHours(0,0,0,0),a>=o&&a<=n})(a),p=m||g,v=n%7===0,x=n%7===6,y=(e=>o.filter(t=>{const r=new Date(t.start);return u(r,e)}))(a);return(0,f.jsxs)("div",{onClick:()=>(e=>{r&&r(e)})(a),className:(0,h.cn)("relative flex items-center justify-center text-sm cursor-pointer transition-all h-9",p?"w-full":"w-9 mx-auto rounded-lg",p&&"week"===s?(0,h.cn)(v&&"rounded-l-lg",x&&"rounded-r-lg"):"rounded-lg",d||p?p?"text-foreground font-bold":"text-foreground":"text-muted-foreground/30",!p&&"hover:bg-muted/50"),style:p?{backgroundColor:"color-mix(in srgb, var(--color-logo-1), transparent 85%)"}:{},children:[(0,f.jsx)("span",{className:"z-10 relative",children:a.getDate()}),y.length>0&&(0,f.jsx)("div",{className:"absolute bottom-0 flex gap-0.5 justify-center",children:y.length>3?(0,f.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-primary/70"}):y.slice(0,3).map((e,t)=>(0,f.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-primary/60"},t))})]},n)})})]})},y=e=>{let{currentDate:t,setCurrentDate:r,handleDayClick:o,events:n,handleUpcomingEventClick:s,isSidebarCollapsed:i,toggleSidebar:l,view:c,visibleWeekStart:d,visibleWeekEnd:u}=e;const{t:m}=(0,a.Bd)();if(i)return null;const g="undefined"!==typeof window&&window.innerWidth<768;return(0,f.jsxs)("div",{className:(0,h.cn)("h-full flex flex-col overflow-y-auto custom-scrollbar",g?"gap-0":"gap-4"),style:{scrollbarGutter:"stable"},children:[(0,f.jsx)("div",{className:g?"mb-0":"",children:(0,f.jsx)(x,{currentDate:t,onDateClick:o,events:n,view:c,visibleWeekStart:d,visibleWeekEnd:u})}),(0,f.jsxs)("div",{className:(0,h.cn)("flex-1 flex flex-col min-h-0 bg-card border p-0 overflow-hidden shadow-sm",g?"rounded-none border-x-0 border-b-0 border-t":"rounded-xl border-border/60"),children:[(0,f.jsx)("div",{className:"flex items-center justify-center px-4 pt-4 pb-2 border-b border-border/50 bg-muted/20",children:(0,f.jsxs)("h4",{className:"text-sm font-semibold text-foreground flex items-center gap-2 m-0",children:[(0,f.jsx)(p.wIk,{className:"w-4 h-4 text-primary"}),m("calendar:upcomingEvents")]})}),(0,f.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2",style:{scrollbarGutter:"stable"},children:n&&n.length>0?(0,f.jsx)("div",{className:"space-y-1",children:n.filter(e=>new Date(e.start)>new Date).sort((e,t)=>new Date(e.start)-new Date(t.start)).slice(0,5).map((e,t)=>(0,f.jsxs)("div",{className:"group flex gap-3 p-3 rounded-lg hover:bg-muted/50 transition-all duration-200 cursor-pointer border border-transparent hover:border-border/50",onClick:()=>s(e.start),children:[(0,f.jsxs)("div",{className:"flex flex-col items-center justify-center w-12 h-12 rounded-lg bg-primary/5 border border-primary/10 shrink-0 group-hover:bg-primary/10 transition-colors",children:[(0,f.jsx)("span",{className:"text-[10px] uppercase font-bold text-primary/70",children:new Date(e.start).toLocaleDateString(void 0,{month:"short"})}),(0,f.jsx)("span",{className:"text-xl font-bold text-primary leading-none mt-0.5",children:new Date(e.start).getDate()})]}),(0,f.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[(0,f.jsx)("h5",{className:"text-sm font-medium text-foreground truncate",children:e.title||m("calendar:untitledEvent")}),(0,f.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-muted-foreground",children:[(0,f.jsxs)("span",{className:"flex items-center gap-1",style:{fontSize:"var(--font-size-small)"},children:[(0,f.jsx)(p.Ohp,{className:"w-3 h-3"}),(0,f.jsxs)("span",{style:{fontSize:"var(--font-size-small)"},children:[new Date(e.start).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})," - ",new Date(e.end).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})]})]}),e.location&&(0,f.jsxs)("span",{className:"flex items-center gap-1 truncate",children:[(0,f.jsx)(p.HzC,{className:"w-3 h-3"}),(0,f.jsx)("span",{className:"truncate max-w-[100px]",children:e.location})]})]})]}),(0,f.jsx)("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 duration-200",children:(0,f.jsx)(p.fOo,{className:"w-4 h-4 text-muted-foreground"})})]},t))}):(0,f.jsxs)("div",{className:"flex flex-col items-center justify-center h-40 text-center text-muted-foreground",children:[(0,f.jsx)("div",{className:"w-10 h-10 rounded-full bg-muted/50 flex items-center justify-center mb-3",children:(0,f.jsx)(p.wIk,{className:"w-5 h-5 opacity-40"})}),(0,f.jsx)("p",{className:"text-sm font-medium",children:m("calendar:noUpcomingEvents")}),(0,f.jsx)("p",{className:"text-xs opacity-60 mt-1",children:m("calendar:checkBackLater")})]})})]})]})},b=e=>{let{currentDate:t,referenceDate:r,view:o,handleDayClick:n,scrollContainerRef:s,numWeeks:i=7,numDays:l=30}=e;const{t:c,i18n:p}=(0,a.Bd)(),h=new Date,v=r||t;let x;if("day"===o){x=m(v,0,0)}else{const e=g(v,i,i);x=e.flat()}const y=d(p.language);return(0,f.jsx)("div",{className:"flex py-2",style:{width:"".concat("day"===o?100*x.length:x.length*(100/7),"%"),minWidth:"".concat("day"===o?100*x.length:x.length*(100/7),"%")},children:x.map((e,r)=>{const o=u(e,h),a=u(e,t),s=e.getDay(),i=0===s?6:s-1;return(0,f.jsxs)("div",{onClick:()=>n(e),className:"flex flex-col items-center justify-center cursor-pointer transition-colors hover:bg-muted/50 pb-2",style:{width:"".concat(100/x.length,"%"),flexShrink:0,minWidth:"".concat(100/x.length,"%"),minHeight:"3rem"},children:[(0,f.jsx)("div",{className:"text-[10px] uppercase font-semibold text-muted-foreground tracking-wider mb-1",children:y[i]}),(0,f.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold transition-all ".concat(o?"bg-primary text-primary-foreground":a?"bg-muted text-foreground":"text-foreground"),children:e.getDate()})]},r)})})},w=e=>{let{id:t,start:r,end:a,title:s,color:i,color1:l,isSelected:c,isMultiDay:d,isFirstDay:u,isLastDay:m,isRecurring:g=!1,notes:p,location:v,employees:x,style:y,overlapInfo:b,currentDate:w,isOverlapping:k=!1,isDraft:D=!1,onMouseDown:j,onRightClick:N,onClick:C}=e;const[T,S]=(0,n.useState)(!1),E=(0,n.useRef)(null),A=r instanceof Date?r:new Date(r),I=a instanceof Date?a:new Date(a),R=null!==y&&void 0!==y&&y.height?parseInt(y.height):60,M=R<35,W=R<25,O=(e,t)=>{if(!e)return"rgba(0, 0, 0, ".concat(t,")");let r=0,o=0,n=0;return 4===e.length?(r=parseInt(e[1]+e[1],16),o=parseInt(e[2]+e[2],16),n=parseInt(e[3]+e[3],16)):7===e.length&&(r=parseInt(e.substring(1,3),16),o=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16)),"rgba(".concat(r,", ").concat(o,", ").concat(n,", ").concat(t,")")},L=i||"#2563eb",P=O(L,D?.25:.15),z=L,F=L,V=(0,n.useCallback)(function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"move";e.stopPropagation(),null===j||void 0===j||j(e,{id:t,start:r,end:a,title:s,color:i,color1:l,notes:p,location:v,employees:x,isRecurring:g},o)},[t,r,a,s,i,l,p,v,x,g,j]),H=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),null===N||void 0===N||N(e,{id:t,start:r,end:a,title:s,color:i,color1:l,notes:p,location:v,employees:x,isRecurring:g})},[t,r,a,s,i,l,p,v,x,g,N]),q=(0,n.useCallback)(e=>{e.stopPropagation(),null===C||void 0===C||C({id:t,start:r,end:a,title:s,color:i,color1:l,notes:p,location:v,employees:x,isRecurring:g},e)},[t,r,a,s,i,l,p,v,x,g,C]),B=y||{display:"none"};return(0,f.jsxs)("div",{ref:E,"data-event-id":t,className:(0,h.cn)("absolute rounded-md transition-shadow select-none overflow-hidden group","z-1 cursor-grab hover:z-2",c&&"ring-2 ring-offset-1 ring-primary",k&&"opacity-90",D&&"opacity-70 border-dashed"),style:(0,o.A)((0,o.A)({},B),{},{backgroundColor:P,borderLeft:"3px solid ".concat(z),boxShadow:T?"0 4px 12px rgba(0,0,0,0.15)":"none"}),onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onMouseDown:e=>V(e,"move"),onContextMenu:H,onClick:q,children:[(!d||u)&&(0,f.jsx)("div",{className:(0,h.cn)("absolute top-0 left-0 right-0 h-2 cursor-ns-resize z-2","bg-transparent hover:bg-white/30 transition-colors",T?"opacity-100":"opacity-0"),onMouseDown:e=>{e.stopPropagation(),V(e,"resize-top")}}),(0,f.jsxs)("div",{className:"flex flex-col h-full w-full px-2 py-1 text-xs leading-tight min-h-[0px] relative",children:[(0,f.jsx)("span",{className:"font-semibold truncate",style:{fontSize:"16px",color:F},children:s||(D?"New Event":"(No Title)")}),!W&&(0,f.jsxs)("span",{className:"text-[10px] opacity-80 truncate",style:{color:F},children:[A.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),!M&&" - ".concat(I.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))]}),!M&&v&&(0,f.jsxs)("span",{className:"text-[10px] opacity-70 truncate mt-0.5",style:{color:F},children:["\ud83d\udccd ",v]})]}),g&&(0,f.jsx)("div",{className:"absolute top-1 right-1 text-[8px] opacity-60",style:{color:F},children:(0,f.jsx)("i",{className:"fas fa-redo-alt"})}),(!d||m)&&(0,f.jsx)("div",{className:(0,h.cn)("absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize z-2","bg-transparent hover:bg-white/30 transition-colors",T?"opacity-100":"opacity-0"),onMouseDown:e=>{e.stopPropagation(),V(e,"resize-bottom")}})]})},k=e=>{let{view:t,events:r,selectedEventId:a,currentDate:s,getEventsForCurrentWeek:i,validatedEvents:l,onEventClick:c,onEventRightClick:d,onEventMove:u,onEventResize:p,onCreateEvent:h,scrollContainerRef:v,numWeeks:x=7,numDays:y=30,referenceDate:b}=e;const k=(0,n.useRef)(null),[D,j]=((0,n.useRef)(null),(0,n.useState)(!1)),[N,C]=(0,n.useState)(null),T=(0,n.useRef)(0),S=(0,n.useRef)(null),E=(0,n.useRef)(!1),A=(0,n.useRef)(null),I=b||s;let R;if("day"===t){R=m(I,0,0)}else{const e=g(I,x,x);R=e.flat()}const M=15,W=(0,n.useCallback)(e=>{const t=new Date(e),r=t.getMinutes(),o=r%M;return 0!==o&&(o<7.5?t.setMinutes(r-o):t.setMinutes(r+(M-o))),t.setSeconds(0,0),t},[]),O=(0,n.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);if(e<=0)return o;const n=e/60;let a,s,i;if(r)a=Math.max(0,Math.min(23,Math.floor(n))),s=0,i=0;else{a=Math.max(0,Math.min(23,Math.floor(n)));const e=60*(n-Math.floor(n));s=Math.round(e/M)*M,i=0}const l=new Date(o);return l.setHours(a,s,i,0),l},[]),L=(0,n.useCallback)((e,t)=>{const r=R.length,o=Math.floor(e/t*r);return R[Math.max(0,Math.min(r-1,o))]},[R]),P=(e,t)=>{if(0===e.length)return[];const r=e.map(e=>(0,o.A)((0,o.A)({},e),{},{startTime:new Date(e.start).getTime(),endTime:new Date(e.end).getTime(),column:0,totalColumns:1,isOverlapping:!1}));if(r.sort((e,t)=>e.startTime===t.startTime?e.endTime-t.endTime:e.startTime-t.startTime),"day"===t){const e=6,t=Array(e).fill(null).map(()=>[]);for(const a of r){let r=!1,o=0,n=1/0;for(let s=0;s<e;s++){const e=t[s].filter(e=>a.startTime<e.endTime&&a.endTime>e.startTime).length;if(0===e){t[s].push(a),a.column=s,r=!0;break}e<n&&(n=e,o=s)}r||(t[o].push(a),a.column=o,a.isOverlapping=!0)}const o=new Set(r.map(e=>e.column)),n=Math.min(e,Math.max(1,o.size));r.forEach(e=>{e.totalColumns=n})}else{const e=2,t=new Set;for(let o=0;o<r.length;o++){if(t.has(o))continue;const n=r[o],a=[n];t.add(o);for(let s=o+1;s<r.length;s++){if(t.has(s))continue;const o=r[s];if(n.startTime<o.endTime&&n.endTime>o.startTime){const r=n.startTime<=o.startTime&&n.endTime>=o.endTime,i=o.startTime<=n.startTime&&o.endTime>=n.endTime;if((r||i)&&(a.push(o),t.add(s),a.length>=e))break}}a.length>1&&(a.sort((e,t)=>e.startTime===t.startTime?e.endTime-t.endTime:e.startTime-t.startTime),a.forEach((t,r)=>{t.column=r,t.totalColumns=Math.min(e,a.length)}))}for(let o=0;o<r.length;o++){const e=r[o];if(1===e.totalColumns)for(let t=0;t<r.length;t++){if(o===t)continue;const n=r[t];if(e.startTime<n.endTime&&e.endTime>n.startTime){const t=e.startTime<=n.startTime&&e.endTime>=n.endTime,r=n.startTime<=e.startTime&&n.endTime>=e.endTime;t||r||(e.isOverlapping=!0,n.isOverlapping=!0)}}}}return r},z=(0,n.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"move";if(e.preventDefault(),e.stopPropagation(),0!==e.button)return;E.current=!1;const o=k.current;if(!o)return;T.current=e.clientY;const n=e.clientX,a=new Date(t.start),s=new Date(t.end),i=s.getTime()-a.getTime(),l=(o.getBoundingClientRect(),o.closest(".calendar-scroll-container")||o.closest(".time-slots"));let d=null,m=e.clientY;const g=l?l.scrollTop:0,h=()=>{if(!l)return void(d=null);const e=l.getBoundingClientRect(),t=e.top,r=e.bottom,o=m-t,n=r-m;let a=!1,s=0;if(o<80&&o>0?(a=!0,s=-Math.min(15,Math.floor((80-o)/5))):n<80&&n>0&&(a=!0,s=Math.min(15,Math.floor((80-n)/5))),a&&0!==s){const e=l.scrollTop,t=l.scrollHeight-l.clientHeight,r=Math.max(0,Math.min(t,e+s));l.scrollTop=r,d=requestAnimationFrame(h)}else d=null},f=e=>{m=e.clientY;const o=(l?l.scrollTop:0)-g,c=e.clientY-T.current+o,f=e.clientX-n;(Math.abs(c)>3||Math.abs(f)>3)&&(E.current=!0),!l||"move"!==r&&"resize-top"!==r&&"resize-bottom"!==r||d||(d=requestAnimationFrame(h));const v=1*c,x=Math.round(v/M)*M;if(0!==x)if("resize-top"===r){const e=new Date(a.getTime()+6e4*x),r=W(e);r<s&&(null===p||void 0===p||p(t.id,r,s,!0))}else if("resize-bottom"===r){const e=new Date(s.getTime()+6e4*x),r=W(e);r>a&&(null===p||void 0===p||p(t.id,a,r,!0))}else{let e=new Date(a.getTime()+6e4*x),r=W(e),o=new Date(r.getTime()+i);const n=new Date(a);n.setHours(0,0,0,0);const s=new Date(r);if(s.setHours(0,0,0,0),s.getTime()!==n.getTime()){const e=new Date(n);e.setHours(0,0,0,0);const t=new Date(n);t.setHours(23,59,59,999),r<e?(r=e,o=new Date(r.getTime()+i)):o>t&&(o=t,r=new Date(o.getTime()-i),r<e&&(r=e,o=new Date(r.getTime()+i)))}null===u||void 0===u||u(t.id,r,o,!0)}},v=e=>{if(d&&(cancelAnimationFrame(d),d=null),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",v),!E.current)return void(null===c||void 0===c||c(t,e));const o=(l?l.scrollTop:0)-g,n=1*(e.clientY-T.current+o),m=Math.round(n/M)*M;if(0!==m)if("resize-top"===r){const e=new Date(a.getTime()+6e4*m),r=W(e);r<s&&(null===p||void 0===p||p(t.id,r,s,!1))}else if("resize-bottom"===r){const e=new Date(s.getTime()+6e4*m),r=W(e);r>a&&(null===p||void 0===p||p(t.id,a,r,!1))}else{let e=new Date(a.getTime()+6e4*m),r=W(e),o=new Date(r.getTime()+i);const n=new Date(a);n.setHours(0,0,0,0);const s=new Date(r);if(s.setHours(0,0,0,0),s.getTime()!==n.getTime()){const e=new Date(n);e.setHours(0,0,0,0);const t=new Date(n);t.setHours(23,59,59,999),r<e?(r=e,o=new Date(r.getTime()+i)):o>t&&(o=t,r=new Date(o.getTime()-i),r<e&&(r=e,o=new Date(r.getTime()+i)))}null===u||void 0===u||u(t.id,r,o,!1)}};document.addEventListener("mousemove",f),document.addEventListener("mouseup",v)},[W,u,p,c]),F=(0,n.useCallback)(e=>{console.log("Grid mousedown fired"),console.log("Click target:",e.target),console.log("Target className:",e.target.className),console.log("Target data-event-id:",e.target.getAttribute("data-event-id"));const t=e.target.closest("[data-event-id]");if(console.log("Closest event element:",t),t)return void console.log("Click on event detected, ignoring grid mousedown");if(0!==e.button)return;console.log("Grid mousedown - creating new event"),e.preventDefault();const r=k.current;if(!r)return;const n=r.getBoundingClientRect(),a=e.clientX-n.left,s=e.clientY-n.top,i=L(a,n.width),l=O(s,i,!0),c=new Date(l.getTime()+36e5);E.current=!1,T.current=e.clientY,S.current=l;const d={id:"draft-".concat(Date.now()),title:"",start:l,end:c,isDraft:!0,color:"#3b82f6"};A.current=d,C(d),j(!0);const u=e=>{const t=e.clientY-n.top;Math.abs(e.clientY-T.current)>5&&(E.current=!0);const r=O(t,i,!1),a=new Date(i);a.setHours(0,0,0,0);const s=new Date(i);let l,c;s.setHours(23,59,59,999),r<S.current?(l=W(r),c=W(new Date(S.current.getTime()+36e5))):(l=W(S.current),c=W(r),c.getTime()-l.getTime()<9e5&&(c=new Date(l.getTime()+9e5))),l<a&&(l=a,c=new Date(l.getTime()+36e5)),c>s&&(c=s,c.getTime()-l.getTime()<9e5&&(l=new Date(c.getTime()-9e5),l<a&&(l=a,c=new Date(l.getTime()+9e5))));const d=(0,o.A)((0,o.A)({},A.current),{},{start:l,end:c});A.current=d,C(d)},m=()=>{if(document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",m),j(!1),C(null),E.current)console.log("Creating drag event with panel:",A.current),null===h||void 0===h||h((0,o.A)((0,o.A)({},A.current),{},{id:"temp-".concat(Date.now()),isDraft:!1}),!0);else{const e={id:"temp-".concat(Date.now()),title:"",start:l,end:c,color:"#3b82f6"};console.log("Creating single-click event and opening panel:",e),null===h||void 0===h||h(e,!0)}};document.addEventListener("mousemove",u),document.addEventListener("mouseup",m)},[s,L,O,W,h]),V=(0,n.useCallback)(e=>{if(e.target.closest("[data-event-id]"))return;e.preventDefault();const t=k.current;if(!t)return;const r=t.getBoundingClientRect(),o=e.clientX-r.left,n=e.clientY-r.top,a=L(o,r.width),s=O(n,a,!0),i=new Date(s.getTime()+36e5),l={id:"temp-".concat(Date.now()),title:"",start:s,end:i,color:"#3b82f6"};null===h||void 0===h||h(l,!0)},[s,L,O,h]);return(0,f.jsxs)("div",{className:"relative flex-1 bg-background select-none min-w-max",ref:k,style:{height:"1440px",width:"".concat("day"===t?100*R.length:R.length/7*100,"%"),minWidth:"".concat("day"===t?100*R.length:R.length/7*100,"%")},onMouseDown:F,onDoubleClick:V,children:[Array.from({length:24},(e,t)=>(0,f.jsx)("div",{className:"h-[60px] w-full border-b border-border flex items-start"},t)),(0,f.jsx)("div",{className:"absolute inset-0 flex pointer-events-none h-full",children:R.map((e,t)=>(0,f.jsx)("div",{className:"border-l border-border h-full first:border-l-0",style:{width:"".concat(100/R.length,"%")}},t))}),(0,f.jsx)("div",{className:"absolute inset-0 top-0 left-0 w-full h-full",children:(0,f.jsx)("div",{className:"relative w-full h-full",children:(()=>{let e=[];if(r&&r.length>0){const n=new Date(R[0]);n.setHours(0,0,0,0);new Date(R[R.length-1]).setHours(23,59,59,999);const a=r.filter(e=>e.isBeingMoved||e.isBeingResized),s=r.filter(e=>!e.isBeingMoved&&!e.isBeingResized);R.forEach((r,n)=>{const a=s.filter(e=>{if(!e||!e.start)return!1;const t=new Date(e.start);return t.getDate()===r.getDate()&&t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()}),i=P(a,t).map(e=>(0,o.A)((0,o.A)({},e),{},{dayIndex:n}));e.push(...i)}),s.forEach(r=>{if(!r||!r.start)return;const a=new Date(r.start);if(-1===e.findIndex(e=>e.id===r.id)){let s=R.findIndex(e=>e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear());if(s<0){const e=Math.floor((a-n)/864e5);s=Math.max(0,Math.min(R.length-1,e))}const i=P([r],t).map(e=>(0,o.A)((0,o.A)({},e),{},{dayIndex:s}));e.push(...i)}}),a.forEach(t=>{const r=new Date(t.start);let a=R.findIndex(e=>e.getDate()===r.getDate()&&e.getMonth()===r.getMonth()&&e.getFullYear()===r.getFullYear());if(a<0){const e=Math.floor((r-n)/864e5);a=Math.max(0,Math.min(R.length-1,e))}e.push((0,o.A)((0,o.A)({},t),{},{dayIndex:a,column:0,totalColumns:1,isOverlapping:!1}))})}if(N){const t=new Date(N.start);let r=R.findIndex(e=>e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear());-1===r&&(r=0),e.push((0,o.A)((0,o.A)({},N),{},{dayIndex:r,column:0,totalColumns:1,isOverlapping:!1}))}return e.map(e=>{if(!e||!e.start||void 0===e.dayIndex||e.dayIndex<0)return null;const t=new Date(e.start),r=new Date(e.end),n=60*(t.getHours()+t.getMinutes()/60),s=(r-t)/36e5,i=Math.max(60*s,15),u=R.length,m="".concat(100/u,"%"),g="".concat(e.dayIndex*(100/u),"%");let p={};if(e.isOverlapping){const t=100/u/e.totalColumns;p={top:"".concat(n,"px"),left:"calc(".concat(g," + ").concat(e.column*t,"%)"),width:"calc(".concat(t,"% - 4px)"),height:"".concat(i,"px"),position:"absolute",zIndex:e.isSelected?3:2}}else p={top:"".concat(n,"px"),left:g,width:"calc(".concat(m," - 4px)"),height:"".concat(i,"px"),position:"absolute",zIndex:e.isSelected?3:1};let h=(0,o.A)({},e);return l&&l.has(e.id)&&(h.color="#0f54bc",h.color1="#a8c1ff",h.color2="#4da6fb"),(0,f.jsx)(w,(0,o.A)((0,o.A)({},h),{},{style:p,isOverlapping:e.isOverlapping,isSelected:a===e.id,onMouseDown:z,onRightClick:d,onClick:c}),e.id)}).filter(Boolean)})()})})]})};var D=r(8463);r(9959);const j=e=>{let{event:t,currentDate:r,onConfirm:o,onCancel:s,isRecurring:i}=e;const{t:l}=(0,a.Bd)(),c=null!=t.recurrenceId,d=i||c,u=(0,n.useCallback)(e=>{"Escape"===e.key&&s()},[s]);(0,n.useEffect)(()=>(document.body.style.overflow="hidden",window.addEventListener("keydown",u),()=>{document.body.style.overflow="",window.removeEventListener("keydown",u)}),[u]);return(0,f.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-in fade-in duration-200",style:{backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)"},onClick:e=>{e.target===e.currentTarget&&s()},children:(0,f.jsxs)("div",{className:"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border overflow-hidden flex flex-col transform transition-all duration-200 scale-100 animate-in zoom-in-95",onClick:e=>e.stopPropagation(),style:{backgroundColor:"var(--background-div-color)",borderColor:"var(--grey-2)",boxShadow:"var(--box-shadow-md)"},children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b",style:{borderBottomColor:"var(--red-2)",backgroundColor:"var(--red-1)"},children:[(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("div",{className:"p-2 rounded-full",style:{backgroundColor:"var(--red-2)",color:"var(--red-4)"},children:(0,f.jsx)(p.eHT,{size:24})}),(0,f.jsx)("h3",{className:"text-xl font-semibold tracking-tight",style:{color:"var(--red-4)",fontFamily:"var(--font-family-headings)",fontSize:"var(--font-size-large)"},children:d?l("calendar:deleteTitle","Delete Recurring Event"):l("common:deleteConfirmation.title","Delete Event")})]}),(0,f.jsx)("button",{onClick:s,className:"p-2 rounded-full transition-colors hover:bg-black/5",style:{color:"var(--red-4)"},"aria-label":"Close",children:(0,f.jsx)(p.yGN,{size:20})})]}),(0,f.jsxs)("div",{className:"p-6 flex-1",style:{color:"var(--text-color)",fontFamily:"var(--font-family-text)",fontSize:"var(--font-size-medium)",lineHeight:"1.6"},children:[(0,f.jsx)("p",{style:{marginBottom:"var(--spacing-md)"},children:d?l("calendar:deleteMessage","This is a recurring event. Which occurrences would you like to delete?"):l("common:deleteConfirmation.message","Are you sure you want to delete this event?")}),"contract"===t.type&&(0,f.jsx)("div",{className:"p-4 rounded-lg mt-4",style:{backgroundColor:"var(--red-1)",border:"1px solid var(--red-2)",color:"var(--red-4)",fontSize:"var(--font-size-small)"},children:(0,f.jsx)("strong",{children:l("common:deleteConfirmation.contractWarning","WARNING: This is a scheduled appointment. Deleting it may affect your employment status and availability record.")})})]}),(0,f.jsxs)("div",{className:"px-6 py-4 border-t flex justify-end gap-3",style:{borderTopColor:"var(--grey-2)",backgroundColor:"var(--grey-1-light)"},children:[(0,f.jsx)("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",children:l("common:deleteConfirmation.cancel","Cancel")}),d?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("button",{onClick:()=>o("single"),className:"px-4 py-2 text-sm font-medium rounded-md shadow-sm btn-yellow",children:l("common:deleteConfirmation.deleteThisOnly","Delete Only This Event")}),(0,f.jsx)("button",{onClick:()=>o("future"),className:"px-4 py-2 text-sm font-medium rounded-md shadow-sm btn-yellow",children:l("common:deleteConfirmation.deleteAllFuture","Delete This & Future Events")})]}):(0,f.jsx)("button",{onClick:()=>o("single"),className:"px-4 py-2 text-sm font-medium text-white bg-destructive hover:bg-destructive/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95",children:l("common:deleteConfirmation.delete","Delete Event")})]})]})})},N=e=>{let{event:t,position:r,onClose:o,onDelete:i,onColorChange:l,colorOptions:c=s}=e;const{t:d}=(0,a.Bd)(),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&o()},t=e=>{"Escape"===e.key&&o()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[o]);const[m,g]=(0,n.useState)(r);(0,n.useEffect)(()=>{if(u.current){const e=u.current.getBoundingClientRect(),t=window.innerWidth,o=window.innerHeight;let n=r.x,a=r.y;r.x+e.width>t&&(n=t-e.width-10),r.y+e.height>o&&(a=o-e.height-10),g({x:n,y:a})}},[r]);return(0,f.jsxs)("div",{ref:u,className:(0,h.cn)("fixed z-40 min-w-[180px] rounded-lg shadow-xl","bg-card/95 backdrop-blur-md border border-border/60","py-2 animate-in fade-in zoom-in-95 duration-150"),style:{left:"".concat(m.x,"px"),top:"".concat(m.y,"px")},children:[(0,f.jsxs)("div",{className:"px-3 py-2 border-b border-border/40",children:[(0,f.jsx)("span",{className:"text-sm font-medium text-foreground truncate block",children:t.title||d("calendar:noTitle")}),(0,f.jsxs)("span",{className:"text-xs text-muted-foreground",children:[new Date(t.start).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})," - ",new Date(t.end).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})]})]}),(0,f.jsxs)("div",{className:"px-3 py-2 border-b border-border/40",children:[(0,f.jsx)("span",{className:"text-xs text-muted-foreground mb-2 block",children:d("calendar:color")}),(0,f.jsx)("div",{className:"flex gap-1.5 flex-wrap",children:c.map(e=>(0,f.jsx)("button",{className:(0,h.cn)("w-6 h-6 rounded-full border-2 transition-transform hover:scale-110",t.color===e.color?"border-white shadow-md ring-2 ring-offset-1 ring-offset-card":"border-transparent"),style:{backgroundColor:e.color,ringColor:e.color},onClick:()=>{return r=e,null===l||void 0===l||l(t,r),void o();var r},title:e.name||e.color},e.id||e.color))})]}),(0,f.jsx)("div",{className:"px-2 pt-2",children:(0,f.jsxs)("button",{className:(0,h.cn)("w-full px-3 py-2 rounded-md text-sm font-medium","flex items-center gap-2","text-red-500 hover:bg-red-500/10 transition-colors"),onClick:()=>{null===i||void 0===i||i(t),o()},children:[(0,f.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d("calendar:deleteEventAction")]})})]})};var C=r(627);const T=e=>{let{selectedDays:t,onChange:r}=e;const{i18n:o}=(0,a.Bd)(),n=(e=>{const t=new Date(2e3,0,3);return Array.from({length:7},(r,o)=>{const n=new Date(t);return n.setDate(t.getDate()+o),n.toLocaleString(e,{weekday:"long"})})})(o.language),s=t||[!1,!1,!1,!1,!1,!1,!1];return(0,f.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map((e,o)=>(0,f.jsx)("button",{type:"button",onClick:()=>(e=>{const o=[...t||[!1,!1,!1,!1,!1,!1,!1]];o[e]=!o[e],r(o)})(o),className:(0,h.cn)("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200","border border-input hover:bg-muted",s[o]?"bg-primary text-primary-foreground border-primary":"bg-background text-foreground"),children:e},o))})},S=e=>{let{value:t,onChange:r,className:a}=e;const s=e=>{if(!e)return{day:"",month:"",year:""};try{const t=new Date(e);return isNaN(t.getTime())?{day:"",month:"",year:""}:{day:String(t.getDate()).padStart(2,"0"),month:String(t.getMonth()+1).padStart(2,"0"),year:String(t.getFullYear())}}catch(t){return{day:"",month:"",year:""}}},[i,l]=(0,n.useState)(s(t)),c=(0,n.useRef)(null),d=(0,n.useRef)(null),u=(0,n.useRef)(null),m=(0,n.useRef)(null),g=(0,n.useRef)(null),v=(0,n.useRef)(t);(0,n.useEffect)(()=>{if(t!==v.current){v.current=t;const e="".concat(i.year,"-").concat(i.month,"-").concat(i.day),r=s(t);"".concat(r.year,"-").concat(r.month,"-").concat(r.day)!==e&&l(r)}},[t]);const x=e=>{const{day:t,month:o,year:n}=e;if(t&&o&&n&&4===n.length){const e="".concat(n,"-").concat(o.padStart(2,"0"),"-").concat(t.padStart(2,"0"));isNaN(Date.parse(e))||r(e)}},y=e=>{e.target.select()},b=(e,t)=>{if("Backspace"===e.key&&""===e.target.value){var r,o;if("month"===t)e.preventDefault(),null===(r=c.current)||void 0===r||r.focus();if("year"===t)e.preventDefault(),null===(o=d.current)||void 0===o||o.focus()}var n,a,s,i;"ArrowRight"===e.key&&e.target.selectionStart===e.target.value.length&&("day"===t&&(null===(n=d.current)||void 0===n||n.focus()),"month"===t&&(null===(a=u.current)||void 0===a||a.focus()));"ArrowLeft"===e.key&&0===e.target.selectionStart&&("year"===t&&(null===(s=d.current)||void 0===s||s.focus()),"month"===t&&(null===(i=c.current)||void 0===i||i.focus()))};return(0,f.jsxs)("div",{className:(0,h.cn)("flex items-center gap-0.5 cursor-text relative group min-w-[180px] w-full","bg-background/50 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2","border border-input rounded-md px-3 py-2",a),onClick:e=>{var t,r,o,n;(e.target===m.current||e.target.classList.contains("flex"))&&(i.day?i.month?i.year?null===(n=c.current)||void 0===n||n.focus():null===(o=u.current)||void 0===o||o.focus():null===(r=d.current)||void 0===r||r.focus():null===(t=c.current)||void 0===t||t.focus())},ref:m,children:[(0,f.jsx)("input",{ref:c,type:"text",inputMode:"numeric",placeholder:"DD",value:i.day,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>2&&(t=t.slice(0,2));const r=(0,o.A)((0,o.A)({},i),{},{day:t});var n;(l(r),2===t.length)&&(null===(n=d.current)||void 0===n||n.focus());x(r)},onKeyDown:e=>b(e,"day"),onFocus:y,onClick:y,className:"w-[28px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium",maxLength:2}),(0,f.jsx)("span",{className:"text-muted-foreground/40 select-none",children:"/"}),(0,f.jsx)("input",{ref:d,type:"text",inputMode:"numeric",placeholder:"MM",value:i.month,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>2&&(t=t.slice(0,2));const r=(0,o.A)((0,o.A)({},i),{},{month:t});var n;(l(r),2===t.length)&&(null===(n=u.current)||void 0===n||n.focus());x(r)},onKeyDown:e=>b(e,"month"),onFocus:y,onClick:y,className:"w-[28px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium",maxLength:2}),(0,f.jsx)("span",{className:"text-muted-foreground/40 select-none",children:"/"}),(0,f.jsx)("input",{ref:u,type:"text",inputMode:"numeric",placeholder:"YYYY",value:i.year,onChange:e=>{let t=e.target.value.replace(/\D/g,"");t.length>4&&(t=t.slice(0,4));const r=(0,o.A)((0,o.A)({},i),{},{year:t});l(r),x(r)},onKeyDown:e=>b(e,"year"),onFocus:y,onClick:y,className:"w-[42px] bg-transparent border-none p-0 text-center focus:outline-none focus:ring-0 placeholder:text-muted-foreground/50 text-sm font-medium",maxLength:4}),(0,f.jsxs)("div",{className:"ml-auto pl-2 flex items-center border-l border-border h-5",children:[(0,f.jsx)("button",{type:"button",tabIndex:-1,onClick:e=>{e.preventDefault(),e.stopPropagation();try{var t;null===(t=g.current)||void 0===t||t.showPicker()}catch(r){console.warn("showPicker not supported",r)}},className:"text-muted-foreground hover:text-foreground transition-colors cursor-pointer outline-none focus:text-foreground p-0.5",title:"Open calendar",children:(0,f.jsx)(p.wIk,{size:16})}),(0,f.jsx)("input",{ref:g,type:"date",className:"w-0 h-0 opacity-0 absolute bottom-0 right-0 pointer-events-none",tabIndex:-1,value:t||"",onChange:e=>{const t=e.target.value;if(t){const e=s(t);l(e),x(e)}}})]})]})},E=e=>{let{icon:t,children:r}=e;return(0,f.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mb-1.5 ",children:[t&&(0,f.jsx)(t,{className:"w-4 h-4"}),r]})},A="flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:bg-background",I="flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200 hover:bg-background appearance-none cursor-pointer",R="flex min-h-[80px] w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-y transition-all duration-200 hover:bg-background",M=e=>{let{event:t,onClose:r,onSave:s,onDelete:i,colorOptions:l,userData:c,workspaceContext:d={type:"personal"}}=e;const u=(0,n.useRef)(Date.now()),{t:m,i18n:g}=(0,a.Bd)("calendar"),{selectedWorkspace:v}=(0,C.M)(),x=e=>{const t=new Date(2e3,0,3);return Array.from({length:7},(r,o)=>{const n=new Date(t);return n.setDate(t.getDate()+o),n.toLocaleString(e,{weekday:"long"})})},[y,b]=(0,n.useState)({title:"",start:new Date,end:new Date,location:"",notes:"",employee:"",isRecurring:!1,repeatValue:"Every Week",endRepeatValue:"After",endRepeatCount:10,endRepeatDate:null,type:"availability",weeklyDays:[!1,!1,!1,!1,!1,!1,!1],monthlyType:"day",monthlyDay:1,monthlyWeek:"first",monthlyDayOfWeek:0}),[w,k]=(0,n.useState)([]),[D,j]=(0,n.useState)(!1),N=(()=>{if(!y.isRecurring)return null;const e=new Date(y.start);let t=null;if("On Date"===y.endRepeatValue&&y.endRepeatDate)t=new Date(y.endRepeatDate);else if("After"===y.endRepeatValue){const r=y.endRepeatCount||10;y.end.getTime(),y.start.getTime();if("Every Day"===y.repeatValue)t=new Date(e),t.setDate(t.getDate()+(r-1));else if("Every Week"===y.repeatValue){const o=(y.weeklyDays||[!1,!1,!1,!1,!1,!1,!1]).filter(Boolean).length||1,n=Math.ceil(r/o);t=new Date(e),t.setDate(t.getDate()+7*n)}else"Every Month"===y.repeatValue&&(t=new Date(e),t.setMonth(t.getMonth()+(r-1)))}else"Never"===y.endRepeatValue&&(t=new Date(e),t.setFullYear(t.getFullYear()+2));return t})();(0,n.useEffect)(()=>{if(t&&t.start&&t.end){const e=new Date(t.start),r=new Date(t.end);if(isNaN(e.getTime())||isNaN(r.getTime()))return;const o=e.getDay(),n=0===o?6:o-1,a=[!1,!1,!1,!1,!1,!1,!1];a[n]=!0,b({id:t.id,title:t.title||"",start:e,end:r,location:t.location||"",notes:t.notes||"",employee:t.employee||"",isRecurring:t.isRecurring||!1,repeatValue:t.repeatValue||"Every Week",endRepeatValue:t.endRepeatValue||"After",endRepeatCount:t.endRepeatCount||10,endRepeatDate:t.endRepeatDate?new Date(t.endRepeatDate):null,type:t.type||"availability",weeklyDays:t.weeklyDays||a,monthlyType:t.monthlyType||"day",monthlyDay:t.monthlyDay||e.getDate(),monthlyWeek:t.monthlyWeek||"first",monthlyDayOfWeek:void 0!==t.monthlyDayOfWeek?t.monthlyDayOfWeek:n})}else if(!t){const e=new Date,t=new Date(e);t.setMinutes(0,0,0),t.setSeconds(0,0);const r=new Date(t);r.setHours(t.getHours()+1);const o=t.getDay(),n=0===o?6:o-1,a=[!1,!1,!1,!1,!1,!1,!1];a[n]=!0,b({title:"",start:t,end:r,location:"",notes:"",employee:"",isRecurring:!1,repeatValue:"Every Week",endRepeatValue:"After",endRepeatCount:10,endRepeatDate:null,type:"availability",weeklyDays:a,monthlyType:"day",monthlyDay:t.getDate(),monthlyWeek:"first",monthlyDayOfWeek:n})}},[t]);const M=e=>{const{name:t,value:r}=e.target;b(e=>(0,o.A)((0,o.A)({},e),{},{[t]:r}))},W=(e,t)=>{if(e.includes("Date")){const r="startDate"===e?"start":"end",n=new Date(y[r]);if(!t||""===t.trim())return;if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return;const a=new Date(t);if(isNaN(a.getTime()))return;const s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),n.getHours(),n.getMinutes());isNaN(s.getTime())||b(e=>(0,o.A)((0,o.A)({},e),{},{[r]:s}))}if(e.includes("Time")){if(!t||""===t.trim())return;const r="startTime"===e?"start":"end",n=t.split(":");if(2!==n.length)return;const a=parseInt(n[0],10),s=parseInt(n[1],10);if(isNaN(a)||isNaN(s)||a<0||a>23||s<0||s>59)return;const i=new Date(y[r]),l=new Date(i.getFullYear(),i.getMonth(),i.getDate(),a,s);isNaN(l.getTime())||b(e=>(0,o.A)((0,o.A)({},e),{},{[r]:l}))}},O=e=>{if(!e)return"";try{const t=e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return"";const r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"".concat(r,"-").concat(o,"-").concat(n)}catch(t){return""}},L=e=>{if(!e||""===e.trim())return null;if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return null;const t=new Date(e);return isNaN(t.getTime())?null:t},P=e=>{if(!e)return"";try{const t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toTimeString().slice(0,5)}catch(t){return""}};return(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200 overflow-y-auto p-4",onClick:r,children:(0,f.jsxs)("div",{className:"bg-card w-full rounded-2xl shadow-2xl flex flex-col border border-border animate-in zoom-in-95 duration-200 my-auto relative",style:{maxWidth:y.isRecurring?"1400px":"700px"},onClick:e=>e.stopPropagation(),children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b border-border bg-muted/20 backdrop-blur-md shrink-0 rounded-t-2xl",children:[(0,f.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,f.jsx)("h3",{className:"font-bold tracking-tight text-foreground m-0",style:{fontSize:"18px"},children:t&&t.id?m("editEvent","Edit Event"):m("createEvent","Create Event")}),(0,f.jsx)("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:y.type})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[t&&t.id&&i&&(0,f.jsx)("button",{onClick:i,className:"p-2 text-destructive hover:bg-destructive/10 rounded-full transition-colors",title:"Delete",children:(0,f.jsx)(p.IXo,{size:18})}),(0,f.jsx)("button",{onClick:r,className:"p-2 text-muted-foreground hover:bg-muted hover:text-foreground rounded-full transition-colors",children:(0,f.jsx)(p.yGN,{size:20})})]})]}),w.length>0&&(0,f.jsxs)("div",{className:"relative overflow-hidden px-6 py-4 bg-white border-b-2 border-[var(--red-2)] text-[var(--red-4)] animate-in slide-in-from-top-2 shrink-0 flex gap-3",style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[(0,f.jsx)("div",{className:"flex-shrink-0",children:(0,f.jsx)("div",{className:"w-8 h-8 rounded-full bg-[var(--red-2)]/20 flex items-center justify-center border-2 border-[var(--red-2)]",children:(0,f.jsx)(p.y3G,{className:"w-4 h-4 text-[var(--red-4)]"})})}),(0,f.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,f.jsx)("h4",{className:"font-bold text-sm mb-1 text-[var(--red-4)]",children:"Validation Errors"}),w.map((e,t)=>(0,f.jsx)("div",{className:"text-sm leading-relaxed text-[var(--red-4)]/90",children:e},t))]})]}),(0,f.jsx)("div",{className:y.isRecurring?"grid grid-cols-2":"p-6",children:y.isRecurring?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"p-6 space-y-5 bg-background",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.jH2,children:m("title","Title")}),(0,f.jsx)("input",{name:"title",value:y.title,onChange:M,placeholder:"Add title",className:(0,h.cn)(A,"text-base font-medium"),autoFocus:!(null!==t&&void 0!==t&&t.id)})]}),(0,f.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.Ohp,children:"Start"}),(0,f.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,f.jsx)(S,{value:O(y.start),onChange:e=>W("startDate",e),className:A}),(0,f.jsx)("input",{type:"time",value:P(y.start),onChange:e=>W("startTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.Ohp,children:"End"}),(0,f.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,f.jsx)(S,{value:O(y.end),onChange:e=>W("endDate",e),className:A}),(0,f.jsx)("input",{type:"time",value:P(y.end),onChange:e=>W("endTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.HzC,children:m("location","Location")}),(0,f.jsx)("input",{name:"location",value:y.location,onChange:M,placeholder:"Add location",className:A})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.qm6,children:m("notes","Description")}),(0,f.jsx)("textarea",{name:"notes",value:y.notes,onChange:M,placeholder:"Add description...",className:R})]}),(0,f.jsx)("div",{className:"space-y-1.5",children:(0,f.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors",onClick:()=>b(e=>(0,o.A)((0,o.A)({},e),{},{isRecurring:!e.isRecurring})),children:[(0,f.jsx)("div",{className:(0,h.cn)("w-5 h-5 rounded border flex items-center justify-center transition-colors shrink-0",y.isRecurring?"bg-primary border-primary text-primary-foreground":"border-muted-foreground"),children:y.isRecurring&&(0,f.jsx)(p.YrT,{className:"w-3.5 h-3.5"})}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(p.jEl,{className:"w-4 h-4 text-muted-foreground"}),(0,f.jsx)("span",{className:"text-sm font-medium",children:m("recurringEvent","Repeat this event")})]})]})})]}),(0,f.jsxs)("div",{className:"p-6 space-y-5 bg-muted/30",children:[(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.jEl,children:"Repeat"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"repeatValue",value:y.repeatValue,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"Every Day",children:"Every Day"}),(0,f.jsx)("option",{value:"Every Week",children:"Every Week"}),(0,f.jsx)("option",{value:"Every Month",children:"Every Month"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"End Repeat"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"endRepeatValue",value:y.endRepeatValue,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"After",children:"After"}),(0,f.jsx)("option",{value:"On Date",children:"On Date"}),(0,f.jsx)("option",{value:"Never",children:"Never"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),"Every Week"===y.repeatValue&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.wIk,children:m("repeatDays","Repeat on days")}),(0,f.jsx)(T,{selectedDays:y.weeklyDays,onChange:e=>b(t=>(0,o.A)((0,o.A)({},t),{},{weeklyDays:e}))})]}),"Every Month"===y.repeatValue&&(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Repeat on"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"monthlyType",value:y.monthlyType,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"day",children:"Day of month"}),(0,f.jsx)("option",{value:"weekday",children:"Day of week"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),"day"===y.monthlyType&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Day number"}),(0,f.jsx)("input",{type:"number",name:"monthlyDay",value:y.monthlyDay,onChange:M,min:"1",max:"31",className:A})]}),"weekday"===y.monthlyType&&(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Week"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"monthlyWeek",value:y.monthlyWeek,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"first",children:"First"}),(0,f.jsx)("option",{value:"second",children:"Second"}),(0,f.jsx)("option",{value:"third",children:"Third"}),(0,f.jsx)("option",{value:"fourth",children:"Fourth"}),(0,f.jsx)("option",{value:"last",children:"Last"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Day of week"}),(0,f.jsx)("div",{className:"flex flex-wrap gap-2",children:x(g.language).map((e,t)=>(0,f.jsx)("button",{type:"button",onClick:()=>b(e=>(0,o.A)((0,o.A)({},e),{},{monthlyDayOfWeek:t})),className:(0,h.cn)("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200","border border-input hover:bg-muted",y.monthlyDayOfWeek===t?"bg-primary text-primary-foreground border-primary":"bg-background text-foreground"),children:e},t))})]})]})]}),("After"===y.endRepeatValue||"On Date"===y.endRepeatValue)&&(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:["After"===y.endRepeatValue&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Number of occurrences"}),(0,f.jsx)("input",{type:"number",name:"endRepeatCount",value:y.endRepeatCount,onChange:M,min:"1",max:"365",className:A})]}),"On Date"===y.endRepeatValue&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"End Date"}),(0,f.jsx)(S,{value:y.endRepeatDate?O(y.endRepeatDate):"",onChange:e=>{const t=L(e);null===t&&""!==e||b(e=>(0,o.A)((0,o.A)({},e),{},{endRepeatDate:t}))},className:A})]})]}),N&&(0,f.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-background/50 border border-border",children:[(0,f.jsx)(p.wIk,{className:"w-4 h-4 text-muted-foreground"}),(0,f.jsxs)("span",{className:"text-sm text-muted-foreground",children:[m("calculatedEndDate","Calculated end date"),":"]}),(0,f.jsx)("span",{className:"text-sm font-medium text-foreground",children:N.toLocaleDateString()})]})]})]}):(0,f.jsxs)("div",{className:"space-y-5",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.jH2,children:m("title","Title")}),(0,f.jsx)("input",{name:"title",value:y.title,onChange:M,placeholder:"Add title",className:(0,h.cn)(A,"text-base font-medium"),autoFocus:!(null!==t&&void 0!==t&&t.id)})]}),(0,f.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.Ohp,children:"Start"}),(0,f.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,f.jsx)(S,{value:O(y.start),onChange:e=>W("startDate",e),className:A}),(0,f.jsx)("input",{type:"time",value:P(y.start),onChange:e=>W("startTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.Ohp,children:"End"}),(0,f.jsxs)("div",{className:"grid grid-cols-[3fr_2fr] gap-2",children:[(0,f.jsx)(S,{value:O(y.end),onChange:e=>W("endDate",e),className:A}),(0,f.jsx)("input",{type:"time",value:P(y.end),onChange:e=>W("endTime",e.target.value),className:(0,h.cn)(A,"min-w-0")})]})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.HzC,children:m("location","Location")}),(0,f.jsx)("input",{name:"location",value:y.location,onChange:M,placeholder:"Add location",className:A})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.qm6,children:m("notes","Description")}),(0,f.jsx)("textarea",{name:"notes",value:y.notes,onChange:M,placeholder:"Add description...",className:R})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-border bg-muted/10 cursor-pointer hover:bg-muted/20 transition-colors",onClick:()=>b(e=>(0,o.A)((0,o.A)({},e),{},{isRecurring:!e.isRecurring})),children:[(0,f.jsx)("div",{className:(0,h.cn)("w-5 h-5 rounded border flex items-center justify-center transition-colors shrink-0",y.isRecurring?"bg-primary border-primary text-primary-foreground":"border-muted-foreground"),children:y.isRecurring&&(0,f.jsx)(p.YrT,{className:"w-3.5 h-3.5"})}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(p.jEl,{className:"w-4 h-4 text-muted-foreground"}),(0,f.jsx)("span",{className:"text-sm font-medium",children:m("recurringEvent","Repeat this event")})]})]}),y.isRecurring&&(0,f.jsxs)("div",{className:"pl-4 pr-4 py-4 rounded-lg border border-border bg-muted/5 space-y-4 animate-in slide-in-from-top-2 duration-200",children:[(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.jEl,children:"Repeat"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"repeatValue",value:y.repeatValue,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"Every Day",children:"Every Day"}),(0,f.jsx)("option",{value:"Every Week",children:"Every Week"}),(0,f.jsx)("option",{value:"Every Month",children:"Every Month"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"End Repeat"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"endRepeatValue",value:y.endRepeatValue,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"After",children:"After"}),(0,f.jsx)("option",{value:"On Date",children:"On Date"}),(0,f.jsx)("option",{value:"Never",children:"Never"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),"Every Week"===y.repeatValue&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{icon:p.wIk,children:m("repeatDays","Repeat on days")}),(0,f.jsx)(T,{selectedDays:y.weeklyDays,onChange:e=>b(t=>(0,o.A)((0,o.A)({},t),{},{weeklyDays:e}))})]}),"Every Month"===y.repeatValue&&(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Repeat on"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"monthlyType",value:y.monthlyType,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"day",children:"Day of month"}),(0,f.jsx)("option",{value:"weekday",children:"Day of week"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),"day"===y.monthlyType&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Day number"}),(0,f.jsx)("input",{type:"number",name:"monthlyDay",value:y.monthlyDay,onChange:M,min:"1",max:"31",className:A})]}),"weekday"===y.monthlyType&&(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Week"}),(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsxs)("select",{name:"monthlyWeek",value:y.monthlyWeek,onChange:M,className:I,children:[(0,f.jsx)("option",{value:"first",children:"First"}),(0,f.jsx)("option",{value:"second",children:"Second"}),(0,f.jsx)("option",{value:"third",children:"Third"}),(0,f.jsx)("option",{value:"fourth",children:"Fourth"}),(0,f.jsx)("option",{value:"last",children:"Last"})]}),(0,f.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:(0,f.jsx)("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Day of week"}),(0,f.jsx)("div",{className:"flex flex-wrap gap-2",children:x(g.language).map((e,t)=>(0,f.jsx)("button",{type:"button",onClick:()=>b(e=>(0,o.A)((0,o.A)({},e),{},{monthlyDayOfWeek:t})),className:(0,h.cn)("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200","border border-input hover:bg-muted",y.monthlyDayOfWeek===t?"bg-primary text-primary-foreground border-primary":"bg-background text-foreground"),children:e},t))})]})]})]}),("After"===y.endRepeatValue||"On Date"===y.endRepeatValue)&&(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:["After"===y.endRepeatValue&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"Number of occurrences"}),(0,f.jsx)("input",{type:"number",name:"endRepeatCount",value:y.endRepeatCount,onChange:M,min:"1",max:"365",className:A})]}),"On Date"===y.endRepeatValue&&(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)(E,{children:"End Date"}),(0,f.jsx)(S,{value:y.endRepeatDate?O(y.endRepeatDate):"",onChange:e=>{const t=L(e);null===t&&""!==e||b(e=>(0,o.A)((0,o.A)({},e),{},{endRepeatDate:t}))},className:A})]})]}),N&&(0,f.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30 border border-border",children:[(0,f.jsx)(p.wIk,{className:"w-4 h-4 text-muted-foreground"}),(0,f.jsxs)("span",{className:"text-sm text-muted-foreground",children:[m("calculatedEndDate","Calculated end date"),":"]}),(0,f.jsx)("span",{className:"text-sm font-medium text-foreground",children:N.toLocaleDateString()})]})]})]})]})}),(0,f.jsxs)("div",{className:"p-5 border-t border-border bg-muted/10 flex justify-end gap-3 backdrop-blur-sm shrink-0 rounded-b-2xl",children:[(0,f.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",children:m("cancel","Cancel")}),(0,f.jsxs)("button",{onClick:()=>{const e=Date.now()-u.current;console.log("handleSaveWrapper called. Time since mount: ".concat(e,"ms")),e<500?console.log("Ignoring click on save button (too soon after mount)"):y.end<=y.start?k(["End time must be after start time"]):(j(!0),setTimeout(()=>{s((0,o.A)((0,o.A)({},y),{},{isValidated:!0,fromDatabase:!0,color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb"}),!0),j(!1)},400))},disabled:D,className:"px-6 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95 disabled:opacity-70 disabled:pointer-events-none flex items-center gap-2",children:[D&&(0,f.jsx)("span",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),m("save","Save Event")]})]})]})})};var W=r(8753),O=r(4506);const L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;const[t,r]=(0,n.useState)(()=>e instanceof Date?e:new Date),[a,i]=(0,n.useState)("week"),[l,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(0),[m,g]=(0,n.useState)(0),[p,h]=(0,n.useState)(!1),[f,v]=(0,n.useState)(s.map(e=>({name:e.name,color:e.color,checked:!0}))),[x,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(null),[k,D]=(0,n.useState)(!1),[j,N]=(0,n.useState)({x:0,y:0}),[C,T]=(0,n.useState)(null),S=(0,n.useCallback)(e=>{const o=new Date(t),n=o.getHours(),s=o.getMinutes(),i=o.getSeconds(),l=o.getMilliseconds();"week"===a?(o.setDate(o.getDate()+7*e),u(0)):"day"===a?(c(e>0?"left":"right"),o.setDate(o.getDate()+e),g(0)):o.setMonth(o.getMonth()+e),o.setHours(n,s,i,l),r(o)},[t,a]),E=(0,n.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])u(t=>{const r=t+e;return Math.max(-7,Math.min(7,r))});else if(-1===e){const e=new Date(t);e.setDate(e.getDate()-7),r(e),u(0)}else if(1===e){const e=new Date(t);e.setDate(e.getDate()+7),r(e),u(0)}},[t]),A=(0,n.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])g(t=>{const r=t+e;return Math.max(-7,Math.min(7,r))});else if(-1===e){const e=new Date(t);e.setDate(e.getDate()-1),r(e),g(0)}else if(1===e){const e=new Date(t);e.setDate(e.getDate()+1),r(e),g(0)}},[t]),I=(0,n.useCallback)(e=>{c((e>t?1:-1)>0?"left":"right"),r(e),u(0),g(0),i("day"===a?"day":"week")},[t,a,i]),R=(0,n.useCallback)(e=>{c((e>t?1:-1)>0?"left":"right"),r(new Date(e)),u(0),i("week")},[t]),M=(0,n.useCallback)(e=>{v(t=>{const r=[...t];return r[e]=(0,o.A)((0,o.A)({},r[e]),{},{checked:!r[e].checked}),r})},[]),W=(0,n.useCallback)(e=>{if(e.stopPropagation(),"INPUT"!==e.target.tagName){const t=e.currentTarget.getBoundingClientRect();w({x:0,y:t.height+8}),y(!x)}},[x]),O=(0,n.useCallback)(()=>{h(!p)},[p]),L=(0,n.useCallback)(()=>{},[]),P=(0,n.useCallback)((e,t)=>{T(e),N(t),D(!0)},[]),z=(0,n.useCallback)(()=>{D(!1),T(null)},[]),F=(0,n.useCallback)(()=>{C&&z()},[C,z]),V=(0,n.useCallback)(()=>{C&&z()},[C,z]),H=(0,n.useCallback)(()=>{C&&z()},[C,z]);return{currentDate:t,setCurrentDate:r,view:a,setView:i,slideDirection:l,setSlideDirection:c,weekScrollOffset:d,setWeekScrollOffset:u,dayScrollOffset:m,setDayScrollOffset:g,isSidebarCollapsed:p,setIsSidebarCollapsed:h,categories:f,setCategories:v,showHeaderDateDropdown:x,setShowHeaderDateDropdown:y,dropdownPosition:b,setDropdownPosition:w,showContextMenu:k,contextMenuPosition:j,contextMenuEvent:C,navigateDate:S,handleWeekScroll:E,handleDayScroll:A,handleDayClick:I,handleUpcomingEventClick:R,handleCategoryToggle:M,handleHeaderDateClick:W,toggleSidebar:O,handleBackToMiniCalendar:L,showContextMenuAt:P,hideContextMenu:z,handleContextMenuEdit:F,handleContextMenuDuplicate:V,handleContextMenuDelete:H}};var P=r(5821),z=r(2206),F=r(7186);const V=(0,F.Qg)(z.functions,"saveCalendarEvent"),H=(0,F.Qg)(z.functions,"saveRecurringEvents"),q=async e=>{if(console.log("checkPermissions called with uid:",e),!e)return console.error("checkPermissions failed: User ID is required"),!1;console.log("Auth state in checkPermissions:",{currentUser:z.auth.currentUser?z.auth.currentUser.uid:"null",isInitialized:z.auth._isInitialized}),z.auth._isInitialized||(console.log("Auth not fully initialized, waiting..."),await new Promise(e=>setTimeout(e,1e3)));const t=z.auth.currentUser;return t?t.uid!==e?(console.error("checkPermissions failed: User ID mismatch - current: ".concat(t.uid,", requested: ").concat(e)),!1):(console.log("checkPermissions passed for uid:",e),!0):(console.error("checkPermissions failed: User not authenticated"),!1)},B=async(e,t)=>{console.log("SAVE SINGLE EVENT called with:",{eventId:e.id,userId:t,title:e.title,isAvailability:e.isAvailability});if(!await q(t))return console.error("User does not have permission to save event"),{success:!1,error:"Permission denied"};try{const r={userId:t,title:e.title||"Available",start:e.start.toISOString(),end:e.end.toISOString(),color:e.color,color1:e.color1,color2:e.color2,notes:e.notes||"",location:e.location||"",isAvailability:!1!==e.isAvailability,isValidated:e.isValidated||!0,canton:e.canton||[],area:e.area||[],languages:e.languages||[],experience:e.experience||"",software:e.software||[],certifications:e.certifications||[],workAmount:e.workAmount||""},o=await V(r);return o.data.success?(console.log("Event saved with ID: ".concat(o.data.id)),{success:!0,id:o.data.id}):(console.error("Firebase function returned error:",o.data.error),{success:!1,error:o.data.error||"Failed to save event"})}catch(r){return console.error("Error calling saveEvent Firebase function:",r),{success:!1,error:"Failed to save event: "+r.message}}};const Y=async function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"worker",n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{var a;let s=o;"professional"===o&&(s="worker"),console.log("Calling updateCalendarEvent Firebase function with:",{eventId:e,userId:r,originalAccountType:o,mappedAccountType:s,startType:typeof t.start,endType:typeof t.end,start:t.start instanceof Date?t.start.toISOString():t.start,end:t.end instanceof Date?t.end.toISOString():t.end,title:t.title,collectionToUse:"manager"===s?"jobs-listing":"availability",eventHasFromDatabaseFlag:!0===t.fromDatabase,eventHasValidatedFlag:!0===t.isValidated,isForceUpdate:n}),console.log("Auth debug:",{currentUser:null===(a=z.auth.currentUser)||void 0===a?void 0:a.uid,isAuthenticated:!!z.auth.currentUser,userIdParam:r});const i=(0,F.Qg)(z.functions,"updateCalendarEvent"),l=await i({eventId:e,userId:r,accountType:s,title:t.title,start:t.start instanceof Date?t.start.toISOString():t.start,end:t.end instanceof Date?t.end.toISOString():t.end,color:t.color,color1:t.color1,color2:t.color2,notes:t.notes,location:t.location,isValidated:t.isValidated,isRecurring:t.isRecurring,recurrenceId:t.recurrenceId,canton:t.canton,area:t.area,experience:t.experience,software:t.software,certifications:t.certifications,workAmount:t.workAmount,isAvailability:t.isAvailability});return console.log("Update event result:",l.data),l.data}catch(s){return console.error("Error calling updateEvent Firebase function:",s),console.error("Error details:",{message:s.message,code:s.code,details:s.details,stack:s.stack}),"functions/not-found"===s.code?{success:!1,error:"Event not found in database. It may have been deleted or moved."}:"functions/permission-denied"===s.code?{success:!1,error:"Permission denied. You do not have access to update this event."}:"functions/invalid-argument"===s.code?{success:!1,error:"Invalid event data provided."}:s.message.includes("CORS")||s.message.includes("Access-Control-Allow-Origin")?(console.error("CORS error detected - this is a server configuration issue"),{success:!1,error:"Server configuration error. The backend needs to be configured to allow requests from this domain. Please contact your system administrator."}):s.message.includes("net::ERR_FAILED")||s.message.includes("Failed to fetch")?(console.error("Network error detected"),{success:!1,error:"Network error. Please check your internet connection and try again."}):{success:!1,error:"Failed to update event: ".concat(s.code||s.message||"unknown error")}}},_=async(e,t)=>{console.log("SAVE RECURRING EVENTS called with:",{eventId:e.id,userId:t,repeatValue:e.repeatValue,isRecurring:e.isRecurring});try{await q(t);const r={userId:t,baseEvent:{id:e.id,title:e.title||"Available",start:e.start instanceof Date?e.start.toISOString():e.start,end:e.end instanceof Date?e.end.toISOString():e.end,color:e.color,color1:e.color1,color2:e.color2,notes:e.notes||"",location:e.location||"",isAvailability:!1!==e.isAvailability,isValidated:e.isValidated||!0,isRecurring:!0,repeatValue:e.repeatValue||"Every Day",endRepeatValue:e.endRepeatValue||"After",endRepeatCount:e.endRepeatCount||10,endRepeatDate:e.endRepeatDate?e.endRepeatDate instanceof Date?e.endRepeatDate.toISOString():e.endRepeatDate:null,weeklyDays:e.weeklyDays,monthlyType:e.monthlyType,monthlyDay:e.monthlyDay,monthlyWeek:e.monthlyWeek,monthlyDayOfWeek:e.monthlyDayOfWeek,canton:e.canton||[],area:e.area||[],languages:e.languages||[],experience:e.experience||"",software:e.software||[],certifications:e.certifications||[],workAmount:e.workAmount||""}},o=await H(r);return o.data.success?(console.log("Recurring events saved successfully. Count: ".concat(o.data.count)),{success:!0,recurrenceId:o.data.recurrenceId,count:o.data.count}):(console.error("Firebase function returned error:",o.data.error),{success:!1,error:o.data.error||"Failed to save recurring events"})}catch(r){return console.error("Error calling saveRecurringEvents Firebase function:",r),{success:!1,error:"Failed to save recurring events: "+r.message}}};const U=new class{constructor(){this.notifications=[],this.listeners=[],this.currentId=0}showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;const o=this.currentId++,n={id:o,message:e,type:t,timestamp:(new Date).getTime()};return this.notifications.push(n),this.notifyListeners(),r>0&&setTimeout(()=>{this.dismissNotification(o)},r),o}dismissNotification(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.notifyListeners()}clearAll(){this.notifications=[],this.notifyListeners()}getNotifications(){return[...this.notifications]}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){this.listeners.forEach(e=>e(this.getNotifications()))}},G=U,K=(e,t,r,a,s,l,c,d)=>{const[u,m]=(0,n.useState)([]),[g,p]=(0,n.useState)(null),[h,f]=(0,n.useState)(null),[v,x]=(0,n.useState)([]),[y,b]=(0,n.useState)(null),[w,k]=(0,n.useState)(new Set),[D,j]=(0,n.useState)(!1),[N,C]=(0,n.useState)(null),[T,S]=(0,n.useState)(!1),[E,A]=(0,n.useState)(null),[I,R]=(0,n.useState)(null),[M,W]=(0,n.useState)(null),[O,L]=(0,n.useState)(!1),[P,V]=(0,n.useState)(null),[H,q]=(0,n.useState)(!1),[U,K]=(0,n.useState)([[]]),[J,X]=(0,n.useState)(0),[Q,Z]=(0,n.useState)(null),[$,ee]=(0,n.useState)(!1),[te,re]=(0,n.useState)(null),oe=(0,n.useCallback)(e=>{const t=U.slice(0,J+1);t.push([...e]),K(t),X(t.length-1)},[U,J]),ne=(0,n.useCallback)((e,t)=>{if(J>0){const e=J-1;X(e),t([...U[e]]);const r=U[e];g&&!r.find(e=>e.id===g.id)&&(p(null),f(null))}},[J,U,g]),ae=(0,n.useCallback)((e,t)=>{if(J<U.length-1){const e=J+1;X(e),t([...U[e]]);const r=U[e];g&&!r.find(e=>e.id===g.id)&&(p(null),f(null))}},[J,U,g]),se=(0,n.useCallback)((e,t,r,n,a)=>{if(console.log("handleEventClick called with event:",e),t.stopPropagation(),t.ctrlKey||t.metaKey)return void x(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]);v.length>0&&x([]);const s=a?Date.now()-a:0;if(n||s<200)return void console.log("Event clicked after drag - not opening panel");console.log("Clean event click detected - opening event panel");const i=r.find(t=>t.id===e.id)||e;b((0,o.A)({id:i.id,start:new Date(i.start),end:new Date(i.end),title:i.title,color:i.color,color1:i.color1,color2:i.color2,notes:i.notes,location:i.location,employees:i.employees},i)),f(e.id),p(i)},[v]),ie=(0,n.useCallback)((e,t,r)=>{console.log("Event double-clicked:",e.id,"- opening event panel"),t.stopPropagation();const n=r.find(t=>t.id===e.id)||e;b((0,o.A)({id:n.id,start:new Date(n.start),end:new Date(n.end),title:n.title,color:n.color,color1:n.color1,color2:n.color2,notes:n.notes,location:n.location,employees:n.employees},n)),f(e.id),p(n)},[]),le=(0,n.useCallback)((e,t)=>{if(console.log("Panel closing, checking if event needs to be restored or removed"),g&&String(g.id).startsWith("temp-")){console.log("Removing unsaved temp event from array:",g.id);return t(e.filter(e=>e.id!==g.id)),p(null),f(null),void b(null)}if(y&&g&&y.id===g.id){console.log("Restoring event to original position:",y);const r=e.findIndex(e=>e.id===g.id);if(-1!==r){const n=e[r],a=n.start instanceof Date?n.start:new Date(n.start),s=n.end instanceof Date?n.end:new Date(n.end),i=y.start instanceof Date?y.start:new Date(y.start),l=y.end instanceof Date?y.end:new Date(y.end);if(a.getTime()!==i.getTime()||s.getTime()!==l.getTime()||(n.title||"")!==(y.title||"")||(n.notes||"")!==(y.notes||"")||(n.location||"")!==(y.location||"")||(n.employees||"")!==(y.employees||"")||(n.color||"")!==(y.color||"")){console.log("Event was modified, restoring to original state");const a=[...e];a[r]=(0,o.A)((0,o.A)({},y),{},{start:new Date(y.start),end:new Date(y.end),fromDatabase:n.fromDatabase||!1,isValidated:n.isValidated||!1}),t(a),oe(a)}else console.log("Event was not modified, no restoration needed")}}p(null),f(null),b(null)},[y,g,oe]),ce=((0,n.useCallback)(function(r,n){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const l=String(r.id).includes("_")?String(r.id).split("_")[0]:r.id;let c=[...s];const d=c.findIndex(e=>e.id===r.id);if(-1!==d?c[d]=(0,o.A)((0,o.A)({},c[d]),r):c.push(r),r.isRecurring&&n){console.log("Event save details:",{id:r.id,baseId:l,isNowRecurring:r.isRecurring,repeatValue:r.repeatValue,isAvailability:r.isAvailability,shouldClose:n,alreadyProcessed:a});const d=c.filter(e=>e.id!==r.id&&(e.recurrenceId===r.recurrenceId||String(e.id).includes("_")&&String(e.id).split("_")[0]===String(l)));if(console.log("Filtered out ".concat(d.length," existing recurring events")),c=c.filter(e=>!d.includes(e)),n&&e&&!a&&(console.log("Final save: should save recurring events to database"),l!==r.id&&console.log("Updating instance of recurring event with baseId:",l),console.log("Calling saveRecurringEvents with:",r),console.log("userId value:",e),"worker"===t&&!a)){console.log("Making direct call to saveRecurringEvents");const t=(0,o.A)((0,o.A)({},r),{},{userId:e});_(t,e).then(e=>{if(console.log("saveRecurringEvents result:",e),q(!1),e.success){console.log("Recurring events saved successfully",e),G.showNotification("Recurring events saved successfully","success"),k(t=>new Set([...t,e.recurrenceId]));const t=s.map(t=>String(t.id)===String(l)?(0,o.A)((0,o.A)({},t),{},{fromDatabase:!0,recurrenceId:e.recurrenceId,isValidated:!0}):t);i(t)}else console.error("Failed to save recurring events",e.error),G.showNotification("Failed to save recurring events: "+(e.error||"Unknown error"),"error"),console.log("Falling back to saveEvent for recurring event"),ce(r,l)}).catch(e=>{console.error("Error in saveRecurringEvents:",e),q(!1),G.showNotification("Error saving recurring events","error"),ce(r,l)})}}else if(n&&e&&!a){console.log("Saving regular (non-recurring) event to database");const n=(0,o.A)((0,o.A)({},r),{},{userId:e,isAvailability:"worker"===t||r.isAvailability});B(n,e).then(e=>{if(console.log("Regular saveEvent result:",e),q(!1),e.success){console.log("Event saved successfully with ID:",e.id),k(t=>new Set([...t,e.id]));const t=s.map(t=>String(t.id)===String(r.id)?(0,o.A)((0,o.A)({},t),{},{id:e.id,fromDatabase:!0,isValidated:!0}):t);i(t),G.showNotification("Event saved successfully","success")}else console.error("Failed to save event:",e.error),G.showNotification("Failed to save event: "+(e.error||"Unknown error"),"error")}).catch(e=>{console.error("Error saving event:",e),q(!1),G.showNotification("Error saving event","error")})}else n&&q(!1);if(i(c),n)oe(c);else{const e=c.find(e=>String(e.id)===String(r.id))||c.find(e=>String(e.id).startsWith(l));p(e||null),f(e?String(e.id):null)}},[e,t,oe]),(0,n.useCallback)((r,n)=>{console.log("Using saveRecurringEventFallback with direct saveEvent call");const a=(0,o.A)((0,o.A)({},r),{},{id:n,fromDatabase:!0,isAvailability:"worker"===t||r.isAvailability});B(a,e).then(e=>{console.log("Fallback saveEvent result:",e),q(!1),e.success?(console.log("Fallback save successful"),G.showNotification("Event saved successfully","success"),k(e=>new Set([...e,n]))):(console.error("Fallback save failed:",e.error),G.showNotification("Failed to save event: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error in fallback save:",e),q(!1),G.showNotification("Error saving event","error")})},[t,e])),de=(0,n.useCallback)(function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;console.log("handleEventDelete called with:",{eventId:r,deleteType:o});const s=n.find(e=>String(e.id)===String(r));if(!s)return void console.warn("Event not found for deletion:",r);let i;const l=String(s.id).split("-")[0],c=new Date(s.start);"future"===o&&(s.isRecurring||s.recurrenceId||String(s.id).includes("-"))?(console.log("Deleting this and all future occurrences from series"),i=n.filter(e=>{if(!String(e.id).startsWith(l)&&(!e.recurrenceId||e.recurrenceId!==s.recurrenceId))return!0;return new Date(e.start)<c})):"all"===o&&(s.isRecurring||s.recurrenceId)?(console.log("Deleting all occurrences of the series"),i=n.filter(e=>!(String(e.id).startsWith(l)||e.recurrenceId&&e.recurrenceId===s.recurrenceId))):(console.log("Deleting only this occurrence"),i=n.filter(e=>String(e.id)!==String(r))),console.log("Event Delete - Updated events array:",i),a(i),oe(i),e?async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"worker",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"single",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;try{console.log("Deleting event:",e,"for user:",t,"type:",o);const a={eventId:e,userId:t,accountType:r,deleteType:o,recurrenceId:n};console.log("Delete data:",a);const s=(0,F.Qg)(z.functions,"deleteCalendarEvent"),i=await s(a);return console.log("Delete event result:",i.data),i.data}catch(a){return console.error("Error deleting event:",a),a.message.includes("CORS")||a.message.includes("Access-Control-Allow-Origin")?(console.error("CORS error detected during delete - this is a server configuration issue"),{success:!1,error:"Server configuration error. The backend needs to be configured to allow requests from this domain. Please contact your system administrator."}):a.message.includes("net::ERR_FAILED")||a.message.includes("Failed to fetch")?(console.error("Network error detected during delete"),{success:!1,error:"Network error. Please check your internet connection and try again."}):{success:!1,error:"Failed to delete event: ".concat(a.code||"unknown error")}}}(r,e,t,o,s.recurrenceId).then(e=>{e.success?console.log("Event deleted from database successfully"):console.error("Failed to delete event from database:",e.error)}).catch(e=>{console.error("Error deleting event from database:",e)}):console.warn("Auth not ready or user not logged in, event not deleted from database"),p(null),f(null),j(!1),C(null)},[e,t,oe]),ue=(0,n.useCallback)(e=>{const t=new Date(e);t.setHours(9,0,0,0);const r=new Date(t);r.setHours(10,0,0,0);const n={id:"temp-".concat(Date.now()),title:"",start:t,end:r,color:l[0].color,color1:l[0].color1,category:l[0].name,notes:"",location:"",employees:"",isRecurring:!1,position:{x:window.innerWidth/2,y:window.innerHeight/2}};b((0,o.A)((0,o.A)({},n),{},{start:new Date(t),end:new Date(r)})),p(n)},[l]),me=(0,n.useCallback)((e,t)=>{if(!e||!t)return;const r=new Date(e.start),o=new Date(e.end).getTime()-r.getTime(),n=new Date(t);n.setHours(r.getHours(),r.getMinutes(),0,0);const a=new Date(n.getTime()+o);console.log("Event drop on day:",{draggedEvent:e,targetDate:t,newStart:n,newEnd:a})},[]),ge=(0,n.useCallback)((r,n)=>{if(console.log("Saving event:",r),n){console.log("Immediate panel close, mark as validated, and showing loading spinner");const e=u.map(e=>{var t,n,a;return e.id===r.id?(0,o.A)((0,o.A)((0,o.A)({},e),r),{},{isValidated:!0,color:(null===(t=l.find(e=>"blue"===e.id))||void 0===t?void 0:t.color)||e.color,color1:(null===(n=l.find(e=>"blue"===e.id))||void 0===n?void 0:n.color1)||e.color1,color2:(null===(a=l.find(e=>"blue"===e.id))||void 0===a?void 0:a.color2)||e.color2,fromDatabase:!0}):e});var a,s,i;if(-1===u.findIndex(e=>e.id===r.id))e.push((0,o.A)((0,o.A)({},r),{},{isValidated:!0,color:(null===(a=l.find(e=>"blue"===e.id))||void 0===a?void 0:a.color)||r.color,color1:(null===(s=l.find(e=>"blue"===e.id))||void 0===s?void 0:s.color1)||r.color1,color2:(null===(i=l.find(e=>"blue"===e.id))||void 0===i?void 0:i.color2)||r.color2,fromDatabase:!0}));m(e),oe(e),k(e=>new Set([...e,r.id])),p(null),f(null),b(null),q(!0)}const c=u.find(e=>e.id===r.id),d=!(null!==c&&void 0!==c&&c.fromDatabase);if(e&&n){const n=(0,o.A)((0,o.A)({},r),{},{userId:e,isAvailability:"worker"===t||r.isAvailability,isValidated:!0});r.isRecurring&&r.repeatValue&&"None"!==r.repeatValue?(console.log("Saving recurring event to database in background"),_(n,e).then(e=>{console.log("Background recurring save result:",e),q(!1),e.success?G.showNotification("Recurring events saved successfully","success"):(console.error("Failed to save recurring events",e.error),G.showNotification("Failed to save recurring events: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error saving recurring events:",e),q(!1),G.showNotification("Error saving recurring events","error")})):d?(console.log("Saving new event to database in background"),B(n,e).then(e=>{console.log("Background save result:",e),q(!1),e.success?(G.showNotification("Event saved successfully","success"),e.id&&e.id!==r.id&&m(t=>t.map(t=>t.id===r.id?(0,o.A)((0,o.A)({},t),{},{id:e.id}):t))):(console.error("Failed to save event:",e.error),G.showNotification("Failed to save event: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error saving event:",e),q(!1),G.showNotification("Error saving event","error")})):(console.log("Updating existing event in database in background"),Y(r.id,n,e,t).then(e=>{console.log("Background update result:",e),q(!1),e.success?(G.showNotification("Event updated successfully","success"),k(e=>new Set([...e,r.id]))):(console.error("Failed to update event:",e.error),G.showNotification("Failed to update event: "+(e.error||"Unknown error"),"error"))}).catch(e=>{console.error("Error updating event:",e),q(!1),G.showNotification("Error updating event","error")}))}else{const e=u.map(e=>e.id===r.id?(0,o.A)((0,o.A)({},e),r):e);u.find(e=>e.id===r.id)||e.push(r),m(e),n&&(oe(e),q(!1))}},[u,m,oe,k,p,f,b,q,e,t,l]),pe=(0,n.useCallback)((e,t)=>{t.preventDefault(),t.stopPropagation(),console.log("Event right-clicked:",e)},[]),he=(0,n.useCallback)(function(r,n,a){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=u.find(e=>e.id===r);if(!i)return void console.error("Event not found:",r);s?(ee(!0),re(Date.now())):setTimeout(()=>{ee(!1)},250);const l=[...u],c=l.findIndex(e=>e.id===r);if(-1===c)return void console.error("Event index not found:",r);if(s)return l[c]=(0,o.A)((0,o.A)({},l[c]),{},{start:n,end:a,isBeingResized:!0}),void m(l);const d=i.isRecurringInstance,g=d?u.find(e=>e.id===i.recurringParentId):i;if(i.isRecurring||(null===g||void 0===g?void 0:g.recurrence)||d||String(r).includes("-")||String(r).includes("_"))return V({type:"resize",eventId:r,event:i,originalEvent:g,newStart:n,newEnd:a}),R({start:i.start instanceof Date?i.start:new Date(i.start),end:i.end instanceof Date?i.end:new Date(i.end)}),W({start:n,end:a}),A(i),void requestAnimationFrame(()=>{S(!0)});l[c]=(0,o.A)((0,o.A)({},l[c]),{},{start:n,end:a,isBeingResized:!1}),m(l),oe(l);const p=!i.isValidated&&!i.fromDatabase;if(e&&!p){const o={id:r,start:n,end:a,title:i.title,color:i.color,color1:i.color1,color2:i.color2,isValidated:i.isValidated||!1,isRecurring:!1,notes:i.notes,location:i.location,employees:i.employees,canton:i.canton,area:i.area,experience:i.experience,software:i.software,certifications:i.certifications,isAvailability:i.isAvailability};console.log("Updating resized event in database:",o),Y(r,o,e,t).then(e=>{e.success?(console.log("Event resize updated in database successfully"),k(e=>new Set([...e,r]))):(console.warn("Database update failed for resize operation:",e.error),G.showNotification("Failed to save resize changes","warning"))}).catch(e=>{console.warn("Database update error for resize operation:",e),G.showNotification("Failed to save resize changes","warning")})}else console.log("Skipping database update - either no userId or event is new");console.log("Event resized successfully")},[u,m,oe,V,R,W,A,S,ee,re]),fe=(0,n.useCallback)(function(r,n,a){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=u.find(e=>e.id===r);if(!i)return void console.error("Event not found:",r);s?(ee(!0),re(Date.now())):setTimeout(()=>{ee(!1)},250);const l=n instanceof Date?n:new Date(n),c=a instanceof Date?a:new Date(a),d=i.isRecurringInstance,g=d?u.find(e=>e.id===i.recurringParentId):i,p=[...u],h=p.findIndex(e=>e.id===r);if(-1===h)return void console.error("Event index not found:",r);if(s)return p[h]=(0,o.A)((0,o.A)({},p[h]),{},{start:l,end:c,isBeingMoved:!0}),void m(p);const f=i.isRecurring||(null===g||void 0===g?void 0:g.recurrence)||d||String(r).includes("-")||String(r).includes("_");let v=i.isLastOccurrence||!1;if(f&&i.recurrenceId&&!v){const e=u.filter(e=>e.recurrenceId===i.recurrenceId);if(e.length>0){e.sort((e,t)=>{const r=e.end instanceof Date?e.end:new Date(e.end);return(t.end instanceof Date?t.end:new Date(t.end)).getTime()-r.getTime()});const t=e[0];v=i.id===t.id,console.log("Checking if event ".concat(i.id," is last in series: ").concat(v))}}if(f)return V({type:d?"move_single":"move",eventId:r,event:i,originalEvent:g,newStart:l,newEnd:c}),R({start:i.start instanceof Date?i.start:new Date(i.start),end:i.end instanceof Date?i.end:new Date(i.end)}),W({start:l,end:c}),A((0,o.A)((0,o.A)({},i),{},{isLastOccurrence:v})),void requestAnimationFrame(()=>{S(!0)});p[h]=(0,o.A)((0,o.A)({},p[h]),{},{start:l,end:c,isBeingMoved:!1}),m(p),oe(p);const x=!i.isValidated&&!i.fromDatabase;if(e&&!x){const o={id:r,start:l,end:c,title:i.title,color:i.color,color1:i.color1,color2:i.color2,isValidated:i.isValidated||!1,isRecurring:!1,notes:i.notes,location:i.location,employees:i.employees,canton:i.canton,area:i.area,experience:i.experience,software:i.software,certifications:i.certifications,isAvailability:i.isAvailability};console.log("Updating moved event in database:",o),Y(r,o,e,t).then(e=>{e.success?(console.log("Event move updated in database successfully"),k(e=>new Set([...e,r]))):(console.warn("Database update failed for move operation:",e.error),G.showNotification("Failed to save move changes","warning"))}).catch(e=>{console.warn("Database update error for move operation:",e),G.showNotification("Failed to save move changes","warning")})}else console.log("Skipping database update - either no userId or event is new");console.log("Event moved successfully")},[u,m,oe,V,R,W,A,S,ee,re]),ve=(0,n.useCallback)(r=>{console.log("Modification confirm:",r),P?(async(e,t,r,n,a,s,l,c,d,u,m,g,p,h,f,v,x)=>{if(console.log("handleModificationConfirm called with type:",e,"pendingModification:",t),!t)return void console.error("handleModificationConfirm called but no pending modification");d(!1);const{type:y,eventId:b,event:w,newStart:k,newEnd:D}=t;if(console.log("Processing event:",b,"with modification type:",y),"cancel"===e){if(y===i.MOVE||y===i.RESIZE||y===i.MOVE_SINGLE){const e=r.map(e=>e.id===b?(0,o.A)((0,o.A)({},e),{},{start:(null===c||void 0===c?void 0:c.start)instanceof Date?c.start:new Date(c.start),end:(null===c||void 0===c?void 0:c.end)instanceof Date?c.end:new Date(c.end),isBeingMoved:!1}):e);n(e),v&&(console.log("Event move canceled, resetting local storage"),v(e)),x&&x(e=>{const t=new Set(e);return t.delete(b),t})}return u(null),m(null),g(null),void p(null)}if("single"===e){const e=r.findIndex(e=>String(e.id)===String(b));if(-1!==e){console.log("Modifying single event ".concat(b," from recurring series"));const t=[...r],i=!!t[e].recurrenceId;if(t[e]=(0,o.A)((0,o.A)({},t[e]),{},{start:k,end:D,isBeingMoved:!1}),i&&(console.log("Removing recurrenceId from single moved event ".concat(b)),delete t[e].recurrenceId,t[e].isRecurring=!1),n(t),a(t),console.log("Single recurring event modification completed"),s){const r={id:b,start:k,end:D,title:t[e].title,color:t[e].color,color1:t[e].color1,color2:t[e].color2,isValidated:t[e].isValidated||!1,isRecurring:!1,notes:t[e].notes,location:t[e].location,employees:t[e].employees,canton:t[e].canton,area:t[e].area,experience:t[e].experience,software:t[e].software,certifications:t[e].certifications,isAvailability:t[e].isAvailability};console.log("Sending update to database for single event:",r),Y(b,r,s,l).then(e=>{e.success?console.log("Single event modified successfully in database"):console.error("Failed to modify single event in database:",e.error)}).catch(e=>{console.error("Error modifying single event in database:",e)})}}}else if("all"===e){const e=new Date(w.start),t=c?new Date(c.start):new Date(w.start),i=String(b).split(/[-_]/)[0],d=w.recurrenceId;console.log("Modifying all future occurrences with baseId: ".concat(i,", recurrenceId: ").concat(d,", eventId: ").concat(b));const u=r.filter(e=>String(e.id).startsWith(i)||d&&e.recurrenceId===d);console.log("Found ".concat(u.length," events in this series"));const m=k.getTime()-t.getTime();console.log("Time difference to apply: ".concat(m,"ms"));const g="".concat(s,"_").concat(Date.now(),"_recurrence");console.log("Generated new recurrenceId for modified events: ".concat(g));const p=[],h=u.findIndex(e=>String(e.id)===String(b));if(-1!==h){console.log("Found current event at index ".concat(h,": ").concat(b));const e=(0,o.A)((0,o.A)({},u[h]),{},{start:k,end:D,recurrenceId:g,isBeingMoved:!1});p.push(e)}else console.warn("Could not find current event ".concat(b," in series events"));for(const r of u)if(String(r.id)!==String(b)&&new Date(r.start)>=e){const e=new Date(r.start.getTime()+m),t=new Date(r.end.getTime()+m);console.log("Modifying event ".concat(r.id," from ").concat(r.start," to ").concat(e));const n=(0,o.A)((0,o.A)({},r),{},{start:e,end:t,recurrenceId:g,isBeingMoved:!1});p.push(n)}console.log("Modified ".concat(p.length," events in total"));const f=[...r.filter(e=>!(String(e.id).startsWith(i)||d&&e.recurrenceId===d)),...p];n(f),a(f),console.log("All recurring event modifications completed"),s&&(console.log("Updating database with modified recurring events"),p.forEach(e=>{const t={id:e.id,start:e.start,end:e.end,title:e.title,color:e.color,color1:e.color1,color2:e.color2,isValidated:e.isValidated||!1,isRecurring:!0,recurrenceId:g,notes:e.notes,location:e.location,employees:e.employees,canton:e.canton,area:e.area,experience:e.experience,software:e.software,certifications:e.certifications,isAvailability:e.isAvailability,isBeingMoved:!1};Y(e.id,t,s,l).then(t=>{t.success?console.log("Event ".concat(e.id," modified successfully in database")):console.error("Failed to modify event ".concat(e.id," in database:"),t.error)}).catch(t=>{console.error("Error modifying event ".concat(e.id," in database:"),t)})}))}u(null),m(null),g(null),p(null)})(r,P,u,m,oe,e,t,I,S,V,A,R,W,0,0,c,d):console.error("handleModificationConfirm called but no pending modification")},[P,u,m,oe,e,t,I,S,V,A,R,W,p,f,c,d]),xe=(0,n.useCallback)(()=>{console.log("Move confirm"),ve("single")},[ve]),ye=(0,n.useCallback)(()=>{console.log("Move all confirm"),ve("all")},[ve]),be=(0,n.useCallback)(()=>{console.log("Move cancel"),ve("cancel")},[ve]),we=(0,n.useCallback)(()=>{console.log("Event change complete"),oe([...u])},[oe,u]);return{events:u,setEvents:m,selectedEvent:g,setSelectedEvent:p,selectedEventId:h,setSelectedEventId:f,selectedEventIds:v,setSelectedEventIds:x,originalEventPosition:y,setOriginalEventPosition:b,validatedEvents:w,setValidatedEvents:k,showDeleteConfirmation:D,setShowDeleteConfirmation:j,eventToDelete:N,setEventToDelete:C,showMoveConfirmation:T,setShowMoveConfirmation:S,movedEvent:E,setMovedEvent:A,originalEventDates:I,setOriginalEventDates:R,newEventDates:M,setNewEventDates:W,showModificationDialog:O,setShowModificationDialog:L,pendingModification:P,setPendingModification:V,isSaving:H,setIsSaving:q,history:U,currentHistoryIndex:J,addToHistory:oe,handleEventClick:se,handleEventDoubleClick:ie,handleEventRightClick:pe,handlePanelClose:le,handleEventSave:ge,handleEventDelete:de,handleEventResize:he,handleEventMove:fe,handleModificationConfirm:ve,handleMoveConfirm:xe,handleMoveAllConfirm:ye,handleMoveCancel:be,handleEventChangeComplete:we,handleCreateEventClick:ue,handleEventDropOnDay:me,undo:ne,redo:ae,slideDirection:Q,setSlideDirection:Z,isDragging:$,setIsDragging:ee,dragStartTime:te,setDragStartTime:re}};var J=r(3376),X=r(4304),Q=r(8846),Z=r(1816),$=r(3694),ee=r(2335),te=r(3271);const re=e=>{let{color:t,color1:r,onChange:o,size:a=32,className:i=""}=e;const[l,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(t||s[0].color),[m,g]=(0,n.useState)(100),v=(0,n.useRef)(null),x=(0,n.useRef)(null),y=(0,n.useRef)(null),[b,w]=(0,n.useState)({top:0,left:0}),[k,D]=(0,n.useState)(!1),j=(0,n.useRef)(null);(0,n.useEffect)(()=>{t&&u(t)},[t]),(0,n.useEffect)(()=>{const e=e=>{v.current&&y.current&&!v.current.contains(e.target)&&!y.current.contains(e.target)&&(c(!1),D(!1))};if(l&&k)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l,k]),(0,n.useEffect)(()=>{if(l&&x.current){const e=()=>{const e=x.current.getBoundingClientRect(),t=window.innerHeight-e.bottom,r=e.top;let o=e.bottom+window.scrollY+8,n=e.left+window.scrollX+e.width/2-160;t<450&&r>t&&(o=e.top+window.scrollY-450-8),n<8&&(n=8),n+320>window.innerWidth-8&&(n=window.innerWidth-320-8),w({top:o,left:n}),j.current=setTimeout(()=>{D(!0)},100)};return D(!1),e(),()=>{j.current&&clearTimeout(j.current)}}D(!1)},[l]);const N=(e,t)=>{const r=parseInt(e.replace("#",""),16);return"#"+((1<<24)+(Math.min(255,Math.floor(t/100*(r>>16)))<<16)+(Math.min(255,Math.floor(t/100*(r>>8&255)))<<8)+Math.min(255,Math.floor(t/100*(255&r)))).toString(16).slice(1)},C=e=>{u(e);const t=N(e,m);o(e,t)},T=r||t||s[0].color1;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:(0,h.cn)("relative",i),ref:v,children:(0,f.jsx)("button",{ref:x,type:"button",onClick:e=>{e.stopPropagation(),l?(c(!1),D(!1)):c(!0)},className:"rounded-full border-2 transition-all hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2",style:{width:"".concat(a,"px"),height:"".concat(a,"px"),backgroundColor:T,borderColor:"rgba(37, 99, 235, 0.3)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},"aria-label":"Select color"})}),l&&k&&(0,f.jsxs)("div",{ref:y,className:"fixed p-4 bg-white rounded-xl shadow-2xl border border-border",style:{width:"320px",top:"".concat(b.top,"px"),left:"".concat(b.left,"px"),maxHeight:"90vh",overflowY:"auto",zIndex:"var(--z-index-popup, 11000)"},onClick:e=>e.stopPropagation(),children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,f.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:"Select Color"}),(0,f.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),c(!1),D(!1)},className:"p-1 hover:bg-muted rounded transition-colors","aria-label":"Close",children:(0,f.jsx)(p.yGN,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-2",children:"Preset Colors"}),(0,f.jsx)("div",{className:"flex gap-2 flex-wrap",children:s.map(e=>{const r=t===e.color;return(0,f.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),(e=>{const t=e.color,r=e.color1;u(t),o(t,r),c(!1),D(!1)})(e)},className:(0,h.cn)("w-8 h-8 rounded-full border-2 transition-all hover:scale-110",r?"":"border-transparent"),style:{backgroundColor:e.color1||e.color,borderColor:r?"var(--color-logo-1)":"transparent",boxShadow:r?"0 0 0 2px var(--color-logo-1), 0 0 0 4px rgba(37, 99, 235, 0.1)":"none"},title:e.name,"aria-label":e.name},e.id)})})]}),(0,f.jsxs)("div",{className:"border-t border-border pt-4",children:[(0,f.jsx)("label",{className:"block text-xs font-medium text-muted-foreground mb-2",children:"Custom Color"}),(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsx)("div",{className:"flex justify-center",children:(0,f.jsx)(te.jI,{color:d,onChange:C,style:{width:"100%"}})}),(0,f.jsx)("div",{className:"flex items-center gap-3",children:(0,f.jsx)("input",{type:"text",value:d,onChange:e=>{const t=e.target.value;/^#[0-9A-F]{6}$/i.test(t)&&C(t)},className:"flex-1 px-2 py-1 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"#000000",onClick:e=>e.stopPropagation()})}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-xs font-medium text-muted-foreground mb-2",children:["Brightness: ",m,"%"]}),(0,f.jsx)("input",{type:"range",min:"20",max:"100",value:m,onChange:e=>{const t=parseInt(e.target.value);g(t);const r=N(d,t);o(d,r)},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",style:{background:"linear-gradient(to right, ".concat(N(d,20)," 0%, ").concat(N(d,100)," 100%)")},onClick:e=>e.stopPropagation()}),(0,f.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["Preview: ",(0,f.jsx)("span",{style:{color:N(d,m)},children:"\u25cf"})]})]})]})]})]})]})]})};var oe=r(6563),ne=r(6935);const ae=[{key:"monday",labelKey:"operations.monday"},{key:"tuesday",labelKey:"operations.tuesday"},{key:"wednesday",labelKey:"operations.wednesday"},{key:"thursday",labelKey:"operations.thursday"},{key:"friday",labelKey:"operations.friday"},{key:"saturday",labelKey:"operations.saturday"},{key:"sunday",labelKey:"operations.sunday"}],se=[{value:"pharmacist",labelKey:"operations.workerTypes.pharmacist"},{value:"cashier",labelKey:"operations.workerTypes.cashier"},{value:"assistant",labelKey:"operations.workerTypes.assistant"},{value:"pharmacy_technician",labelKey:"operations.workerTypes.pharmacyTechnician"},{value:"other",labelKey:"operations.workerTypes.other"}],ie=e=>{let{isOpen:t,onClose:r,profileData:i,onSave:l,editingRole:c=null,onDelete:d=null}=e;const{t:u}=(0,a.Bd)(["dashboardProfile","common"]),{selectedWorkspace:m}=(0,C.M)(),[g,h]=(0,n.useState)({workerType:"none",workerTypeOther:"",assignedWorkers:[],appliesToAllDays:!1,specificDays:[]}),[v,x]=(0,n.useState)(!1),[y,b]=(0,n.useState)([]),[w,k]=(0,n.useState)(!1),[j,N]=(0,n.useState)(null),[T,S]=(0,n.useState)(null),[E,A]=(0,n.useState)({}),[I,R]=(0,n.useState)({}),[M,W]=(0,n.useState)({}),[O,L]=(0,n.useState)({}),{showSuccess:F,showError:V}=(0,ne.h)(),H=(0,n.useRef)(null),q=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(c){const e=c.assignedWorkers||[];if(0===e.length&&(c.assignedPharmacistId||c.placeholderName)){const t=s[0];e.push({id:Date.now().toString(),workerId:c.assignedPharmacistId||"",placeholderName:c.placeholderName||"",color:c.color||t.color,color1:c.color1||t.color1})}h({workerType:c.workerType||"pharmacist",workerTypeOther:c.workerTypeOther||"",assignedWorkers:e,appliesToAllDays:c.appliesToAllDays||!1,specificDays:c.specificDays||[]});const t=e.length>0&&e[0].color?e[0].color:c.color||s[0].color;S(t)}else h({workerType:"none",workerTypeOther:"",assignedWorkers:[],appliesToAllDays:!1,specificDays:[]}),S(null);A({}),R({}),W({})},[c,t]);const B=(0,n.useCallback)(()=>{const e=(0,X.get)(i,"operationalSettings.workerRequirements")||[],t=new Set;e.forEach(e=>{(e.assignedWorkers||[]).forEach(e=>{e.color&&t.add(e.color)}),e.color&&t.add(e.color)});(g.assignedWorkers||[]).forEach(e=>{e.color&&t.add(e.color)});return s.find(e=>!t.has(e.color))||s[0]},[i,g.assignedWorkers]);(0,n.useEffect)(()=>{if(!c&&t&&g.workerType&&"none"!==g.workerType){var e;const t=null===H.current,r=null!==H.current&&H.current!==g.workerType,n="other"===g.workerType&&q.current!==g.workerTypeOther&&""!==(null===(e=g.workerTypeOther)||void 0===e?void 0:e.trim());if(t||r||n){const e=((0,X.get)(i,"operationalSettings.workerRequirements")||[]).find(e=>{var t;return"other"===g.workerType?"other"===e.workerType&&e.workerTypeOther===g.workerTypeOther&&""!==(null===(t=g.workerTypeOther)||void 0===t?void 0:t.trim()):e.workerType===g.workerType&&"other"!==e.workerType});if(e){const t=(e.assignedWorkers||[]).map(e=>(0,o.A)((0,o.A)({},e),{},{id:e.id||Date.now().toString()+Math.random()}));if(h(r=>(0,o.A)((0,o.A)({},r),{},{assignedWorkers:t,appliesToAllDays:e.appliesToAllDays||r.appliesToAllDays,specificDays:e.specificDays||r.specificDays})),t.length>0){const e=t[0].color||s[0].color;S(e)}}else h(e=>(0,o.A)((0,o.A)({},e),{},{assignedWorkers:[],appliesToAllDays:!1,specificDays:[]})),S(null),N(null)}H.current=g.workerType,q.current=g.workerTypeOther}else t||(H.current=null,q.current=null)},[g.workerType,g.workerTypeOther,c,t,i,B]),(0,n.useEffect)(()=>{t&&g.workerType&&"none"!==g.workerType&&(async()=>{if(t&&null!==m&&void 0!==m&&m.facilityId){k(!0);try{const e=(0,P.doc)(z.db,"facilityProfiles",m.facilityId),t=await(0,P.getDoc)(e);if(t.exists()){const e=t.data().employees||[],r=e.filter(e=>"admin"===e.rights).map(e=>e.uid),o=e.filter(e=>"admin"!==e.rights).map(e=>e.uid),n=[...new Set([...r,...o])].map(async e=>{try{const o=(0,P.doc)(z.db,"professionalProfiles",e),n=await(0,P.getDoc)(o);if(n.exists()){var t;const o=n.data(),a=o.identity||{};return{uid:e,firstName:a.legalFirstName||a.firstName||"",lastName:a.legalLastName||a.lastName||"",email:(null===(t=o.contact)||void 0===t?void 0:t.primaryEmail)||"",isAdmin:r.includes(e)}}{const t=(0,P.doc)(z.db,"users",e),o=await(0,P.getDoc)(t);if(o.exists()){const t=o.data();return{uid:e,firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",isAdmin:r.includes(e)}}}}catch(o){console.error("Error fetching profile for user ".concat(e,":"),o)}return null}),a=(await Promise.all(n)).filter(e=>null!==e);b(a)}}catch(e){console.error("Error fetching team members:",e)}finally{k(!1)}}})()},[t,null===m||void 0===m?void 0:m.facilityId,g.workerType]),(0,n.useEffect)(()=>{const e=g.assignedWorkers||[];if(e.length>0){const t=e.find(e=>e.color)||e[0];t&&t.color&&S(t.color)}else c||S(null)},[g.assignedWorkers,c]);(0,n.useMemo)(()=>{const e=(0,X.get)(i,"operationalSettings.standardOpeningHours")||{};return ae.map(t=>{const r=e[t.key]||"",n="closed"===r||""===r;let a="08:00",s="18:00";if(!n&&r.includes("-")){var i,l;const e=r.split("-");a=(null===(i=e[0])||void 0===i?void 0:i.trim())||"08:00",s=(null===(l=e[1])||void 0===l?void 0:l.trim())||"18:00"}return(0,o.A)((0,o.A)({},t),{},{isClosed:n,openingTime:a,closingTime:s,rawValue:r})})},[i]);const Y=(0,n.useCallback)(()=>[...[{value:"none",label:u("operations.workerTypes.none","None")}],...se.map(e=>({value:e.value,label:u(e.labelKey)}))],[u]),_=((0,n.useCallback)(()=>{const e=[{value:"",label:u("operations.selectPharmacistOrPlaceholder","Select Pharmacist or Enter Placeholder")}];return y.forEach(t=>{const r=t.firstName||"",o=t.lastName||"",n="".concat(r," ").concat(o).trim();e.push({value:t.uid,label:n||"".concat(r).concat(o)||"Unknown"})}),e.push({value:"placeholder",label:u("operations.usePlaceholderName","Enter Placeholder Name")}),e},[y,u]),(0,n.useCallback)((e,t)=>{h(r=>{if("appliesToAllDays"===e)return(0,o.A)((0,o.A)({},r),{},{appliesToAllDays:t,specificDays:t?[]:r.specificDays});if("toggleDay"===e){const e=r.specificDays.indexOf(t)>=0?r.specificDays.filter(e=>e!==t):[...r.specificDays,t];return(0,o.A)((0,o.A)({},r),{},{specificDays:e})}if("workerType"===e){if("none"===t)return(0,o.A)((0,o.A)({},r),{},{[e]:t,workerTypeOther:"",assignedWorkers:[]});if("other"!==t)return(0,o.A)((0,o.A)({},r),{},{[e]:t,workerTypeOther:""})}return(0,o.A)((0,o.A)({},r),{},{[e]:t})}),"workerType"===e&&R(e=>{const t=(0,o.A)({},e);return delete t.workerType,t}),"workerTypeOther"===e&&R(e=>{const t=(0,o.A)({},e);return delete t.workerTypeOther,t})},[])),U=(0,n.useCallback)(()=>{var e;if(!g.workerType||"none"===g.workerType)return R({workerType:u("operations.workerTypeRequired","Role type is required")}),void V(u("operations.workerTypeRequired","Role type is required"));if("other"===g.workerType&&(null===(e=g.workerTypeOther)||void 0===e||!e.trim()))return R({workerTypeOther:u("operations.workerTypeOtherRequired","Role type name is required")}),void V(u("operations.workerTypeOtherRequired","Role type name is required"));const t=g.assignedWorkers||[];let r;if(t.length>0){const e=t[t.length-1];r={color:e.color||s[0].color,color1:e.color1||s[0].color1}}else r=s[0];const n={id:Date.now().toString(),workerId:"",placeholderName:"",color:r.color,color1:r.color1};h(e=>(0,o.A)((0,o.A)({},e),{},{assignedWorkers:[...e.assignedWorkers||[],n]})),S(r.color),N(n.id)},[g.assignedWorkers,g.workerType,g.workerTypeOther,u,V]),G=(0,n.useCallback)(e=>{h(t=>(0,o.A)((0,o.A)({},t),{},{assignedWorkers:(t.assignedWorkers||[]).filter(t=>t.id!==e)})),A(t=>{const r=(0,o.A)({},t);return delete r["".concat(e,"_workerId")],delete r["".concat(e,"_placeholderName")],1===Object.keys(r).length&&r._general&&delete r._general,r})},[]),K=(0,n.useCallback)((e,t,r)=>{h(n=>(0,o.A)((0,o.A)({},n),{},{assignedWorkers:(n.assignedWorkers||[]).map(n=>{if(n.id===e){if("color"===t){const e=s.find(e=>e.color===r),t=(0,o.A)((0,o.A)({},n),{},{color:r,color1:(null===e||void 0===e?void 0:e.color1)||r});return S(r),t}return(0,o.A)((0,o.A)({},n),{},{[t]:r})}return n})})),"workerId"!==t&&"placeholderName"!==t||A(n=>{const a=(0,o.A)({},n);return"workerId"===t?(delete a["".concat(e,"_workerId")],"placeholder"===r&&delete a["".concat(e,"_placeholderName")]):"placeholderName"===t&&delete a["".concat(e,"_placeholderName")],a})},[]),J=(0,n.useCallback)(()=>{var e;const t={},r={};let o=!0;if(g.workerType&&"none"!==g.workerType||(o=!1,r.workerType=u("operations.workerTypeRequired","Role type is required")),"other"!==g.workerType||null!==(e=g.workerTypeOther)&&void 0!==e&&e.trim()||(o=!1,r.workerTypeOther=u("operations.workerTypeOtherRequired","Role type name is required")),g.workerType&&"none"!==g.workerType){const e=g.assignedWorkers||[];0===e.length&&(o=!1,t._general=u("operations.atLeastOneWorkerRequired","At least one worker is required")),e.forEach(e=>{const r=e.workerId||"",n=e.placeholderName||"";r&&""!==r?"placeholder"!==r||n.trim()||(o=!1,t["".concat(e.id,"_placeholderName")]=u("operations.placeholderNameRequired","Placeholder name is required")):(o=!1,t["".concat(e.id,"_workerId")]=u("operations.workerSelectionRequired","Worker selection is required"))})}return A(t),R(r),o},[g.assignedWorkers,g.workerType,g.workerTypeOther,u]),te=((0,n.useCallback)(()=>{var e;return g.workerType&&"none"!==g.workerType?"other"!==g.workerType||null!==(e=g.workerTypeOther)&&void 0!==e&&e.trim()?(R({}),!0):(R({workerTypeOther:u("operations.workerTypeOtherRequired","Role type name is required")}),!1):(R({workerType:u("operations.workerTypeRequired","Role type is required")}),!1)},[g.workerType,g.workerTypeOther,u]),(0,n.useCallback)(async e=>{var t;if(null!==m&&void 0!==m&&m.facilityId){if(!g.workerType||"none"===g.workerType)return R({workerType:u("operations.workerTypeRequired","Role type is required")}),void V(u("operations.workerTypeRequired","Role type is required"));if("other"===g.workerType&&(null===(t=g.workerTypeOther)||void 0===t||!t.trim()))return R({workerTypeOther:u("operations.workerTypeOtherRequired","Role type name is required")}),void V(u("operations.workerTypeOtherRequired","Role type name is required"));L(t=>(0,o.A)((0,o.A)({},t),{},{[e]:!0}));try{(0,X.get)(i,"operationalSettings.workerRequirements");let t;t=c?c.id:Date.now().toString();const r=await(0,oe.W_)(m.facilityId,t,g.workerType,g.workerTypeOther,e);if(r.success){const t=window.location.origin,n="".concat(t,"/invite/").concat(r.invitationToken);W(t=>(0,o.A)((0,o.A)({},t),{},{[e]:{link:n,token:r.invitationToken}})),F(u("operations.invitationGenerated","Invitation link generated successfully"))}else V(r.error||u("operations.invitationGenerationFailed","Failed to generate invitation"))}catch(r){console.error("Error generating invitation:",r),V(u("operations.invitationGenerationFailed","Failed to generate invitation"))}finally{L(t=>(0,o.A)((0,o.A)({},t),{},{[e]:!1}))}}else V(u("operations.facilityRequired","Facility is required"))},[g,i,m,c,u,F,V])),ie=(0,n.useCallback)(e=>{navigator.clipboard.writeText(e),F(u("common.linkCopied","Link copied to clipboard"))},[u,F]),le=(0,n.useCallback)(e=>{const t=encodeURIComponent(u("operations.invitationEmailSubject","Join our facility team")),r=encodeURIComponent(u("operations.invitationEmailBody","You've been invited to join our facility team. Click the link to accept: ".concat(e)));window.location.href="mailto:?subject=".concat(t,"&body=").concat(r)},[u]),ce=(0,n.useCallback)(e=>{const t=encodeURIComponent(u("operations.invitationWhatsAppMessage","You've been invited to join our facility team. Click here: ".concat(e)));window.open("https://wa.me/?text=".concat(t),"_blank")},[u]),de=(0,n.useCallback)(()=>{if(!J())return;const e=(0,X.get)(i,"operationalSettings.workerRequirements")||[];let t;if(c)t=e.map(e=>e.id===c.id?(0,o.A)((0,o.A)({},e),g):e);else{const r=e.findIndex(e=>{var t;return"other"===g.workerType?"other"===e.workerType&&e.workerTypeOther===g.workerTypeOther&&""!==(null===(t=g.workerTypeOther)||void 0===t?void 0:t.trim()):e.workerType===g.workerType&&"other"!==e.workerType});if(r>=0)t=e.map((e,t)=>t===r?(0,o.A)((0,o.A)({},e),g):e);else{const r=(0,o.A)({id:Date.now().toString()},g);t=[...e,r]}}l(t),r(),h({workerType:"none",workerTypeOther:"",assignedWorkers:[],appliesToAllDays:!1,specificDays:[]}),N(null),A({}),W({})},[g,i,l,r,c,J]),ue=(0,n.useCallback)(()=>{if(d&&c){const e=((0,X.get)(i,"operationalSettings.workerRequirements")||[]).filter(e=>e.id!==c.id);d(e),x(!1),r()}},[d,c,i,r]);return t?(0,f.jsxs)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&r()},children:[(0,f.jsxs)("div",{className:"bg-card rounded-xl shadow-xl max-w-[448px] w-full max-h-[600px] min-h-[600px] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,f.jsxs)("div",{className:"p-6 border-b border-border flex items-center justify-between rounded-t-xl transition-colors shrink-0",style:{backgroundColor:T||"transparent",borderBottomColor:T?"rgba(255, 255, 255, 0.2)":void 0},children:[(0,f.jsx)("h3",{className:"text-xl font-semibold transition-colors",style:{color:T?"#ffffff":void 0},children:c?u("operations.editWorkerRequirement","Edit Facility Role"):u("operations.addWorkerRequirement")}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[c&&d&&(0,f.jsx)("button",{onClick:()=>x(!0),className:"p-2 hover:bg-destructive/10 rounded-lg transition-colors",style:{color:T?"#ffffff":void 0,backgroundColor:T?"rgba(255, 255, 255, 0.1)":void 0},onMouseEnter:e=>{T&&(e.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.3)")},onMouseLeave:e=>{T&&(e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)")},"aria-label":"Delete",children:(0,f.jsx)(p.IXo,{className:"w-5 h-5"})}),(0,f.jsx)("button",{onClick:r,className:"p-2 hover:bg-muted rounded-lg transition-colors",style:{color:T?"#ffffff":void 0,backgroundColor:T?"rgba(255, 255, 255, 0.1)":void 0},onMouseEnter:e=>{T&&(e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)")},onMouseLeave:e=>{T&&(e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.1)")},"aria-label":"Close",children:(0,f.jsx)(p.yGN,{className:"w-5 h-5"})})]})]}),(0,f.jsxs)("div",{className:"p-6 space-y-6 flex-1 overflow-y-auto",children:[(0,f.jsx)("div",{className:"mb-4",children:(0,f.jsx)(ee.A,{label:u("operations.workerType","Role Type"),options:Y(),value:g.workerType,onChange:e=>_("workerType",e),placeholder:u("operations.selectWorkerType"),required:!0,error:I.workerType})}),"other"===g.workerType&&(0,f.jsx)("div",{className:"mb-4",children:(0,f.jsx)($.A,{label:u("operations.workerTypeOther"),type:"text",value:g.workerTypeOther||"",onChange:e=>_("workerTypeOther",e.target.value),placeholder:u("operations.workerTypeOtherPlaceholder"),required:!0,error:I.workerTypeOther})}),g.workerType&&"none"!==g.workerType&&(0,f.jsx)("div",{className:"mb-4",children:(()=>{const e=g.assignedWorkers||[],t=e.filter(e=>e.workerId||e.placeholderName),r=e.filter(e=>!e.workerId&&!e.placeholderName&&j===e.id);return(0,f.jsxs)(f.Fragment,{children:[t.length>0&&(0,f.jsx)("div",{className:"space-y-2 mb-4",children:t.map(e=>{var t;const r=e.workerId&&"placeholder"!==e.workerId?(()=>{const t=y.find(t=>t.uid===e.workerId);return t?"".concat(t.firstName," ").concat(t.lastName).trim():"Unknown"})():e.placeholderName||u("operations.placeholder","Placeholder"),n=(0,X.get)(i,"operationalSettings.workerRequirements")||[],a=c?n.filter(e=>e.id!==c.id):n,s=new Set(a.flatMap(e=>(e.assignedWorkers||[]).filter(e=>e.workerId&&""!==e.workerId&&"placeholder"!==e.workerId).map(e=>String(e.workerId)))),l=new Set((g.assignedWorkers||[]).filter(t=>t.id!==e.id&&t.workerId&&""!==t.workerId&&"placeholder"!==t.workerId).map(e=>String(e.workerId))),d=new Set([...s,...l]),m=e.workerId&&"placeholder"!==e.workerId?String(e.workerId):null,h=(y||[]).filter(e=>{if(!e||!e.uid)return!1;const t=String(e.uid);return!d.has(t)||t===m});return(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-border rounded-lg bg-card/50",children:[(0,f.jsx)(re,{color:e.color,color1:e.color1,onChange:(t,r)=>K(e.id,"color",t),size:32}),(0,f.jsx)("div",{className:"flex-1",children:j===e.id||!e.workerId&&!e.placeholderName?(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(ee.A,{label:u("operations.selectWorkerOrPlaceholder","Select Worker or Placeholder"),options:[{value:"",label:u("operations.selectWorkerOrPlaceholder","Select Worker or Placeholder")},...h.map(e=>({value:e.uid,label:"".concat(e.firstName," ").concat(e.lastName).trim()||"Unknown"})),{value:"placeholder",label:u("operations.usePlaceholderName","Enter Placeholder Name")}],value:"placeholder"===e.workerId?"placeholder":e.workerId||"",onChange:t=>{"placeholder"===t?(K(e.id,"workerId","placeholder"),K(e.id,"placeholderName",""),N(e.id)):t?(K(e.id,"workerId",t),K(e.id,"placeholderName",""),N(null)):(K(e.id,"workerId",""),K(e.id,"placeholderName",""),N(null))},required:!0,error:E["".concat(e.id,"_workerId")]},"".concat(e.id,"-").concat(d.size,"-").concat(h.length)),"placeholder"===e.workerId&&(0,f.jsx)($.A,{label:u("operations.placeholderName","Placeholder Name"),type:"text",value:e.placeholderName||"",onChange:t=>{K(e.id,"placeholderName",t.target.value)},placeholder:u("operations.placeholderNamePlaceholder","Enter name"),required:!0,error:E["".concat(e.id,"_placeholderName")]})]}):(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("span",{className:"text-sm font-medium",children:r}),(0,f.jsx)("button",{type:"button",onClick:()=>N(e.id),className:"p-1 text-muted-foreground hover:bg-muted rounded transition-colors text-xs",children:u("common.edit","Edit")})]})}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(!e.workerId||"placeholder"===e.workerId)&&(0,f.jsx)("button",{type:"button",onClick:()=>te(e.id),disabled:O[e.id]||!g.workerType||"none"===g.workerType||"other"===g.workerType&&!(null!==(t=g.workerTypeOther)&&void 0!==t&&t.trim()),className:"p-1 text-primary hover:bg-primary/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:g.workerType&&"none"!==g.workerType?O[e.id]?u("operations.generatingInvitation","Generating..."):u("operations.generateInvitationLink","Generate Invitation Link"):u("operations.workerTypeRequired","Role type is required"),children:O[e.id]?(0,f.jsx)(p.TwU,{size:16,className:"animate-spin"}):(0,f.jsx)(p.Pum,{size:16})}),(0,f.jsx)("button",{type:"button",onClick:()=>G(e.id),className:"p-1 text-destructive hover:bg-destructive/10 rounded transition-colors",children:(0,f.jsx)(p.IXo,{size:16})})]})]}),M[e.id]&&(0,f.jsxs)("div",{className:"p-3 border border-border rounded-lg bg-card/50 space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("h5",{className:"text-xs font-semibold",children:u("operations.sendInvitation","Send Invitation")}),(0,f.jsx)("button",{onClick:()=>W(t=>{const r=(0,o.A)({},t);return delete r[e.id],r}),className:"p-1 text-muted-foreground hover:text-foreground",children:(0,f.jsx)(p.yGN,{size:12})})]}),(0,f.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,f.jsx)("div",{className:"p-2 bg-white rounded-lg",children:(0,f.jsx)(Z.h,{value:M[e.id].link,size:120})}),(0,f.jsx)($.A,{type:"text",value:M[e.id].link,readOnly:!0,className:"w-full text-xs"}),(0,f.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,f.jsxs)(D.A,{onClick:()=>ie(M[e.id].link),variant:"secondary",className:"flex-1 text-xs py-1",children:[(0,f.jsx)(p.nxz,{size:12,className:"mr-1"}),u("common.copy","Copy")]}),(0,f.jsxs)(D.A,{onClick:()=>le(M[e.id].link),variant:"secondary",className:"flex-1 text-xs py-1",children:[(0,f.jsx)(p.pHD,{size:12,className:"mr-1"}),u("operations.shareEmail","Email")]}),(0,f.jsxs)(D.A,{onClick:()=>ce(M[e.id].link),variant:"secondary",className:"flex-1 text-xs py-1",children:[(0,f.jsx)(Q.EcP,{size:12,className:"mr-1"}),u("operations.shareWhatsApp","WhatsApp")]})]})]})]})]},e.id)})}),t.length>0&&(0,f.jsx)("div",{className:"my-4 border-t border-border"}),(0,f.jsxs)("div",{className:"space-y-2",children:[0===t.length&&(!g.assignedWorkers||0===g.assignedWorkers.length||g.assignedWorkers.every(e=>!e.workerId&&!e.placeholderName)&&!j)&&(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"text-xs text-muted-foreground text-center py-2",children:u("operations.noWorkersAssigned",'No workers assigned. Click "Add Worker" to assign.')}),E._general&&(0,f.jsx)("p",{className:"text-xs text-destructive text-center py-1",children:E._general})]}),r.map(e=>{var t;const r=(0,X.get)(i,"operationalSettings.workerRequirements")||[],n=c?r.filter(e=>e.id!==c.id):r,a=new Set(n.flatMap(e=>(e.assignedWorkers||[]).filter(e=>e.workerId&&""!==e.workerId&&"placeholder"!==e.workerId).map(e=>String(e.workerId)))),s=new Set((g.assignedWorkers||[]).filter(t=>t.id!==e.id&&t.workerId&&""!==t.workerId&&"placeholder"!==t.workerId).map(e=>String(e.workerId))),l=new Set([...a,...s]),d=e.workerId&&"placeholder"!==e.workerId?String(e.workerId):null,m=(y||[]).filter(e=>{if(!e||!e.uid)return!1;const t=String(e.uid);return!l.has(t)||t===d});return(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-border rounded-lg bg-card/50",children:[(0,f.jsx)(re,{color:e.color,color1:e.color1,onChange:(t,r)=>K(e.id,"color",t),size:32}),(0,f.jsx)("div",{className:"flex-1",children:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(ee.A,{label:u("operations.selectWorkerOrPlaceholder","Select Worker or Placeholder"),options:[{value:"",label:u("operations.selectWorkerOrPlaceholder","Select Worker or Placeholder")},...m.map(e=>({value:e.uid,label:"".concat(e.firstName," ").concat(e.lastName).trim()||"Unknown"})),{value:"placeholder",label:u("operations.usePlaceholderName","Enter Placeholder Name")}],value:"placeholder"===e.workerId?"placeholder":e.workerId||"",onChange:t=>{"placeholder"===t?(K(e.id,"workerId","placeholder"),K(e.id,"placeholderName",""),N(e.id)):t?(K(e.id,"workerId",t),K(e.id,"placeholderName",""),N(null)):G(e.id)},required:!0,error:E["".concat(e.id,"_workerId")]},"".concat(e.id,"-").concat(l.size,"-").concat(m.length)),"placeholder"===e.workerId&&(0,f.jsx)($.A,{label:u("operations.placeholderName","Placeholder Name"),type:"text",value:e.placeholderName||"",onChange:t=>{K(e.id,"placeholderName",t.target.value)},placeholder:u("operations.placeholderNamePlaceholder","Enter name"),required:!0,error:E["".concat(e.id,"_placeholderName")]})]})}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)("button",{type:"button",onClick:()=>te(e.id),disabled:O[e.id]||!g.workerType||"none"===g.workerType||"other"===g.workerType&&!(null!==(t=g.workerTypeOther)&&void 0!==t&&t.trim()),className:"p-1 text-primary hover:bg-primary/10 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:g.workerType&&"none"!==g.workerType?O[e.id]?u("operations.generatingInvitation","Generating..."):u("operations.generateInvitationLink","Generate Invitation Link"):u("operations.workerTypeRequired","Role type is required"),children:O[e.id]?(0,f.jsx)(p.TwU,{size:16,className:"animate-spin"}):(0,f.jsx)(p.Pum,{size:16})}),(0,f.jsx)("button",{type:"button",onClick:()=>G(e.id),className:"p-1 text-destructive hover:bg-destructive/10 rounded transition-colors",children:(0,f.jsx)(p.IXo,{size:16})})]})]}),M[e.id]&&(0,f.jsxs)("div",{className:"p-3 border border-border rounded-lg bg-card/50 space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("h5",{className:"text-xs font-semibold",children:u("operations.sendInvitation","Send Invitation")}),(0,f.jsx)("button",{onClick:()=>W(t=>{const r=(0,o.A)({},t);return delete r[e.id],r}),className:"p-1 text-muted-foreground hover:text-foreground",children:(0,f.jsx)(p.yGN,{size:12})})]}),(0,f.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,f.jsx)("div",{className:"p-2 bg-white rounded-lg",children:(0,f.jsx)(Z.h,{value:M[e.id].link,size:120})}),(0,f.jsx)($.A,{type:"text",value:M[e.id].link,readOnly:!0,className:"w-full text-xs"}),(0,f.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,f.jsxs)(D.A,{onClick:()=>ie(M[e.id].link),variant:"secondary",className:"flex-1 text-xs py-1",children:[(0,f.jsx)(p.nxz,{size:12,className:"mr-1"}),u("common.copy","Copy")]}),(0,f.jsxs)(D.A,{onClick:()=>le(M[e.id].link),variant:"secondary",className:"flex-1 text-xs py-1",children:[(0,f.jsx)(p.pHD,{size:12,className:"mr-1"}),u("operations.shareEmail","Email")]}),(0,f.jsxs)(D.A,{onClick:()=>ce(M[e.id].link),variant:"secondary",className:"flex-1 text-xs py-1",children:[(0,f.jsx)(Q.EcP,{size:12,className:"mr-1"}),u("operations.shareWhatsApp","WhatsApp")]})]})]})]})]},e.id)}),(0,f.jsx)("div",{className:"mt-3",children:(0,f.jsxs)(D.A,{onClick:U,variant:"secondary",className:"text-xs py-1 px-2",children:[(0,f.jsx)(p.GGD,{className:"w-3 h-3 mr-1"}),u("operations.addWorker","Add Worker")]})})]})]})})()})]}),(0,f.jsxs)("div",{className:"p-6 border-t border-border flex gap-3 justify-end shrink-0 bg-card rounded-b-xl",children:[(0,f.jsx)(D.A,{onClick:r,variant:"secondary",className:"px-6 py-2.5 bg-white border-2 border-border text-foreground hover:bg-muted",children:u("common.cancel","Cancel")}),(0,f.jsx)(D.A,{onClick:de,variant:"confirmation",className:"px-6 py-2.5",children:u("common.save","Save")})]})]}),v&&(0,f.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 animate-in fade-in duration-200",style:{backgroundColor:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(4px)"},onClick:e=>{e.target===e.currentTarget&&x(!1)},children:(0,f.jsxs)("div",{className:"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border overflow-hidden flex flex-col transform transition-all duration-200 scale-100 animate-in zoom-in-95",onClick:e=>e.stopPropagation(),style:{backgroundColor:"var(--background-div-color)",borderColor:"var(--grey-2)",boxShadow:"var(--box-shadow-md)"},children:[(0,f.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b",style:{borderBottomColor:"var(--red-2)",backgroundColor:"var(--red-1)"},children:[(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("div",{className:"p-2 rounded-full",style:{backgroundColor:"var(--white)",color:"var(--red-4)"},children:(0,f.jsx)(p.eHT,{size:24})}),(0,f.jsx)("h3",{className:"text-xl font-semibold tracking-tight",style:{color:"var(--red-4)",fontFamily:"var(--font-family-headings)",fontSize:"var(--font-size-large)"},children:u("common:deleteConfirmation.title","Delete Facility Role")})]}),(0,f.jsx)("button",{onClick:()=>x(!1),className:"p-2 rounded-full transition-colors hover:bg-black/5",style:{color:"var(--red-4)"},"aria-label":"Close",children:(0,f.jsx)(p.yGN,{size:20})})]}),(0,f.jsx)("div",{className:"p-6 flex-1",style:{color:"var(--text-color)",fontFamily:"var(--font-family-text)",fontSize:"var(--font-size-medium)",lineHeight:"1.6"},children:(0,f.jsx)("p",{style:{marginBottom:"var(--spacing-md)"},children:u("common:deleteConfirmation.message","Are you sure you want to delete this facility role? This action cannot be undone.")})}),(0,f.jsxs)("div",{className:"px-6 py-4 border-t flex justify-end gap-3",style:{borderTopColor:"var(--grey-2)",backgroundColor:"var(--grey-1-light)"},children:[(0,f.jsx)("button",{onClick:()=>x(!1),className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-muted rounded-md transition-colors",children:u("common:deleteConfirmation.cancel","Cancel")}),(0,f.jsx)("button",{onClick:ue,className:"px-4 py-2 text-sm font-medium text-white bg-destructive hover:bg-destructive/90 rounded-md shadow-sm transition-all hover:shadow-md active:scale-95",children:u("common:deleteConfirmation.delete","Delete")})]})]})})]}):null},le=e=>{let{currentDate:t,events:r,employees:s,onEventClick:i,onCreateEvent:l,view:d="week",onDateClick:m,onEventMove:g,profileData:v,onUpdateProfileData:x,isLoadingProfile:y=!1}=e;const{t:b}=(0,a.Bd)(["calendar","dashboard","dashboardProfile"]),w=(0,J.Zp)(),{selectedWorkspace:k}=(0,C.M)(),[D,j]=(0,n.useState)(!1),[N,T]=(0,n.useState)(null),[S,E]=(0,n.useState)([]),A=(0,n.useMemo)(()=>"day"===d?[t]:c(t),[t,d]),I=((0,n.useMemo)(()=>{const e={};return r?(r.forEach(t=>{const r=t.workerId||t.employeeId||t.userId;r?(e[r]||(e[r]=[]),e[r].push(t)):t.employees&&Array.isArray(t.employees)&&t.employees.forEach(r=>{e[r]||(e[r]=[]),e[r].push(t)})}),e):e},[r]),(0,n.useMemo)(()=>v&&(0,X.get)(v,"operationalSettings.workerRequirements")||[],[v])),R=(0,n.useMemo)(()=>{const e=[];return I.forEach(t=>{const r=t.assignedWorkers||[];if(0===r.length){const r={color:"#cbd5e1",color1:"#e2e8f0"};e.push((0,o.A)((0,o.A)({},t),{},{worker:null,color:r.color,color1:r.color1,rowIndex:0,uniqueKey:"".concat(t.id,"-0")}))}else r.forEach((r,n)=>{e.push((0,o.A)((0,o.A)({},t),{},{worker:r,color:r.color||t.color||"#cbd5e1",color1:r.color1||t.color1||"#e2e8f0",rowIndex:n,uniqueKey:"".concat(t.id,"-").concat(r.id||n)}))})}),e},[I]),M=v&&"object"===typeof v&&"operationalSettings"in v,W=M||null!==v&&void 0!==v&&!y&&Object.keys(v).length>0,O=W&&!y&&0===I.length,L=y||!W||null!==v&&!M&&0===Object.keys(v||{}).length;(0,n.useEffect)(()=>{(async()=>{if(null!==k&&void 0!==k&&k.facilityId)try{const e=(0,P.doc)(z.db,"facilityProfiles",k.facilityId),t=await(0,P.getDoc)(e);if(t.exists()){const e=t.data().employees||[],r=e.filter(e=>"admin"===e.rights).map(e=>e.uid),o=e.filter(e=>"admin"!==e.rights).map(e=>e.uid),n=[...new Set([...r,...o])].map(async e=>{try{const r=(0,P.doc)(z.db,"professionalProfiles",e),o=await(0,P.getDoc)(r);if(o.exists()){var t;const r=o.data(),n=r.identity||{},a=n.legalFirstName||n.firstName||"";return{uid:e,id:e,firstName:a,lastName:n.legalLastName||n.lastName||"",email:(null===(t=r.contact)||void 0===t?void 0:t.primaryEmail)||""}}{const t=(0,P.doc)(z.db,"users",e),r=await(0,P.getDoc)(t);if(r.exists()){const t=r.data();return{uid:e,id:e,firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||""}}}}catch(r){console.error("Error fetching profile for user ".concat(e,":"),r)}return null}),a=(await Promise.all(n)).filter(e=>null!==e);E(a)}}catch(e){console.error("Error fetching team members:",e)}})()},[null===k||void 0===k?void 0:k.facilityId]);const F=(e,t)=>{if("other"===e&&t)return t;return{pharmacist:b("dashboardProfile:operations.workerTypes.pharmacist"),cashier:b("dashboardProfile:operations.workerTypes.cashier"),assistant:b("dashboardProfile:operations.workerTypes.assistant"),pharmacy_technician:b("dashboardProfile:operations.workerTypes.pharmacyTechnician"),other:b("dashboardProfile:operations.workerTypes.other")}[e]||e},V=e=>{if(!e||"placeholder"===e)return null;const t=S.find(t=>t.uid===e||t.id===e);if(t)return"".concat(t.firstName," ").concat(t.lastName).trim();const r=null===s||void 0===s?void 0:s.find(t=>t.id===e);return r?"".concat(r.firstName," ").concat(r.lastName).trim():null};return(0,f.jsxs)("div",{className:"flex flex-1 overflow-hidden h-full bg-background border rounded-lg shadow-sm",style:{minHeight:"600px"},children:[(0,f.jsxs)("div",{className:"w-56 flex-shrink-0 border-r border-border bg-card z-10 flex flex-col",children:[(0,f.jsxs)("button",{className:"h-20 border-b border-border flex items-center justify-center gap-2 px-4 bg-muted/30 w-full hover:bg-muted/50 transition-colors group",onClick:()=>w("/dashboard/organization?tab=organigram"),title:b("dashboard:dashboard.sidebar.organization"),children:[(0,f.jsx)(p.VSk,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-all duration-300 group-hover:rotate-90 group-hover:scale-110"}),(0,f.jsx)("span",{className:"text-xs font-semibold text-muted-foreground group-hover:text-foreground uppercase tracking-wider transition-colors",children:b("dashboardProfile:operations.facilityRolesTitle")})]}),(0,f.jsxs)("button",{className:"h-12 border-b border-border flex items-center justify-center gap-2 px-4 bg-primary/5 hover:bg-primary/10 w-full transition-colors group",onClick:()=>w("/dashboard/organization?tab=organigram"),title:b("dashboardProfile:operations.addTeamMember","Add Team Member"),children:[(0,f.jsx)(p.GGD,{className:"w-4 h-4 text-primary group-hover:scale-110 transition-all"}),(0,f.jsx)("span",{className:"text-xs font-semibold text-primary",children:b("dashboardProfile:operations.addTeamMember","Add Team Member")})]}),(0,f.jsxs)("div",{className:"flex-1 overflow-hidden overflow-y-auto custom-scrollbar",children:[L?(0,f.jsx)("div",{className:"flex items-center justify-center h-full min-h-[200px]",children:(0,f.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}):R.map(e=>{var t,r;return(0,f.jsxs)("div",{className:"h-16 border-b border-border flex items-center px-4 relative group hover:bg-muted/50 transition-colors cursor-pointer",onClick:t=>{t.stopPropagation();const r=I.find(t=>t.id===e.id);T(r),j(!0)},children:[(0,f.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1",style:{backgroundColor:e.color||"#cbd5e1"}}),(0,f.jsxs)("div",{className:"pl-2 overflow-hidden flex-1",children:[(0,f.jsx)("div",{className:"font-medium text-sm truncate text-foreground",children:null!==(t=e.worker)&&void 0!==t&&t.workerId&&"placeholder"!==e.worker.workerId?V(e.worker.workerId)||"Unknown Worker":(null===(r=e.worker)||void 0===r?void 0:r.placeholderName)||F(e.workerType,e.workerTypeOther)}),(0,f.jsx)("div",{className:"text-xs truncate font-medium mt-0.5",style:{color:e.color||"#94a3b8"},children:F(e.workerType,e.workerTypeOther)})]}),(0,f.jsx)("button",{onClick:t=>{t.stopPropagation();const r=I.find(t=>t.id===e.id);T(r),j(!0)},className:"opacity-0 group-hover:opacity-100 transition-all duration-300 p-2 hover:bg-muted rounded-lg ml-2 flex-shrink-0",title:b("dashboardProfile:operations.editWorkerRequirement","Edit Facility Role"),children:(0,f.jsx)(p.VSk,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-all duration-300 group-hover:rotate-90 group-hover:scale-110"})})]},e.uniqueKey)}),(0,f.jsxs)("button",{onClick:()=>{T(null),j(!0)},className:"h-16 border-t border-border flex items-center justify-center gap-2 px-4 bg-muted/30 w-full hover:bg-muted/50 transition-colors group",children:[(0,f.jsx)(p.GGD,{className:"w-4 h-4 text-muted-foreground group-hover:text-primary transition-all"}),(0,f.jsx)("span",{className:"text-xs font-semibold text-muted-foreground group-hover:text-foreground transition-colors",children:b("dashboardProfile:operations.addWorkerRequirement")})]})]})]}),(0,f.jsx)("div",{className:"flex-1 overflow-auto custom-scrollbar",children:(0,f.jsxs)("div",{className:"min-w-max",children:[(0,f.jsx)("div",{className:"flex h-20 border-b border-border sticky top-0 bg-card z-10 shadow-sm",children:A.map(e=>{const t=u(e,new Date);return(0,f.jsxs)("div",{className:(0,h.cn)("flex-1 min-w-[160px] flex flex-col items-center justify-center border-r border-border px-2 cursor-pointer hover:bg-muted/30 transition-colors",t&&"bg-primary/5"),onClick:()=>m&&m(e),children:[(0,f.jsx)("span",{className:(0,h.cn)("text-xs font-medium uppercase tracking-wider",t?"text-primary":"text-muted-foreground"),children:e.toLocaleDateString(void 0,{weekday:"short"})}),(0,f.jsx)("span",{className:(0,h.cn)("text-sm font-semibold mt-0.5 w-7 h-7 flex items-center justify-center rounded-full",t?"bg-primary text-primary-foreground":"text-foreground"),children:e.getDate()})]},e.toISOString())})}),L?(0,f.jsx)("div",{className:"flex items-center justify-center h-full min-h-[200px]",children:(0,f.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}):O?(0,f.jsx)("div",{className:"flex items-center justify-center h-full min-h-[200px] p-4",children:(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:b("dashboardProfile:operations.noWorkerRequirements")}),(0,f.jsxs)("button",{onClick:()=>{T(null),j(!0)},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors",children:[(0,f.jsx)(p.GGD,{className:"w-4 h-4"}),b("dashboardProfile:operations.addWorkerRequirement")]})]})}):R.map(e=>(0,f.jsx)("div",{className:"flex h-16 border-b border-border",children:A.map(t=>{const o=r.filter(r=>{const o=new Date(r.start);if(!u(o,t))return!1;if(e.worker){if(e.worker.workerId&&"placeholder"!==e.worker.workerId)return r.workerId===e.worker.workerId||r.employeeId===e.worker.workerId;if(e.worker.placeholderName)return r.workerName===e.worker.placeholderName||r.employeeName===e.worker.placeholderName}const n=r.workerRole||r.employeeRole,a=r.workerType;return n===e.workerType||a===e.workerType||"other"===e.workerType&&n===e.workerTypeOther}),n=u(t,new Date);return(0,f.jsxs)("div",{className:(0,h.cn)("flex-1 min-w-[160px] border-r border-border p-1.5 flex flex-col gap-1 relative group hover:bg-muted/30 transition-colors",n&&"bg-primary/5 hover:bg-primary/10"),onClick:()=>{var r,o,n,a;const s=new Date(t);s.setHours(9,0,0,0);const i=new Date(t);i.setHours(17,0,0,0);const c={id:"temp-".concat(Date.now()),start:s,end:i,workerType:e.workerType,workerRole:"other"===e.workerType?e.workerTypeOther:e.workerType,workerId:(null===(r=e.worker)||void 0===r?void 0:r.workerId)||null,workerName:(null===(o=e.worker)||void 0===o?void 0:o.placeholderName)||null,title:null!==(n=e.worker)&&void 0!==n&&n.workerId&&"placeholder"!==e.worker.workerId?V(e.worker.workerId)||"Unknown":(null===(a=e.worker)||void 0===a?void 0:a.placeholderName)||F(e.workerType,e.workerTypeOther),color:e.color,color1:e.color1||e.color};l(c,!0)},children:[o.map(t=>(0,f.jsxs)("div",{className:"text-xs p-1.5 rounded border shadow-sm cursor-pointer hover:shadow-md transition-all truncate",style:{backgroundColor:t.color1||e.color||"#e2e8f0",borderColor:t.color||e.color||"#cbd5e1",color:"#1e293b"},onClick:e=>{e.stopPropagation(),i(t,e)},children:[(0,f.jsx)("div",{className:"font-medium truncate",children:t.title||"Assignment"}),t.start&&(0,f.jsxs)("div",{className:"text-[10px] opacity-80",children:[new Date(t.start).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"-",new Date(t.end).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]},t.id)),(0,f.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:(0,f.jsx)("div",{className:"bg-primary/10 text-primary rounded-full p-1",children:(0,f.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,f.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,f.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})})]},t.toISOString())})},e.uniqueKey))]})}),(0,f.jsx)(ie,{isOpen:D,onClose:()=>{j(!1),T(null)},profileData:v,onSave:async e=>{if(x){const t=(0,o.A)((0,o.A)({},v),{},{operationalSettings:(0,o.A)((0,o.A)({},(0,X.get)(v,"operationalSettings",{})),{},{workerRequirements:e})});await x(t,{forceRefresh:!0})}},onDelete:async e=>{if(x){const t=(0,o.A)((0,o.A)({},v),{},{operationalSettings:(0,o.A)((0,o.A)({},(0,X.get)(v,"operationalSettings",{})),{},{workerRequirements:e})});await x(t,{forceRefresh:!0})}},editingRole:N})]})};var ce=r(5702);const de=e=>{let{userData:t}=e;const{t:r}=(0,a.Bd)(["dashboard","calendar"]),{isTutorialActive:i,activeTutorial:l}=(0,O.s8)(),{selectedWorkspace:d}=(0,C.M)(),u=(e=>{var t;return(null===e||void 0===e||null===(t=e.basicInfo)||void 0===t?void 0:t.accountType)||"worker"})(t),m=(e=>{var t,r;const o=[null===e||void 0===e?void 0:e.uid,null===e||void 0===e?void 0:e.firebase_uid,null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.userId,null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.uid,null===e||void 0===e||null===(r=e.user)||void 0===r?void 0:r.id].find(e=>e&&"string"===typeof e);return o||console.warn("No valid user ID found in userData:",e),o||null})(t),{isMainSidebarCollapsed:x}=(0,W.c)(),[w,D]=(0,n.useState)(!1),T=(0,n.useRef)(null),S=(0,n.useRef)(null),[E,A]=(0,n.useState)("calendar"),I="team"===(null===d||void 0===d?void 0:d.type),{profileData:R,isLoading:F,updateProfileData:V}=(0,ce.A)(),[H,q]=(0,n.useState)(null),B=(()=>{if(!d)return{type:"personal",role:"professional"};let e=d.role;return"admin"===e&&(e="manager"),{type:d.type,role:e}})(),{currentDate:_,setCurrentDate:U,view:G,setView:J,categories:X,setCategories:Q,isSidebarCollapsed:Z,setIsSidebarCollapsed:$,showHeaderDateDropdown:ee,setShowHeaderDateDropdown:te,dropdownPosition:re,navigateDate:oe,handleDayClick:ne,handleUpcomingEventClick:ae,handleCategoryToggle:se,handleHeaderDateClick:ie,toggleSidebar:de}=L(),[ue,me]=(0,n.useState)(()=>{const e=new Date(_),t=e.getDay(),r=0===t?-6:1-t;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e}),[ge,pe]=(0,n.useState)(()=>{const e=new Date(_),t=e.getDay(),r=0===t?0:7-t;return e.setDate(e.getDate()+r),e.setHours(23,59,59,999),e}),he=oe,fe=ne,ve=ae,[xe,ye]=(0,n.useState)(30),be=(0,n.useRef)(xe),we=((0,n.useRef)(!1),(0,n.useRef)(!1));(0,n.useLayoutEffect)(()=>{const e=T.current;if(e){if("day"===G&&xe>be.current){const t=xe-be.current,r=e.clientWidth;e.scrollLeft+=t*r}be.current=xe}},[xe,G,T]),(0,n.useEffect)(()=>{const e=T.current;if(!e||"week"!==G)return;const t=new Date(_),r=t.getDay(),o=0===r?-6:1-r;t.setDate(t.getDate()+o),t.setHours(0,0,0,0);const n=g(_,0,0);let a=-1;for(let i=0;i<n.length;i++){const e=new Date(n[i][0]);e.setHours(0,0,0,0);const r=new Date(n[i][6]);if(r.setHours(23,59,59,999),t>=e&&t<=r){a=i;break}}if(-1===a)return;n.length;const s=a*e.clientWidth;e.scrollTo({left:s,behavior:we.current?"smooth":"auto"}),we.current||(we.current=!0)},[_,G,0]),(0,n.useEffect)(()=>{const e=T.current;if(!e||"week"!==G)return;let t;const r=()=>{const t=e.scrollLeft,r=e.clientWidth;if(0===r)return;const o=Math.round(t/r),n=g(_,0,0);if(o>=0&&o<n.length){const e=n[o],t=new Date(e[0]);t.setHours(0,0,0,0);const r=new Date(e[6]);r.setHours(23,59,59,999);"".concat(ue.getFullYear(),"-").concat(ue.getMonth(),"-").concat(ue.getDate())!=="".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate())&&(me(t),pe(r))}},o=()=>{t&&clearTimeout(t),t=setTimeout(r,150)};return e.addEventListener("scroll",o,{passive:!0}),r(),()=>{e.removeEventListener("scroll",o),t&&clearTimeout(t)}},[T,G,_,0,ue]);const{saveEventsToLocalStorage:ke,setPendingChanges:De,pendingChanges:je}=((e,t)=>{const[r,o]=(0,n.useState)(new Set),[a,s]=(0,n.useState)(Date.now()),i=(0,n.useCallback)(e=>{},[e]),l=(0,n.useCallback)(()=>null,[e]),c=(0,n.useCallback)(e=>{o(t=>new Set([...t,e]))},[]),d=(0,n.useCallback)(async n=>{if(0===r.size||!e)return void console.log("No pending changes or no userId - skipping sync",{pendingChanges:r.size,userId:e});console.log("Syncing ".concat(r.size," pending changes to database"),Array.from(r));const a=Array.from(r);for(const r of a){const a=n.find(e=>e.id===r);if(a)if(a.fromDatabase||a.isValidated||a.id&&!a.id.toString().startsWith("temp-")&&!a.id.toString().startsWith("duplicate-")&&a.id.toString().length>10)try{console.log("Syncing event ".concat(r," to database - fromDB: ").concat(a.fromDatabase,", validated: ").concat(a.isValidated));const n={id:r,start:a.start,end:a.end,title:a.title,color:a.color,color1:a.color1,color2:a.color2,isValidated:a.isValidated||!1,isRecurring:a.isRecurring||!1,recurrenceId:a.recurrenceId,notes:a.notes,location:a.location,employees:a.employees,canton:a.canton,area:a.area,experience:a.experience,software:a.software,certifications:a.certifications,isAvailability:a.isAvailability},s=await Y(r,n,e,t,!0);s.success?(console.log("Successfully synced event ".concat(r," to database")),o(e=>{const t=new Set(e);return t.delete(r),t})):console.warn("Failed to sync event ".concat(r,":"),s.error)}catch(i){console.warn("Error syncing event ".concat(r,":"),i)}else console.log("Skipping sync for event ".concat(r," - appears to be local-only or temporary")),o(e=>{const t=new Set(e);return t.delete(r),t});else console.warn("Event ".concat(r," not found in events array - removing from pending changes")),o(e=>{const t=new Set(e);return t.delete(r),t})}s(Date.now())},[r,e,t]);return(0,n.useEffect)(()=>{const e=setInterval(()=>{r.size>0&&console.log("Periodic sync triggered - syncing pending changes")},3e5);return()=>clearInterval(e)},[r.size]),(0,n.useEffect)(()=>{const e=()=>{r.size>0&&console.log("Page unload detected - syncing pending changes")},t=()=>{"hidden"===document.visibilityState&&r.size>0&&console.log("Page hidden - syncing pending changes")};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[r.size]),{pendingChanges:r,lastSyncTime:a,saveEventsToLocalStorage:i,loadEventsFromLocalStorage:l,markEventForSync:c,syncPendingChanges:d,setPendingChanges:o,setLastSyncTime:s}})(m,u),{events:Ne,setEvents:Ce,selectedEvent:Te,setSelectedEvent:Se,selectedEventId:Ee,setSelectedEventId:Ae,history:Ie,currentHistoryIndex:Re,validatedEvents:Me,showDeleteConfirmation:We,setShowDeleteConfirmation:Oe,eventToDelete:Le,setEventToDelete:Pe,originalEventPosition:ze,setOriginalEventPosition:Fe,handleEventSave:Ve,handleEventDelete:He,handlePanelClose:qe,handleCreateEventClick:Be,addToHistory:Ye,undo:_e,redo:Ue}=K(m,u,0,0,0,s,ke,De),Ge=(0,n.useCallback)((e,t)=>{q(null);const r=Ne.find(t=>t.id===e.id)||e;Fe((0,o.A)({id:r.id,start:new Date(r.start),end:new Date(r.end),title:r.title,color:r.color,color1:r.color1,notes:r.notes,location:r.location,employees:r.employees},r)),Ae(e.id),Se(r)},[Ne,Se,Ae,Fe]),Ke=(0,n.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),q({event:t,position:{x:e.clientX,y:e.clientY}})},[]),Je=(0,n.useCallback)(()=>{q(null)},[]),Xe=(0,n.useCallback)((e,t)=>{const r=Ne.map(r=>r.id===e.id?(0,o.A)((0,o.A)({},r),{},{color:t.color,color1:t.color1,color2:t.color2,category:t.name}):r);Ce(r),Ye(r)},[Ne,Ce,Ye]),Qe=(0,n.useCallback)(e=>{Pe(e),Oe(!0)},[Pe,Oe]),Ze=(0,n.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=Ne.findIndex(t=>t.id===e);if(-1===a)return;const s=Ne[a];n&&!s.isBeingMoved&&Fe((0,o.A)({id:s.id,start:new Date(s.start),end:new Date(s.end),title:s.title,color:s.color,color1:s.color1,notes:s.notes,location:s.location,employees:s.employees},s));const i=[...Ne];if(i[a]=(0,o.A)((0,o.A)({},i[a]),{},{start:t,end:r,isBeingMoved:n}),Ce(i),!n){const n=i[a],s=new Date(t);s.setHours(0,0,1,0);const l=new Date(t);l.setHours(23,59,59,999);if(!(t>=s&&t<=l&&r>=s&&r<=l&&r>t)){if(ze&&ze.id===e){const t=[...Ne],r=t.findIndex(t=>t.id===e);-1!==r&&(t[r]=(0,o.A)((0,o.A)({},t[r]),{},{start:new Date(ze.start),end:new Date(ze.end),isBeingMoved:!1}),Ce(t))}return}console.log("Event moved - opening panel for confirmation"),Se(n),Ae(n.id)}},[Ne,Ce,Se,Ae,Fe,ze]),$e=(0,n.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=Ne.findIndex(t=>t.id===e);if(-1===a)return;const s=Ne[a];n&&!s.isBeingResized&&(console.log("Resize started - storing original position"),Fe((0,o.A)({id:s.id,start:new Date(s.start),end:new Date(s.end),title:s.title,color:s.color,color1:s.color1,notes:s.notes,location:s.location,employees:s.employees},s)));const i=[...Ne];if(i[a]=(0,o.A)((0,o.A)({},i[a]),{},{start:t,end:r,isBeingResized:n}),Ce(i),!n){const e=i[a];console.log("Event resized - opening panel for confirmation"),Se(e),Ae(e.id)}},[Ne,Ce,Se,Ae,Fe]),et=(0,n.useCallback)(function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("handleGridCreateEvent called:",{newEvent:e,openPanel:t});const r=(0,o.A)((0,o.A)({},e),{},{color:e.color||s[0].color,color1:e.color1||s[0].color1,color2:s[0].color2,category:s[0].name,title:e.title||"",notes:"",location:"",employees:""});console.log("Event with defaults:",r);const n=[...Ne,r];Ce(n),Ye(n),console.log("Event added to array, count:",n.length),t?(console.log("Opening panel for event:",r.id),Fe((0,o.A)((0,o.A)({},r),{},{start:new Date(r.start),end:new Date(r.end)})),Se(r),Ae(r.id),console.log("Panel opened, event visible in UI")):console.log("Event added without panel (should not happen now)")},[Ne,Ce,Ye,Se,Ae,Fe]),{handleKeyboardShortcuts:tt}=((e,t,r,o,a,s)=>{const i=(0,n.useCallback)(n=>{"INPUT"!==n.target.tagName&&"TEXTAREA"!==n.target.tagName&&(n.ctrlKey&&"z"===n.key&&!n.shiftKey?(n.preventDefault(),e&&e()):n.ctrlKey&&n.shiftKey&&"Z"===n.key||n.ctrlKey&&"y"===n.key?(n.preventDefault(),t&&t()):"Delete"===n.key&&r&&!o?(n.preventDefault(),a&&a(r)):"Escape"===n.key&&(n.preventDefault(),r&&s&&s()))},[e,t,r,o,a,s]);return(0,n.useEffect)(()=>(document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}),[i]),{handleKeyboardShortcuts:i}})(()=>_e(Ne,Ce),()=>Ue(Ne,Ce),Te,We,e=>{Pe(e),Oe(!0)},()=>qe(Ne,Ce)),rt=((e,t,r)=>{const o=t.reduce((e,t)=>(t.checked&&e.push(t.color),e),[]);return 0===o.length?e:e.filter(e=>!!e&&(!(!e.id||!String(e.id).startsWith("temp-"))||!!e.isDraft||(!0===e.isValidated?o.includes(r.find(e=>"blue"===e.id).color):!1===e.isValidated?o.includes(r.find(e=>"grey"===e.id).color):o.includes(e.color))))})(Ne,X,s),{events:ot}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"worker";const[r,o]=(0,n.useState)([]),[a,s]=(0,n.useState)(!0),[i,l]=(0,n.useState)(null),{isTutorialActive:c,activeTutorial:d}=(0,O.s8)(),u=(0,n.useCallback)(()=>{if(!c||"calendar"!==d)return[];const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t);r.setDate(r.getDate()+1);const o=new Date(t);return o.setDate(o.getDate()+7),[{id:"tutorial-availability-1",title:"Available",start:new Date(r.getTime()+324e5),end:new Date(r.getTime()+612e5),color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb",isAvailability:!0,isValidated:!0,fromDatabase:!1,isTutorial:!0},{id:"tutorial-availability-2",title:"Available",start:new Date(o.getTime()+288e5),end:new Date(o.getTime()+576e5),color:"#0f54bc",color1:"#a8c1ff",color2:"#4da6fb",isAvailability:!0,isValidated:!0,fromDatabase:!1,isTutorial:!0},{id:"tutorial-contract-1",title:"Geneva Hospital - Temporary Contract",start:new Date("2026-02-01"),end:new Date("2026-03-31"),color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",isContract:!0,isValidated:!0,location:"Geneva Hospital, Rue Gabrielle-Perret-Gentil 4, 1205 Geneva",notes:"Emergency Department - Full-time position",fromDatabase:!1,isTutorial:!0},{id:"tutorial-contract-2",title:"Lausanne Clinic - Part-time",start:new Date("2026-04-01"),end:new Date("2026-06-30"),color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",isContract:!0,isValidated:!1,location:"Lausanne Clinic, Avenue de la Gare 28, 1000 Lausanne",notes:"General Practice - Weekends only",fromDatabase:!1,isTutorial:!0}]},[c,d]);return(0,n.useEffect)(()=>{if(!e)return void s(!1);if(c&&"calendar"===d){const e=u();return o(e),s(!1),void l(null)}console.log("Setting up real-time listener for user:",e,"accountType:",t);const r=(0,P.P)((0,P.rJ)(z.db,"availability"),(0,P._M)("userId","==",e)),n=(0,P.aQ)(r,e=>{try{const t=[];e.forEach(e=>{const r=e.data(),o=r.from instanceof P.Timestamp?r.from.toDate():new Date(r.from),n=r.to instanceof P.Timestamp?r.to.toDate():new Date(r.to),a=r.isValidated||!1;let s,i,l;a?(s="#0f54bc",i="#a8c1ff",l="#4da6fb"):(s="#8c8c8c",i="#e6e6e6",l="#b3b3b3"),t.push({id:e.id,title:r.title||"Available",start:o,end:n,color:s,color1:i,color2:l,isAvailability:!0,isValidated:a,recurrenceId:r.recurrenceId||null,isRecurring:!!r.recurrenceId,canton:r.locationCountry||[],area:r.LocationArea||[],languages:r.languages||[],experience:r.experience||"",software:r.software||[],certifications:r.certifications||[],workAmount:r.workAmount||"",notes:r.notes||"",location:r.location||"",fromDatabase:!0})}),t.sort((e,t)=>t.start-e.start),console.log("Real-time update: ".concat(t.length," availability events loaded")),o(e=>{const r=e.filter(e=>e.isContract);return[...t,...r]}),s(!1),l(null)}catch(t){console.error("Error processing availability events:",t),l(t.message),s(!1)}},e=>{console.error("Error in availability events listener:",e),l(e.message),s(!1)});let a=null;if("employer"===t||"worker"===t||"professional"===t){const r=(0,P.P)((0,P.rJ)(z.db,"contracts"),(0,P._M)("parties.professional.profileId","==",e)),n=(0,P.P)((0,P.rJ)(z.db,"contracts"),(0,P._M)("parties.employer.profileId","==",e)),s=(0,P.P)((0,P.rJ)(z.db,"contracts"),(0,P._M)("workerId","==",e)),i=(0,P.P)((0,P.rJ)(z.db,"contracts"),(0,P._M)("employerId","==",e)),l=[];("employer"===t?[n,i]:[r,s]).forEach((e,t)=>{const r=(0,P.aQ)(e,e=>{try{const r=[];e.forEach(e=>{var t;const o=e.data(),n=(null===(t=o.statusLifecycle)||void 0===t?void 0:t.currentStatus)||o.status;if("active"!==n&&"pending"!==n&&"pending_professional_approval"!==n&&"pending_facility_approval"!==n)return;const a=o.from instanceof P.Timestamp?o.from.toDate():new Date(o.from),s=o.to instanceof P.Timestamp?o.to.toDate():new Date(o.to);r.push({id:e.id,title:o.title||"Contract",start:a,end:s,color:"#f54455",color1:"#ffbbcf",color2:"#ff6064",isContract:!0,isValidated:o.isValidated||!1,location:o.location||"",notes:o.notes||"",fromDatabase:!0})}),console.log("Real-time update: ".concat(r.length," contract events loaded from query ").concat(t+1)),o(e=>{const t=e.filter(e=>e.isAvailability),o=e.filter(e=>e.isContract),n=new Map;return[...o,...r].forEach(e=>{n.has(e.id)||n.set(e.id,e)}),[...t,...Array.from(n.values())]})}catch(r){console.error("Error processing contract events:",r)}},e=>{console.error("Error in contract events listener:",e)});l.push(r)}),a=()=>{l.forEach(e=>e())}}return()=>{console.log("Cleaning up real-time listeners"),n(),a&&a()}},[e,t]),{events:r,loading:a,error:i}}(m,u),nt=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(ot){if(JSON.stringify(ot.map(e=>{var t,r;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(r=e.end)||void 0===r?void 0:r.getTime()}}))===(nt.current?JSON.stringify(nt.current.map(e=>{var t,r;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(r=e.end)||void 0===r?void 0:r.getTime()}})):null))return;nt.current=ot;const e=ot.map(e=>(0,o.A)((0,o.A)({},e),{},{fromDatabase:!0,isValidated:!0}));Ce(t=>{const r=t.filter(e=>!e.fromDatabase),o=t.filter(e=>e.isBeingMoved||e.isBeingResized),n=new Set(o.map(e=>e.id)),a=new Map(e.map(e=>[e.id,e])),s=[];for(const d of e)if(n.has(d.id)){const e=o.find(e=>e.id===d.id);s.push(e)}else s.push(d);for(const e of o)a.has(e.id)||s.push(e);s.push(...r);const i=JSON.stringify(s.map(e=>{var t,r;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(r=e.end)||void 0===r?void 0:r.getTime()}})),l=JSON.stringify(t.map(e=>{var t,r;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(r=e.end)||void 0===r?void 0:r.getTime()}})),c=Ie[Re]?JSON.stringify(Ie[Re].map(e=>{var t,r;return{id:e.id,start:null===(t=e.start)||void 0===t?void 0:t.getTime(),end:null===(r=e.end)||void 0===r?void 0:r.getTime()}})):null;return i!==l&&i!==c&&Ye(s),s})}},[ot,Ce,Ye,Ie,Re]),(0,n.useEffect)(()=>{const e=document.querySelector(".time-slots");e&&(e.scrollTop=420)},[]),(0,n.useEffect)(()=>{const e=S.current,t=T.current;if(!e||!t)return;let r=!1;const o=()=>{r||(r=!0,e&&(e.scrollLeft=t.scrollLeft),requestAnimationFrame(()=>{r=!1}))},n=()=>{r||(r=!0,t&&(t.scrollLeft=e.scrollLeft),requestAnimationFrame(()=>{r=!1}))};return t.addEventListener("scroll",o),e.addEventListener("scroll",n),()=>{t.removeEventListener("scroll",o),e.removeEventListener("scroll",n)}},[]),(0,n.useEffect)(()=>(document.addEventListener("keydown",tt),()=>document.removeEventListener("keydown",tt)),[tt]),(0,n.useEffect)(()=>{console.log("selectedEvent changed:",Te),console.log("selectedEventId changed:",Ee)},[Te,Ee]),(0,n.useEffect)(()=>{const e=()=>{H&&q(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[H]);const at=(0,n.useCallback)(()=>{Q(e=>e.map(e=>(0,o.A)((0,o.A)({},e),{},{checked:!0})))},[Q]),st=X.some(e=>!e.checked);return(0,f.jsxs)("div",{className:"h-full flex flex-col overflow-hidden animate-in fade-in duration-500",children:[(0,f.jsxs)("div",{className:"shrink-0 w-full z-20 bg-card/95 backdrop-blur-sm border-b border-border shadow-sm flex items-center justify-between gap-4 px-6 h-16",children:[i&&"calendar"===l&&(0,f.jsxs)("div",{className:"calendar-view-options flex gap-2 mr-4",children:[(0,f.jsx)("button",{className:"px-3 py-1.5 bg-primary text-primary-foreground rounded-md text-sm font-medium",children:r("calendar:dayView")}),(0,f.jsx)("button",{className:"px-3 py-1.5 bg-muted text-muted-foreground rounded-md text-sm font-medium",children:r("calendar:weekView")}),(0,f.jsx)("button",{className:"px-3 py-1.5 bg-muted text-muted-foreground rounded-md text-sm font-medium",children:r("calendar:monthView")})]}),(0,f.jsx)(v,{currentDate:_,view:G,setView:J,navigateDate:he,setCurrentDate:U,isSidebarCollapsed:!1,toggleSidebar:()=>$(!Z),categories:X,handleCategoryToggle:se,onResetCategories:at,isTopBarMode:!0,onShowFiltersOverlay:D,scrollContainerRef:T,calendarMode:E,setCalendarMode:A,isTeamWorkspace:I})]}),(0,f.jsx)("div",{className:(0,h.cn)("flex-1 flex overflow-hidden relative","team"===E?"p-0":"p-4 gap-4"),children:"team"===E&&I?(0,f.jsx)("div",{className:"w-full h-full",children:(0,f.jsx)(le,{currentDate:_,events:rt,employees:[],onEventClick:Ge,onCreateEvent:et,view:G,onDateClick:fe,onEventMove:Ze,profileData:R,onUpdateProfileData:V,isLoadingProfile:F})}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:(0,h.cn)("flex flex-col transition-all duration-300 w-full md:w-[320px] lg:w-[360px]",x?"flex":Z?"hidden lg:flex w-0 overflow-hidden":"flex"),children:[i&&"calendar"===l&&(0,f.jsx)("div",{className:"mb-4",children:(0,f.jsxs)("button",{className:"new-appointment-button w-full py-2.5 px-4 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[(0,f.jsx)(p.wIk,{className:"w-4 h-4"}),r("calendar:newAppointment")]})}),(0,f.jsx)(y,{currentDate:_,setCurrentDate:U,handleUpcomingEventClick:ve,events:rt,isSidebarCollapsed:Z,handleCreateEventClick:()=>Be(_),handleDayClick:fe,showHeaderDateDropdown:ee,setShowHeaderDateDropdown:te,handleHeaderDateClick:ie,dropdownPosition:re,toggleSidebar:de,view:G,visibleWeekStart:ue,visibleWeekEnd:ge})]}),(0,f.jsx)("div",{className:"flex-1 flex flex-col relative min-w-0 transition-all duration-300 bg-card border border-border/60 rounded-xl overflow-hidden",children:(0,f.jsxs)("div",{className:"flex-1 overflow-hidden relative calendar-grid flex flex-col",children:[(0,f.jsxs)("div",{className:"flex flex-shrink-0",style:{margin:0,padding:0},children:[(0,f.jsx)("div",{className:"flex-shrink-0 bg-background/95 backdrop-blur-sm z-10 flex items-end justify-center pb-2",style:{width:"4rem",minHeight:"3rem",borderLeft:"1px solid hsl(var(--border))",borderRight:"1px solid hsl(var(--border))",boxSizing:"border-box",margin:0,padding:0}}),(0,f.jsx)("div",{className:"flex-1 overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",ref:S,onScroll:e=>{T.current&&(T.current.scrollLeft=e.target.scrollLeft)},children:(0,f.jsx)(b,{currentDate:_,referenceDate:_,view:G,handleDayClick:fe,scrollContainerRef:S,numWeeks:0,numDays:xe})})]}),(0,f.jsx)("div",{className:"flex-1 time-slots bg-muted/5 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:(0,f.jsxs)("div",{className:"relative min-h-full flex",style:{margin:0,padding:0},children:[(0,f.jsx)("div",{className:"sticky flex-shrink-0 bg-background/95 backdrop-blur-sm z-10",style:{width:"4rem",height:"1440px",position:"sticky",left:0,top:0,alignSelf:"flex-start",borderLeft:"1px solid hsl(var(--border))",borderRight:"1px solid hsl(var(--border))",boxSizing:"border-box",margin:0,padding:0},children:Array.from({length:24},(e,t)=>{const r=t;return(0,f.jsx)("div",{className:"h-[60px] text-[10px] text-muted-foreground text-right pr-4 relative",children:(0,f.jsx)("span",{className:"text-[10px] pb-1",children:r<10?"0".concat(r,":00"):"".concat(r,":00")})},t)})}),(0,f.jsx)("div",{className:"flex-1 calendar-scroll-container overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",style:{scrollSnapType:"x mandatory",scrollBehavior:"smooth"},ref:T,onScroll:e=>{S.current&&(S.current.scrollLeft=e.target.scrollLeft)},children:(0,f.jsx)("div",{className:"relative min-h-full min-w-max",children:(0,f.jsx)("div",{className:"time-grid h-full relative min-w-max",children:(0,f.jsx)(k,{view:G,events:rt,selectedEventId:Ee,currentDate:_,referenceDate:_,getEventsForCurrentWeek:()=>((e,t)=>{const r=new Date(t[0]);r.setHours(0,0,0,0);const o=new Date(t[6]);return o.setHours(23,59,59,999),e.filter(e=>{const t=new Date(e.start),n=new Date(e.end);return t<=o&&n>=r})})(Ne,c(_)),validatedEvents:Me,onEventClick:Ge,onEventRightClick:Ke,onEventMove:Ze,onEventResize:$e,onCreateEvent:et,scrollContainerRef:T,numWeeks:0,numDays:xe})})})})]})})]})})]})}),H&&(0,f.jsx)(N,{event:H.event,position:H.position,onClose:Je,onDelete:Qe,onColorChange:Xe,colorOptions:s}),Te&&(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(M,{event:Te,onClose:()=>{qe(Ne,Ce)},onSave:Ve,onDelete:()=>{Te&&Te.id&&(Pe(Te),Oe(!0))},colorOptions:s,accountType:u,userData:t,workspaceContext:B})}),We&&Le&&(0,f.jsx)(j,{event:Le,currentDate:new Date(Le.start),onConfirm:e=>He(Le.id,e,Ne,Ce),onCancel:()=>{Oe(!1),Pe(null)}}),w&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>D(!1)}),(0,f.jsxs)("div",{className:(0,h.cn)("fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border rounded-t-2xl shadow-2xl","animate-in slide-in-from-bottom duration-300"),style:{height:"75vh"},children:[(0,f.jsxs)("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[(0,f.jsx)("h3",{className:"text-lg font-semibold m-0",children:r("calendar:categoryFilters")}),(0,f.jsx)("button",{onClick:()=>D(!1),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:(0,f.jsx)(p.yGN,{className:"w-5 h-5"})})]}),(0,f.jsxs)("div",{className:"overflow-y-auto p-4 space-y-2",style:{height:"calc(75vh - 73px)",scrollbarGutter:"stable"},children:[X.map((e,t)=>(0,f.jsxs)("label",{className:"flex items-center gap-3 px-3 py-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors",children:[(0,f.jsxs)("div",{className:"relative flex items-center",children:[(0,f.jsx)("input",{type:"checkbox",checked:e.checked,onChange:()=>se(t),className:"peer h-4 w-4 rounded border text-primary focus:ring-1 focus:ring-primary/20 cursor-pointer transition-all appearance-none bg-background",style:{backgroundColor:e.checked?e.color:"transparent",borderColor:e.color,borderWidth:"1px"}}),(0,f.jsx)("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]}),(0,f.jsx)("span",{className:"text-sm font-medium",children:e.name})]},t)),st&&(0,f.jsx)("button",{onClick:()=>{at(),D(!1)},className:"w-full h-10 rounded-lg border border-input bg-background text-sm font-medium hover:bg-muted transition-all mt-4",children:r("calendar:resetAll")})]})]})]})]})}}}]);
//# sourceMappingURL=7213.b6f8b733.chunk.js.map