{"version":3,"file":"static/js/6547.b4bbbfa9.chunk.js","mappings":"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","sources":["dashboard/pages/messages/components/ConversationsList.js","dashboard/pages/messages/components/ConversationView.js","services/messagesService.js","dashboard/pages/messages/Messages.js","dashboard/components/EmptyState/EmptyState.js","dashboard/hooks/useMobileView.js"],"sourcesContent":["import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport PropTypes from 'prop-types';\nimport { format } from 'date-fns';\nimport { cn } from '../../../../utils/cn';\nimport { FiMessageSquare, FiChevronRight } from 'react-icons/fi';\n\n/**\n * Conversation item matching contracts sidebar layout\n */\nconst ConversationItem = ({ conversation, isSelected, onClick }) => {\n  const { t } = useTranslation(['messages']);\n  const formatDate = (timestamp) => {\n    if (!timestamp) return '';\n    try {\n      const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\n      return format(date, 'MMM d, yyyy');\n    } catch (error) {\n      return '';\n    }\n  };\n\n  const getTimeDisplay = (timestamp) => {\n    if (!timestamp) return '';\n    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\n    const now = new Date();\n    const diffMs = now - date;\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return t('messages:time.now');\n    if (diffMins < 60) return `${diffMins}${t('messages:time.minutes')}`;\n    if (diffHours < 24) return `${diffHours}${t('messages:time.hours')}`;\n    if (diffDays < 7) return `${diffDays}${t('messages:time.days')}`;\n    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n  };\n\n  const displayName = conversation.displayName || t('messages:placeholders.unknown');\n  const lastMessage = conversation.lastMessage?.text || t('messages:placeholders.noMessages');\n  const date = formatDate(conversation.lastMessageTimestamp || conversation.createdAt);\n  const timeDisplay = getTimeDisplay(conversation.lastMessageTimestamp);\n\n  return (\n    <button\n      onClick={() => onClick(conversation.id)}\n      className={cn(\n        \"w-full flex items-center gap-4 pl-8 py-3 pr-0 transition-all text-left border-b border-border/40 last:border-b-0\",\n        \"hover:bg-muted/30\",\n        isSelected\n          ? \"bg-primary/5 border-l-4\"\n          : \"border-l-4 border-l-transparent hover:border-l-primary/30\"\n      )}\n      style={{\n        borderLeftColor: isSelected ? 'var(--primary-color)' : 'transparent'\n      }}\n    >\n      {/* Notification Badge - Left side, vertically centered - Only show when not selected */}\n      {conversation.unreadCount > 0 && !isSelected && (\n        <div className=\"flex items-center justify-center shrink-0\">\n          <div className=\"w-5 h-5 bg-destructive rounded-full flex items-center justify-center text-xs font-bold text-white\">\n            {conversation.unreadCount > 9 ? '9+' : conversation.unreadCount}\n          </div>\n        </div>\n      )}\n      {/* Spacer when no badge to maintain alignment */}\n      {(!conversation.unreadCount || isSelected) && (\n        <div className=\"w-5 shrink-0\"></div>\n      )}\n\n      <div className={cn(\n        \"w-12 h-12 rounded-xl flex items-center justify-center shrink-0 transition-colors overflow-hidden\",\n        isSelected\n          ? \"bg-primary/10\"\n          : \"bg-muted/30\"\n      )}>\n        {conversation.photoURL ? (\n          <img\n            src={conversation.photoURL}\n            alt={displayName}\n            className=\"w-full h-full object-cover\"\n          />\n        ) : (\n          <FiMessageSquare\n            className=\"w-6 h-6\"\n            style={{ color: isSelected ? 'var(--primary-color)' : 'var(--text-light-color)' }}\n          />\n        )}\n      </div>\n\n      <div className=\"flex-1 min-w-0 flex flex-col gap-1.5\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <h3 className={cn(\n            \"text-sm font-semibold truncate flex-1\",\n            conversation.unreadCount > 0 ? \"\" : \"\"\n          )} style={{ color: 'var(--text-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n            {displayName}\n          </h3>\n          {timeDisplay && (\n            <span className=\"text-xs shrink-0\" style={{ color: 'var(--text-light-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n              {timeDisplay}\n            </span>\n          )}\n        </div>\n\n        {lastMessage && (\n          <p className=\"text-xs truncate\" style={{ color: 'var(--text-light-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n            {lastMessage}\n          </p>\n        )}\n\n        {date && (\n          <p className=\"text-xs\" style={{ color: 'var(--text-light-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n            {date}\n          </p>\n        )}\n      </div>\n\n      <FiChevronRight\n        className={cn(\n          \"w-5 h-5 shrink-0 transition-colors\",\n          isSelected ? \"\" : \"opacity-0\"\n        )}\n        style={{ color: 'var(--text-light-color)' }}\n      />\n    </button>\n  );\n};\n\nConversationItem.propTypes = {\n  conversation: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    displayName: PropTypes.string,\n    lastMessage: PropTypes.shape({\n      text: PropTypes.string\n    }),\n    lastMessageTimestamp: PropTypes.oneOfType([PropTypes.object, PropTypes.string, PropTypes.instanceOf(Date)]),\n    createdAt: PropTypes.oneOfType([PropTypes.object, PropTypes.string, PropTypes.instanceOf(Date)]),\n    photoURL: PropTypes.string,\n    unreadCount: PropTypes.number\n  }).isRequired,\n  isSelected: PropTypes.bool.isRequired,\n  onClick: PropTypes.func.isRequired\n};\n\nconst ConversationsList = ({\n  conversations,\n  selectedConversationId,\n  onSelectConversation,\n  messageContext,\n  currentUserId\n}) => {\n  const { t } = useTranslation(['messages']);\n  if (!conversations.length) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full text-center\" style={{ color: 'var(--text-light-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)' }}>\n        <p style={{ margin: 0 }}>{t('messages:empty.noConversationsFound')}</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-0\">\n      {conversations.map((conversation) => (\n        <ConversationItem\n          key={conversation.id}\n          conversation={conversation}\n          isSelected={selectedConversationId === conversation.id}\n          onClick={onSelectConversation}\n        />\n      ))}\n    </div>\n  );\n};\n\nConversationItem.propTypes = {\n  conversation: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    displayName: PropTypes.string,\n    lastMessage: PropTypes.shape({\n      text: PropTypes.string\n    }),\n    lastMessageTimestamp: PropTypes.oneOfType([PropTypes.object, PropTypes.string, PropTypes.instanceOf(Date)]),\n    createdAt: PropTypes.oneOfType([PropTypes.object, PropTypes.string, PropTypes.instanceOf(Date)]),\n    photoURL: PropTypes.string,\n    unreadCount: PropTypes.number\n  }).isRequired,\n  isSelected: PropTypes.bool.isRequired,\n  onClick: PropTypes.func.isRequired\n};\n\nConversationsList.propTypes = {\n  conversations: PropTypes.arrayOf(PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    displayName: PropTypes.string,\n    lastMessage: PropTypes.shape({\n      text: PropTypes.string\n    }),\n    lastMessageTimestamp: PropTypes.oneOfType([PropTypes.object, PropTypes.string, PropTypes.instanceOf(Date)]),\n    createdAt: PropTypes.oneOfType([PropTypes.object, PropTypes.string, PropTypes.instanceOf(Date)]),\n    photoURL: PropTypes.string,\n    unreadCount: PropTypes.number\n  })).isRequired,\n  selectedConversationId: PropTypes.string,\n  onSelectConversation: PropTypes.func.isRequired,\n  messageContext: PropTypes.string,\n  currentUserId: PropTypes.string\n};\n\nexport default ConversationsList;","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { collection, query, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../../../../services/firebase';\nimport { useNotification } from '../../../../contexts/NotificationContext';\nimport PropTypes from 'prop-types';\nimport { cn } from '../../../../utils/cn';\nimport { FiSend, FiUser, FiX } from 'react-icons/fi';\n\n/**\n * ConversationView - Complete redesign\n */\nconst ConversationView = ({\n  conversation,\n  currentUser,\n  messageContext = 'personal',\n  workspaceContext,\n  isTutorial = false\n}) => {\n  const { t } = useTranslation(['messages']);\n  const { showError } = useNotification();\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSending, setIsSending] = useState(false);\n  const [showProfileImage, setShowProfileImage] = useState(false);\n  const messagesContainerRef = useRef(null);\n  const messagesListener = useRef(null);\n\n  // Auto-scroll to bottom when messages change\n  const scrollToBottom = () => {\n    if (messagesContainerRef.current) {\n      messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;\n    }\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const getMockMessages = useCallback(() => {\n    if (!isTutorial || !conversation) return [];\n    \n    const now = new Date();\n    const mockMessages = [];\n    \n    if (conversation.id === 'tutorial-doctor-smith') {\n      const otherUserId = 'tutorial-doctor';\n      const otherUserName = t('messages:tutorial.doctorName');\n      \n      mockMessages.push(\n        {\n          id: 'mock-1',\n          senderId: otherUserId,\n          senderName: otherUserName,\n          text: t('messages:tutorial.doctorMessage1', 'Hello! I wanted to discuss the temporary contract opportunity for February. Are you available for a quick call?'),\n          timestamp: { toDate: () => new Date(now.getTime() - 2 * 60 * 60 * 1000) },\n          status: 'read',\n          reactions: []\n        },\n        {\n          id: 'mock-2',\n          senderId: currentUser?.uid || 'current-user',\n          senderName: currentUser?.displayName || t('messages:status.you'),\n          text: t('messages:tutorial.doctorMessage2', 'Yes, I\\'m very interested! When would be a good time for you?'),\n          timestamp: { toDate: () => new Date(now.getTime() - 1.5 * 60 * 60 * 1000) },\n          status: 'read',\n          reactions: []\n        },\n        {\n          id: 'mock-3',\n          senderId: otherUserId,\n          senderName: otherUserName,\n          text: t('messages:tutorial.doctorMessage3', 'Great! How about tomorrow at 2 PM? I can share more details about the position and answer any questions you might have.'),\n          timestamp: { toDate: () => new Date(now.getTime() - 1 * 60 * 60 * 1000) },\n          status: 'read',\n          reactions: []\n        }\n      );\n    } else if (conversation.id === 'tutorial-lausanne-clinic') {\n      const otherUserId = 'tutorial-hospital';\n      const otherUserName = t('messages:tutorial.hospitalName');\n      \n      mockMessages.push(\n        {\n          id: 'mock-4',\n          senderId: otherUserId,\n          senderName: otherUserName,\n          text: t('messages:tutorial.hospitalMessage1', 'Your application has been reviewed and we\\'re impressed with your qualifications. We\\'d like to schedule an interview.'),\n          timestamp: { toDate: () => new Date(now.getTime() - 24 * 60 * 60 * 1000) },\n          status: 'read',\n          reactions: []\n        },\n        {\n          id: 'mock-5',\n          senderId: currentUser?.uid || 'current-user',\n          senderName: currentUser?.displayName || t('messages:status.you'),\n          text: t('messages:tutorial.hospitalMessage2', 'Thank you so much! I\\'m very excited about this opportunity. I\\'m available next week.'),\n          timestamp: { toDate: () => new Date(now.getTime() - 23 * 60 * 60 * 1000) },\n          status: 'read',\n          reactions: []\n        },\n        {\n          id: 'mock-6',\n          senderId: otherUserId,\n          senderName: otherUserName,\n          text: t('messages:tutorial.hospitalMessage3', 'Perfect! I\\'ll send you a calendar invite with available time slots. Looking forward to speaking with you.'),\n          timestamp: { toDate: () => new Date(now.getTime() - 22 * 60 * 60 * 1000) },\n          status: 'read',\n          reactions: []\n        }\n      );\n    }\n    \n    return mockMessages.sort((a, b) => a.timestamp.toDate() - b.timestamp.toDate());\n  }, [isTutorial, conversation, currentUser, t]);\n\n  useEffect(() => {\n    if (isTutorial) {\n      const mockMessages = getMockMessages();\n      setMessages(mockMessages);\n      setIsLoading(false);\n      return;\n    }\n\n    if (!conversation || !currentUser) {\n      setMessages([]);\n      setIsLoading(false);\n      return;\n    }\n\n    setIsLoading(true);\n\n    const messagesQuery = query(\n      collection(db, 'conversations', conversation.id, 'messages'),\n      orderBy('timestamp', 'asc')\n    );\n\n    if (messagesListener.current) {\n      messagesListener.current();\n    }\n\n    messagesListener.current = onSnapshot(\n      messagesQuery,\n      (snapshot) => {\n        const messagesList = snapshot.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        }));\n        setMessages(messagesList);\n        setIsLoading(false);\n      },\n      (error) => {\n        console.error('Error fetching messages:', error);\n        showError('Failed to load messages');\n        setIsLoading(false);\n      }\n    );\n\n    return () => {\n      if (messagesListener.current) {\n        messagesListener.current();\n      }\n    };\n  }, [conversation, currentUser, showError, isTutorial, getMockMessages]);\n\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n\n    if (!newMessage.trim() || isSending) return;\n\n    if (isTutorial) {\n      const mockMessage = {\n        id: `mock-${Date.now()}`,\n        senderId: currentUser?.uid || 'current-user',\n        senderName: currentUser?.displayName || t('messages:status.you'),\n        text: newMessage.trim(),\n        timestamp: { toDate: () => new Date() },\n        status: 'sent',\n        reactions: []\n      };\n      setMessages(prev => [...prev, mockMessage]);\n      setNewMessage('');\n      setTimeout(scrollToBottom, 100);\n      return;\n    }\n\n    setIsSending(true);\n\n    try {\n      const messageData = {\n        senderId: currentUser.uid,\n        text: newMessage.trim(),\n        timestamp: serverTimestamp(),\n        status: 'sent',\n        reactions: []\n      };\n\n      await addDoc(collection(db, 'conversations', conversation.id, 'messages'), messageData);\n\n      setNewMessage('');\n      setTimeout(scrollToBottom, 100);\n    } catch (error) {\n      console.error('Error sending message:', error);\n      showError('Failed to send message');\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage(e);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex items-center justify-center bg-background/50\">\n        <div className=\"flex flex-col items-center gap-3\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent\"></div>\n          <span className=\"text-sm text-muted-foreground\">{t('messages:loading')}</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-background\">\n      {/* HEADER - Sticky at top, NOT scrolling */}\n<div className=\"shrink-0 flex items-center justify-between px-6 py-4 border-b border-border bg-card/95 backdrop-blur-sm min-h-16\">\n  {/* Left: Notification Indicator */}\n  <div className=\"flex items-center justify-center shrink-0 mr-3\">\n    <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\"></div>\n  </div>\n\n  {/* Contact Info */}\n  <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n    {/* Profile Image */}\n    {conversation.photoURL && (\n      <button\n        onClick={() => setShowProfileImage(true)}\n        className=\"shrink-0 w-10 h-10 rounded-full overflow-hidden border-2 border-border hover:border-primary/50 transition-colors cursor-pointer\"\n      >\n        <img\n          src={conversation.photoURL}\n          alt={conversation.displayName || t('messages:status.unknownUser')}\n          className=\"w-full h-full object-cover\"\n        />\n      </button>\n    )}\n    {!conversation.photoURL && (\n      <div className=\"shrink-0 w-10 h-10 rounded-full bg-primary/10 border-2 border-primary/20 flex items-center justify-center\">\n        <FiUser className=\"w-5 h-5 text-primary\" />\n      </div>\n    )}\n\n    {/* Name and Status */}\n    <div className=\"flex-1 min-w-0\">\n      <h3 className=\"text-sm font-semibold text-foreground truncate flex items-center gap-2\" style={{ fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n        {conversation.displayName || t('messages:status.unknownUser')}\n        {messageContext === 'facility' && (\n          <span className=\"px-2 py-0.5 rounded-full text-[10px] font-bold uppercase bg-primary/10 text-primary border border-primary/20 dark:bg-primary/30 dark:text-primary-foreground dark:border-primary/50\">\n            {t('messages:context.facilityLabel')}\n          </span>\n        )}\n      </h3>\n      <p className=\"text-xs text-muted-foreground truncate\" style={{ fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n        {messageContext === 'facility'\n          ? `${t('messages:context.facility')} ${conversation.contractId ? `â€¢ ${t('messages:context.contract')}` : ''}`\n          : t('messages:context.personal')\n        }\n      </p>\n    </div>\n  </div>\n</div >\n\n{/* Profile Image Modal */ }\n{\n  showProfileImage && conversation.photoURL && (\n    <div\n      className=\"fixed inset-0 z-50 bg-black/30 flex items-center justify-center transition-opacity duration-300\"\n      onClick={() => setShowProfileImage(false)}\n    >\n      <div\n        className=\"relative flex items-center justify-center p-8\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <button\n          onClick={() => setShowProfileImage(false)}\n          className=\"absolute -top-2 -right-2 z-10 h-8 w-8 flex items-center justify-center bg-background/90 hover:bg-background border border-border rounded-full transition-colors shadow-lg\"\n        >\n          <FiX className=\"h-4 w-4\" style={{ color: 'var(--text-color)' }} />\n        </button>\n        <div className=\"relative flex items-center justify-center\">\n          <img\n            src={conversation.photoURL}\n            alt={conversation.displayName || 'User'}\n            className=\"w-48 h-48 object-cover rounded-full border-4 border-background shadow-xl\"\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n\n{/* MESSAGES AREA - This scrolls, NOT the parent div */ }\n      <style>{`\n        @keyframes textAppear {\n          from {\n            opacity: 0;\n            transform: translateY(4px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        .message-text-animate {\n          animation: textAppear 0.4s ease-out forwards;\n          opacity: 0;\n        }\n        .message-bubble-animate {\n          animation: textAppear 0.3s ease-out forwards;\n          opacity: 0;\n        }\n      `}</style>\n      <div\n        ref={messagesContainerRef}\n        className=\"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar bg-muted/10\"\n        style={{ scrollbarGutter: 'stable' }}\n      >\n        <div className=\"w-full px-6 py-6\">\n          {messages.length === 0 ? (\n            <div className=\"h-full min-h-[400px] flex flex-col items-center justify-center text-center\">\n              <div className=\"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center mb-4\">\n                <FiSend className=\"w-8 h-8 text-primary/60\" />\n              </div>\n              <h4 className=\"text-base font-semibold text-foreground mb-2\" style={{ margin: 0 }}>{t('messages:empty.noMessagesInChat')}</h4>\n              <p className=\"text-sm text-muted-foreground max-w-xs\" style={{ margin: 0 }}>\n                {t('messages:empty.startChatting')}\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              {messages.map((message, index) => {\n                const isCurrentUser = message.senderId === (currentUser?.uid || 'current-user');\n                const showDateHeader = index === 0 ||\n                  (new Date(message.timestamp?.toDate()).toDateString() !==\n                    new Date(messages[index - 1].timestamp?.toDate()).toDateString());\n                const isSameSender = index > 0 && messages[index - 1].senderId === message.senderId;\n\n                return (\n                  <React.Fragment key={message.id}>\n                    {/* Date Header */}\n                    {showDateHeader && message.timestamp && (\n                      <div className=\"flex items-center justify-center py-4\">\n                        <div className=\"px-3 py-1 rounded-full bg-muted/60 text-xs font-medium text-muted-foreground\">\n                          {new Date(message.timestamp.toDate()).toLocaleDateString(undefined, {\n                            weekday: 'long',\n                            year: 'numeric',\n                            month: 'long',\n                            day: 'numeric'\n                          })}\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Message Bubble */}\n                    <div className={cn(\n                      \"flex gap-3 items-end w-full\",\n                      isCurrentUser ? \"justify-end\" : \"justify-start\",\n                      !isSameSender && \"mt-4\"\n                    )}>\n                      {/* Avatar for recipient messages - Left side */}\n                      {!isCurrentUser && (\n                        <div className={cn(\n                          \"shrink-0 w-8 h-8 rounded-full bg-muted/30 flex items-center justify-center\",\n                          isSameSender && \"opacity-0\"\n                        )}>\n                          <FiUser className=\"w-4 h-4 text-muted-foreground\" />\n                        </div>\n                      )}\n\n                      {/* Message content */}\n                      <div className={cn(\n                        \"flex flex-col gap-1.5 max-w-[70%] message-bubble-animate\",\n                        isCurrentUser ? \"items-end\" : \"items-start\"\n                      )} style={{ animationDelay: `${index * 0.05}s` }}>\n                        {/* Sender name for recipient messages */}\n                        {!isCurrentUser && !isSameSender && (\n                          <span className=\"text-xs font-medium text-muted-foreground px-1\">\n                            {message.senderName || conversation.displayName || t('messages:status.unknownUser')}\n                          </span>\n                        )}\n\n                        <div className={cn(\n                          \"px-4 py-3 rounded-2xl shadow-sm\",\n                          isCurrentUser\n                            ? \"bg-primary text-primary-foreground rounded-br-sm\"\n                            : \"bg-muted/50 text-foreground border border-border/50 rounded-bl-sm\"\n                        )}>\n                          <p className={cn(\n                            \"text-sm leading-relaxed whitespace-pre-wrap break-words message-text-animate\",\n                            isCurrentUser ? \"text-primary-foreground\" : \"text-foreground\"\n                          )} style={{ margin: 0, animationDelay: `${index * 0.05 + 0.1}s` }}>\n                            {message.text}\n                          </p>\n                        </div>\n\n                        {/* Timestamp */}\n                        <span className={cn(\n                          \"text-xs text-muted-foreground px-1\",\n                          isCurrentUser ? \"text-right\" : \"text-left\"\n                        )}>\n                          {message.timestamp?.toDate\n                            ? new Date(message.timestamp.toDate()).toLocaleTimeString(undefined, {\n                              hour: '2-digit',\n                              minute: '2-digit'\n                            })\n                            : t('messages:status.sending')}\n                        </span>\n                      </div>\n\n                      {/* Avatar for current user messages - Right side */}\n                      {isCurrentUser && (\n                        <div className={cn(\n                          \"shrink-0 w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center\",\n                          isSameSender && \"opacity-0\"\n                        )}>\n                          <FiUser className=\"w-4 h-4 text-primary\" />\n                        </div>\n                      )}\n                    </div>\n                  </React.Fragment>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n\n{/* INPUT AREA - Fixed at bottom, NOT scrolling */ }\n<div className=\"shrink-0 px-4 py-3 border-t border-border bg-card/95 backdrop-blur-sm\">\n  <style>{`\n          .message-textarea::-webkit-scrollbar {\n            display: none;\n          }\n          .message-textarea {\n            -ms-overflow-style: none;\n            scrollbar-width: none;\n          }\n        `}</style>\n  <form onSubmit={handleSendMessage} className=\"w-full\">\n    <div className=\"flex items-start gap-2\">\n      {/* Text Input */}\n      <div className=\"flex-1 relative\">\n        <textarea\n          value={newMessage}\n          onChange={(e) => setNewMessage(e.target.value)}\n          onKeyPress={handleKeyPress}\n          placeholder={t('messages:placeholders.typeMessage')}\n          rows={1}\n          className=\"message-textarea w-full resize-none px-3 py-2 rounded-lg border border-input bg-background text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring transition-all overflow-y-auto\"\n          disabled={isSending}\n          style={{\n            height: '36px',\n            minHeight: '36px',\n            maxHeight: '120px',\n            fontFamily: 'var(--font-family-text, Roboto, sans-serif)',\n            lineHeight: '1.5',\n            margin: 0\n          }}\n          onInput={(e) => {\n            e.target.style.height = 'auto';\n            e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';\n            if (e.target.scrollHeight <= 36) {\n              e.target.style.height = '36px';\n            }\n          }}\n        />\n      </div>\n\n      {/* Send Button */}\n      <button\n        type=\"submit\"\n        disabled={!newMessage.trim() || isSending}\n        className={cn(\n          \"shrink-0 w-9 h-9 flex items-center justify-center rounded-lg transition-all\",\n          \"bg-primary text-primary-foreground shadow-sm hover:shadow-md\",\n          \"disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none\",\n          \"hover:scale-105 active:scale-95\"\n        )}\n        title={t('messages:conversation.sendMessage')}\n        style={{ margin: 0, marginTop: '2px' }}\n      >\n        {isSending ? (\n          <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n        ) : (\n          <FiSend className=\"w-4 h-4\" />\n        )}\n      </button>\n    </div>\n  </form>\n</div>\n    </div >\n  );\n};\n\nConversationView.propTypes = {\n  conversation: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    photoURL: PropTypes.string,\n    displayName: PropTypes.string,\n    contractId: PropTypes.string\n  }).isRequired,\n  currentUser: PropTypes.shape({\n    uid: PropTypes.string.isRequired\n  }).isRequired,\n  messageContext: PropTypes.string,\n  workspaceContext: PropTypes.object,\n  isTutorial: PropTypes.bool\n};\n\nexport default ConversationView;","import { db, auth } from './firebase';\nimport { \n  collection, \n  doc, \n  getDoc, \n  getDocs, \n  addDoc, \n  updateDoc, \n  query, \n  where, \n  orderBy, \n  serverTimestamp,\n  Timestamp,\n  arrayUnion\n} from 'firebase/firestore';\n\nconst messagesService = {\n  /**\n   * Get all conversations for the current user\n   */\n  getConversations: async () => {\n    try {\n      const currentUser = auth.currentUser;\n      if (!currentUser) {\n        throw new Error('No authenticated user');\n      }\n\n      // Query conversations where the current user is a participant\n      // Use new structure (participantIds) with backward compatibility\n      const conversationsRef = collection(db, 'conversations');\n      const q = query(\n        conversationsRef,\n        where('participantIds', 'array-contains', currentUser.uid),\n        orderBy('lastMessageTimestamp', 'desc')\n      );\n\n      const snapshot = await getDocs(q);\n      const conversations = [];\n\n      // For each conversation, use participantInfo from the document\n      for (const convDoc of snapshot.docs) {\n        const convData = convDoc.data();\n        \n        // Use participantInfo if available (new structure), otherwise fetch from users collection\n        let participantsDetails = [];\n        \n        if (convData.participantInfo && Array.isArray(convData.participantInfo)) {\n          // New structure: use participantInfo directly\n          participantsDetails = convData.participantInfo.filter(\n            participant => participant.userId !== currentUser.uid\n          );\n        } else {\n          // Backward compatibility: fetch participant details\n          const participantIds = convData.participantIds || convData.participants || [];\n          for (const participantId of participantIds) {\n            if (participantId !== currentUser.uid) {\n              const userDocRef = doc(db, 'users', participantId);\n              const userDoc = await getDoc(userDocRef);\n              if (userDoc.exists()) {\n                participantsDetails.push({\n                  userId: userDoc.id,\n                  displayName: userDoc.data().displayName || 'Unknown User',\n                  photoURL: userDoc.data().photoURL\n                });\n              }\n            }\n          }\n        }\n\n        conversations.push({\n          id: convDoc.id,\n          ...convData,\n          participantInfo: convData.participantInfo || participantsDetails,\n          lastUpdated: convData.lastMessageTimestamp?.toDate() || convData.updatedAt?.toDate() || new Date()\n        });\n      }\n\n      return conversations;\n    } catch (error) {\n      console.error('Error fetching conversations:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get a single conversation by ID\n   * @param {string} conversationId - Conversation ID\n   */\n  getConversation: async (conversationId) => {\n    try {\n      const conversationRef = doc(db, 'conversations', conversationId);\n      const conversationDoc = await getDoc(conversationRef);\n\n      if (!conversationDoc.exists()) {\n        throw new Error('Conversation not found');\n      }\n\n      return {\n        id: conversationDoc.id,\n        ...conversationDoc.data()\n      };\n    } catch (error) {\n      console.error(`Error fetching conversation ${conversationId}:`, error);\n      throw error;\n    }\n  },\n\n  /**\n   * Create a new conversation\n   * @param {Object} conversationData - Conversation data\n   */\n  createConversation: async (conversationData) => {\n    try {\n      const currentUser = auth.currentUser;\n      if (!currentUser) {\n        throw new Error('No authenticated user');\n      }\n\n      // SECURITY CHECK: Ensure user is in participantIds\n      const participantIds = conversationData.participantIds || conversationData.participants || [];\n      if (!participantIds.includes(currentUser.uid)) {\n        throw new Error('You must be a participant in the conversation');\n      }\n      \n      // Ensure participantIds array is unique\n      const uniqueParticipantIds = [...new Set(participantIds)];\n      \n      // Prepare conversation data with new structure\n      const newConversationData = {\n        participantIds: uniqueParticipantIds,\n        participantInfo: conversationData.participantInfo || [],\n        contractId: conversationData.contractId || null,\n        facilityProfileId: conversationData.facilityProfileId || null,\n        professionalProfileId: conversationData.professionalProfileId || null,\n        lastMessage: {\n          text: '',\n          senderId: '',\n          timestamp: serverTimestamp()\n        },\n        lastMessageTimestamp: serverTimestamp(),\n        unreadCounts: uniqueParticipantIds.reduce((acc, id) => {\n          acc[id] = 0;\n          return acc;\n        }, {}),\n        isArchivedBy: [],\n        typingIndicator: uniqueParticipantIds.reduce((acc, id) => {\n          acc[id] = false;\n          return acc;\n        }, {}),\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n        createdBy: currentUser.uid\n      };\n\n      const conversationRef = collection(db, 'conversations');\n      const docRef = await addDoc(conversationRef, newConversationData);\n\n      // Get the newly created conversation\n      const newConversation = await getDoc(docRef);\n      return {\n        id: docRef.id,\n        ...newConversation.data()\n      };\n    } catch (error) {\n      console.error('Error creating conversation:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get messages for a conversation\n   * @param {string} conversationId - Conversation ID\n   */\n  getMessages: async (conversationId) => {\n    try {\n      const messagesRef = collection(db, 'conversations', conversationId, 'messages');\n      const q = query(messagesRef, orderBy('timestamp', 'asc'));\n      const snapshot = await getDocs(q);\n\n      const messages = [];\n      snapshot.forEach(doc => {\n        const data = doc.data();\n        messages.push({\n          id: doc.id,\n          ...data,\n          timestamp: data.timestamp?.toDate() || new Date()\n        });\n      });\n\n      return messages;\n    } catch (error) {\n      console.error(`Error fetching messages for conversation ${conversationId}:`, error);\n      throw error;\n    }\n  },\n\n  /**\n   * Send a message in a conversation\n   * @param {string} conversationId - Conversation ID\n   * @param {Object} messageData - Message data\n   */\n  sendMessage: async (conversationId, messageData) => {\n    try {\n      const currentUser = auth.currentUser;\n      if (!currentUser) {\n        throw new Error('No authenticated user');\n      }\n\n      // Check if conversation exists\n      const conversationRef = doc(db, 'conversations', conversationId);\n      const conversationDoc = await getDoc(conversationRef);\n\n      if (!conversationDoc.exists()) {\n        throw new Error('Conversation not found');\n      }\n\n      // SECURITY CHECK: Verify user is a participant\n      const conversationData = conversationDoc.data();\n      const isParticipant = conversationData.participantIds?.includes(currentUser.uid) || \n                            conversationData.participants?.includes(currentUser.uid);\n      \n      if (!isParticipant) {\n        throw new Error('Not authorized to send message to this conversation');\n      }\n\n      // Add message to the conversation\n      const messagesRef = collection(db, 'conversations', conversationId, 'messages');\n      const timestamp = Timestamp.now();\n      \n      const messageRef = await addDoc(messagesRef, {\n        ...messageData,\n        senderId: currentUser.uid,\n        timestamp,\n        read: false\n      });\n\n      // Update conversation with last message info\n      const participantIds = conversationData.participantIds || conversationData.participants || [];\n      const updateData = {\n        lastMessage: {\n          text: messageData.text,\n          senderId: currentUser.uid,\n          timestamp\n        },\n        lastMessageTimestamp: timestamp,\n        updatedAt: serverTimestamp()\n      };\n      \n      // Update unreadCounts (new structure)\n      if (conversationData.unreadCounts) {\n        const unreadCounts = { ...conversationData.unreadCounts };\n        participantIds.forEach(id => {\n          if (id !== currentUser.uid) {\n            unreadCounts[id] = (unreadCounts[id] || 0) + 1;\n          }\n        });\n        updateData.unreadCounts = unreadCounts;\n      } else {\n        // Backward compatibility with old structure\n        updateData.unreadBy = arrayUnion(...participantIds.filter(id => id !== currentUser.uid));\n      }\n      \n      await updateDoc(conversationRef, updateData);\n\n      // Get the newly created message\n      const newMessage = await getDoc(messageRef);\n      return {\n        id: messageRef.id,\n        ...newMessage.data(),\n        timestamp: newMessage.data().timestamp.toDate()\n      };\n    } catch (error) {\n      console.error(`Error sending message in conversation ${conversationId}:`, error);\n      throw error;\n    }\n  },\n\n  /**\n   * Mark messages as read\n   * @param {string} conversationId - Conversation ID\n   */\n  markAsRead: async (conversationId) => {\n    try {\n      const currentUser = auth.currentUser;\n      if (!currentUser) {\n        throw new Error('No authenticated user');\n      }\n\n      // Get the conversation\n      const conversationRef = doc(db, 'conversations', conversationId);\n      const conversationDoc = await getDoc(conversationRef);\n\n      if (!conversationDoc.exists()) {\n        throw new Error('Conversation not found');\n      }\n\n      const conversationData = conversationDoc.data();\n      \n      // SECURITY CHECK: Verify user is a participant\n      const isParticipant = conversationData.participantIds?.includes(currentUser.uid) || \n                            conversationData.participants?.includes(currentUser.uid);\n      \n      if (!isParticipant) {\n        throw new Error('Not authorized to access this conversation');\n      }\n      \n      // Handle both old structure (unreadBy array) and new structure (unreadCounts object)\n      if (conversationData.unreadCounts) {\n        // New structure - set current user's unread count to 0\n        const unreadCounts = { ...conversationData.unreadCounts };\n        unreadCounts[currentUser.uid] = 0;\n        await updateDoc(conversationRef, { unreadCounts });\n      } else if (conversationData.unreadBy) {\n        // Old structure - remove current user from unreadBy array\n        const unreadBy = (conversationData.unreadBy || []).filter(id => id !== currentUser.uid);\n        await updateDoc(conversationRef, { unreadBy });\n      }\n\n      return { success: true };\n    } catch (error) {\n      console.error(`Error marking conversation ${conversationId} as read:`, error);\n      throw error;\n    }\n  }\n};\n\nexport default messagesService; ","import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { collection, query, where, orderBy, onSnapshot } from 'firebase/firestore';\nimport { db } from '../../../services/firebase';\nimport { useDashboard } from '../../contexts/DashboardContext';\nimport { useMobileView } from '../../hooks/useMobileView';\nimport { usePageMobile } from '../../contexts/PageMobileContext';\nimport { WORKSPACE_TYPES } from '../../../utils/sessionAuth';\nimport ConversationsList from './components/ConversationsList';\nimport ConversationView from './components/ConversationView';\nimport LoadingSpinner from '../../../components/LoadingSpinner/LoadingSpinner';\nimport EmptyState from '../../components/EmptyState/EmptyState';\nimport { useNotification } from '../../../contexts/NotificationContext';\nimport messagesService from '../../../services/messagesService';\nimport { cn } from '../../../utils/cn';\nimport { FiMessageSquare, FiSearch, FiX, FiSliders } from 'react-icons/fi';\nimport { useTutorial } from '../../contexts/TutorialContext';\n\nconst MESSAGE_CONTEXTS = {\n  PERSONAL: 'personal',\n  FACILITY: 'facility'\n};\n\nconst Messages = () => {\n  const { t } = useTranslation(['messages']);\n  const { showError } = useNotification();\n  const { user, selectedWorkspace } = useDashboard();\n  const isMobile = useMobileView();\n  const pageMobileContext = usePageMobile();\n  const setPageMobileStateRef = useRef(pageMobileContext?.setPageMobileState || (() => { }));\n  const { isTutorialActive, activeTutorial } = useTutorial();\n\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [unreadOnly, setUnreadOnly] = useState(false);\n  const [dateRange, setDateRange] = useState('');\n  const [showSidebar, setShowSidebar] = useState(true);\n  const [showFiltersOverlay, setShowFiltersOverlay] = useState(false);\n  const [readConversationIds, setReadConversationIds] = useState(new Set());\n  const conversationsListener = useRef(null);\n\n  const getUserRole = useMemo(() => {\n    if (!selectedWorkspace || !user) return null;\n    if (selectedWorkspace.type === WORKSPACE_TYPES.PERSONAL) return 'personal';\n    if (selectedWorkspace.type === WORKSPACE_TYPES.TEAM) return selectedWorkspace.role || 'employee';\n    return null;\n  }, [selectedWorkspace, user]);\n\n  const canAccessFacilityMessages = useMemo(() => {\n    if (!selectedWorkspace || selectedWorkspace.type !== WORKSPACE_TYPES.TEAM) return false;\n    const role = getUserRole;\n    return role && role !== 'employee';\n  }, [selectedWorkspace, getUserRole]);\n\n  useEffect(() => {\n    if (!user || !selectedWorkspace) {\n      setConversations([]);\n      setIsLoading(false);\n      return;\n    }\n\n    const fetchConversations = async () => {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        let conversationsQuery;\n        const conversationsRef = collection(db, 'conversations');\n        const activeTab = MESSAGE_CONTEXTS.PERSONAL;\n\n        if (activeTab === MESSAGE_CONTEXTS.PERSONAL) {\n          conversationsQuery = query(\n            conversationsRef,\n            where('participantIds', 'array-contains', user.uid),\n            orderBy('lastMessageTimestamp', 'desc')\n          );\n        } else if (activeTab === MESSAGE_CONTEXTS.FACILITY && canAccessFacilityMessages) {\n          conversationsQuery = query(\n            conversationsRef,\n            where('facilityProfileId', '==', selectedWorkspace.facilityId),\n            orderBy('lastMessageTimestamp', 'desc')\n          );\n        } else {\n          setConversations([]);\n          setIsLoading(false);\n          return;\n        }\n\n        if (conversationsListener.current) conversationsListener.current();\n\n        conversationsListener.current = onSnapshot(\n          conversationsQuery,\n          async (snapshot) => {\n            const conversationsList = [];\n            snapshot.docs.forEach(doc => {\n              const conversationData = doc.data();\n              let displayInfo = {};\n              const activeTab = MESSAGE_CONTEXTS.PERSONAL;\n              if (activeTab === MESSAGE_CONTEXTS.PERSONAL) {\n                const otherParticipant = conversationData.participantInfo?.find(p => p.userId !== user.uid);\n                if (otherParticipant) {\n                  displayInfo = {\n                    displayName: otherParticipant.displayName,\n                    photoURL: otherParticipant.photoURL,\n                    role: otherParticipant.roleInConversation,\n                    otherParticipant\n                  };\n                }\n              } else if (activeTab === MESSAGE_CONTEXTS.FACILITY) {\n                const professionalParticipant = conversationData.participantInfo?.find(p => p.roleInConversation === 'professional');\n                if (professionalParticipant) {\n                  displayInfo = {\n                    displayName: `${professionalParticipant.displayName} (Professional)`,\n                    photoURL: professionalParticipant.photoURL,\n                    role: 'professional',\n                    contractId: conversationData.contractId\n                  };\n                } else {\n                  displayInfo = {\n                    displayName: 'Facility Conversation',\n                    photoURL: null,\n                    role: 'facility',\n                    contractId: conversationData.contractId\n                  };\n                }\n              }\n              conversationsList.push({ id: doc.id, ...conversationData, ...displayInfo });\n            });\n\n            conversationsList.sort((a, b) => {\n              const aTime = a.lastMessageTimestamp?.toDate?.() || new Date(0);\n              const bTime = b.lastMessageTimestamp?.toDate?.() || new Date(0);\n              return bTime - aTime;\n            });\n\n            setConversations(conversationsList);\n            setIsLoading(false);\n          },\n          (err) => {\n            console.error('Error listening to conversations:', err);\n            setError(err);\n            showError(t('errors.loadingConversations', 'Failed to load conversations'));\n            setIsLoading(false);\n          }\n        );\n      } catch (err) {\n        console.error('Error setting up conversations listener:', err);\n        setError(err);\n        showError(t('errors.loadingConversations', 'Failed to load conversations'));\n        setIsLoading(false);\n      }\n    };\n\n    fetchConversations();\n    return () => {\n      if (conversationsListener.current) conversationsListener.current();\n    };\n  }, [user, selectedWorkspace, canAccessFacilityMessages, t, showError]);\n\n  useEffect(() => {\n    const setPageMobileState = setPageMobileStateRef.current;\n    if (!setPageMobileState || typeof setPageMobileState !== 'function') {\n      return;\n    }\n    if (isMobile) {\n      const handleBack = () => {\n        setSelectedConversation(null);\n        setShowSidebar(true);\n      };\n      setPageMobileState(!!selectedConversation, handleBack);\n    } else {\n      setPageMobileState(false, null);\n    }\n  }, [isMobile, selectedConversation]);\n\n  const getMockConversations = useCallback(() => {\n    if (!isTutorialActive || activeTutorial !== 'messages') return [];\n    \n    const now = new Date();\n    const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60 * 1000);\n    const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    \n    return [\n      {\n        id: 'tutorial-doctor-smith',\n        displayName: t('messages:tutorial.doctorName'),\n        photoURL: null,\n        lastMessage: { text: t('messages:tutorial.doctorMessage') },\n        lastMessageTimestamp: { toDate: () => twoHoursAgo },\n        createdAt: { toDate: () => new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000) },\n        unreadCount: 1,\n        participantIds: [user?.uid || 'current-user', 'tutorial-doctor'],\n        participantInfo: [\n          { userId: user?.uid || 'current-user', displayName: user?.displayName || 'You', roleInConversation: 'professional' },\n          { userId: 'tutorial-doctor', displayName: t('messages:tutorial.doctorName'), roleInConversation: 'professional' }\n        ],\n        isTutorial: true\n      },\n      {\n        id: 'tutorial-lausanne-clinic',\n        displayName: t('messages:tutorial.hospitalName'),\n        photoURL: null,\n        lastMessage: { text: t('messages:tutorial.hospitalMessage') },\n        lastMessageTimestamp: { toDate: () => oneDayAgo },\n        createdAt: { toDate: () => new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000) },\n        unreadCount: 0,\n        participantIds: [user?.uid || 'current-user', 'tutorial-hospital'],\n        participantInfo: [\n          { userId: user?.uid || 'current-user', displayName: user?.displayName || 'You', roleInConversation: 'professional' },\n          { userId: 'tutorial-hospital', displayName: t('messages:tutorial.hospitalName'), roleInConversation: 'facility' }\n        ],\n        isTutorial: true\n      }\n    ];\n  }, [isTutorialActive, activeTutorial, user, t]);\n\n  useEffect(() => {\n    if (selectedConversation?.isTutorial) {\n      if (!isTutorialActive || activeTutorial !== 'messages') {\n        setSelectedConversation(null);\n        if (isMobile) {\n          setShowSidebar(true);\n        }\n        return;\n      }\n      const mockConversations = getMockConversations();\n      const stillExists = mockConversations.some(c => c.id === selectedConversation.id);\n      if (!stillExists) {\n        setSelectedConversation(null);\n        if (isMobile) {\n          setShowSidebar(true);\n        }\n      }\n    }\n  }, [isTutorialActive, activeTutorial, selectedConversation, isMobile, getMockConversations]);\n\n  const filterConversations = useCallback((conversationsList) => {\n    let filtered = [...conversationsList];\n\n    if (searchTerm) {\n      const searchLower = searchTerm.toLowerCase();\n      filtered = filtered.filter(conv =>\n        conv.displayName?.toLowerCase().includes(searchLower) ||\n        conv.lastMessage?.text?.toLowerCase().includes(searchLower)\n      );\n    }\n\n    if (unreadOnly) {\n      filtered = filtered.filter(conv => conv.unreadCount > 0);\n    }\n\n    if (dateRange) {\n      const now = new Date();\n      let cutoffDate = new Date();\n      switch (dateRange) {\n        case 'last-week':\n          cutoffDate.setDate(now.getDate() - 7);\n          break;\n        case 'last-month':\n          cutoffDate.setMonth(now.getMonth() - 1);\n          break;\n        case 'last-3-months':\n          cutoffDate.setMonth(now.getMonth() - 3);\n          break;\n        case 'last-year':\n          cutoffDate.setFullYear(now.getFullYear() - 1);\n          break;\n        default:\n          cutoffDate = new Date(0);\n      }\n      filtered = filtered.filter(conv => {\n        const lastMessageDate = conv.lastMessageTimestamp?.toDate?.() || new Date(0);\n        return lastMessageDate >= cutoffDate;\n      });\n    }\n\n    return filtered;\n  }, [searchTerm, unreadOnly, dateRange]);\n\n  const allConversations = useMemo(() => {\n    const mockConversations = getMockConversations();\n    const all = mockConversations.length > 0 && conversations.length === 0 ? mockConversations : conversations;\n    return all.map(conv => {\n      if (readConversationIds.has(conv.id)) {\n        return { ...conv, unreadCount: 0 };\n      }\n      return conv;\n    });\n  }, [conversations, getMockConversations, readConversationIds]);\n\n  const filteredConversations = useMemo(() => filterConversations(allConversations), [allConversations, filterConversations]);\n\n  const handleSelectConversation = useCallback(async (conversationId) => {\n    const conversation = allConversations.find(c => c.id === conversationId);\n    if (conversation) {\n      setSelectedConversation(conversation);\n      setReadConversationIds(prev => new Set([...prev, conversationId]));\n      if (isMobile) {\n        setShowSidebar(false);\n      }\n      if (user && !conversation.isTutorial) {\n        try {\n          await messagesService.markAsRead(conversationId);\n        } catch (error) {\n          console.error('Error marking conversation as read:', error);\n        }\n      }\n    }\n  }, [allConversations, user, isMobile]);\n\n  const unreadCount = useMemo(() => filteredConversations.filter(c => c.unreadCount > 0).length, [filteredConversations]);\n\n  if (isLoading && conversations.length === 0 && (!isTutorialActive || activeTutorial !== 'messages')) return <LoadingSpinner />;\n\n  if (error) {\n    return (\n      <EmptyState\n        title={t('errors.title')}\n        description={t('errors.description')}\n        actionText={t('errors.retry')}\n        onAction={() => window.location.reload()}\n      />\n    );\n  }\n\n  return (\n    <div className={cn(\n      \"h-full flex flex-col overflow-hidden animate-in fade-in duration-500\",\n      isMobile && \"overflow-y-hidden\"\n    )}>\n      {/* Page Top Bar - Search and Filters Only (Title in main header) */}\n      <div className={cn(\n        \"shrink-0 w-full z-20 bg-card/95 backdrop-blur-sm border-b border-border shadow-sm h-16\",\n        isMobile ? \"px-4\" : \"px-6\"\n      )}>\n        {isMobile ? (\n          <div className=\"flex items-center gap-2 h-full\">\n            <div className=\"flex-1 relative\">\n              <FiSearch className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none\" />\n                <input\n                  type=\"text\"\n                  placeholder={t('messages:searchPlaceholder')}\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"w-full h-9 pl-9 pr-20 rounded-lg border border-input bg-background text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring transition-all\"\n                />\n              <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1\">\n                {searchTerm && (\n                  <button\n                    onClick={() => setSearchTerm('')}\n                    className=\"p-1.5 hover:bg-muted rounded-full transition-colors\"\n                  >\n                    <FiX className=\"w-4 h-4 text-muted-foreground\" />\n                  </button>\n                )}\n                <button\n                  onClick={() => setShowFiltersOverlay(true)}\n                  className={cn(\n                    \"p-1.5 rounded-full transition-colors relative\",\n                    (unreadOnly || dateRange) ? \"bg-primary/10 text-primary\" : \"hover:bg-muted text-muted-foreground\"\n                  )}\n                >\n                  <FiSliders className=\"w-4 h-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"flex items-center gap-3 h-full\">\n            {/* Search and Filters */}\n            <div className=\"flex-1 flex items-center gap-3\">\n              {/* Search Input */}\n              <div className=\"flex-1 relative\">\n                <FiSearch className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none\" />\n              <input\n                type=\"text\"\n                placeholder={t('messages:searchPlaceholder')}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full h-9 pl-9 pr-8 rounded-lg border border-input bg-background text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring transition-all\"\n              />\n                {searchTerm && (\n                  <button\n                    onClick={() => setSearchTerm('')}\n                    className=\"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-muted rounded-full transition-colors\"\n                  >\n                    <FiX className=\"w-3.5 h-3.5 text-muted-foreground\" />\n                  </button>\n                )}\n              </div>\n\n              {/* Filter: Message Type */}\n              <select\n                value={unreadOnly ? 'unread' : 'all'}\n                onChange={(e) => setUnreadOnly(e.target.value === 'unread')}\n                className=\"h-9 px-3 rounded-lg border border-input bg-background text-xs font-medium focus:outline-none focus:ring-2 focus:ring-ring transition-all shrink-0 min-w-[120px]\"\n              >\n                <option value=\"all\">{t('messages:filters.all')}</option>\n                <option value=\"unread\">{t('messages:filters.unreadOnly')}</option>\n              </select>\n\n              {/* Filter: Date Range */}\n              <select\n                value={dateRange}\n                onChange={(e) => setDateRange(e.target.value)}\n                className=\"h-9 px-3 rounded-lg border border-input bg-background text-xs font-medium focus:outline-none focus:ring-2 focus:ring-ring transition-all shrink-0 min-w-[120px]\"\n              >\n                <option value=\"\">{t('messages:filters.date.all')}</option>\n                <option value=\"last-week\">{t('messages:filters.date.lastWeek')}</option>\n                <option value=\"last-month\">{t('messages:filters.date.lastMonth')}</option>\n                <option value=\"last-3-months\">{t('messages:filters.date.last3Months')}</option>\n                <option value=\"last-year\">{t('messages:filters.date.lastYear')}</option>\n              </select>\n            </div>\n\n            {/* Right: Unread Count */}\n            {unreadCount > 0 && (\n              <div className=\"shrink-0 flex items-center gap-2 px-3 py-1.5 bg-destructive/10 rounded-lg border border-destructive/20\">\n                <span className=\"text-xs font-medium text-muted-foreground m-0\">{t('messages:unread')}</span>\n                <span className=\"text-sm font-bold text-destructive m-0\">{unreadCount}</span>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* 2. Main Split Content */}\n      <div className={cn(\n        \"flex-1 flex overflow-hidden min-h-0 relative\",\n        isMobile ? \"p-0\" : \"p-4 gap-4\"\n      )}>\n        {/* Left: Conversations List Sidebar (No search/filters, just list) */}\n        <div className={cn(\n          \"flex flex-col transition-all duration-300 shrink-0\",\n          isMobile\n            ? cn(\n              \"absolute inset-0 z-10 bg-background overflow-y-auto\",\n              showSidebar ? \"translate-x-0\" : \"-translate-x-full\"\n            )\n            : \"w-full md:w-[320px] lg:w-[360px] pr-0 overflow-hidden\"\n        )}>\n          {/* Sidebar Container - Just the conversation list */}\n          <div className={cn(\n            \"flex-1 flex flex-col bg-card/60 backdrop-blur-sm border border-border shadow-sm overflow-hidden\",\n            isMobile ? \"rounded-none border-0\" : \"rounded-xl\"\n          )}>\n            {/* Conversations List */}\n            {filteredConversations.length === 0 ? (\n              <div className=\"flex-1 flex flex-col items-center justify-center gap-4 text-center\">\n                <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\n                  <FiMessageSquare className=\"w-8 h-8\" style={{ color: 'var(--primary-color)' }} />\n                </div>\n                <p className=\"text-sm font-medium\" style={{ color: 'var(--text-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n                  {searchTerm || unreadOnly || dateRange ? t('messages:empty.noMessagesFound') : t('messages:empty.noConversationsYet')}\n                </p>\n                <p className=\"text-xs\" style={{ color: 'var(--text-light-color)', fontFamily: 'var(--font-family-text, Roboto, sans-serif)', margin: 0 }}>\n                  {searchTerm || unreadOnly || dateRange ? t('messages:empty.adjustFilters') : t('messages:empty.startConversation')}\n                </p>\n              </div>\n            ) : (\n              <div className=\"flex-1 overflow-y-auto\" style={{ scrollbarGutter: 'stable' }}>\n                <ConversationsList\n                  conversations={filteredConversations}\n                  selectedConversationId={selectedConversation?.id}\n                  onSelectConversation={handleSelectConversation}\n                  messageContext={MESSAGE_CONTEXTS.PERSONAL}\n                  currentUserId={user?.uid}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Right: Content Area (Conversation View) - FIXED HEIGHT with internal scroll */}\n        <div className={cn(\n          \"flex-1 flex flex-col bg-transparent relative min-w-0 min-h-0 transition-transform duration-300\",\n          isMobile && selectedConversation ? \"translate-x-0 overflow-y-auto absolute inset-0 z-20\" : \"overflow-y-auto\"\n        )}>\n          {selectedConversation ? (\n            <div className={cn(\n              \"h-full w-full bg-card/60 backdrop-blur-sm border border-border shadow-sm overflow-hidden\",\n              isMobile ? \"rounded-none border-0\" : \"rounded-xl\"\n            )}>\n              <ConversationView\n                conversation={selectedConversation}\n                currentUser={user}\n                messageContext={MESSAGE_CONTEXTS.PERSONAL}\n                workspaceContext={selectedWorkspace}\n                isTutorial={selectedConversation?.isTutorial}\n              />\n            </div>\n          ) : (\n            <div className=\"w-full flex flex-col items-center justify-center p-8 text-center z-0 min-h-[400px]\">\n              <div className=\"max-w-md w-full bg-card p-8 rounded-2xl border border-border/50 shadow-lg backdrop-blur-sm animate-in fade-in zoom-in-95 duration-500 mx-auto\">\n                <div className=\"w-16 h-16 mx-auto rounded-full bg-muted/50 flex items-center justify-center mb-6 ring-4 ring-background\">\n                  <FiMessageSquare className=\"text-muted-foreground w-8 h-8\" />\n                </div>\n                <h2 className=\"text-xl font-bold text-foreground mb-2\">{t('messages:selectConversation.title')}</h2>\n                <p className=\"text-muted-foreground mb-6\">\n                  {t('messages:selectConversation.subtitle')}\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Messages;","import React from 'react';\r\n\r\nconst EmptyState = ({ title, description, actionText, onAction, icon }) => {\r\n  return (\r\n    <div className=\"empty-state\">\r\n      {icon && <div className=\"empty-state-icon\">{icon}</div>}\r\n      <h3 className=\"empty-state-title\">{title}</h3>\r\n      {description && <p className=\"empty-state-description\">{description}</p>}\r\n      {actionText && onAction && (\r\n        <button className=\"empty-state-action\" onClick={onAction}>\r\n          {actionText}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmptyState; \r\n","import { useState, useEffect } from 'react';\n\nexport const useMobileView = () => {\n  const [isMobile, setIsMobile] = useState(() => {\n    return typeof window !== 'undefined' ? window.innerWidth < 768 : false;\n  });\n\n  useEffect(() => {\n    const handleResize = () => {\n      setIsMobile(window.innerWidth < 768);\n    };\n\n    handleResize();\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return isMobile;\n};\n\nexport default useMobileView;\n\n"],"names":["ConversationItem","_ref","_conversation$lastMes","conversation","isSelected","onClick","t","useTranslation","displayName","lastMessage","text","date","timestamp","toDate","Date","format","error","formatDate","lastMessageTimestamp","createdAt","timeDisplay","diffMs","diffMins","Math","floor","diffHours","diffDays","concat","toLocaleDateString","undefined","month","day","getTimeDisplay","_jsxs","id","className","cn","style","borderLeftColor","children","unreadCount","_jsx","photoURL","src","alt","FiMessageSquare","color","fontFamily","margin","FiChevronRight","_ref2","conversations","selectedConversationId","onSelectConversation","messageContext","currentUserId","length","map","currentUser","workspaceContext","isTutorial","showError","useNotification","messages","setMessages","useState","newMessage","setNewMessage","isLoading","setIsLoading","isSending","setIsSending","showProfileImage","setShowProfileImage","messagesContainerRef","useRef","messagesListener","scrollToBottom","current","scrollTop","scrollHeight","useEffect","getMockMessages","useCallback","now","mockMessages","otherUserId","otherUserName","push","senderId","senderName","getTime","status","reactions","uid","sort","a","b","messagesQuery","query","collection","db","orderBy","onSnapshot","snapshot","messagesList","docs","doc","_objectSpread","data","console","handleSendMessage","async","e","preventDefault","trim","mockMessage","prev","setTimeout","messageData","serverTimestamp","addDoc","FiUser","contractId","stopPropagation","FiX","ref","scrollbarGutter","FiSend","message","index","_message$timestamp","_messages$timestamp","_message$timestamp2","isCurrentUser","showDateHeader","toDateString","isSameSender","React","weekday","year","animationDelay","toLocaleTimeString","hour","minute","onSubmit","value","onChange","target","onKeyPress","key","shiftKey","placeholder","rows","disabled","height","minHeight","maxHeight","lineHeight","onInput","min","type","title","marginTop","getConversations","auth","Error","conversationsRef","q","where","getDocs","convDoc","_convData$lastMessage","_convData$updatedAt","convData","participantsDetails","participantInfo","Array","isArray","filter","participant","userId","participantIds","participants","participantId","userDocRef","userDoc","getDoc","exists","lastUpdated","updatedAt","getConversation","conversationRef","conversationId","conversationDoc","createConversation","conversationData","includes","uniqueParticipantIds","Set","newConversationData","facilityProfileId","professionalProfileId","unreadCounts","reduce","acc","isArchivedBy","typingIndicator","createdBy","docRef","newConversation","getMessages","messagesRef","forEach","_data$timestamp","sendMessage","_conversationData$par","_conversationData$par2","Timestamp","messageRef","read","updateData","unreadBy","arrayUnion","updateDoc","markAsRead","_conversationData$par3","_conversationData$par4","success","MESSAGE_CONTEXTS","Messages","user","selectedWorkspace","useDashboard","isMobile","useMobileView","pageMobileContext","usePageMobile","setPageMobileStateRef","setPageMobileState","isTutorialActive","activeTutorial","useTutorial","setConversations","selectedConversation","setSelectedConversation","setError","searchTerm","setSearchTerm","unreadOnly","setUnreadOnly","dateRange","setDateRange","showSidebar","setShowSidebar","showFiltersOverlay","setShowFiltersOverlay","readConversationIds","setReadConversationIds","conversationsListener","getUserRole","useMemo","WORKSPACE_TYPES","PERSONAL","TEAM","role","canAccessFacilityMessages","conversationsQuery","activeTab","facilityId","conversationsList","displayInfo","otherParticipant","find","p","roleInConversation","professionalParticipant","_a$lastMessageTimesta","_a$lastMessageTimesta2","_b$lastMessageTimesta","_b$lastMessageTimesta2","aTime","call","err","fetchConversations","handleBack","getMockConversations","twoHoursAgo","oneDayAgo","some","c","filterConversations","filtered","searchLower","toLowerCase","conv","_conv$displayName","_conv$lastMessage","_conv$lastMessage$tex","cutoffDate","setDate","getDate","setMonth","getMonth","setFullYear","getFullYear","_conv$lastMessageTime","_conv$lastMessageTime2","allConversations","mockConversations","has","filteredConversations","handleSelectConversation","messagesService","EmptyState","description","actionText","onAction","window","location","reload","FiSearch","FiSliders","ConversationsList","ConversationView","LoadingSpinner","icon","setIsMobile","innerWidth","handleResize","addEventListener","removeEventListener"],"ignoreList":[],"sourceRoot":""}