name: ðŸš§ Deploy to Demo
on:
  push:
    branches: [ develop ] # <--- CHANGED BRANCH

jobs:
  deploy-demo:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. INJECT DEMO CONFIG
      - name: Create Demo Config
        # Uses the DEMO secret so users connect to the fake DB
        run: echo "export const firebaseConfig = ${{ secrets.FIREBASE_CONFIG_DEMO }};" > src/firebaseConfig.js

      # 2. BUILD
      - name: Install & Build
        run: |
          npm ci
          npm run build

      # 3. DEPLOY FRONTEND (To Subfolder)
      - name: ðŸ“‚ Sync to Demo Folder
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./build/
          # ðŸš¨ IMPORTANT: Uploads to the 'demo' subdomain folder
          server-dir: /demo.medishift.cloud/ 

      # 4. DEPLOY BACKEND (To Demo Project)
      - name: ðŸ”¥ Deploy to Firebase Demo
        uses: w9jds/firebase-action@master
        with:
          args: deploy --only functions,firestore
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
          # ðŸš¨ IMPORTANT: Must be your DEMO project ID
          PROJECT_ID: "fir-interimed
"